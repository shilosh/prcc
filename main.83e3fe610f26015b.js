(self.webpackChunkprccapp=self.webpackChunkprccapp||[]).push([[179],{906:(K0,Xh,Yh)=>{"use strict";function ni(e){return"function"==typeof e}function Rp(e){const i=e(n=>{Error.call(n),n.stack=(new Error).stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}const Q0=Rp(e=>function(i){e(this),this.message=i?`${i.length} errors occurred during unsubscription:\n${i.map((n,r)=>`${r+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=i});function m(e,t){if(e){const i=e.indexOf(t);0<=i&&e.splice(i,1)}}class Je{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const s of i)s.remove(this);else i.remove(this);const{initialTeardown:n}=this;if(ni(n))try{n()}catch(s){t=s instanceof Q0?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{En(s)}catch(u){t=t??[],u instanceof Q0?t=[...t,...u.errors]:t.push(u)}}if(t)throw new Q0(t)}}add(t){var i;if(t&&t!==this)if(this.closed)En(t);else{if(t instanceof Je){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(t)}}_hasParent(t){const{_parentage:i}=this;return i===t||Array.isArray(i)&&i.includes(t)}_addParent(t){const{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(t),i):i?[i,t]:t}_removeParent(t){const{_parentage:i}=this;i===t?this._parentage=null:Array.isArray(i)&&m(i,t)}remove(t){const{_finalizers:i}=this;i&&m(i,t),t instanceof Je&&t._removeParent(this)}}Je.EMPTY=(()=>{const e=new Je;return e.closed=!0,e})();const oa=Je.EMPTY;function as(e){return e instanceof Je||e&&"closed"in e&&ni(e.remove)&&ni(e.add)&&ni(e.unsubscribe)}function En(e){ni(e)?e():e.unsubscribe()}const wn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ur={setTimeout(e,t,...i){const{delegate:n}=Ur;return n?.setTimeout?n.setTimeout(e,t,...i):setTimeout(e,t,...i)},clearTimeout(e){const{delegate:t}=Ur;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function vo(e){Ur.setTimeout(()=>{const{onUnhandledError:t}=wn;if(!t)throw e;t(e)})}function ls(){}const Ra=Wo("C",void 0,void 0);function Wo(e,t,i){return{kind:e,value:t,error:i}}let cs=null;function Ro(e){if(wn.useDeprecatedSynchronousErrorHandling){const t=!cs;if(t&&(cs={errorThrown:!1,error:null}),e(),t){const{errorThrown:i,error:n}=cs;if(cs=null,i)throw n}}else e()}class La extends Je{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,as(t)&&t.add(this)):this.destination=Kh}static create(t,i,n){return new ec(t,i,n)}next(t){this.isStopped?xd(function ru(e){return Wo("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?xd(function bd(e){return Wo("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?xd(Ra,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ks=Function.prototype.bind;function Ct(e,t){return ks.call(e,t)}class Lp{constructor(t){this.partialObserver=t}next(t){const{partialObserver:i}=this;if(i.next)try{i.next(t)}catch(n){Pn(n)}}error(t){const{partialObserver:i}=this;if(i.error)try{i.error(t)}catch(n){Pn(n)}else Pn(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(i){Pn(i)}}}class ec extends La{constructor(t,i,n){let r;if(super(),ni(t)||!t)r={next:t??void 0,error:i??void 0,complete:n??void 0};else{let s;this&&wn.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&Ct(t.next,s),error:t.error&&Ct(t.error,s),complete:t.complete&&Ct(t.complete,s)}):r=t}this.destination=new Lp(r)}}function Pn(e){wn.useDeprecatedSynchronousErrorHandling?function Jl(e){wn.useDeprecatedSynchronousErrorHandling&&cs&&(cs.errorThrown=!0,cs.error=e)}(e):vo(e)}function xd(e,t){const{onStoppedNotification:i}=wn;i&&Ur.setTimeout(()=>i(e,t))}const Kh={closed:!0,next:ls,error:function qr(e){throw e},complete:ls},tc="function"==typeof Symbol&&Symbol.observable||"@@observable";function Rs(e){return e}function nc(e){return 0===e.length?Rs:1===e.length?e[0]:function(i){return e.reduce((n,r)=>r(n),i)}}let On=(()=>{class e{constructor(i){i&&(this._subscribe=i)}lift(i){const n=new e;return n.source=this,n.operator=i,n}subscribe(i,n,r){const s=function Tr(e){return e&&e instanceof La||function cl(e){return e&&ni(e.next)&&ni(e.error)&&ni(e.complete)}(e)&&as(e)}(i)?i:new ec(i,n,r);return Ro(()=>{const{operator:u,source:h}=this;s.add(u?u.call(s,h):h?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(i){try{return this._subscribe(i)}catch(n){i.error(n)}}forEach(i,n){return new(n=jr(n))((r,s)=>{const u=new ec({next:h=>{try{i(h)}catch(_){s(_),u.unsubscribe()}},error:s,complete:r});this.subscribe(u)})}_subscribe(i){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(i)}[tc](){return this}pipe(...i){return nc(i)(this)}toPromise(i){return new(i=jr(i))((n,r)=>{let s;this.subscribe(u=>s=u,u=>r(u),()=>n(s))})}}return e.create=t=>new e(t),e})();function jr(e){var t;return null!==(t=e??wn.Promise)&&void 0!==t?t:Promise}const ul=Rp(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let hi=(()=>{class e extends On{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){const n=new Fa(this,this);return n.operator=i,n}_throwIfClosed(){if(this.closed)throw new ul}next(i){Ro(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const n of this.currentObservers)n.next(i)}})}error(i){Ro(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;const{observers:n}=this;for(;n.length;)n.shift().error(i)}})}complete(){Ro(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return(null===(i=this.observers)||void 0===i?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){const{hasError:n,isStopped:r,observers:s}=this;return n||r?oa:(this.currentObservers=null,s.push(i),new Je(()=>{this.currentObservers=null,m(s,i)}))}_checkFinalizedStatuses(i){const{hasError:n,thrownError:r,isStopped:s}=this;n?i.error(r):s&&i.complete()}asObservable(){const i=new On;return i.source=this,i}}return e.create=(t,i)=>new Fa(t,i),e})();class Fa extends hi{constructor(t,i){super(),this.destination=t,this.source=i}next(t){var i,n;null===(n=null===(i=this.destination)||void 0===i?void 0:i.next)||void 0===n||n.call(i,t)}error(t){var i,n;null===(n=null===(i=this.destination)||void 0===i?void 0:i.error)||void 0===n||n.call(i,t)}complete(){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===i||i.call(t)}_subscribe(t){var i,n;return null!==(n=null===(i=this.source)||void 0===i?void 0:i.subscribe(t))&&void 0!==n?n:oa}}class Sr extends hi{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const i=super._subscribe(t);return!i.closed&&t.next(this._value),i}getValue(){const{hasError:t,thrownError:i,_value:n}=this;if(t)throw i;return this._throwIfClosed(),n}next(t){super.next(this._value=t)}}function wd(e){return ni(e?.lift)}function Ai(e){return t=>{if(wd(t))return t.lift(function(i){try{return e(i,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Mi(e,t,i,n,r){return new Vn(e,t,i,n,r)}class Vn extends La{constructor(t,i,n,r,s,u){super(t),this.onFinalize=s,this.shouldUnsubscribe=u,this._next=i?function(h){try{i(h)}catch(_){t.error(_)}}:super._next,this._error=r?function(h){try{r(h)}catch(_){t.error(_)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(h){t.error(h)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:i}=this;super.unsubscribe(),!i&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Un(e,t){return Ai((i,n)=>{let r=0;i.subscribe(Mi(n,s=>{n.next(e.call(t,s,r++))}))})}function dl(e,t,i,n){var u,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var h=e.length-1;h>=0;h--)(u=e[h])&&(s=(r<3?u(s):r>3?u(t,i,s):u(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s}function Lo(e){return this instanceof Lo?(this.v=e,this):new Lo(e)}function fl(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function sa(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i={},n("next"),n("throw"),n("return"),i[Symbol.asyncIterator]=function(){return this},i);function n(s){i[s]=e[s]&&function(u){return new Promise(function(h,_){!function r(s,u,h,_){Promise.resolve(_).then(function(x){s({value:x,done:h})},u)}(h,_,(u=e[s](u)).done,u.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Be=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function yt(e){return ni(e?.then)}function xt(e){return ni(e[tc])}function ht(e){return Symbol.asyncIterator&&ni(e?.[Symbol.asyncIterator])}function fn(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const pn=function Sn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Mn(e){return ni(e?.[pn])}function Fn(e){return function za(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=i.apply(e,t||[]),s=[];return r={},u("next"),u("throw"),u("return"),r[Symbol.asyncIterator]=function(){return this},r;function u(P){n[P]&&(r[P]=function(F){return new Promise(function($,W){s.push([P,F,$,W])>1||h(P,F)})})}function h(P,F){try{!function _(P){P.value instanceof Lo?Promise.resolve(P.value.v).then(x,M):S(s[0][2],P)}(n[P](F))}catch($){S(s[0][3],$)}}function x(P){h("next",P)}function M(P){h("throw",P)}function S(P,F){P(F),s.shift(),s.length&&h(s[0][0],s[0][1])}}(this,arguments,function*(){const i=e.getReader();try{for(;;){const{value:n,done:r}=yield Lo(i.read());if(r)return yield Lo(void 0);yield yield Lo(n)}}finally{i.releaseLock()}})}function Ui(e){return ni(e?.getReader)}function Xn(e){if(e instanceof On)return e;if(null!=e){if(xt(e))return function so(e){return new On(t=>{const i=e[tc]();if(ni(i.subscribe))return i.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Be(e))return function Fr(e){return new On(t=>{for(let i=0;i<e.length&&!t.closed;i++)t.next(e[i]);t.complete()})}(e);if(yt(e))return function aa(e){return new On(t=>{e.then(i=>{t.closed||(t.next(i),t.complete())},i=>t.error(i)).then(null,vo)})}(e);if(ht(e))return ao(e);if(Mn(e))return function Wr(e){return new On(t=>{for(const i of e)if(t.next(i),t.closed)return;t.complete()})}(e);if(Ui(e))return function cu(e){return ao(Fn(e))}(e)}throw fn(e)}function ao(e){return new On(t=>{(function J0(e,t){var i,n,r,s;return function ic(e,t,i,n){return new(i||(i=Promise))(function(s,u){function h(M){try{x(n.next(M))}catch(S){u(S)}}function _(M){try{x(n.throw(M))}catch(S){u(S)}}function x(M){M.done?s(M.value):function r(s){return s instanceof i?s:new i(function(u){u(s)})}(M.value).then(h,_)}x((n=n.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(i=fl(e);!(n=yield i.next()).done;)if(t.next(n.value),t.closed)return}catch(u){r={error:u}}finally{try{n&&!n.done&&(s=i.return)&&(yield s.call(i))}finally{if(r)throw r.error}}t.complete()})})(e,t).catch(i=>t.error(i))})}function la(e,t,i,n=0,r=!1){const s=t.schedule(function(){i(),r?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!r)return s}function or(e,t,i=1/0){return ni(t)?or((n,r)=>Un((s,u)=>t(n,s,r,u))(Xn(e(n,r))),i):("number"==typeof t&&(i=t),Ai((n,r)=>function ii(e,t,i,n,r,s,u,h){const _=[];let x=0,M=0,S=!1;const P=()=>{S&&!_.length&&!x&&t.complete()},F=W=>x<n?$(W):_.push(W),$=W=>{s&&t.next(W),x++;let X=!1;Xn(i(W,M++)).subscribe(Mi(t,K=>{r?.(K),s?F(K):t.next(K)},()=>{X=!0},void 0,()=>{if(X)try{for(x--;_.length&&x<n;){const K=_.shift();u?la(t,u,()=>$(K)):$(K)}P()}catch(K){t.error(K)}}))};return e.subscribe(Mi(t,F,()=>{S=!0,P()})),()=>{h?.()}}(n,r,e,i)))}function ca(e=1/0){return or(Rs,e)}const Zo=new On(e=>e.complete());function da(e){return e&&ni(e.schedule)}function Dd(e){return e[e.length-1]}function Ls(e){return da(Dd(e))?e.pop():void 0}function uu(e,t=0){return Ai((i,n)=>{i.subscribe(Mi(n,r=>la(n,e,()=>n.next(r),t),()=>la(n,e,()=>n.complete(),t),r=>la(n,e,()=>n.error(r),t)))})}function He(e,t=0){return Ai((i,n)=>{n.add(e.schedule(()=>i.subscribe(n),t))})}function Fs(e,t){if(!e)throw new Error("Iterable cannot be null");return new On(i=>{la(i,t,()=>{const n=e[Symbol.asyncIterator]();la(i,t,()=>{n.next().then(r=>{r.done?i.complete():i.next(r.value)})},0,!0)})})}function Pi(e,t){return t?function zg(e,t){if(null!=e){if(xt(e))return function Va(e,t){return Xn(e).pipe(He(t),uu(t))}(e,t);if(Be(e))return function Zr(e,t){return new On(i=>{let n=0;return t.schedule(function(){n===e.length?i.complete():(i.next(e[n++]),i.closed||this.schedule())})})}(e,t);if(yt(e))return function Ir(e,t){return Xn(e).pipe(He(t),uu(t))}(e,t);if(ht(e))return Fs(e,t);if(Mn(e))return function Ng(e,t){return new On(i=>{let n;return la(i,t,()=>{n=e[pn](),la(i,t,()=>{let r,s;try{({value:r,done:s}=n.next())}catch(u){return void i.error(u)}s?i.complete():i.next(r)},0,!0)}),()=>ni(n?.return)&&n.return()})}(e,t);if(Ui(e))return function Np(e,t){return Fs(Fn(e),t)}(e,t)}throw fn(e)}(e,t):Xn(e)}function Lt(...e){const t=Ls(e),i=function Ba(e,t){return"number"==typeof Dd(e)?e.pop():t}(e,1/0),n=e;return n.length?1===n.length?Xn(n[0]):ca(i)(Pi(n,t)):Zo}function Dt(...e){return Pi(e,Ls(e))}function In(e={}){const{connector:t=(()=>new hi),resetOnError:i=!0,resetOnComplete:n=!0,resetOnRefCountZero:r=!0}=e;return s=>{let u,h,_,x=0,M=!1,S=!1;const P=()=>{h?.unsubscribe(),h=void 0},F=()=>{P(),u=_=void 0,M=S=!1},$=()=>{const W=u;F(),W?.unsubscribe()};return Ai((W,X)=>{x++,!S&&!M&&P();const K=_=_??t();X.add(()=>{x--,0===x&&!S&&!M&&(h=xo($,r))}),K.subscribe(X),!u&&x>0&&(u=new ec({next:Q=>K.next(Q),error:Q=>{S=!0,P(),h=xo(F,i,Q),K.error(Q)},complete:()=>{M=!0,P(),h=xo(F,n),K.complete()}}),Xn(W).subscribe(u))})(s)}}function xo(e,t,...i){if(!0===t)return void e();if(!1===t)return;const n=new ec({next:()=>{n.unsubscribe(),e()}});return Xn(t(...i)).subscribe(n)}function Ar(e,t){return Ai((i,n)=>{let r=null,s=0,u=!1;const h=()=>u&&!r&&n.complete();i.subscribe(Mi(n,_=>{r?.unsubscribe();let x=0;const M=s++;Xn(e(_,M)).subscribe(r=Mi(n,S=>n.next(t?t(_,S,M,x++):S),()=>{r=null,h()}))},()=>{u=!0,h()}))})}function An(e,t=Rs){return e=e??Xo,Ai((i,n)=>{let r,s=!0;i.subscribe(Mi(n,u=>{const h=t(u);(s||!e(r,h))&&(s=!1,r=h,n.next(u))}))})}function Xo(e,t){return e===t}function ai(e){for(let t in e)if(e[t]===ai)return t;throw Error("Could not find renamed property on target object.")}function ha(e,t){for(const i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t[i])}function mi(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(mi).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const i=t.indexOf("\n");return-1===i?t:t.substring(0,i)}function Oi(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Bg=ai({__forward_ref__:ai});function Yn(e){return e.__forward_ref__=Yn,e.toString=function(){return mi(this())},e}function an(e){return sc(e)?e():e}function sc(e){return"function"==typeof e&&e.hasOwnProperty(Bg)&&e.__forward_ref__===Yn}function Td(e){return e&&!!e.\u0275providers}const du="https://g.co/ng/security#xss";class gt extends Error{constructor(t,i){super(function ac(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,i)),this.code=t}}function ln(e){return"string"==typeof e?e:null==e?"":String(e)}function lo(e,t){throw new gt(-201,!1)}function fs(e,t){null==e&&function cn(e,t,i,n){throw new Error(`ASSERTION ERROR: ${e}`+(null==n?"":` [Expected=> ${i} ${n} ${t} <=Actual]`))}(t,e,null,"!=")}function Bt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function qi(e){return{providers:e.providers||[],imports:e.imports||[]}}function ps(e){return lc(e,cc)||lc(e,sf)}function lc(e,t){return e.hasOwnProperty(t)?e[t]:null}function Pd(e){return e&&(e.hasOwnProperty(Od)||e.hasOwnProperty(fu))?e[Od]:null}const cc=ai({\u0275prov:ai}),Od=ai({\u0275inj:ai}),sf=ai({ngInjectableDef:ai}),fu=ai({ngInjectorDef:ai});var Zt=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Zt||{});let Up;function wo(e){const t=Up;return Up=e,t}function lf(e,t,i){const n=ps(e);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:i&Zt.Optional?null:void 0!==t?t:void lo(mi(e))}const gi=globalThis,Nn={},dc="__NG_DI_FLAG__",Rd="ngTempTokenPath",Zg=/\n/gm,cf="__source";let mu;function vl(e){const t=mu;return mu=e,t}function qp(e,t=Zt.Default){if(void 0===mu)throw new gt(-203,!1);return null===mu?lf(e,void 0,t):mu.get(e,t&Zt.Optional?null:void 0,t)}function st(e,t=Zt.Default){return(function af(){return Up}()||qp)(an(e),t)}function Vt(e,t=Zt.Default){return st(e,Ld(t))}function Ld(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function df(e){const t=[];for(let i=0;i<e.length;i++){const n=an(e[i]);if(Array.isArray(n)){if(0===n.length)throw new gt(900,!1);let r,s=Zt.Default;for(let u=0;u<n.length;u++){const h=n[u],_=Nd(h);"number"==typeof _?-1===_?r=h.token:s|=_:r=h}t.push(st(r,s))}else t.push(st(n))}return t}function Fd(e,t){return e[dc]=t,e.prototype[dc]=t,e}function Nd(e){return e[dc]}function Yo(e){return{toString:e}.toString()}var _u=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(_u||{}),Nr=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Nr||{});const Ko={},ri=[],fc=ai({\u0275cmp:ai}),hf=ai({\u0275dir:ai}),yu=ai({\u0275pipe:ai}),Xg=ai({\u0275mod:ai}),Bs=ai({\u0275fac:ai}),bl=ai({__NG_ELEMENT_ID__:ai}),vu=ai({__NG_ENV_ID__:ai});function Zp(e,t,i){let n=e.length;for(;;){const r=e.indexOf(t,i);if(-1===r)return r;if(0===r||e.charCodeAt(r-1)<=32){const s=t.length;if(r+s===n||e.charCodeAt(r+s)<=32)return r}i=r+1}}function zd(e,t,i){let n=0;for(;n<i.length;){const r=i[n];if("number"==typeof r){if(0!==r)break;n++;const s=i[n++],u=i[n++],h=i[n++];e.setAttribute(t,u,h,s)}else{const s=r,u=i[++n];ff(s)?e.setProperty(t,s,u):e.setAttribute(t,s,u),n++}}return n}function Yg(e){return 3===e||4===e||6===e}function ff(e){return 64===e.charCodeAt(0)}function bu(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let i=-1;for(let n=0;n<t.length;n++){const r=t[n];"number"==typeof r?i=r:0===i||xu(e,i,r,null,-1===i||2===i?t[++n]:null)}}return e}function xu(e,t,i,n,r){let s=0,u=e.length;if(-1===t)u=-1;else for(;s<e.length;){const h=e[s++];if("number"==typeof h){if(h===t){u=-1;break}if(h>t){u=s-1;break}}}for(;s<e.length;){const h=e[s];if("number"==typeof h)break;if(h===i){if(null===n)return void(null!==r&&(e[s+1]=r));if(n===e[s+1])return void(e[s+2]=r)}s++,null!==n&&s++,null!==r&&s++}-1!==u&&(e.splice(u,0,t),s=u+1),e.splice(s++,0,i),null!==n&&e.splice(s++,0,n),null!==r&&e.splice(s++,0,r)}const Xp="ng-template";function pf(e,t,i){let n=0,r=!0;for(;n<e.length;){let s=e[n++];if("string"==typeof s&&r){const u=e[n++];if(i&&"class"===s&&-1!==Zp(u.toLowerCase(),t,0))return!0}else{if(1===s){for(;n<e.length&&"string"==typeof(s=e[n++]);)if(s.toLowerCase()===t)return!0;return!1}"number"==typeof s&&(r=!1)}}return!1}function Yp(e){return 4===e.type&&e.value!==Xp}function wu(e,t,i){return t===(4!==e.type||i?e.value:Xp)}function rv(e,t,i){let n=4;const r=e.attrs||[],s=function Qg(e){for(let t=0;t<e.length;t++)if(Yg(e[t]))return t;return e.length}(r);let u=!1;for(let h=0;h<t.length;h++){const _=t[h];if("number"!=typeof _){if(!u)if(4&n){if(n=2|1&n,""!==_&&!wu(e,_,i)||""===_&&1===t.length){if(Vs(n))return!1;u=!0}}else{const x=8&n?_:t[++h];if(8&n&&null!==e.attrs){if(!pf(e.attrs,x,i)){if(Vs(n))return!1;u=!0}continue}const S=ov(8&n?"class":_,r,Yp(e),i);if(-1===S){if(Vs(n))return!1;u=!0;continue}if(""!==x){let P;P=S>s?"":r[S+1].toLowerCase();const F=8&n?P:null;if(F&&-1!==Zp(F,x,0)||2&n&&x!==P){if(Vs(n))return!1;u=!0}}}}else{if(!u&&!Vs(n)&&!Vs(_))return!1;if(u&&Vs(_))continue;u=!1,n=_|1&n}}return Vs(n)||u}function Vs(e){return 0==(1&e)}function ov(e,t,i,n){if(null===t)return-1;let r=0;if(n||!i){let s=!1;for(;r<t.length;){const u=t[r];if(u===e)return r;if(3===u||6===u)s=!0;else{if(1===u||2===u){let h=t[++r];for(;"string"==typeof h;)h=t[++r];continue}if(4===u)break;if(0===u){r+=4;continue}}r+=s?1:2}return-1}return function mf(e,t){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){const n=e[i];if("number"==typeof n)return-1;if(n===t)return i;i++}return-1}(t,e)}function Kg(e,t,i=!1){for(let n=0;n<t.length;n++)if(rv(e,t[n],i))return!0;return!1}function Cu(e,t){e:for(let i=0;i<t.length;i++){const n=t[i];if(e.length===n.length){for(let r=0;r<e.length;r++)if(e[r]!==n[r])continue e;return!0}}return!1}function Kp(e,t){return e?":not("+t.trim()+")":t}function Jg(e){let t=e[0],i=1,n=2,r="",s=!1;for(;i<e.length;){let u=e[i];if("string"==typeof u)if(2&n){const h=e[++i];r+="["+u+(h.length>0?'="'+h+'"':"")+"]"}else 8&n?r+="."+u:4&n&&(r+=" "+u);else""!==r&&!Vs(u)&&(t+=Kp(s,r),r=""),n=u,s=s||!Vs(n);i++}return""!==r&&(t+=Kp(s,r)),t}function ui(e){return Yo(()=>{const t=fa(e),i={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===_u.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Nr.Emulated,styles:e.styles||ri,_:null,schemas:e.schemas||null,tView:null,id:""};Qp(i);const n=e.dependencies;return i.directiveDefs=gc(n,!1),i.pipeDefs=gc(n,!0),i.id=function Mu(e){let t=0;const i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const r of i)t=Math.imul(31,t)+r.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(i),i})}function e_(e){return Qn(e)||zr(e)}function pc(e){return null!==e}function Wi(e){return Yo(()=>({type:e.type,bootstrap:e.bootstrap||ri,declarations:e.declarations||ri,imports:e.imports||ri,exports:e.exports||ri,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Vd(e,t){if(null==e)return Ko;const i={};for(const n in e)if(e.hasOwnProperty(n)){let r=e[n],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),i[r]=n,t&&(t[r]=s)}return i}function Pt(e){return Yo(()=>{const t=fa(e);return Qp(t),t})}function Qn(e){return e[fc]||null}function zr(e){return e[hf]||null}function Br(e){return e[yu]||null}function uo(e,t){const i=e[Xg]||null;if(!i&&!0===t)throw new Error(`Type ${mi(e)} does not have '\u0275mod' property.`);return i}function fa(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||Ko,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||ri,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Vd(e.inputs,t),outputs:Vd(e.outputs)}}function Qp(e){e.features?.forEach(t=>t(e))}function gc(e,t){if(!e)return null;const i=t?Br:e_;return()=>("function"==typeof e?e():e).map(n=>i(n)).filter(pc)}const sr=0,$t=1,bn=2,Ni=3,Fo=4,Ot=5,ji=6,_c=7,Zi=8,ms=9,ar=10,mn=11,xl=12,yf=13,$a=14,yr=15,wl=16,Us=17,gs=18,Ud=19,Jp=20,Qo=21,js=22,Du=23,Tu=24,jn=25,yc=1,bf=2,$s=7,vc=9,Yr=11;function No(e){return Array.isArray(e)&&"object"==typeof e[yc]}function Co(e){return Array.isArray(e)&&!0===e[yc]}function jd(e){return 0!=(4&e.flags)}function Cl(e){return e.componentOffset>-1}function $d(e){return 1==(1&e.flags)}function $i(e){return!!e.template}function em(e){return 0!=(512&e[bn])}function bc(e,t){return e.hasOwnProperty(Bs)?e[Bs]:null}let g=gi.WeakRef??class Pu{constructor(t){this.ref=t}deref(){return this.ref}},v=0,w=null,E=!1;function I(e){const t=w;return w=e,t}class O{constructor(){this.id=v++,this.ref=function c(e){return new g(e)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[t,i]of this.producers){const n=i.producerNode.deref();if(null!=n&&i.atTrackingVersion===this.trackingVersion){if(n.producerPollStatus(i.seenValueVersion))return!0}else this.producers.delete(t),n?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const t=E;E=!0;try{for(const[i,n]of this.consumers){const r=n.consumerNode.deref();null!=r&&r.trackingVersion===n.atTrackingVersion?r.onConsumerDependencyMayHaveChanged():(this.consumers.delete(i),r?.producers.delete(this.id))}}finally{E=t}}producerAccessed(){if(E)throw new Error("");if(null===w)return;let t=w.producers.get(this.id);void 0===t?(t={consumerNode:w.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:w.trackingVersion},w.producers.set(this.id,t),this.consumers.set(w.id,t)):(t.seenValueVersion=this.valueVersion,t.atTrackingVersion=w.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==w?.consumerAllowSignalWrites}producerPollStatus(t){return this.valueVersion!==t||(this.onProducerUpdateValueVersion(),this.valueVersion!==t)}}let oe=null;const we=()=>{};class xe extends O{constructor(t,i,n){super(),this.watch=t,this.schedule=i,this.dirty=!1,this.cleanupFn=we,this.registerOnCleanup=r=>{this.cleanupFn=r},this.consumerAllowSignalWrites=n}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const t=I(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=we,this.watch(this.registerOnCleanup)}finally{I(t)}}cleanup(){this.cleanupFn()}}class Ae{constructor(t,i,n){this.previousValue=t,this.currentValue=i,this.firstChange=n}isFirstChange(){return this.firstChange}}function Te(){return Ne}function Ne(e){return e.type.prototype.ngOnChanges&&(e.setInput=Re),ut}function ut(){const e=Ve(this),t=e?.current;if(t){const i=e.previous;if(i===Ko)e.previous=t;else for(let n in t)i[n]=t[n];e.current=null,this.ngOnChanges(t)}}function Re(e,t,i,n){const r=this.declaredInputs[i],s=Ve(e)||function lt(e,t){return e[Ze]=t}(e,{previous:Ko,current:null}),u=s.current||(s.current={}),h=s.previous,_=h[r];u[r]=new Ae(_&&_.currentValue,t,h===Ko),e[n]=t}Te.ngInherit=!0;const Ze="__ngSimpleChanges__";function Ve(e){return e[Ze]||null}const nt=function(e,t,i){};function Et(e){for(;Array.isArray(e);)e=e[sr];return e}function Ut(e,t){return Et(t[e])}function Gt(e,t){return Et(t[e.index])}function Dn(e,t){return e.data[t]}function Tn(e,t){const i=t[e];return No(i)?i:i[sr]}function lr(e,t){return null==t?null:e[t]}function $r(e){e[Us]=0}function vs(e){1024&e[bn]||(e[bn]|=1024,zi(e,1))}function Hs(e){1024&e[bn]&&(e[bn]&=-1025,zi(e,-1))}function zi(e,t){let i=e[Ni];if(null===i)return;i[Ot]+=t;let n=i;for(i=i[Ni];null!==i&&(1===t&&1===n[Ot]||-1===t&&0===n[Ot]);)i[Ot]+=t,n=i,i=i[Ni]}const Yt={lFrame:j1(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Ou(){return Yt.bindingsEnabled}function Bo(){return null!==Yt.skipHydrationRootTNode}function ft(){return Yt.lFrame.lView}function li(){return Yt.lFrame.tView}function Ef(e){return Yt.lFrame.contextLView=e,e[Zi]}function ku(e){return Yt.lFrame.contextLView=null,e}function Kr(){let e=dv();for(;null!==e&&64===e.type;)e=e.parent;return e}function dv(){return Yt.lFrame.currentTNode}function Gs(e,t){const i=Yt.lFrame;i.currentTNode=e,i.isParent=t}function Ga(){return Yt.lFrame.isParent}function Mf(){Yt.lFrame.isParent=!1}function Ml(){return Yt.lFrame.bindingIndex++}function bs(e){const t=Yt.lFrame,i=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,i}function Ru(e,t){const i=Yt.lFrame;i.bindingIndex=i.bindingRootIndex=e,Mc(t)}function Mc(e){Yt.lFrame.currentDirectiveIndex=e}function U1(){return Yt.lFrame.currentQueryIndex}function fv(e){Yt.lFrame.currentQueryIndex=e}function eT(e){const t=e[$t];return 2===t.type?t.declTNode:1===t.type?e[ji]:null}function pv(e,t,i){if(i&Zt.SkipSelf){let r=t,s=e;for(;!(r=r.parent,null!==r||i&Zt.Host||(r=eT(s),null===r||(s=s[$a],10&r.type))););if(null===r)return!1;t=r,e=s}const n=Yt.lFrame=ga();return n.currentTNode=t,n.lView=e,!0}function d_(e){const t=ga(),i=e[$t];Yt.lFrame=t,t.currentTNode=i.firstChild,t.lView=e,t.tView=i,t.contextLView=e,t.bindingIndex=i.bindingStartIndex,t.inI18n=!1}function ga(){const e=Yt.lFrame,t=null===e?null:e.child;return null===t?j1(e):t}function j1(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function $1(){const e=Yt.lFrame;return Yt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const vr=$1;function en(){const e=$1();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Gi(){return Yt.lFrame.selectedIndex}function Nu(e){Yt.lFrame.selectedIndex=e}function br(){const e=Yt.lFrame;return Dn(e.tView,e.selectedIndex)}let f_=!0;function Xd(){return f_}function Dc(e){f_=e}function p_(e,t){for(let i=t.directiveStart,n=t.directiveEnd;i<n;i++){const s=e.data[i].type.prototype,{ngAfterContentInit:u,ngAfterContentChecked:h,ngAfterViewInit:_,ngAfterViewChecked:x,ngOnDestroy:M}=s;u&&(e.contentHooks??=[]).push(-i,u),h&&((e.contentHooks??=[]).push(i,h),(e.contentCheckHooks??=[]).push(i,h)),_&&(e.viewHooks??=[]).push(-i,_),x&&((e.viewHooks??=[]).push(i,x),(e.viewCheckHooks??=[]).push(i,x)),null!=M&&(e.destroyHooks??=[]).push(i,M)}}function Df(e,t,i){Kd(e,t,3,i)}function om(e,t,i,n){(3&e[bn])===i&&Kd(e,t,i,n)}function Yd(e,t){let i=e[bn];(3&i)===t&&(i&=8191,i+=1,e[bn]=i)}function Kd(e,t,i,n){const s=n??-1,u=t.length-1;let h=0;for(let _=void 0!==n?65535&e[Us]:0;_<u;_++)if("number"==typeof t[_+1]){if(h=t[_],null!=n&&h>=n)break}else t[_]<0&&(e[Us]+=65536),(h<s||-1==s)&&(gv(e,i,t,_),e[Us]=(4294901760&e[Us])+_+2),_++}function Dl(e,t){nt(4,e,t);const i=I(null);try{t.call(e)}finally{I(i),nt(5,e,t)}}function gv(e,t,i,n){const r=i[n]<0,s=i[n+1],h=e[r?-i[n]:i[n]];r?e[bn]>>13<e[Us]>>16&&(3&e[bn])===t&&(e[bn]+=8192,Dl(h,s)):Dl(h,s)}const Qd=-1;class Tc{constructor(t,i,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=n}}function eh(e){return e!==Qd}function ts(e){return 32767&e}function am(e,t){let i=function nT(e){return e>>16}(e),n=t;for(;i>0;)n=n[$a],i--;return n}let m_=!0;function lm(e){const t=m_;return m_=e,t}const yv=255,vv=5;let G1=0;const Wa={};function g_(e,t){const i=bv(e,t);if(-1!==i)return i;const n=t[$t];n.firstCreatePass&&(e.injectorIndex=t.length,__(n.data,e),__(t,null),__(n.blueprint,null));const r=Bu(e,t),s=e.injectorIndex;if(eh(r)){const u=ts(r),h=am(r,t),_=h[$t].data;for(let x=0;x<8;x++)t[s+x]=h[u+x]|_[u+x]}return t[s+8]=r,s}function __(e,t){e.push(0,0,0,0,0,0,0,0,t)}function bv(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Bu(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let i=0,n=null,r=t;for(;null!==r;){if(n=Cv(r),null===n)return Qd;if(i++,r=r[$a],-1!==n.injectorIndex)return n.injectorIndex|i<<16}return Qd}function cm(e,t,i){!function iT(e,t,i){let n;"string"==typeof i?n=i.charCodeAt(0)||0:i.hasOwnProperty(bl)&&(n=i[bl]),null==n&&(n=i[bl]=G1++);const r=n&yv;t.data[e+(r>>vv)]|=1<<r}(e,t,i)}function y_(e,t,i){if(i&Zt.Optional||void 0!==e)return e;lo()}function Eo(e,t,i,n){if(i&Zt.Optional&&void 0===n&&(n=null),!(i&(Zt.Self|Zt.Host))){const r=e[ms],s=wo(void 0);try{return r?r.get(t,n,i&Zt.Optional):lf(t,n,i&Zt.Optional)}finally{wo(s)}}return y_(n,0,i)}function v_(e,t,i,n=Zt.Default,r){if(null!==e){if(2048&t[bn]&&!(n&Zt.Self)){const u=function th(e,t,i,n,r){let s=e,u=t;for(;null!==s&&null!==u&&2048&u[bn]&&!(512&u[bn]);){const h=wv(s,u,i,n|Zt.Self,Wa);if(h!==Wa)return h;let _=s.parent;if(!_){const x=u[Jp];if(x){const M=x.get(i,Wa,n);if(M!==Wa)return M}_=Cv(u),u=u[$a]}s=_}return r}(e,t,i,n,Wa);if(u!==Wa)return u}const s=wv(e,t,i,n,Wa);if(s!==Wa)return s}return Eo(t,i,n,r)}function wv(e,t,i,n,r){const s=function um(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(bl)?e[bl]:void 0;return"number"==typeof t?t>=0?t&yv:rT:t}(i);if("function"==typeof s){if(!pv(t,e,n))return n&Zt.Host?y_(r,0,n):Eo(t,i,n,r);try{let u;if(u=s(n),null!=u||n&Zt.Optional)return u;lo()}finally{vr()}}else if("number"==typeof s){let u=null,h=bv(e,t),_=Qd,x=n&Zt.Host?t[yr][ji]:null;for((-1===h||n&Zt.SkipSelf)&&(_=-1===h?Bu(e,t):t[h+8],_!==Qd&&Zs(n,!1)?(u=t[$t],h=ts(_),t=am(_,t)):h=-1);-1!==h;){const M=t[$t];if(Ws(s,h,M.data)){const S=Tl(h,t,i,u,n,x);if(S!==Wa)return S}_=t[h+8],_!==Qd&&Zs(n,t[$t].data[h+8]===x)&&Ws(s,h,t)?(u=M,h=ts(_),t=am(_,t)):h=-1}}return r}function Tl(e,t,i,n,r,s){const u=t[$t],h=u.data[e+8],M=b_(h,u,i,null==n?Cl(h)&&m_:n!=u&&0!=(3&h.type),r&Zt.Host&&s===h);return null!==M?qs(t,u,M,h):Wa}function b_(e,t,i,n,r){const s=e.providerIndexes,u=t.data,h=1048575&s,_=e.directiveStart,M=s>>20,P=r?h+M:e.directiveEnd;for(let F=n?h:h+M;F<P;F++){const $=u[F];if(F<_&&i===$||F>=_&&$.type===i)return F}if(r){const F=u[_];if(F&&$i(F)&&F.type===i)return _}return null}function qs(e,t,i,n){let r=e[i];const s=t.data;if(function sm(e){return e instanceof Tc}(r)){const u=r;u.resolving&&function gr(e,t){const i=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new gt(-200,`Circular dependency in DI detected for ${e}${i}`)}(function kn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():ln(e)}(s[i]));const h=lm(u.canSeeViewProviders);u.resolving=!0;const x=u.injectImpl?wo(u.injectImpl):null;pv(e,n,Zt.Default);try{r=e[i]=u.factory(void 0,s,e,n),t.firstCreatePass&&i>=n.directiveStart&&function H1(e,t,i){const{ngOnChanges:n,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(n){const u=Ne(t);(i.preOrderHooks??=[]).push(e,u),(i.preOrderCheckHooks??=[]).push(e,u)}r&&(i.preOrderHooks??=[]).push(0-e,r),s&&((i.preOrderHooks??=[]).push(e,s),(i.preOrderCheckHooks??=[]).push(e,s))}(i,s[i],t)}finally{null!==x&&wo(x),lm(h),u.resolving=!1,vr()}}return r}function Ws(e,t,i){return!!(i[t+(e>>vv)]&1<<e)}function Zs(e,t){return!(e&Zt.Self||e&Zt.Host&&t)}class Vo{constructor(t,i){this._tNode=t,this._lView=i}get(t,i,n){return v_(this._tNode,this._lView,t,Ld(n),i)}}function rT(){return new Vo(Kr(),ft())}function va(e){return sc(e)?()=>{const t=va(an(e));return t&&t()}:bc(e)}function Cv(e){const t=e[$t],i=t.type;return 2===i?t.declTNode:1===i?e[ji]:null}const Sc="__parameters__";function Sl(e,t,i){return Yo(()=>{const n=function Uu(e){return function(...i){if(e){const n=e(...i);for(const r in n)this[r]=n[r]}}}(t);function r(...s){if(this instanceof r)return n.apply(this,s),this;const u=new r(...s);return h.annotation=u,h;function h(_,x,M){const S=_.hasOwnProperty(Sc)?_[Sc]:Object.defineProperty(_,Sc,{value:[]})[Sc];for(;S.length<=M;)S.push(null);return(S[M]=S[M]||[]).push(u),_}}return i&&(r.prototype=Object.create(i.prototype)),r.prototype.ngMetadataName=e,r.annotationCls=r,r})}function ns(e,t){e.forEach(i=>Array.isArray(i)?ns(i,t):t(i))}function Za(e,t,i){t>=e.length?e.push(i):e.splice(t,0,i)}function ws(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function Mo(e,t){const i=[];for(let n=0;n<e;n++)i.push(t);return i}function mo(e,t,i){let n=rh(e,t);return n>=0?e[1|n]=i:(n=~n,function po(e,t,i,n){let r=e.length;if(r==t)e.push(i,n);else if(1===r)e.push(n,e[0]),e[0]=i;else{for(r--,e.push(e[r-1],e[r]);r>t;)e[r]=e[r-2],r--;e[t]=i,e[t+1]=n}}(e,n,t,i)),n}function pm(e,t){const i=rh(e,t);if(i>=0)return e[1|i]}function rh(e,t){return function K1(e,t,i){let n=0,r=e.length>>i;for(;r!==n;){const s=n+(r-n>>1),u=e[s<<i];if(t===u)return s<<i;u>t?r=s:n=s+1}return~(r<<i)}(e,t,1)}const E_=Fd(Sl("Optional"),8),M_=Fd(Sl("SkipSelf"),4);function Ac(e){return 128==(128&e.flags)}var ki=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(ki||{});const R_=/^>|^->|<!--|-->|--!>|<!-$/g,hw=/(<|>)/,L_="\u200b$1\u200b";const ah=new Map;let fw=0;const Rv="__ngContext__";function go(e,t){No(t)?(e[Rv]=t[Ud],function vm(e){ah.set(e[Ud],e)}(t)):e[Rv]=t}let Lv;function j_(e,t){return Lv(e,t)}function xm(e){const t=e[Ni];return Co(t)?t[Ni]:t}function Fv(e){return yw(e[xl])}function Nv(e){return yw(e[Fo])}function yw(e){for(;null!==e&&!Co(e);)e=e[Fo];return e}function Ff(e,t,i,n,r){if(null!=n){let s,u=!1;Co(n)?s=n:No(n)&&(u=!0,n=n[sr]);const h=Et(n);0===e&&null!==i?null==r?ww(t,i,h):ch(t,i,h,r||null,!0):1===e&&null!==i?ch(t,i,h,r||null,!0):2===e?function Q_(e,t,i){const n=io(e,t);n&&function X_(e,t,i,n){e.removeChild(t,i,n)}(e,n,t,i)}(t,h,u):3===e&&t.destroyNode(h),null!=s&&function TT(e,t,i,n,r){const s=i[$s];s!==Et(i)&&Ff(t,e,n,s,r);for(let h=Yr;h<i.length;h++){const _=i[h];Bf(_[$t],_,e,t,n,s)}}(t,e,s,i,r)}}function Nf(e,t){return e.createComment(function ym(e){return e.replace(R_,t=>t.replace(hw,L_))}(t))}function lh(e,t,i){return e.createElement(t,i)}function zv(e,t){const i=e[vc],n=i.indexOf(t);Hs(t),i.splice(n,1)}function G_(e,t){if(e.length<=Yr)return;const i=Yr+t,n=e[i];if(n){const r=n[wl];null!==r&&r!==e&&zv(r,n),t>0&&(e[i-1][Fo]=n[Fo]);const s=ws(e,Yr+t);!function ET(e,t){Bf(e,t,t[mn],2,null,null),t[sr]=null,t[ji]=null}(n[$t],n);const u=s[gs];null!==u&&u.detachView(s[$t]),n[Ni]=null,n[Fo]=null,n[bn]&=-129}return n}function q_(e,t){if(!(256&t[bn])){const i=t[mn];t[Du]?.destroy(),t[Tu]?.destroy(),i.destroyNode&&Bf(e,t,i,3,null,null),function Cm(e){let t=e[xl];if(!t)return W_(e[$t],e);for(;t;){let i=null;if(No(t))i=t[xl];else{const n=t[Yr];n&&(i=n)}if(!i){for(;t&&!t[Fo]&&t!==e;)No(t)&&W_(t[$t],t),t=t[Ni];null===t&&(t=e),No(t)&&W_(t[$t],t),i=t&&t[Fo]}t=i}}(t)}}function W_(e,t){if(!(256&t[bn])){t[bn]&=-129,t[bn]|=256,function xw(e,t){let i;if(null!=e&&null!=(i=e.destroyHooks))for(let n=0;n<i.length;n+=2){const r=t[i[n]];if(!(r instanceof Tc)){const s=i[n+1];if(Array.isArray(s))for(let u=0;u<s.length;u+=2){const h=r[s[u]],_=s[u+1];nt(4,h,_);try{_.call(h)}finally{nt(5,h,_)}}else{nt(4,r,s);try{s.call(r)}finally{nt(5,r,s)}}}}}(e,t),function bw(e,t){const i=e.cleanup,n=t[_c];if(null!==i)for(let s=0;s<i.length-1;s+=2)if("string"==typeof i[s]){const u=i[s+3];u>=0?n[u]():n[-u].unsubscribe(),s+=2}else i[s].call(n[i[s+1]]);null!==n&&(t[_c]=null);const r=t[Qo];if(null!==r){t[Qo]=null;for(let s=0;s<r.length;s++)(0,r[s])()}}(e,t),1===t[$t].type&&t[mn].destroy();const i=t[wl];if(null!==i&&Co(t[Ni])){i!==t[Ni]&&zv(i,t);const n=t[gs];null!==n&&n.detachView(e)}!function Ov(e){ah.delete(e[Ud])}(t)}}function Z_(e,t,i){return function Bv(e,t,i){let n=t;for(;null!==n&&40&n.type;)n=(t=n).parent;if(null===n)return i[sr];{const{componentOffset:r}=n;if(r>-1){const{encapsulation:s}=e.data[n.directiveStart+r];if(s===Nr.None||s===Nr.Emulated)return null}return Gt(n,i)}}(e,t.parent,i)}function ch(e,t,i,n,r){e.insertBefore(t,i,n,r)}function ww(e,t,i){e.appendChild(t,i)}function Vv(e,t,i,n,r){null!==n?ch(e,t,i,n,r):ww(e,t,i)}function io(e,t){return e.parentNode(t)}function uh(e,t,i){return Uv(e,t,i)}let Y_,Zv,J_,Uv=function zf(e,t,i){return 40&e.type?Gt(e,i):null};function K_(e,t,i,n){const r=Z_(e,n,t),s=t[mn],h=uh(n.parent||t[ji],n,t);if(null!=r)if(Array.isArray(i))for(let _=0;_<i.length;_++)Vv(s,r,i[_],h,!1);else Vv(s,r,i,h,!1);void 0!==Y_&&Y_(s,n,t,i,r)}function Dm(e,t){if(null!==t){const i=t.type;if(3&i)return Gt(t,e);if(4&i)return jv(-1,e[t.index]);if(8&i){const n=t.child;if(null!==n)return Dm(e,n);{const r=e[t.index];return Co(r)?jv(-1,r):Et(r)}}if(32&i)return j_(t,e)()||Et(e[t.index]);{const n=Ew(e,t);return null!==n?Array.isArray(n)?n[0]:Dm(xm(e[yr]),n):Dm(e,t.next)}}return null}function Ew(e,t){return null!==t?e[yr][ji].projection[t.projection]:null}function jv(e,t){const i=Yr+e+1;if(i<t.length){const n=t[i],r=n[$t].firstChild;if(null!==r)return Dm(n,r)}return t[$s]}function $v(e,t,i,n,r,s,u){for(;null!=i;){const h=n[i.index],_=i.type;if(u&&0===t&&(h&&go(Et(h),n),i.flags|=2),32!=(32&i.flags))if(8&_)$v(e,t,i.child,n,r,s,!1),Ff(t,e,r,h,s);else if(32&_){const x=j_(i,n);let M;for(;M=x();)Ff(t,e,r,M,s);Ff(t,e,r,h,s)}else 16&_?Hv(e,t,n,i,r,s):Ff(t,e,r,h,s);i=u?i.projectionNext:i.next}}function Bf(e,t,i,n,r,s){$v(i,n,e.firstChild,t,r,s,!1)}function Hv(e,t,i,n,r,s){const u=i[yr],_=u[ji].projection[n.projection];if(Array.isArray(_))for(let x=0;x<_.length;x++)Ff(t,e,r,_[x],s);else{let x=_;const M=u[Ni];Ac(n)&&(x.flags|=128),$v(e,t,x,M,r,s,!0)}}function Dw(e,t,i){""===i?e.removeAttribute(t,"class"):e.setAttribute(t,"class",i)}function Tw(e,t,i){const{mergedAttrs:n,classes:r,styles:s}=i;null!==n&&zd(e,t,n),null!==r&&Dw(e,t,r),null!==s&&function IT(e,t,i){e.setAttribute(t,"style",i)}(e,t,s)}function Qv(e){return function Xv(){if(void 0===J_&&(J_=null,gi.trustedTypes))try{J_=gi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return J_}()?.createScriptURL(e)||e}class xi{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${du})`}}function Oc(e){return e instanceof xi?e.changingThisBreaksApplicationSecurity:e}function Im(e,t){const i=function PT(e){return e instanceof xi&&e.getTypeName()||null}(e);if(null!=i&&i!==t){if("ResourceURL"===i&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${i} (see ${du})`)}return i===t}const Pw=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var hh=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(hh||{});function Pl(e){const t=kc();return t?t.sanitize(hh.URL,e)||"":Im(e,"URL")?Oc(e):function $f(e){return(e=String(e)).match(Pw)?e:"unsafe:"+e}(ln(e))}function rb(e){const t=kc();if(t)return Qv(t.sanitize(hh.RESOURCE_URL,e)||"");if(Im(e,"ResourceURL"))return Qv(Oc(e));throw new gt(904,!1)}function kc(){const e=ft();return e&&e[ar].sanitizer}class kt{constructor(t,i){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=Bt({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Hf=new kt("ENVIRONMENT_INITIALIZER"),xa=new kt("INJECTOR",-1),sy=new kt("INJECTOR_DEF_TYPES");class $u{get(t,i=Nn){if(i===Nn){const n=new Error(`NullInjectorError: No provider for ${mi(t)}!`);throw n.name="NullInjectorError",n}return i}}function $w(...e){return{\u0275providers:Pm(0,e),\u0275fromNgModule:!0}}function Pm(e,...t){const i=[],n=new Set;let r;const s=u=>{i.push(u)};return ns(t,u=>{const h=u;fh(h,s,[],n)&&(r||=[],r.push(h))}),void 0!==r&&ob(r,s),i}function ob(e,t){for(let i=0;i<e.length;i++){const{ngModule:n,providers:r}=e[i];ab(r,s=>{t(s,n)})}}function fh(e,t,i,n){if(!(e=an(e)))return!1;let r=null,s=Pd(e);const u=!s&&Qn(e);if(s||u){if(u&&!u.standalone)return!1;r=e}else{const _=e.ngModule;if(s=Pd(_),!s)return!1;r=_}const h=n.has(r);if(u){if(h)return!1;if(n.add(r),u.dependencies){const _="function"==typeof u.dependencies?u.dependencies():u.dependencies;for(const x of _)fh(x,t,i,n)}}else{if(!s)return!1;{if(null!=s.imports&&!h){let x;n.add(r);try{ns(s.imports,M=>{fh(M,t,i,n)&&(x||=[],x.push(M))})}finally{}void 0!==x&&ob(x,t)}if(!h){const x=bc(r)||(()=>new r);t({provide:r,useFactory:x,deps:ri},r),t({provide:sy,useValue:r,multi:!0},r),t({provide:Hf,useValue:()=>st(r),multi:!0},r)}const _=s.providers;if(null!=_&&!h){const x=e;ab(_,M=>{t(M,x)})}}}return r!==e&&void 0!==e.providers}function ab(e,t){for(let i of e)Td(i)&&(i=i.\u0275providers),Array.isArray(i)?ab(i,t):t(i)}const BT=ai({provide:String,useValue:ai});function lb(e){return null!==e&&"object"==typeof e&&BT in e}function wa(e){return"function"==typeof e}const Om=new kt("Set Injector scope."),ay={},qw={};let cb;function qf(){return void 0===cb&&(cb=new $u),cb}class Xs{}class Gu extends Xs{get destroyed(){return this._destroyed}constructor(t,i,n,r){super(),this.parent=i,this.source=n,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ub(t,u=>this.processProvider(u)),this.records.set(xa,qu(void 0,this)),r.has("environment")&&this.records.set(Xs,qu(void 0,this));const s=this.records.get(Om);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(sy.multi,ri,Zt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of t)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const i=vl(this),n=wo(void 0);try{return t()}finally{vl(i),wo(n)}}get(t,i=Nn,n=Zt.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(vu))return t[vu](this);n=Ld(n);const s=vl(this),u=wo(void 0);try{if(!(n&Zt.SkipSelf)){let _=this.records.get(t);if(void 0===_){const x=function ph(e){return"function"==typeof e||"object"==typeof e&&e instanceof kt}(t)&&ps(t);_=x&&this.injectableDefInScope(x)?qu(Ol(t),ay):null,this.records.set(t,_)}if(null!=_)return this.hydrate(t,_)}return(n&Zt.Self?qf():this.parent).get(t,i=n&Zt.Optional&&i===Nn?null:i)}catch(h){if("NullInjectorError"===h.name){if((h[Rd]=h[Rd]||[]).unshift(mi(t)),s)throw h;return function gu(e,t,i,n){const r=e[Rd];throw t[cf]&&r.unshift(t[cf]),e.message=function Wp(e,t,i,n=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let r=mi(t);if(Array.isArray(t))r=t.map(mi).join(" -> ");else if("object"==typeof t){let s=[];for(let u in t)if(t.hasOwnProperty(u)){let h=t[u];s.push(u+":"+("string"==typeof h?JSON.stringify(h):mi(h)))}r=`{${s.join(", ")}}`}return`${i}${n?"("+n+")":""}[${r}]: ${e.replace(Zg,"\n  ")}`}("\n"+e.message,r,i,n),e.ngTokenPath=r,e[Rd]=null,e}(h,t,"R3InjectorError",this.source)}throw h}finally{wo(u),vl(s)}}resolveInjectorInitializers(){const t=vl(this),i=wo(void 0);try{const r=this.get(Hf.multi,ri,Zt.Self);for(const s of r)s()}finally{vl(t),wo(i)}}toString(){const t=[],i=this.records;for(const n of i.keys())t.push(mi(n));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new gt(205,!1)}processProvider(t){let i=wa(t=an(t))?t:an(t&&t.provide);const n=function Zw(e){return lb(e)?qu(void 0,e.useValue):qu(km(e),ay)}(t);if(wa(t)||!0!==t.multi)this.records.get(i);else{let r=this.records.get(i);r||(r=qu(void 0,ay,!0),r.factory=()=>df(r.multi),this.records.set(i,r)),i=t,r.multi.push(t)}this.records.set(i,n)}hydrate(t,i){return i.value===ay&&(i.value=qw,i.value=i.factory()),"object"==typeof i.value&&i.value&&function Xw(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}injectableDefInScope(t){if(!t.providedIn)return!1;const i=an(t.providedIn);return"string"==typeof i?"any"===i||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(t){const i=this._onDestroyHooks.indexOf(t);-1!==i&&this._onDestroyHooks.splice(i,1)}}function Ol(e){const t=ps(e),i=null!==t?t.factory:bc(e);if(null!==i)return i;if(e instanceof kt)throw new gt(204,!1);if(e instanceof Function)return function Ww(e){const t=e.length;if(t>0)throw Mo(t,"?"),new gt(204,!1);const i=function Ad(e){return e&&(e[cc]||e[sf])||null}(e);return null!==i?()=>i.factory(e):()=>new e}(e);throw new gt(204,!1)}function km(e,t,i){let n;if(wa(e)){const r=an(e);return bc(r)||Ol(r)}if(lb(e))n=()=>an(e.useValue);else if(function Gw(e){return!(!e||!e.useFactory)}(e))n=()=>e.useFactory(...df(e.deps||[]));else if(function Hw(e){return!(!e||!e.useExisting)}(e))n=()=>st(an(e.useExisting));else{const r=an(e&&(e.useClass||e.provide));if(!function VT(e){return!!e.deps}(e))return bc(r)||Ol(r);n=()=>new r(...df(e.deps))}return n}function qu(e,t,i=!1){return{factory:e,value:t,multi:i?[]:void 0}}function ub(e,t){for(const i of e)Array.isArray(i)?ub(i,t):i&&Td(i)?ub(i.\u0275providers,t):t(i)}const Ca=new kt("AppId",{providedIn:"root",factory:()=>UT}),UT="ng",Wf=new kt("Platform Initializer"),Ea=new kt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Rc=new kt("AnimationModuleType"),Zf=new kt("CSP nonce",{providedIn:"root",factory:()=>function Al(){if(void 0!==Zv)return Zv;if(typeof document<"u")return document;throw new gt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let fy=(e,t,i)=>null;function Fm(e,t,i=!1){return fy(e,t,i)}class Kw{}class Qw{}class Zu{resolveComponentFactory(t){throw function Jw(e){const t=Error(`No component factory found for ${mi(e)}.`);return t.ngComponent=e,t}(t)}}let Ms=(()=>{class t{}return t.NULL=new Zu,t})();function Xu(){return Fc(Kr(),ft())}function Fc(e,t){return new cr(Gt(e,t))}let cr=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=Xu,t})();function eC(e){return e instanceof cr?e.nativeElement:e}class _b{}let Ka=(()=>{class t{constructor(){this.destroyNode=null}}return t.__NG_ELEMENT_ID__=()=>function ZT(){const e=ft(),i=Tn(Kr().index,e);return(No(i)?i:e)[mn]}(),t})(),tC=(()=>{var e;class t{}return(e=t).\u0275prov=Bt({token:e,providedIn:"root",factory:()=>null}),t})();class Yu{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const nC=new Yu("16.2.0"),_y={};function vy(e,t=null,i=null,n){const r=Qa(e,t,i,n);return r.resolveInjectorInitializers(),r}function Qa(e,t=null,i=null,n,r=new Set){const s=[i||ri,$w(e)];return n=n||("object"==typeof e?void 0:mi(e)),new Gu(s,t||qf(),n||null,r)}let Do=(()=>{var e;class t{static create(n,r){if(Array.isArray(n))return vy({name:""},r,n,"");{const s=n.name??"";return vy({name:s},n.parent,n.providers,s)}}}return(e=t).THROW_IF_NOT_FOUND=Nn,e.NULL=new $u,e.\u0275prov=Bt({token:e,providedIn:"any",factory:()=>st(xa)}),e.__NG_ELEMENT_ID__=-1,t})();function kl(e){return e instanceof Function?e():e}let by=(()=>{var e;class t{constructor(){this.callbacks=new Set,this.deferredCallbacks=new Set,this.renderDepth=0,this.runningCallbacks=!1}begin(){if(this.runningCallbacks)throw new gt(102,!1);this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth)try{this.runningCallbacks=!0;for(const n of this.callbacks)n.invoke()}finally{this.runningCallbacks=!1;for(const n of this.deferredCallbacks)this.callbacks.add(n);this.deferredCallbacks.clear()}}register(n){(this.runningCallbacks?this.deferredCallbacks:this.callbacks).add(n)}unregister(n){this.callbacks.delete(n),this.deferredCallbacks.delete(n)}ngOnDestroy(){this.callbacks.clear(),this.deferredCallbacks.clear()}}return(e=t).\u0275prov=Bt({token:e,providedIn:"root",factory:()=>new e}),t})();function Vm(e){for(;e;){e[bn]|=64;const t=xm(e);if(em(e)&&!t)return e;e=t}return null}function wy(e){return e.ngOriginalError}class Qu{constructor(){this._console=console}handleError(t){const i=this._findOriginalError(t);this._console.error("ERROR",t),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(t){let i=t&&wy(t);for(;i&&wy(i);)i=wy(i);return i||null}}const bb=new kt("",{providedIn:"root",factory:()=>!1});class T extends O{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(t){this._lView=t}onConsumerDependencyMayHaveChanged(){Vm(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(t,i,n){const r=I(this);this.trackingVersion++;try{t(i,n)}finally{I(r)}}destroy(){this.trackingVersion++}}let k=null;function L(){return k??=new T,k}function N(e,t){return e[t]??L()}function V(e,t){const i=L();i.hasReadASignal&&(e[t]=k,i.lView=e,k=new T)}const U={};function j(e){te(li(),ft(),Gi()+e,!1)}function te(e,t,i,n){if(!n)if(3==(3&t[bn])){const s=e.preOrderCheckHooks;null!==s&&Df(t,s,i)}else{const s=e.preOrderHooks;null!==s&&om(t,s,0,i)}Nu(i)}function q(e,t=Zt.Default){const i=ft();return null===i?st(e,t):v_(Kr(),i,an(e),t)}function pe(){throw new Error("invalid")}function fe(e,t,i,n,r,s,u,h,_,x,M){const S=t.blueprint.slice();return S[sr]=r,S[bn]=140|n,(null!==x||e&&2048&e[bn])&&(S[bn]|=2048),$r(S),S[Ni]=S[$a]=e,S[Zi]=i,S[ar]=u||e&&e[ar],S[mn]=h||e&&e[mn],S[ms]=_||e&&e[ms]||null,S[ji]=s,S[Ud]=function pw(){return fw++}(),S[js]=M,S[Jp]=x,S[yr]=2==t.type?e[yr]:S,S}function ge(e,t,i,n,r){let s=e.data[t];if(null===s)s=function _e(e,t,i,n,r){const s=dv(),u=Ga(),_=e.data[t]=function _t(e,t,i,n,r,s){let u=t?t.injectorIndex:-1,h=0;return Bo()&&(h|=128),{type:i,index:n,insertBeforeIndex:null,injectorIndex:u,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:h,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,u?s:s&&s.parent,i,t,n,r);return null===e.firstChild&&(e.firstChild=_),null!==s&&(u?null==s.child&&null!==_.parent&&(s.child=_):null===s.next&&(s.next=_,_.prev=s)),_}(e,t,i,n,r),function Ec(){return Yt.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=i,s.value=n,s.attrs=r;const u=function Wd(){const e=Yt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();s.injectorIndex=null===u?-1:u.injectorIndex}return Gs(s,!0),s}function Fe(e,t,i,n){if(0===i)return-1;const r=t.length;for(let s=0;s<i;s++)t.push(n),e.blueprint.push(n),e.data.push(null);return r}function ke(e,t,i,n,r){const s=N(t,Du),u=Gi(),h=2&n;try{if(Nu(-1),h&&t.length>jn&&te(e,t,jn,!1),nt(h?2:0,r),h)s.runInContext(i,n,r);else{const x=I(null);try{i(n,r)}finally{I(x)}}}finally{h&&null===t[Du]&&V(t,Du),Nu(u),nt(h?3:1,r)}}function Ge(e,t,i){if(jd(t)){const n=I(null);try{const s=t.directiveEnd;for(let u=t.directiveStart;u<s;u++){const h=e.data[u];h.contentQueries&&h.contentQueries(1,i[u],u)}}finally{I(n)}}}function ct(e,t,i){Ou()&&(function Xi(e,t,i,n){const r=i.directiveStart,s=i.directiveEnd;Cl(i)&&function Ti(e,t,i){const n=Gt(t,e),r=Qe(i);let u=16;i.signals?u=4096:i.onPush&&(u=64);const h=zc(e,fe(e,r,null,u,n,t,null,e[ar].rendererFactory.createRenderer(n,i),null,null,null));e[t.index]=h}(t,i,e.data[r+i.componentOffset]),e.firstCreatePass||g_(i,t),go(n,t);const u=i.initialInputs;for(let h=r;h<s;h++){const _=e.data[h],x=qs(t,e,h,i);go(x,t),null!==u&&ro(0,h-r,x,_,0,u),$i(_)&&(Tn(i.index,t)[Zi]=qs(t,e,h,i))}}(e,t,i,Gt(i,t)),64==(64&i.flags)&&nr(e,t,i))}function ze(e,t,i=Gt){const n=t.localNames;if(null!==n){let r=t.index+1;for(let s=0;s<n.length;s+=2){const u=n[s+1],h=-1===u?i(t,e):e[u];e[r++]=h}}}function Qe(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Ye(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function Ye(e,t,i,n,r,s,u,h,_,x,M){const S=jn+n,P=S+r,F=function at(e,t){const i=[];for(let n=0;n<t;n++)i.push(n<e?null:U);return i}(S,P),$="function"==typeof x?x():x;return F[$t]={type:e,blueprint:F,template:i,queries:null,viewQuery:h,declTNode:t,data:F.slice().fill(null,S),bindingStartIndex:S,expandoStartIndex:P,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof u?u():u,firstChild:null,schemas:_,consts:$,incompleteFirstPass:!1,ssrId:M}}let Mt=e=>null;function Jt(e,t,i,n){for(let r in e)if(e.hasOwnProperty(r)){i=null===i?{}:i;const s=e[r];null===n?un(i,t,r,s):n.hasOwnProperty(r)&&un(i,t,n[r],s)}return i}function un(e,t,i,n){e.hasOwnProperty(i)?e[i].push(t,n):e[i]=[t,n]}function Xt(e,t,i,n,r,s,u,h){const _=Gt(t,i);let M,x=t.inputs;!h&&null!=x&&(M=x[n])?(jm(e,i,M,n,r),Cl(t)&&function Ri(e,t){const i=Tn(t,e);16&i[bn]||(i[bn]|=64)}(i,t.index)):3&t.type&&(n=function _n(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(n),r=null!=u?u(r,t.value||"",n):r,s.setProperty(_,n,r))}function di(e,t,i,n){if(Ou()){const r=null===n?null:{"":-1},s=function Ei(e,t){const i=e.directiveRegistry;let n=null,r=null;if(i)for(let s=0;s<i.length;s++){const u=i[s];if(Kg(t,u.selectors,!1))if(n||(n=[]),$i(u))if(null!==u.findHostDirectiveDefs){const h=[];r=r||new Map,u.findHostDirectiveDefs(u,h,r),n.unshift(...h,u),wr(e,t,h.length)}else n.unshift(u),wr(e,t,0);else r=r||new Map,u.findHostDirectiveDefs?.(u,n,r),n.push(u)}return null===n?null:[n,r]}(e,i);let u,h;null===s?u=h=null:[u,h]=s,null!==u&&wi(e,t,i,u,r,h),r&&function Rr(e,t,i){if(t){const n=e.localNames=[];for(let r=0;r<t.length;r+=2){const s=i[t[r+1]];if(null==s)throw new gt(-301,!1);n.push(t[r],s)}}}(i,n,r)}i.mergedAttrs=bu(i.mergedAttrs,i.attrs)}function wi(e,t,i,n,r,s){for(let x=0;x<n.length;x++)cm(g_(i,t),e,n[x].type);!function ei(e,t,i){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+i,e.providerIndexes=t}(i,e.data.length,n.length);for(let x=0;x<n.length;x++){const M=n[x];M.providersResolver&&M.providersResolver(M)}let u=!1,h=!1,_=Fe(e,t,n.length,null);for(let x=0;x<n.length;x++){const M=n[x];i.mergedAttrs=bu(i.mergedAttrs,M.hostAttrs),Lr(e,i,t,_,M),ir(_,M,r),null!==M.contentQueries&&(i.flags|=4),(null!==M.hostBindings||null!==M.hostAttrs||0!==M.hostVars)&&(i.flags|=64);const S=M.type.prototype;!u&&(S.ngOnChanges||S.ngOnInit||S.ngDoCheck)&&((e.preOrderHooks??=[]).push(i.index),u=!0),!h&&(S.ngOnChanges||S.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(i.index),h=!0),_++}!function Kn(e,t,i){const r=t.directiveEnd,s=e.data,u=t.attrs,h=[];let _=null,x=null;for(let M=t.directiveStart;M<r;M++){const S=s[M],P=i?i.get(S):null,$=P?P.outputs:null;_=Jt(S.inputs,M,_,P?P.inputs:null),x=Jt(S.outputs,M,x,$);const W=null===_||null===u||Yp(t)?null:Uo(_,M,u);h.push(W)}null!==_&&(_.hasOwnProperty("class")&&(t.flags|=8),_.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=h,t.inputs=_,t.outputs=x}(e,i,s)}function nr(e,t,i){const n=i.directiveStart,r=i.directiveEnd,s=i.index,u=function Lu(){return Yt.lFrame.currentDirectiveIndex}();try{Nu(s);for(let h=n;h<r;h++){const _=e.data[h],x=t[h];Mc(h),(null!==_.hostBindings||0!==_.hostVars||null!==_.hostAttrs)&&kr(_,x)}}finally{Nu(-1),Mc(u)}}function kr(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function wr(e,t,i){t.componentOffset=i,(e.components??=[]).push(t.index)}function ir(e,t,i){if(i){if(t.exportAs)for(let n=0;n<t.exportAs.length;n++)i[t.exportAs[n]]=e;$i(t)&&(i[""]=e)}}function Lr(e,t,i,n,r){e.data[n]=r;const s=r.factory||(r.factory=bc(r.type)),u=new Tc(s,$i(r),q);e.blueprint[n]=u,i[n]=u,function Di(e,t,i,n,r){const s=r.hostBindings;if(s){let u=e.hostBindingOpCodes;null===u&&(u=e.hostBindingOpCodes=[]);const h=~t.index;(function Ci(e){let t=e.length;for(;t>0;){const i=e[--t];if("number"==typeof i&&i<0)return i}return 0})(u)!=h&&u.push(h),u.push(i,n,s)}}(e,t,n,Fe(e,i,r.hostVars,U),r)}function ur(e,t,i,n,r,s){const u=Gt(e,t);!function dr(e,t,i,n,r,s,u){if(null==s)e.removeAttribute(t,r,i);else{const h=null==u?ln(s):u(s,n||"",r);e.setAttribute(t,r,h,i)}}(t[mn],u,s,e.value,i,n,r)}function ro(e,t,i,n,r,s){const u=s[t];if(null!==u)for(let h=0;h<u.length;)Hr(n,i,u[h++],u[h++],u[h++])}function Hr(e,t,i,n,r){const s=I(null);try{const u=e.inputTransforms;null!==u&&u.hasOwnProperty(n)&&(r=u[n].call(t,r)),null!==e.setInput?e.setInput(t,r,i,n):t[n]=r}finally{I(s)}}function Uo(e,t,i){let n=null,r=0;for(;r<i.length;){const s=i[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(e.hasOwnProperty(s)){null===n&&(n=[]);const u=e[s];for(let h=0;h<u.length;h+=2)if(u[h]===t){n.push(s,u[h+1],i[r+1]);break}}r+=2}else r+=2;else r+=4}return n}function Gr(e,t,i,n){return[e,!0,!1,t,null,0,n,i,null,null,null]}function Ma(e,t){const i=e.contentQueries;if(null!==i)for(let n=0;n<i.length;n+=2){const s=i[n+1];if(-1!==s){const u=e.data[s];fv(i[n]),u.contentQueries(2,t[s],s)}}}function zc(e,t){return e[xl]?e[yf][Fo]=t:e[xl]=t,e[yf]=t,t}function yh(e,t,i){fv(0);const n=I(null);try{t(e,i)}finally{I(n)}}function wb(e){return e[_c]||(e[_c]=[])}function Cb(e){return e.cleanup||(e.cleanup=[])}function Mb(e,t){const i=e[ms],n=i?i.get(Qu,null):null;n&&n.handleError(t)}function jm(e,t,i,n,r){for(let s=0;s<i.length;){const u=i[s++],h=i[s++];Hr(e.data[u],t[u],n,h,r)}}function Rl(e,t){const i=Tn(t,e),n=i[$t];!function uC(e,t){for(let i=t.length;i<e.blueprint.length;i++)t.push(e.blueprint[i])}(n,i);const r=i[sr];null!==r&&null===i[js]&&(i[js]=Fm(r,i[ms])),Bc(n,i,i[Zi])}function Bc(e,t,i){d_(t);try{const n=e.viewQuery;null!==n&&yh(1,n,i);const r=e.template;null!==r&&ke(e,t,r,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Ma(e,t),e.staticViewQueries&&yh(2,e.viewQuery,i);const s=e.components;null!==s&&function Db(e,t){for(let i=0;i<t.length;i++)Rl(e,t[i])}(t,s)}catch(n){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),n}finally{t[bn]&=-5,en()}}let My=(()=>{var e;class t{constructor(){this.all=new Set,this.queue=new Map}create(n,r,s){const u=typeof Zone>"u"?null:Zone.current,h=new xe(n,M=>{this.all.has(M)&&this.queue.set(M,u)},s);let _;this.all.add(h),h.notify();const x=()=>{h.cleanup(),_?.(),this.all.delete(h),this.queue.delete(h)};return _=r?.onDestroy(x),{destroy:x}}flush(){if(0!==this.queue.size)for(const[n,r]of this.queue)this.queue.delete(n),r?r.run(()=>n.run()):n.run()}get isQueueEmpty(){return 0===this.queue.size}}return(e=t).\u0275prov=Bt({token:e,providedIn:"root",factory:()=>new e}),t})();function rp(e,t,i){let n=i?e.styles:null,r=i?e.classes:null,s=0;if(null!==t)for(let u=0;u<t.length;u++){const h=t[u];"number"==typeof h?s=h:1==s?r=Oi(r,h):2==s&&(n=Oi(n,h+": "+t[++u]+";"))}i?e.styles=n:e.stylesWithoutHost=n,i?e.classes=r:e.classesWithoutHost=r}function $m(e,t,i,n,r=!1){for(;null!==i;){const s=t[i.index];if(null!==s&&n.push(Et(s)),Co(s)){for(let h=Yr;h<s.length;h++){const _=s[h],x=_[$t].firstChild;null!==x&&$m(_[$t],_,x,n)}s[$s]!==s[sr]&&n.push(s[$s])}const u=i.type;if(8&u)$m(e,t,i.child,n);else if(32&u){const h=j_(i,t);let _;for(;_=h();)n.push(_)}else if(16&u){const h=Ew(t,i);if(Array.isArray(h))n.push(...h);else{const _=xm(t[yr]);$m(_[$t],_,h,n,!0)}}i=r?i.projectionNext:i.next}return n}function To(e,t,i,n=!0){const r=t[ar],s=r.rendererFactory,u=r.afterRenderEventManager;s.begin?.(),u?.begin();try{Dy(e,t,e.template,i)}catch(_){throw n&&Mb(t,_),_}finally{s.end?.(),r.effectManager?.flush(),u?.end()}}function Dy(e,t,i,n){const r=t[bn];if(256!=(256&r)){t[ar].effectManager?.flush(),d_(t);try{$r(t),function u_(e){return Yt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==i&&ke(e,t,i,2,n);const u=3==(3&r);if(u){const x=e.preOrderCheckHooks;null!==x&&Df(t,x,null)}else{const x=e.preOrderHooks;null!==x&&om(t,x,0,null),Yd(t,0)}if(function vh(e){for(let t=Fv(e);null!==t;t=Nv(t)){if(!t[bf])continue;const i=t[vc];for(let n=0;n<i.length;n++){vs(i[n])}}}(t),Tb(t,2),null!==e.contentQueries&&Ma(e,t),u){const x=e.contentCheckHooks;null!==x&&Df(t,x)}else{const x=e.contentHooks;null!==x&&om(t,x,1),Yd(t,1)}!function ae(e,t){const i=e.hostBindingOpCodes;if(null===i)return;const n=N(t,Tu);try{for(let r=0;r<i.length;r++){const s=i[r];if(s<0)Nu(~s);else{const u=s,h=i[++r],_=i[++r];Ru(h,u),n.runInContext(_,2,t[u])}}}finally{null===t[Tu]&&V(t,Tu),Nu(-1)}}(e,t);const h=e.components;null!==h&&vk(t,h,0);const _=e.viewQuery;if(null!==_&&yh(2,_,n),u){const x=e.viewCheckHooks;null!==x&&Df(t,x)}else{const x=e.viewHooks;null!==x&&om(t,x,2),Yd(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[bn]&=-73,Hs(t)}finally{en()}}}function Tb(e,t){for(let i=Fv(e);null!==i;i=Nv(i))for(let n=Yr;n<i.length;n++)yk(i[n],t)}function C9(e,t,i){yk(Tn(t,e),i)}function yk(e,t){if(!function yi(e){return 128==(128&e[bn])}(e))return;const i=e[$t];if(80&e[bn]&&0===t||1024&e[bn]||2===t)Dy(i,e,i.template,e[Zi]);else if(e[Ot]>0){Tb(e,1);const r=e[$t].components;null!==r&&vk(e,r,1)}}function vk(e,t,i){for(let n=0;n<t.length;n++)C9(e,t[n],i)}class Sb{get rootNodes(){const t=this._lView,i=t[$t];return $m(i,t,i.firstChild,[])}constructor(t,i){this._lView=t,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Zi]}set context(t){this._lView[Zi]=t}get destroyed(){return 256==(256&this._lView[bn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[Ni];if(Co(t)){const i=t[8],n=i?i.indexOf(this):-1;n>-1&&(G_(t,n),ws(i,n))}this._attachedToViewContainer=!1}q_(this._lView[$t],this._lView)}onDestroy(t){!function fi(e,t){if(256==(256&e[bn]))throw new gt(911,!1);null===e[Qo]&&(e[Qo]=[]),e[Qo].push(t)}(this._lView,t)}markForCheck(){Vm(this._cdRefInjectingView||this._lView)}detach(){this._lView[bn]&=-129}reattach(){this._lView[bn]|=128}detectChanges(){To(this._lView[$t],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new gt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function wm(e,t){Bf(e,t,t[mn],2,null,null)}(this._lView[$t],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new gt(902,!1);this._appRef=t}}class E9 extends Sb{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;To(t[$t],t,t[Zi],!1)}checkNoChanges(){}get context(){return null}}class bk extends Ms{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const i=Qn(t);return new Ib(i,this.ngModule)}}function xk(e){const t=[];for(let i in e)e.hasOwnProperty(i)&&t.push({propName:e[i],templateName:i});return t}class D9{constructor(t,i){this.injector=t,this.parentInjector=i}get(t,i,n){n=Ld(n);const r=this.injector.get(t,_y,n);return r!==_y||i===_y?r:this.parentInjector.get(t,i,n)}}class Ib extends Qw{get inputs(){const t=this.componentDef,i=t.inputTransforms,n=xk(t.inputs);if(null!==i)for(const r of n)i.hasOwnProperty(r.propName)&&(r.transform=i[r.propName]);return n}get outputs(){return xk(this.componentDef.outputs)}constructor(t,i){super(),this.componentDef=t,this.ngModule=i,this.componentType=t.type,this.selector=function ja(e){return e.map(Jg).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!i}create(t,i,n,r){let s=(r=r||this.ngModule)instanceof Xs?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const u=s?new D9(t,s):t,h=u.get(_b,null);if(null===h)throw new gt(407,!1);const S={rendererFactory:h,sanitizer:u.get(tC,null),effectManager:u.get(My,null),afterRenderEventManager:u.get(by,null)},P=h.createRenderer(null,this.componentDef),F=this.componentDef.selectors[0][0]||"div",$=n?function pt(e,t,i,n){const s=n.get(bb,!1)||i===Nr.ShadowDom,u=e.selectRootElement(t,s);return function $e(e){Mt(e)}(u),u}(P,n,this.componentDef.encapsulation,u):lh(P,F,function M9(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(F)),K=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Q=null;null!==$&&(Q=Fm($,u,!0));const he=Ye(0,null,null,1,0,null,null,null,null,null,null),le=fe(null,he,null,K,null,null,S,P,u,null,Q);let ye,Se;d_(le);try{const Ue=this.componentDef;let Xe,mt=null;Ue.findHostDirectiveDefs?(Xe=[],mt=new Map,Ue.findHostDirectiveDefs(Ue,Xe,mt),Xe.push(Ue)):Xe=[Ue];const bt=function S9(e,t){const i=e[$t],n=jn;return e[n]=t,ge(i,n,2,"#host",null)}(le,$),qe=function I9(e,t,i,n,r,s,u){const h=r[$t];!function A9(e,t,i,n){for(const r of e)t.mergedAttrs=bu(t.mergedAttrs,r.hostAttrs);null!==t.mergedAttrs&&(rp(t,t.mergedAttrs,!0),null!==i&&Tw(n,i,t))}(n,e,t,u);let _=null;null!==t&&(_=Fm(t,r[ms]));const x=s.rendererFactory.createRenderer(t,i);let M=16;i.signals?M=4096:i.onPush&&(M=64);const S=fe(r,Qe(i),null,M,r[e.index],e,s,x,null,null,_);return h.firstCreatePass&&wr(h,e,n.length-1),zc(r,S),r[e.index]=S}(bt,$,Ue,Xe,le,S,P);Se=Dn(he,jn),$&&function O9(e,t,i,n){if(n)zd(e,i,["ng-version",nC.full]);else{const{attrs:r,classes:s}=function gf(e){const t=[],i=[];let n=1,r=2;for(;n<e.length;){let s=e[n];if("string"==typeof s)2===r?""!==s&&t.push(s,e[++n]):8===r&&i.push(s);else{if(!Vs(r))break;r=s}n++}return{attrs:t,classes:i}}(t.selectors[0]);r&&zd(e,i,r),s&&s.length>0&&Dw(e,i,s.join(" "))}}(P,Ue,$,n),void 0!==i&&function k9(e,t,i){const n=e.projection=[];for(let r=0;r<t.length;r++){const s=i[r];n.push(null!=s?Array.from(s):null)}}(Se,this.ngContentSelectors,i),ye=function P9(e,t,i,n,r,s){const u=Kr(),h=r[$t],_=Gt(u,r);wi(h,r,u,i,null,n);for(let M=0;M<i.length;M++)go(qs(r,h,u.directiveStart+M,u),r);nr(h,r,u),_&&go(_,r);const x=qs(r,h,u.directiveStart+u.componentOffset,u);if(e[Zi]=r[Zi]=x,null!==s)for(const M of s)M(x,t);return Ge(h,u,e),x}(qe,Ue,Xe,mt,le,[R9]),Bc(he,le,null)}finally{en()}return new T9(this.componentType,ye,Fc(Se,le),le,Se)}}class T9 extends Kw{constructor(t,i,n,r,s){super(),this.location=n,this._rootLView=r,this._tNode=s,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new E9(r),this.componentType=t}setInput(t,i){const n=this._tNode.inputs;let r;if(null!==n&&(r=n[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),i))return;const s=this._rootLView;jm(s[$t],s,r,t,i),this.previousInputValues.set(t,i),Vm(Tn(this._tNode.index,s))}}get injector(){return new Vo(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function R9(){const e=Kr();p_(ft()[$t],e)}function Si(e){let t=function wk(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),i=!0;const n=[e];for(;t;){let r;if($i(e))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new gt(903,!1);r=t.\u0275dir}if(r){if(i){n.push(r);const u=e;u.inputs=dC(e.inputs),u.inputTransforms=dC(e.inputTransforms),u.declaredInputs=dC(e.declaredInputs),u.outputs=dC(e.outputs);const h=r.hostBindings;h&&z9(e,h);const _=r.viewQuery,x=r.contentQueries;if(_&&F9(e,_),x&&N9(e,x),ha(e.inputs,r.inputs),ha(e.declaredInputs,r.declaredInputs),ha(e.outputs,r.outputs),null!==r.inputTransforms&&(null===u.inputTransforms&&(u.inputTransforms={}),ha(u.inputTransforms,r.inputTransforms)),$i(r)&&r.data.animation){const M=e.data;M.animation=(M.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let u=0;u<s.length;u++){const h=s[u];h&&h.ngInherit&&h(e),h===Si&&(i=!1)}}t=Object.getPrototypeOf(t)}!function L9(e){let t=0,i=null;for(let n=e.length-1;n>=0;n--){const r=e[n];r.hostVars=t+=r.hostVars,r.hostAttrs=bu(r.hostAttrs,i=bu(i,r.hostAttrs))}}(n)}function dC(e){return e===Ko?{}:e===ri?[]:e}function F9(e,t){const i=e.viewQuery;e.viewQuery=i?(n,r)=>{t(n,r),i(n,r)}:t}function N9(e,t){const i=e.contentQueries;e.contentQueries=i?(n,r,s)=>{t(n,r,s),i(n,r,s)}:t}function z9(e,t){const i=e.hostBindings;e.hostBindings=i?(n,r)=>{t(n,r),i(n,r)}:t}function Dk(e){const t=e.inputConfig,i={};for(const n in t)if(t.hasOwnProperty(n)){const r=t[n];Array.isArray(r)&&r[2]&&(i[n]=r[2])}e.inputTransforms=i}function hC(e){return!!e2(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function e2(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Ds(e,t,i){return!Object.is(e[t],i)&&(e[t]=i,!0)}function Fl(e,t,i,n){const r=ft();return Ds(r,Ml(),t)&&(li(),ur(br(),r,e,t,i,n)),Fl}function Sy(e,t,i,n){return Ds(e,Ml(),i)?t+ln(i)+n:U}function yn(e,t,i,n,r,s,u,h){const _=ft(),x=li(),M=e+jn,S=x.firstCreatePass?function c$(e,t,i,n,r,s,u,h,_){const x=t.consts,M=ge(t,e,4,u||null,lr(x,h));di(t,i,M,lr(x,_)),p_(t,M);const S=M.tView=Ye(2,M,n,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,x,null);return null!==t.queries&&(t.queries.template(t,M),S.queries=t.queries.embeddedTView(M)),M}(M,x,_,t,i,n,r,s,u):x.data[M];Gs(S,!1);const P=Bk(x,_,S,e);Xd()&&K_(x,_,P,S),go(P,_),zc(_,_[M]=Gr(P,_,P,S)),$d(S)&&ct(x,_,S),null!=u&&ze(_,S,h)}let Bk=function Vk(e,t,i,n){return Dc(!0),t[mn].createComment("")};function Ft(e,t,i){const n=ft();return Ds(n,Ml(),t)&&Xt(li(),br(),n,e,t,n[mn],i,!1),Ft}function a2(e,t,i,n,r){const u=r?"class":"style";jm(e,i,t.inputs[u],u,n)}function vt(e,t,i,n){const r=ft(),s=li(),u=jn+e,h=r[mn],_=s.firstCreatePass?function p$(e,t,i,n,r,s){const u=t.consts,_=ge(t,e,2,n,lr(u,r));return di(t,i,_,lr(u,s)),null!==_.attrs&&rp(_,_.attrs,!1),null!==_.mergedAttrs&&rp(_,_.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,_),_}(u,s,r,t,i,n):s.data[u],x=Uk(s,r,_,h,t,e);r[u]=x;const M=$d(_);return Gs(_,!0),Tw(h,x,_),32!=(32&_.flags)&&Xd()&&K_(s,r,x,_),0===function zo(){return Yt.lFrame.elementDepthCount}()&&go(x,r),function wf(){Yt.lFrame.elementDepthCount++}(),M&&(ct(s,r,_),Ge(s,_,r)),null!==n&&ze(r,_),vt}function Tt(){let e=Kr();Ga()?Mf():(e=e.parent,Gs(e,!1));const t=e;(function El(e){return Yt.skipHydrationRootTNode===e})(t)&&function im(){Yt.skipHydrationRootTNode=null}(),function xc(){Yt.lFrame.elementDepthCount--}();const i=li();return i.firstCreatePass&&(p_(i,e),jd(e)&&i.queries.elementEnd(e)),null!=t.classesWithoutHost&&function ya(e){return 0!=(8&e.flags)}(t)&&a2(i,t,ft(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function _v(e){return 0!=(16&e.flags)}(t)&&a2(i,t,ft(),t.stylesWithoutHost,!1),Tt}function zn(e,t,i,n){return vt(e,t,i,n),Tt(),zn}let Uk=(e,t,i,n,r,s)=>(Dc(!0),lh(n,r,function zu(){return Yt.lFrame.currentNamespace}()));function bh(e,t,i){const n=ft(),r=li(),s=e+jn,u=r.firstCreatePass?function _$(e,t,i,n,r){const s=t.consts,u=lr(s,n),h=ge(t,e,8,"ng-container",u);return null!==u&&rp(h,u,!0),di(t,i,h,lr(s,r)),null!==t.queries&&t.queries.elementStart(t,h),h}(s,r,n,t,i):r.data[s];Gs(u,!0);const h=$k(r,n,u,e);return n[s]=h,Xd()&&K_(r,n,h,u),go(h,n),$d(u)&&(ct(r,n,u),Ge(r,u,n)),null!=i&&ze(n,u),bh}function xh(){let e=Kr();const t=li();return Ga()?Mf():(e=e.parent,Gs(e,!1)),t.firstCreatePass&&(p_(t,e),jd(e)&&t.queries.elementEnd(e)),xh}let $k=(e,t,i,n)=>(Dc(!0),Nf(t[mn],""));function Fy(){return ft()}function Rb(e){return!!e&&"function"==typeof e.then}function Hk(e){return!!e&&"function"==typeof e.subscribe}function Cr(e,t,i,n){const r=ft(),s=li(),u=Kr();return function qk(e,t,i,n,r,s,u){const h=$d(n),x=e.firstCreatePass&&Cb(e),M=t[Zi],S=wb(t);let P=!0;if(3&n.type||u){const W=Gt(n,t),X=u?u(W):W,K=S.length,Q=u?le=>u(Et(le[n.index])):n.index;let he=null;if(!u&&h&&(he=function b$(e,t,i,n){const r=e.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const u=r[s];if(u===i&&r[s+1]===n){const h=t[_c],_=r[s+2];return h.length>_?h[_]:null}"string"==typeof u&&(s+=2)}return null}(e,t,r,n.index)),null!==he)(he.__ngLastListenerFn__||he).__ngNextListenerFn__=s,he.__ngLastListenerFn__=s,P=!1;else{s=Zk(n,t,M,s,!1);const le=i.listen(X,r,s);S.push(s,le),x&&x.push(r,Q,K,K+1)}}else s=Zk(n,t,M,s,!1);const F=n.outputs;let $;if(P&&null!==F&&($=F[r])){const W=$.length;if(W)for(let X=0;X<W;X+=2){const ye=t[$[X]][$[X+1]].subscribe(s),Se=S.length;S.push(s,ye),x&&x.push(r,n.index,Se,-(Se+1))}}}(s,r,r[mn],u,e,t,n),Cr}function Wk(e,t,i,n){try{return nt(6,t,i),!1!==i(n)}catch(r){return Mb(e,r),!1}finally{nt(7,t,i)}}function Zk(e,t,i,n,r){return function s(u){if(u===Function)return n;Vm(e.componentOffset>-1?Tn(e.index,t):t);let _=Wk(t,i,n,u),x=s.__ngNextListenerFn__;for(;x;)_=Wk(t,i,x,u)&&_,x=x.__ngNextListenerFn__;return r&&!1===_&&u.preventDefault(),_}}function dn(e=1){return function Fu(e){return(Yt.lFrame.contextLView=function h_(e,t){for(;e>0;)t=t[$a],e--;return t}(e,Yt.lFrame.contextLView))[Zi]}(e)}function x$(e,t){let i=null;const n=function sv(e){const t=e.attrs;if(null!=t){const i=t.indexOf(5);if(!(1&i))return t[i+1]}return null}(e);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===n?Kg(e,s,!0):Cu(n,s))return r}else i=r}return i}function Lb(e){const t=ft()[yr][ji];if(!t.projection){const n=t.projection=Mo(e?e.length:1,null),r=n.slice();let s=t.child;for(;null!==s;){const u=e?x$(s,e):0;null!==u&&(r[u]?r[u].projectionNext=s:n[u]=s,r[u]=s),s=s.next}}}function Fb(e,t=0,i){const n=ft(),r=li(),s=ge(r,jn+e,16,null,i||null);null===s.projection&&(s.projection=t),Mf(),(!n[js]||Bo())&&32!=(32&s.flags)&&function Mw(e,t,i){Hv(t[mn],0,t,i,Z_(e,i,t),uh(i.parent||t[ji],i,t))}(r,n,s)}function l2(e,t,i){return c2(e,"",t,"",i),l2}function c2(e,t,i,n,r){const s=ft(),u=Sy(s,t,i,n);return u!==U&&Xt(li(),br(),s,e,u,s[mn],r,!1),c2}function _C(e,t){return e<<17|t<<2}function op(e){return e>>17&32767}function u2(e){return 2|e}function qm(e){return(131068&e)>>2}function d2(e,t){return-131069&e|t<<2}function h2(e){return 1|e}function iR(e,t,i,n,r){const s=e[i+1],u=null===t;let h=n?op(s):qm(s),_=!1;for(;0!==h&&(!1===_||u);){const M=e[h+1];T$(e[h],t)&&(_=!0,e[h+1]=n?h2(M):u2(M)),h=n?op(M):qm(M)}_&&(e[i+1]=n?u2(s):h2(s))}function T$(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&rh(e,t)>=0}const So={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function rR(e){return e.substring(So.key,So.keyEnd)}function oR(e,t){const i=So.textEnd;return i===t?-1:(t=So.keyEnd=function P$(e,t,i){for(;t<i&&e.charCodeAt(t)>32;)t++;return t}(e,So.key=t,i),Ny(e,t,i))}function Ny(e,t,i){for(;t<i&&e.charCodeAt(t)<=32;)t++;return t}function Nl(e,t,i){return Vc(e,t,i,!1),Nl}function Io(e,t){return Vc(e,t,null,!0),Io}function f2(e){!function Uc(e,t,i,n){const r=li(),s=bs(2);r.firstUpdatePass&&dR(r,null,s,n);const u=ft();if(i!==U&&Ds(u,s,i)){const h=r.data[Gi()];if(mR(h,n)&&!uR(r,s)){let _=n?h.classesWithoutHost:h.stylesWithoutHost;null!==_&&(i=Oi(_,i||"")),a2(r,h,u,i,n)}else!function U$(e,t,i,n,r,s,u,h){r===U&&(r=ri);let _=0,x=0,M=0<r.length?r[0]:null,S=0<s.length?s[0]:null;for(;null!==M||null!==S;){const P=_<r.length?r[_+1]:void 0,F=x<s.length?s[x+1]:void 0;let W,$=null;M===S?(_+=2,x+=2,P!==F&&($=S,W=F)):null===S||null!==M&&M<S?(_+=2,$=M):(x+=2,$=S,W=F),null!==$&&fR(e,t,i,n,$,W,u,h),M=_<r.length?r[_]:null,S=x<s.length?s[x]:null}}(r,h,u,u[mn],u[s+1],u[s+1]=function B$(e,t,i){if(null==i||""===i)return ri;const n=[],r=Oc(i);if(Array.isArray(r))for(let s=0;s<r.length;s++)e(n,r[s],!0);else if("object"==typeof r)for(const s in r)r.hasOwnProperty(s)&&e(n,s,r[s]);else"string"==typeof r&&t(n,r);return n}(e,t,i),n,s)}}(V$,nd,e,!0)}function nd(e,t){for(let i=function I$(e){return function aR(e){So.key=0,So.keyEnd=0,So.value=0,So.valueEnd=0,So.textEnd=e.length}(e),oR(e,Ny(e,0,So.textEnd))}(t);i>=0;i=oR(t,i))mo(e,rR(t),!0)}function Vc(e,t,i,n){const r=ft(),s=li(),u=bs(2);s.firstUpdatePass&&dR(s,e,u,n),t!==U&&Ds(r,u,t)&&fR(s,s.data[Gi()],r,r[mn],e,r[u+1]=function j$(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=mi(Oc(e)))),e}(t,i),n,u)}function uR(e,t){return t>=e.expandoStartIndex}function dR(e,t,i,n){const r=e.data;if(null===r[i+1]){const s=r[Gi()],u=uR(e,i);mR(s,n)&&null===t&&!u&&(t=!1),t=function L$(e,t,i,n){const r=function hv(e){const t=Yt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let s=n?t.residualClasses:t.residualStyles;if(null===r)0===(n?t.classBindings:t.styleBindings)&&(i=Nb(i=p2(null,e,t,i,n),t.attrs,n),s=null);else{const u=t.directiveStylingLast;if(-1===u||e[u]!==r)if(i=p2(r,e,t,i,n),null===s){let _=function F$(e,t,i){const n=i?t.classBindings:t.styleBindings;if(0!==qm(n))return e[op(n)]}(e,t,n);void 0!==_&&Array.isArray(_)&&(_=p2(null,e,t,_[1],n),_=Nb(_,t.attrs,n),function N$(e,t,i,n){e[op(i?t.classBindings:t.styleBindings)]=n}(e,t,n,_))}else s=function z$(e,t,i){let n;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)n=Nb(n,e[s].hostAttrs,i);return Nb(n,t.attrs,i)}(e,t,n)}return void 0!==s&&(n?t.residualClasses=s:t.residualStyles=s),i}(r,s,t,n),function M$(e,t,i,n,r,s){let u=s?t.classBindings:t.styleBindings,h=op(u),_=qm(u);e[n]=i;let M,x=!1;if(Array.isArray(i)?(M=i[1],(null===M||rh(i,M)>0)&&(x=!0)):M=i,r)if(0!==_){const P=op(e[h+1]);e[n+1]=_C(P,h),0!==P&&(e[P+1]=d2(e[P+1],n)),e[h+1]=function C$(e,t){return 131071&e|t<<17}(e[h+1],n)}else e[n+1]=_C(h,0),0!==h&&(e[h+1]=d2(e[h+1],n)),h=n;else e[n+1]=_C(_,0),0===h?h=n:e[_+1]=d2(e[_+1],n),_=n;x&&(e[n+1]=u2(e[n+1])),iR(e,M,n,!0),iR(e,M,n,!1),function D$(e,t,i,n,r){const s=r?e.residualClasses:e.residualStyles;null!=s&&"string"==typeof t&&rh(s,t)>=0&&(i[n+1]=h2(i[n+1]))}(t,M,e,n,s),u=_C(h,_),s?t.classBindings=u:t.styleBindings=u}(r,s,t,i,u,n)}}function p2(e,t,i,n,r){let s=null;const u=i.directiveEnd;let h=i.directiveStylingLast;for(-1===h?h=i.directiveStart:h++;h<u&&(s=t[h],n=Nb(n,s.hostAttrs,r),s!==e);)h++;return null!==e&&(i.directiveStylingLast=h),n}function Nb(e,t,i){const n=i?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const u=t[s];"number"==typeof u?r=u:r===n&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),mo(e,u,!!i||t[++s]))}return void 0===e?null:e}function V$(e,t,i){const n=String(t);""!==n&&!n.includes(" ")&&mo(e,n,i)}function fR(e,t,i,n,r,s,u,h){if(!(3&t.type))return;const _=e.data,x=_[h+1],M=function E$(e){return 1==(1&e)}(x)?pR(_,t,i,r,qm(x),u):void 0;yC(M)||(yC(s)||function w$(e){return 2==(2&e)}(x)&&(s=pR(_,null,i,r,h,u)),function ST(e,t,i,n,r){if(t)r?e.addClass(i,n):e.removeClass(i,n);else{let s=-1===n.indexOf("-")?void 0:ki.DashCase;null==r?e.removeStyle(i,n,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=ki.Important),e.setStyle(i,n,r,s))}}(n,u,Ut(Gi(),i),r,s))}function pR(e,t,i,n,r,s){const u=null===t;let h;for(;r>0;){const _=e[r],x=Array.isArray(_),M=x?_[1]:_,S=null===M;let P=i[r+1];P===U&&(P=S?ri:void 0);let F=S?pm(P,n):M===n?P:void 0;if(x&&!yC(F)&&(F=pm(_,n)),yC(F)&&(h=F,u))return h;const $=e[r+1];r=u?op($):qm($)}if(null!==t){let _=s?t.residualClasses:t.residualStyles;null!=_&&(h=pm(_,n))}return h}function yC(e){return void 0!==e}function mR(e,t){return 0!=(e.flags&(t?8:16))}function sn(e,t=""){const i=ft(),n=li(),r=e+jn,s=n.firstCreatePass?ge(n,r,1,t,null):n.data[r],u=gR(n,i,s,t,e);i[r]=u,Xd()&&K_(n,i,u,s),Gs(s,!1)}let gR=(e,t,i,n,r)=>(Dc(!0),function $_(e,t){return e.createText(t)}(t[mn],n));function Yi(e){return Wm("",e,""),Yi}function Wm(e,t,i){const n=ft(),r=Sy(n,e,t,i);return r!==U&&function el(e,t,i){const n=Ut(t,e);!function H_(e,t,i){e.setValue(t,i)}(e[mn],n,i)}(n,Gi(),r),Wm}const By="en-US";let zR=By;function _2(e,t,i,n,r){if(e=an(e),Array.isArray(e))for(let s=0;s<e.length;s++)_2(e[s],t,i,n,r);else{const s=li(),u=ft(),h=Kr();let _=wa(e)?e:an(e.provide);const x=km(e),M=1048575&h.providerIndexes,S=h.directiveStart,P=h.providerIndexes>>20;if(wa(e)||!e.multi){const F=new Tc(x,r,q),$=v2(_,t,r?M:M+P,S);-1===$?(cm(g_(h,u),s,_),y2(s,e,t.length),t.push(_),h.directiveStart++,h.directiveEnd++,r&&(h.providerIndexes+=1048576),i.push(F),u.push(F)):(i[$]=F,u[$]=F)}else{const F=v2(_,t,M+P,S),$=v2(_,t,M,M+P),X=$>=0&&i[$];if(r&&!X||!r&&!(F>=0&&i[F])){cm(g_(h,u),s,_);const K=function cG(e,t,i,n,r){const s=new Tc(e,i,q);return s.multi=[],s.index=t,s.componentProviders=0,cL(s,r,n&&!i),s}(r?lG:aG,i.length,r,n,x);!r&&X&&(i[$].providerFactory=K),y2(s,e,t.length,0),t.push(_),h.directiveStart++,h.directiveEnd++,r&&(h.providerIndexes+=1048576),i.push(K),u.push(K)}else y2(s,e,F>-1?F:$,cL(i[r?$:F],x,!r&&n));!r&&n&&X&&i[$].componentProviders++}}}function y2(e,t,i,n){const r=wa(t),s=function Gf(e){return!!e.useClass}(t);if(r||s){const _=(s?an(t.useClass):t).prototype.ngOnDestroy;if(_){const x=e.destroyHooks||(e.destroyHooks=[]);if(!r&&t.multi){const M=x.indexOf(i);-1===M?x.push(i,[n,_]):x[M+1].push(n,_)}else x.push(i,_)}}}function cL(e,t,i){return i&&e.componentProviders++,e.multi.push(t)-1}function v2(e,t,i,n){for(let r=i;r<n;r++)if(t[r]===e)return r;return-1}function aG(e,t,i,n){return b2(this.multi,[])}function lG(e,t,i,n){const r=this.multi;let s;if(this.providerFactory){const u=this.providerFactory.componentProviders,h=qs(i,i[$t],this.providerFactory.index,n);s=h.slice(0,u),b2(r,s);for(let _=u;_<h.length;_++)s.push(h[_])}else s=[],b2(r,s);return s}function b2(e,t){for(let i=0;i<e.length;i++)t.push((0,e[i])());return t}function Ki(e,t=[]){return i=>{i.providersResolver=(n,r)=>function sG(e,t,i){const n=li();if(n.firstCreatePass){const r=$i(e);_2(i,n.data,n.blueprint,r,!0),_2(t,n.data,n.blueprint,r,!1)}}(n,r?r(e):e,t)}}class Xm{}class uL{}class x2 extends Xm{constructor(t,i,n){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new bk(this);const r=uo(t);this._bootstrapComponents=kl(r.bootstrap),this._r3Injector=Qa(t,i,[{provide:Xm,useValue:this},{provide:Ms,useValue:this.componentFactoryResolver},...n],mi(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class w2 extends uL{constructor(t){super(),this.moduleType=t}create(t){return new x2(this.moduleType,t,[])}}class dL extends Xm{constructor(t){super(),this.componentFactoryResolver=new bk(this),this.instance=null;const i=new Gu([...t.providers,{provide:Xm,useValue:this},{provide:Ms,useValue:this.componentFactoryResolver}],t.parent||qf(),t.debugName,new Set(["environment"]));this.injector=i,t.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function C2(e,t,i=null){return new dL({providers:e,parent:t,debugName:i,runEnvironmentInitializers:!0}).injector}let hG=(()=>{var e;class t{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){const r=Pm(0,n.type),s=r.length>0?C2([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,s)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return(e=t).\u0275prov=Bt({token:e,providedIn:"environment",factory:()=>new e(st(Xs))}),t})();function hL(e){e.getStandaloneInjector=t=>t.get(hG).getOrCreateStandaloneInjector(e)}function sp(e,t,i){const n=function Jo(){const e=Yt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}()+e,r=ft();return r[n]===U?function ed(e,t,i){return e[t]=i}(r,n,i?t.call(i):t()):function Ab(e,t){return e[t]}(r,n)}function M2(e){return t=>{setTimeout(e,void 0,t)}}const rr=class NG extends hi{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,i,n){let r=t,s=i||(()=>null),u=n;if(t&&"object"==typeof t){const _=t;r=_.next?.bind(_),s=_.error?.bind(_),u=_.complete?.bind(_)}this.__isAsync&&(s=M2(s),r&&(r=M2(r)),u&&(u=M2(u)));const h=super.subscribe({next:r,error:s,complete:u});return t instanceof Je&&t.add(h),h}};function zG(){return this._results[Symbol.iterator]()}class D2{get changes(){return this._changes||(this._changes=new rr)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=D2.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=zG)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,i){return this._results.reduce(t,i)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,i){const n=this;n.dirty=!1;const r=function xs(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function bi(e,t,i){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){let r=e[n],s=t[n];if(i&&(r=i(r),s=i(s)),s!==r)return!1}return!0}(n._results,r,i))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function VG(e,t,i,n=!0){const r=t[$t];if(function vw(e,t,i,n){const r=Yr+n,s=i.length;n>0&&(i[r-1][Fo]=t),n<s-Yr?(t[Fo]=i[r],Za(i,Yr+n,t)):(i.push(t),t[Fo]=null),t[Ni]=i;const u=t[wl];null!==u&&i!==u&&function Em(e,t){const i=e[vc];t[yr]!==t[Ni][Ni][yr]&&(e[bf]=!0),null===i?e[vc]=[t]:i.push(t)}(u,t);const h=t[gs];null!==h&&h.insertView(e),t[bn]|=128}(r,t,e,i),n){const s=jv(i,e),u=t[mn],h=io(u,e[$s]);null!==h&&function MT(e,t,i,n,r,s){n[sr]=r,n[ji]=t,Bf(e,n,i,1,r,s)}(r,e[ji],u,t,h,s)}}let wh=(()=>{class t{}return t.__NG_ELEMENT_ID__=$G,t})();const UG=wh,jG=class extends UG{constructor(t,i,n){super(),this._declarationLView=t,this._declarationTContainer=i,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,i){return this.createEmbeddedViewImpl(t,i)}createEmbeddedViewImpl(t,i,n){const r=function BG(e,t,i,n){const r=t.tView,h=fe(e,r,i,4096&e[bn]?4096:16,null,t,null,null,null,n?.injector??null,n?.hydrationInfo??null);h[wl]=e[t.index];const x=e[gs];return null!==x&&(h[gs]=x.createEmbeddedView(r)),Bc(r,h,i),h}(this._declarationLView,this._declarationTContainer,t,{injector:i,hydrationInfo:n});return new Sb(r)}};function $G(){return CC(Kr(),ft())}function CC(e,t){return 4&e.type?new jG(t,e,Fc(e,t)):null}let zl=(()=>{class t{}return t.__NG_ELEMENT_ID__=XG,t})();function XG(){return AL(Kr(),ft())}const YG=zl,SL=class extends YG{constructor(t,i,n){super(),this._lContainer=t,this._hostTNode=i,this._hostLView=n}get element(){return Fc(this._hostTNode,this._hostLView)}get injector(){return new Vo(this._hostTNode,this._hostLView)}get parentInjector(){const t=Bu(this._hostTNode,this._hostLView);if(eh(t)){const i=am(t,this._hostLView),n=ts(t);return new Vo(i[$t].data[n+8],i)}return new Vo(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const i=IL(this._lContainer);return null!==i&&i[t]||null}get length(){return this._lContainer.length-Yr}createEmbeddedView(t,i,n){let r,s;"number"==typeof n?r=n:null!=n&&(r=n.index,s=n.injector);const h=t.createEmbeddedViewImpl(i||{},s,null);return this.insertImpl(h,r,false),h}createComponent(t,i,n,r,s){const u=t&&!function ba(e){return"function"==typeof e}(t);let h;if(u)h=i;else{const W=i||{};h=W.index,n=W.injector,r=W.projectableNodes,s=W.environmentInjector||W.ngModuleRef}const _=u?t:new Ib(Qn(t)),x=n||this.parentInjector;if(!s&&null==_.ngModule){const X=(u?x:this.parentInjector).get(Xs,null);X&&(s=X)}Qn(_.componentType??{});const F=_.create(x,r,null,s);return this.insertImpl(F.hostView,h,false),F}insert(t,i){return this.insertImpl(t,i,!1)}insertImpl(t,i,n){const r=t._lView;if(function vi(e){return Co(e[Ni])}(r)){const _=this.indexOf(t);if(-1!==_)this.detach(_);else{const x=r[Ni],M=new SL(x,x[ji],x[Ni]);M.detach(M.indexOf(t))}}const u=this._adjustIndex(i),h=this._lContainer;return VG(h,r,u,!n),t.attachToViewContainerRef(),Za(T2(h),u,t),t}move(t,i){return this.insert(t,i)}indexOf(t){const i=IL(this._lContainer);return null!==i?i.indexOf(t):-1}remove(t){const i=this._adjustIndex(t,-1),n=G_(this._lContainer,i);n&&(ws(T2(this._lContainer),i),q_(n[$t],n))}detach(t){const i=this._adjustIndex(t,-1),n=G_(this._lContainer,i);return n&&null!=ws(T2(this._lContainer),i)?new Sb(n):null}_adjustIndex(t,i=0){return t??this.length+i}};function IL(e){return e[8]}function T2(e){return e[8]||(e[8]=[])}function AL(e,t){let i;const n=t[e.index];return Co(n)?i=n:(i=Gr(n,t,null,e),t[e.index]=i,zc(t,i)),PL(i,t,e,n),new SL(i,e,t)}let PL=function OL(e,t,i,n){if(e[$s])return;let r;r=8&i.type?Et(n):function KG(e,t){const i=e[mn],n=i.createComment(""),r=Gt(t,e);return ch(i,io(i,r),n,function Mm(e,t){return e.nextSibling(t)}(i,r),!1),n}(t,i),e[$s]=r};class S2{constructor(t){this.queryList=t,this.matches=null}clone(){return new S2(this.queryList)}setDirty(){this.queryList.setDirty()}}class I2{constructor(t=[]){this.queries=t}createEmbeddedView(t){const i=t.queries;if(null!==i){const n=null!==t.contentQueries?t.contentQueries[0]:i.length,r=[];for(let s=0;s<n;s++){const u=i.getByIndex(s);r.push(this.queries[u.indexInDeclarationView].clone())}return new I2(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let i=0;i<this.queries.length;i++)null!==NL(t,i).matches&&this.queries[i].setDirty()}}class kL{constructor(t,i,n=null){this.predicate=t,this.flags=i,this.read=n}}class A2{constructor(t=[]){this.queries=t}elementStart(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,i)}elementEnd(t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(t)}embeddedTView(t){let i=null;for(let n=0;n<this.length;n++){const r=null!==i?i.length:0,s=this.getByIndex(n).embeddedTView(t,r);s&&(s.indexInDeclarationView=n,null!==i?i.push(s):i=[s])}return null!==i?new A2(i):null}template(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,i)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class P2{constructor(t,i=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(t,i){this.isApplyingToNode(i)&&this.matchTNode(t,i)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,i){this.elementStart(t,i)}embeddedTView(t,i){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,i),new P2(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let n=t.parent;for(;null!==n&&8&n.type&&n.index!==i;)n=n.parent;return i===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(t,i){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const s=n[r];this.matchTNodeWithReadOption(t,i,eq(i,s)),this.matchTNodeWithReadOption(t,i,b_(i,t,s,!1,!1))}else n===wh?4&i.type&&this.matchTNodeWithReadOption(t,i,-1):this.matchTNodeWithReadOption(t,i,b_(i,t,n,!1,!1))}matchTNodeWithReadOption(t,i,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===cr||r===zl||r===wh&&4&i.type)this.addMatch(i.index,-2);else{const s=b_(i,t,r,!1,!1);null!==s&&this.addMatch(i.index,s)}else this.addMatch(i.index,n)}}addMatch(t,i){null===this.matches?this.matches=[t,i]:this.matches.push(t,i)}}function eq(e,t){const i=e.localNames;if(null!==i)for(let n=0;n<i.length;n+=2)if(i[n]===t)return i[n+1];return null}function nq(e,t,i,n){return-1===i?function tq(e,t){return 11&e.type?Fc(e,t):4&e.type?CC(e,t):null}(t,e):-2===i?function iq(e,t,i){return i===cr?Fc(t,e):i===wh?CC(t,e):i===zl?AL(t,e):void 0}(e,t,n):qs(e,e[$t],i,t)}function RL(e,t,i,n){const r=t[gs].queries[n];if(null===r.matches){const s=e.data,u=i.matches,h=[];for(let _=0;_<u.length;_+=2){const x=u[_];h.push(x<0?null:nq(t,s[x],u[_+1],i.metadata.read))}r.matches=h}return r.matches}function O2(e,t,i,n){const r=e.queries.getByIndex(i),s=r.matches;if(null!==s){const u=RL(e,t,r,i);for(let h=0;h<s.length;h+=2){const _=s[h];if(_>0)n.push(u[h/2]);else{const x=s[h+1],M=t[-_];for(let S=Yr;S<M.length;S++){const P=M[S];P[wl]===P[Ni]&&O2(P[$t],P,x,n)}if(null!==M[vc]){const S=M[vc];for(let P=0;P<S.length;P++){const F=S[P];O2(F[$t],F,x,n)}}}}}return n}function Bl(e){const t=ft(),i=li(),n=U1();fv(n+1);const r=NL(i,n);if(e.dirty&&function _i(e){return 4==(4&e[bn])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)e.reset([]);else{const s=r.crossesNgTemplate?O2(i,t,n,[]):RL(i,t,r,n);e.reset(s,eC),e.notifyOnChanges()}return!0}return!1}function Ch(e,t,i){const n=li();n.firstCreatePass&&(FL(n,new kL(e,t,i),-1),2==(2&t)&&(n.staticViewQueries=!0)),LL(n,ft(),t)}function MC(e,t,i,n){const r=li();if(r.firstCreatePass){const s=Kr();FL(r,new kL(t,i,n),s.index),function oq(e,t){const i=e.contentQueries||(e.contentQueries=[]);t!==(i.length?i[i.length-1]:-1)&&i.push(e.queries.length-1,t)}(r,e),2==(2&i)&&(r.staticContentQueries=!0)}LL(r,ft(),i)}function Vl(){return function rq(e,t){return e[gs].queries[t].queryList}(ft(),U1())}function LL(e,t,i){const n=new D2(4==(4&i));(function gn(e,t,i,n){const r=wb(t);r.push(i),e.firstCreatePass&&Cb(e).push(n,r.length-1)})(e,t,n,n.destroy),null===t[gs]&&(t[gs]=new I2),t[gs].queries.push(new S2(n))}function FL(e,t,i){null===e.queries&&(e.queries=new A2),e.queries.track(new P2(t,i))}function NL(e,t){return e.queries.getByIndex(t)}const z2=new kt("Application Initializer");let B2=(()=>{var e;class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,r)=>{this.resolve=n,this.reject=r}),this.appInits=Vt(z2,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const s of this.appInits){const u=s();if(Rb(u))n.push(u);else if(Hk(u)){const h=new Promise((_,x)=>{u.subscribe({complete:_,error:x})});n.push(h)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{r()}).catch(s=>{this.reject(s)}),0===n.length&&r(),this.initialized=!0}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),eF=(()=>{var e;class t{log(n){console.log(n)}warn(n){console.warn(n)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})();const id=new kt("LocaleId",{providedIn:"root",factory:()=>Vt(id,Zt.Optional|Zt.SkipSelf)||function Tq(){return typeof $localize<"u"&&$localize.locale||By}()});let TC=(()=>{var e;class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Sr(!1)}add(){this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class Aq{constructor(t,i){this.ngModuleFactory=t,this.componentFactories=i}}let tF=(()=>{var e;class t{compileModuleSync(n){return new w2(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),u=kl(uo(n).declarations).reduce((h,_)=>{const x=Qn(_);return x&&h.push(new Ib(x)),h},[]);return new Aq(r,u)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function oF(...e){}class oi{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new rr(!1),this.onMicrotaskEmpty=new rr(!1),this.onStable=new rr(!1),this.onError=new rr(!1),typeof Zone>"u")throw new gt(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&i,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function Yq(){const e="function"==typeof gi.requestAnimationFrame;let t=gi[e?"requestAnimationFrame":"setTimeout"],i=gi[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&i){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const r=i[Zone.__symbol__("OriginalDelegate")];r&&(i=r)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:i}}().nativeRequestAnimationFrame,function Jq(e){const t=()=>{!function Qq(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(gi,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,$2(e),e.isCheckStableRunning=!0,j2(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),$2(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,n,r,s,u,h)=>{try{return sF(e),i.invokeTask(r,s,u,h)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&t(),aF(e)}},onInvoke:(i,n,r,s,u,h,_)=>{try{return sF(e),i.invoke(r,s,u,h,_)}finally{e.shouldCoalesceRunChangeDetection&&t(),aF(e)}},onHasTask:(i,n,r,s)=>{i.hasTask(r,s),n===r&&("microTask"==s.change?(e._hasPendingMicrotasks=s.microTask,$2(e),j2(e)):"macroTask"==s.change&&(e.hasPendingMacrotasks=s.macroTask))},onHandleError:(i,n,r,s)=>(i.handleError(r,s),e.runOutsideAngular(()=>e.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!oi.isInAngularZone())throw new gt(909,!1)}static assertNotInAngularZone(){if(oi.isInAngularZone())throw new gt(909,!1)}run(t,i,n){return this._inner.run(t,i,n)}runTask(t,i,n,r){const s=this._inner,u=s.scheduleEventTask("NgZoneEvent: "+r,t,Kq,oF,oF);try{return s.runTask(u,i,n)}finally{s.cancelTask(u)}}runGuarded(t,i,n){return this._inner.runGuarded(t,i,n)}runOutsideAngular(t){return this._outer.run(t)}}const Kq={};function j2(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function $2(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function sF(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function aF(e){e._nesting--,j2(e)}class eW{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new rr,this.onMicrotaskEmpty=new rr,this.onStable=new rr,this.onError=new rr}run(t,i,n){return t.apply(i,n)}runGuarded(t,i,n){return t.apply(i,n)}runOutsideAngular(t){return t()}runTask(t,i,n,r){return t.apply(i,n)}}const lF=new kt("",{providedIn:"root",factory:cF});function cF(){const e=Vt(oi);let t=!0;return Lt(new On(r=>{t=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{r.next(t),r.complete()})}),new On(r=>{let s;e.runOutsideAngular(()=>{s=e.onStable.subscribe(()=>{oi.assertNotInAngularZone(),queueMicrotask(()=>{!t&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(t=!0,r.next(!0))})})});const u=e.onUnstable.subscribe(()=>{oi.assertInAngularZone(),t&&(t=!1,e.runOutsideAngular(()=>{r.next(!1)}))});return()=>{s.unsubscribe(),u.unsubscribe()}}).pipe(In()))}const uF=new kt(""),IC=new kt("");let q2,H2=(()=>{var e;class t{constructor(n,r,s){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,q2||(function tW(e){q2=e}(s),s.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{oi.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,s){let u=-1;r&&r>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(h=>h.timeoutId!==u),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:u,updateCb:s})}whenStable(n,r,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,s){return[]}}return(e=t).\u0275fac=function(n){return new(n||e)(st(oi),st(G2),st(IC))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})(),G2=(()=>{var e;class t{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return q2?.findTestabilityInTree(this,n,r)??null}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})(),ap=null;const dF=new kt("AllowMultipleToken"),W2=new kt("PlatformDestroyListeners"),Z2=new kt("appBootstrapListener");class fF{constructor(t,i){this.name=t,this.token=i}}function mF(e,t,i=[]){const n=`Platform: ${t}`,r=new kt(n);return(s=[])=>{let u=X2();if(!u||u.injector.get(dF,!1)){const h=[...i,...s,{provide:r,useValue:!0}];e?e(h):function rW(e){if(ap&&!ap.get(dF,!1))throw new gt(400,!1);(function hF(){!function se(e){oe=e}(()=>{throw new gt(600,!1)})})(),ap=e;const t=e.get(_F);(function pF(e){e.get(Wf,null)?.forEach(i=>i())})(e)}(function gF(e=[],t){return Do.create({name:t,providers:[{provide:Om,useValue:"platform"},{provide:W2,useValue:new Set([()=>ap=null])},...e]})}(h,n))}return function sW(e){const t=X2();if(!t)throw new gt(401,!1);return t}()}}function X2(){return ap?.get(_F)??null}let _F=(()=>{var e;class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const s=function aW(e="zone.js",t){return"noop"===e?new eW:"zone.js"===e?new oi(t):e}(r?.ngZone,function yF(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return s.run(()=>{const u=function dG(e,t,i){return new x2(e,t,i)}(n.moduleType,this.injector,function CF(e){return[{provide:oi,useFactory:e},{provide:Hf,multi:!0,useFactory:()=>{const t=Vt(cW,{optional:!0});return()=>t.initialize()}},{provide:wF,useFactory:lW},{provide:lF,useFactory:cF}]}(()=>s)),h=u.injector.get(Qu,null);return s.runOutsideAngular(()=>{const _=s.onError.subscribe({next:x=>{h.handleError(x)}});u.onDestroy(()=>{AC(this._modules,u),_.unsubscribe()})}),function vF(e,t,i){try{const n=i();return Rb(n)?n.catch(r=>{throw t.runOutsideAngular(()=>e.handleError(r)),r}):n}catch(n){throw t.runOutsideAngular(()=>e.handleError(n)),n}}(h,s,()=>{const _=u.injector.get(B2);return _.runInitializers(),_.donePromise.then(()=>(function BR(e){fs(e,"Expected localeId to be defined"),"string"==typeof e&&(zR=e.toLowerCase().replace(/_/g,"-"))}(u.injector.get(id,By)||By),this._moduleDoBootstrap(u),u))})})}bootstrapModule(n,r=[]){const s=bF({},r);return function nW(e,t,i){const n=new w2(i);return Promise.resolve(n)}(0,0,n).then(u=>this.bootstrapModuleFactory(u,s))}_moduleDoBootstrap(n){const r=n.injector.get(Ym);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(s=>r.bootstrap(s));else{if(!n.instance.ngDoBootstrap)throw new gt(-403,!1);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new gt(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const n=this._injector.get(W2,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Do))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})();function bF(e,t){return Array.isArray(t)?t.reduce(bF,e):{...e,...t}}let Ym=(()=>{var e;class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Vt(wF),this.zoneIsStable=Vt(lF),this.componentTypes=[],this.components=[],this.isStable=Vt(TC).hasPendingTasks.pipe(Ar(n=>n?Dt(!1):this.zoneIsStable),An(),In()),this._injector=Vt(Xs)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const s=n instanceof Qw;if(!this._injector.get(B2).done)throw!s&&function mc(e){const t=Qn(e)||zr(e)||Br(e);return null!==t&&t.standalone}(n),new gt(405,!1);let h;h=s?n:this._injector.get(Ms).resolveComponentFactory(n),this.componentTypes.push(h.componentType);const _=function iW(e){return e.isBoundToModule}(h)?void 0:this._injector.get(Xm),M=h.create(Do.NULL,[],r||h.selector,_),S=M.location.nativeElement,P=M.injector.get(uF,null);return P?.registerApplication(S),M.onDestroy(()=>{this.detachView(M.hostView),AC(this.components,M),P?.unregisterApplication(S)}),this._loadComponent(M),M}tick(){if(this._runningTick)throw new gt(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this.internalErrorHandler(n)}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;AC(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const r=this._injector.get(Z2,[]);r.push(...this._bootstrapListeners),r.forEach(s=>s(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>AC(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new gt(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function AC(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}const wF=new kt("",{providedIn:"root",factory:()=>Vt(Qu).handleError.bind(void 0)});function lW(){const e=Vt(oi),t=Vt(Qu);return i=>e.runOutsideAngular(()=>t.handleError(i))}let cW=(()=>{var e;class t{constructor(){this.zone=Vt(oi),this.applicationRef=Vt(Ym)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();let rd=(()=>{class t{}return t.__NG_ELEMENT_ID__=dW,t})();function dW(e){return function hW(e,t,i){if(Cl(e)&&!i){const n=Tn(e.index,t);return new Sb(n,n)}return 47&e.type?new Sb(t[yr],t):null}(Kr(),ft(),16==(16&e))}class TF{constructor(){}supports(t){return hC(t)}create(t){return new yW(t)}}const _W=(e,t)=>t;class yW{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||_W}forEachItem(t){let i;for(i=this._itHead;null!==i;i=i._next)t(i)}forEachOperation(t){let i=this._itHead,n=this._removalsHead,r=0,s=null;for(;i||n;){const u=!n||i&&i.currentIndex<IF(n,r,s)?i:n,h=IF(u,r,s),_=u.currentIndex;if(u===n)r--,n=n._nextRemoved;else if(i=i._next,null==u.previousIndex)r++;else{s||(s=[]);const x=h-r,M=_-r;if(x!=M){for(let P=0;P<x;P++){const F=P<s.length?s[P]:s[P]=0,$=F+P;M<=$&&$<x&&(s[P]=F+1)}s[u.previousIndex]=M-x}}h!==_&&t(u,h,_)}}forEachPreviousItem(t){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)t(i)}forEachMovedItem(t){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)t(i)}forEachIdentityChange(t){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)t(i)}diff(t){if(null==t&&(t=[]),!hC(t))throw new gt(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,u,i=this._itHead,n=!1;if(Array.isArray(t)){this.length=t.length;for(let h=0;h<this.length;h++)s=t[h],u=this._trackByFn(h,s),null!==i&&Object.is(i.trackById,u)?(n&&(i=this._verifyReinsertion(i,s,u,h)),Object.is(i.item,s)||this._addIdentityChange(i,s)):(i=this._mismatch(i,s,u,h),n=!0),i=i._next}else r=0,function G9(e,t){if(Array.isArray(e))for(let i=0;i<e.length;i++)t(e[i]);else{const i=e[Symbol.iterator]();let n;for(;!(n=i.next()).done;)t(n.value)}}(t,h=>{u=this._trackByFn(r,h),null!==i&&Object.is(i.trackById,u)?(n&&(i=this._verifyReinsertion(i,h,u,r)),Object.is(i.item,h)||this._addIdentityChange(i,h)):(i=this._mismatch(i,h,u,r),n=!0),i=i._next,r++}),this.length=r;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,i,n,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._moveAfter(t,s,r)):t=this._addAfter(new vW(i,n),s,r),t}_verifyReinsertion(t,i,n,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const i=t._next;this._addToRemovals(this._unlink(t)),t=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,i,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,i,n),this._addToMoves(t,n),t}_moveAfter(t,i,n){return this._unlink(t),this._insertAfter(t,i,n),this._addToMoves(t,n),t}_addAfter(t,i,n){return this._insertAfter(t,i,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,i,n){const r=null===i?this._itHead:i._next;return t._next=r,t._prev=i,null===r?this._itTail=t:r._prev=t,null===i?this._itHead=t:i._next=t,null===this._linkedRecords&&(this._linkedRecords=new SF),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const i=t._prev,n=t._next;return null===i?this._itHead=n:i._next=n,null===n?this._itTail=i:n._prev=i,t}_addToMoves(t,i){return t.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new SF),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,i){return t.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class vW{constructor(t,i){this.item=t,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class bW{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,i){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===i||i<=n.currentIndex)&&Object.is(n.trackById,t))return n;return null}remove(t){const i=t._prevDup,n=t._nextDup;return null===i?this._head=n:i._nextDup=n,null===n?this._tail=i:n._prevDup=i,null===this._head}}class SF{constructor(){this.map=new Map}put(t){const i=t.trackById;let n=this.map.get(i);n||(n=new bW,this.map.set(i,n)),n.add(t)}get(t,i){const r=this.map.get(t);return r?r.get(t,i):null}remove(t){const i=t.trackById;return this.map.get(i).remove(t)&&this.map.delete(i),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function IF(e,t,i){const n=e.previousIndex;if(null===n)return n;let r=0;return i&&n<i.length&&(r=i[n]),n+t+r}class AF{constructor(){}supports(t){return t instanceof Map||e2(t)}create(){return new xW}}class xW{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let i;for(i=this._mapHead;null!==i;i=i._next)t(i)}forEachPreviousItem(t){let i;for(i=this._previousMapHead;null!==i;i=i._nextPrevious)t(i)}forEachChangedItem(t){let i;for(i=this._changesHead;null!==i;i=i._nextChanged)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)t(i)}diff(t){if(t){if(!(t instanceof Map||e2(t)))throw new gt(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(t,(n,r)=>{if(i&&i.key===r)this._maybeAddToChanges(i,n),this._appendAfter=i,i=i._next;else{const s=this._getOrCreateRecordForKey(r,n);i=this._insertBeforeOrAppend(i,s)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let n=i;null!==n;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,i){if(t){const n=t._prev;return i._next=t,i._prev=n,t._prev=i,n&&(n._next=i),t===this._mapHead&&(this._mapHead=i),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(t,i){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,i);const s=r._prev,u=r._next;return s&&(s._next=u),u&&(u._prev=s),r._next=null,r._prev=null,r}const n=new wW(t);return this._records.set(t,n),n.currentValue=i,this._addToAdditions(n),n}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,i){Object.is(i,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=i,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,i){t instanceof Map?t.forEach(i):Object.keys(t).forEach(n=>i(t[n],n))}}class wW{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function PF(){return new kC([new TF])}let kC=(()=>{var e;class t{constructor(n){this.factories=n}static create(n,r){if(null!=r){const s=r.factories.slice();n=n.concat(s)}return new t(n)}static extend(n){return{provide:t,useFactory:r=>t.create(n,r||PF()),deps:[[t,new M_,new E_]]}}find(n){const r=this.factories.find(s=>s.supports(n));if(null!=r)return r;throw new gt(901,!1)}}return(e=t).\u0275prov=Bt({token:e,providedIn:"root",factory:PF}),t})();function OF(){return new Wb([new AF])}let Wb=(()=>{var e;class t{constructor(n){this.factories=n}static create(n,r){if(r){const s=r.factories.slice();n=n.concat(s)}return new t(n)}static extend(n){return{provide:t,useFactory:r=>t.create(n,r||OF()),deps:[[t,new M_,new E_]]}}find(n){const r=this.factories.find(s=>s.supports(n));if(r)return r;throw new gt(901,!1)}}return(e=t).\u0275prov=Bt({token:e,providedIn:"root",factory:OF}),t})();const MW=mF(null,"core",[]);let DW=(()=>{var e;class t{constructor(n){}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Ym))},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({}),t})();function jy(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let tS=null;function lp(){return tS}class VW{}const Qi=new kt("DocumentToken");let nS=(()=>{var e;class t{historyGo(n){throw new Error("Not implemented")}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:function(){return Vt(jW)},providedIn:"platform"}),t})();const UW=new kt("Location Initialized");let jW=(()=>{var e;class t extends nS{constructor(){super(),this._doc=Vt(Qi),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return lp().getBaseHref(this._doc)}onPopState(n){const r=lp().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=lp().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,r,s){this._history.pushState(n,r,s)}replaceState(n,r,s){this._history.replaceState(n,r,s)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:function(){return new e},providedIn:"platform"}),t})();function iS(e,t){if(0==e.length)return t;if(0==t.length)return e;let i=0;return e.endsWith("/")&&i++,t.startsWith("/")&&i++,2==i?e+t.substring(1):1==i?e+t:e+"/"+t}function VF(e){const t=e.match(/#|\?|$/),i=t&&t.index||e.length;return e.slice(0,i-("/"===e[i-1]?1:0))+e.slice(i)}function Eh(e){return e&&"?"!==e[0]?"?"+e:e}let Qm=(()=>{var e;class t{historyGo(n){throw new Error("Not implemented")}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:function(){return Vt(jF)},providedIn:"root"}),t})();const UF=new kt("appBaseHref");let jF=(()=>{var e;class t extends Qm{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Vt(Qi).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return iS(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+Eh(this._platformLocation.search),s=this._platformLocation.hash;return s&&n?`${r}${s}`:r}pushState(n,r,s,u){const h=this.prepareExternalUrl(s+Eh(u));this._platformLocation.pushState(n,r,h)}replaceState(n,r,s,u){const h=this.prepareExternalUrl(s+Eh(u));this._platformLocation.replaceState(n,r,h)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(nS),st(UF,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),$W=(()=>{var e;class t extends Qm{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=iS(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,s,u){let h=this.prepareExternalUrl(s+Eh(u));0==h.length&&(h=this._platformLocation.pathname),this._platformLocation.pushState(n,r,h)}replaceState(n,r,s,u){let h=this.prepareExternalUrl(s+Eh(u));0==h.length&&(h=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,h)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(nS),st(UF,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})(),LC=(()=>{var e;class t{constructor(n){this._subject=new rr,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._basePath=function qW(e){if(new RegExp("^(https?:)?//").test(e)){const[,i]=e.split(/\/\/[^\/]+/);return i}return e}(VF($F(r))),this._locationStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Eh(r))}normalize(n){return t.stripTrailingSlash(function GW(e,t){if(!e||!t.startsWith(e))return t;const i=t.substring(e.length);return""===i||["/",";","?","#"].includes(i[0])?i:t}(this._basePath,$F(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",s=null){this._locationStrategy.pushState(s,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Eh(r)),s)}replaceState(n,r="",s=null){this._locationStrategy.replaceState(s,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Eh(r)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(s=>s(n,r))}subscribe(n,r,s){return this._subject.subscribe({next:n,error:r,complete:s})}}return(e=t).normalizeQueryParams=Eh,e.joinWithSlash=iS,e.stripTrailingSlash=VF,e.\u0275fac=function(n){return new(n||e)(st(Qm))},e.\u0275prov=Bt({token:e,factory:function(){return function HW(){return new LC(st(Qm))}()},providedIn:"root"}),t})();function $F(e){return e.replace(/\/index.html$/,"")}function QF(e,t){t=encodeURIComponent(t);for(const i of e.split(";")){const n=i.indexOf("="),[r,s]=-1==n?[i,""]:[i.slice(0,n),i.slice(n+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}const fS=/\s+/,JF=[];let e5=(()=>{var e;class t{constructor(n,r,s,u){this._iterableDiffers=n,this._keyValueDiffers=r,this._ngEl=s,this._renderer=u,this.initialClasses=JF,this.stateMap=new Map}set klass(n){this.initialClasses=null!=n?n.trim().split(fS):JF}set ngClass(n){this.rawClass="string"==typeof n?n.trim().split(fS):n}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const n=this.rawClass;if(Array.isArray(n)||n instanceof Set)for(const r of n)this._updateState(r,!0);else if(null!=n)for(const r of Object.keys(n))this._updateState(r,!!n[r]);this._applyStateDiff()}_updateState(n,r){const s=this.stateMap.get(n);void 0!==s?(s.enabled!==r&&(s.changed=!0,s.enabled=r),s.touched=!0):this.stateMap.set(n,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const n of this.stateMap){const r=n[0],s=n[1];s.changed?(this._toggleClass(r,s.enabled),s.changed=!1):s.touched||(s.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),s.touched=!1}}_toggleClass(n,r){(n=n.trim()).length>0&&n.split(fS).forEach(s=>{r?this._renderer.addClass(this._ngEl.nativeElement,s):this._renderer.removeClass(this._ngEl.nativeElement,s)})}}return(e=t).\u0275fac=function(n){return new(n||e)(q(kC),q(Wb),q(cr),q(Ka))},e.\u0275dir=Pt({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),t})();class PZ{constructor(t,i,n,r){this.$implicit=t,this.ngForOf=i,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Jm=(()=>{var e;class t{set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}constructor(n,r,s){this._viewContainer=n,this._template=r,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const r=this._viewContainer;n.forEachOperation((s,u,h)=>{if(null==s.previousIndex)r.createEmbeddedView(this._template,new PZ(s.item,this._ngForOf,-1,-1),null===h?void 0:h);else if(null==h)r.remove(null===u?void 0:u);else if(null!==u){const _=r.get(u);r.move(_,h),n5(_,s)}});for(let s=0,u=r.length;s<u;s++){const _=r.get(s).context;_.index=s,_.count=u,_.ngForOf=this._ngForOf}n.forEachIdentityChange(s=>{n5(r.get(s.currentIndex),s)})}static ngTemplateContextGuard(n,r){return!0}}return(e=t).\u0275fac=function(n){return new(n||e)(q(zl),q(wh),q(kC))},e.\u0275dir=Pt({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),t})();function n5(e,t){e.context.$implicit=t.item}let Sa=(()=>{var e;class t{constructor(n,r){this._viewContainer=n,this._context=new OZ,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){r5("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){r5("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,r){return!0}}return(e=t).\u0275fac=function(n){return new(n||e)(q(zl),q(wh))},e.\u0275dir=Pt({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),t})();class OZ{constructor(){this.$implicit=null,this.ngIf=null}}function r5(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${mi(t)}'.`)}let yS=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({}),t})();const a5="browser";function l5(e){return"server"===e}let aX=(()=>{var e;class t{}return(e=t).\u0275prov=Bt({token:e,providedIn:"root",factory:()=>new lX(st(Qi),window)}),t})();class lX{constructor(t,i){this.document=t,this.window=i,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const i=function cX(e,t){const i=e.getElementById(t)||e.getElementsByName(t)[0];if(i)return i;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=n.currentNode;for(;r;){const s=r.shadowRoot;if(s){const u=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(u)return u}r=n.nextNode()}}return null}(this.document,t);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(t){this.supportsScrolling()&&(this.window.history.scrollRestoration=t)}scrollToElement(t){const i=t.getBoundingClientRect(),n=i.left+this.window.pageXOffset,r=i.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(n-s[0],r-s[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class c5{}class OX extends VW{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class xS extends OX{static makeCurrent(){!function BW(e){tS||(tS=e)}(new xS)}onAndCancel(t,i,n){return t.addEventListener(i,n),()=>{t.removeEventListener(i,n)}}dispatchEvent(t,i){t.dispatchEvent(i)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,i){return(i=i||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,i){return"window"===i?window:"document"===i?t:"body"===i?t.body:null}getBaseHref(t){const i=function kX(){return Kb=Kb||document.querySelector("base"),Kb?Kb.getAttribute("href"):null}();return null==i?null:function RX(e){ZC=ZC||document.createElement("a"),ZC.setAttribute("href",e);const t=ZC.pathname;return"/"===t.charAt(0)?t:`/${t}`}(i)}resetBaseElement(){Kb=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return QF(document.cookie,t)}}let ZC,Kb=null,FX=(()=>{var e;class t{build(){return new XMLHttpRequest}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();const wS=new kt("EventManagerPlugins");let p5=(()=>{var e;class t{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(s=>{s.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,r,s){return this._findPluginFor(r).addEventListener(n,r,s)}getZone(){return this._zone}_findPluginFor(n){let r=this._eventNameToPlugin.get(n);if(r)return r;if(r=this._plugins.find(u=>u.supports(n)),!r)throw new gt(5101,!1);return this._eventNameToPlugin.set(n,r),r}}return(e=t).\u0275fac=function(n){return new(n||e)(st(wS),st(oi))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();class m5{constructor(t){this._doc=t}}const CS="ng-app-id";let g5=(()=>{var e;class t{constructor(n,r,s,u={}){this.doc=n,this.appId=r,this.nonce=s,this.platformId=u,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=l5(u),this.resetHostNodes()}addStyles(n){for(const r of n)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(n){for(const r of n)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(r=>r.remove()),n.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const r of this.getAllStyles())this.addStyleToHost(n,r)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const r of this.hostNodes)this.addStyleToHost(r,n)}onStyleRemoved(n){const r=this.styleRef;r.get(n)?.elements?.forEach(s=>s.remove()),r.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${CS}="${this.appId}"]`);if(n?.length){const r=new Map;return n.forEach(s=>{null!=s.textContent&&r.set(s.textContent,s)}),r}return null}changeUsageCount(n,r){const s=this.styleRef;if(s.has(n)){const u=s.get(n);return u.usage+=r,u.usage}return s.set(n,{usage:r,elements:[]}),r}getStyleElement(n,r){const s=this.styleNodesInDOM,u=s?.get(r);if(u?.parentNode===n)return s.delete(r),u.removeAttribute(CS),u;{const h=this.doc.createElement("style");return this.nonce&&h.setAttribute("nonce",this.nonce),h.textContent=r,this.platformIsServer&&h.setAttribute(CS,this.appId),h}}addStyleToHost(n,r){const s=this.getStyleElement(n,r);n.appendChild(s);const u=this.styleRef,h=u.get(r)?.elements;h?h.push(s):u.set(r,{elements:[s],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Qi),st(Ca),st(Zf,8),st(Ea))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();const ES={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},MS=/%COMP%/g,VX=new kt("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function y5(e,t){return t.map(i=>i.replace(MS,e))}let v5=(()=>{var e;class t{constructor(n,r,s,u,h,_,x,M=null){this.eventManager=n,this.sharedStylesHost=r,this.appId=s,this.removeStylesOnCompDestroy=u,this.doc=h,this.platformId=_,this.ngZone=x,this.nonce=M,this.rendererByCompId=new Map,this.platformIsServer=l5(_),this.defaultRenderer=new DS(n,h,x,this.platformIsServer)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Nr.ShadowDom&&(r={...r,encapsulation:Nr.Emulated});const s=this.getOrCreateRenderer(n,r);return s instanceof x5?s.applyToHost(n):s instanceof TS&&s.applyStyles(),s}getOrCreateRenderer(n,r){const s=this.rendererByCompId;let u=s.get(r.id);if(!u){const h=this.doc,_=this.ngZone,x=this.eventManager,M=this.sharedStylesHost,S=this.removeStylesOnCompDestroy,P=this.platformIsServer;switch(r.encapsulation){case Nr.Emulated:u=new x5(x,M,r,this.appId,S,h,_,P);break;case Nr.ShadowDom:return new HX(x,M,n,r,h,_,this.nonce,P);default:u=new TS(x,M,r,S,h,_,P)}s.set(r.id,u)}return u}ngOnDestroy(){this.rendererByCompId.clear()}}return(e=t).\u0275fac=function(n){return new(n||e)(st(p5),st(g5),st(Ca),st(VX),st(Qi),st(Ea),st(oi),st(Zf))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();class DS{constructor(t,i,n,r){this.eventManager=t,this.doc=i,this.ngZone=n,this.platformIsServer=r,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,i){return i?this.doc.createElementNS(ES[i]||i,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,i){(b5(t)?t.content:t).appendChild(i)}insertBefore(t,i,n){t&&(b5(t)?t.content:t).insertBefore(i,n)}removeChild(t,i){t&&t.removeChild(i)}selectRootElement(t,i){let n="string"==typeof t?this.doc.querySelector(t):t;if(!n)throw new gt(-5104,!1);return i||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,i,n,r){if(r){i=r+":"+i;const s=ES[r];s?t.setAttributeNS(s,i,n):t.setAttribute(i,n)}else t.setAttribute(i,n)}removeAttribute(t,i,n){if(n){const r=ES[n];r?t.removeAttributeNS(r,i):t.removeAttribute(`${n}:${i}`)}else t.removeAttribute(i)}addClass(t,i){t.classList.add(i)}removeClass(t,i){t.classList.remove(i)}setStyle(t,i,n,r){r&(ki.DashCase|ki.Important)?t.style.setProperty(i,n,r&ki.Important?"important":""):t.style[i]=n}removeStyle(t,i,n){n&ki.DashCase?t.style.removeProperty(i):t.style[i]=""}setProperty(t,i,n){t[i]=n}setValue(t,i){t.nodeValue=i}listen(t,i,n){if("string"==typeof t&&!(t=lp().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${i}`);return this.eventManager.addEventListener(t,i,this.decoratePreventDefault(n))}decoratePreventDefault(t){return i=>{if("__ngUnwrap__"===i)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(i)):t(i))&&i.preventDefault()}}}function b5(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class HX extends DS{constructor(t,i,n,r,s,u,h,_){super(t,s,u,_),this.sharedStylesHost=i,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const x=y5(r.id,r.styles);for(const M of x){const S=document.createElement("style");h&&S.setAttribute("nonce",h),S.textContent=M,this.shadowRoot.appendChild(S)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,i){return super.appendChild(this.nodeOrShadowRoot(t),i)}insertBefore(t,i,n){return super.insertBefore(this.nodeOrShadowRoot(t),i,n)}removeChild(t,i){return super.removeChild(this.nodeOrShadowRoot(t),i)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class TS extends DS{constructor(t,i,n,r,s,u,h,_){super(t,s,u,h),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=r,this.styles=_?y5(_,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class x5 extends TS{constructor(t,i,n,r,s,u,h,_){const x=r+"-"+n.id;super(t,i,n,s,u,h,_,x),this.contentAttr=function UX(e){return"_ngcontent-%COMP%".replace(MS,e)}(x),this.hostAttr=function jX(e){return"_nghost-%COMP%".replace(MS,e)}(x)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,i){const n=super.createElement(t,i);return super.setAttribute(n,this.contentAttr,""),n}}let GX=(()=>{var e;class t extends m5{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,s){return n.addEventListener(r,s,!1),()=>this.removeEventListener(n,r,s)}removeEventListener(n,r,s){return n.removeEventListener(r,s)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Qi))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();const w5=["alt","control","meta","shift"],qX={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},WX={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let ZX=(()=>{var e;class t extends m5{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,r,s){const u=t.parseEventName(r),h=t.eventCallback(u.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>lp().onAndCancel(n,u.domEventName,h))}static parseEventName(n){const r=n.toLowerCase().split("."),s=r.shift();if(0===r.length||"keydown"!==s&&"keyup"!==s)return null;const u=t._normalizeKey(r.pop());let h="",_=r.indexOf("code");if(_>-1&&(r.splice(_,1),h="code."),w5.forEach(M=>{const S=r.indexOf(M);S>-1&&(r.splice(S,1),h+=M+".")}),h+=u,0!=r.length||0===u.length)return null;const x={};return x.domEventName=s,x.fullKey=h,x}static matchEventFullKeyCode(n,r){let s=qX[n.key]||n.key,u="";return r.indexOf("code.")>-1&&(s=n.code,u="code."),!(null==s||!s)&&(s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),w5.forEach(h=>{h!==s&&(0,WX[h])(n)&&(u+=h+".")}),u+=s,u===r)}static eventCallback(n,r,s){return u=>{t.matchEventFullKeyCode(u,n)&&s.runGuarded(()=>r(u))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Qi))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();const QX=mF(MW,"browser",[{provide:Ea,useValue:a5},{provide:Wf,useValue:function XX(){xS.makeCurrent()},multi:!0},{provide:Qi,useFactory:function KX(){return function AT(e){Zv=e}(document),document},deps:[]}]),JX=new kt(""),M5=[{provide:IC,useClass:class LX{addToWindow(t){gi.getAngularTestability=(n,r=!0)=>{const s=t.findTestabilityInTree(n,r);if(null==s)throw new gt(5103,!1);return s},gi.getAllAngularTestabilities=()=>t.getAllTestabilities(),gi.getAllAngularRootElements=()=>t.getAllRootElements(),gi.frameworkStabilizers||(gi.frameworkStabilizers=[]),gi.frameworkStabilizers.push(n=>{const r=gi.getAllAngularTestabilities();let s=r.length,u=!1;const h=function(_){u=u||_,s--,0==s&&n(u)};r.forEach(_=>{_.whenStable(h)})})}findTestabilityInTree(t,i,n){return null==i?null:t.getTestability(i)??(n?lp().isShadowRoot(i)?this.findTestabilityInTree(t,i.host,!0):this.findTestabilityInTree(t,i.parentElement,!0):null)}},deps:[]},{provide:uF,useClass:H2,deps:[oi,G2,IC]},{provide:H2,useClass:H2,deps:[oi,G2,IC]}],D5=[{provide:Om,useValue:"root"},{provide:Qu,useFactory:function YX(){return new Qu},deps:[]},{provide:wS,useClass:GX,multi:!0,deps:[Qi,oi,Ea]},{provide:wS,useClass:ZX,multi:!0,deps:[Qi]},v5,g5,p5,{provide:_b,useExisting:v5},{provide:c5,useClass:FX,deps:[]},[]];let IS,eY=(()=>{var e;class t{constructor(n){}static withServerTransition(n){return{ngModule:t,providers:[{provide:Ca,useValue:n.appId}]}}}return(e=t).\u0275fac=function(n){return new(n||e)(st(JX,12))},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({providers:[...D5,...M5],imports:[yS,DW]}),t})(),T5=(()=>{var e;class t{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Qi))},e.\u0275prov=Bt({token:e,factory:function(n){let r=null;return r=n?new n:function nY(){return new T5(st(Qi))}(),r},providedIn:"root"}),t})();function $l(e){return Ai((t,i)=>{Xn(e).subscribe(Mi(i,()=>i.complete(),ls)),!i.closed&&t.subscribe(i)})}function Hc(e){return e<=0?()=>Zo:Ai((t,i)=>{let n=0;t.subscribe(Mi(i,r=>{++n<=e&&(i.next(r),e<=n&&i.complete())}))})}function up(e){return null!=e&&"false"!=`${e}`}function nl(e,t=0){return function aY(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):t}function XC(e){return Array.isArray(e)?e:[e]}function yo(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Hy(e){return e instanceof cr?e.nativeElement:e}typeof window<"u"&&window;try{IS=typeof Intl<"u"&&Intl.v8BreakIterator}catch{IS=!1}let Qb,eg,AS,Ia=(()=>{var e;class t{constructor(n){this._platformId=n,this.isBrowser=this._platformId?function sX(e){return e===a5}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!IS)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Ea))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function Jb(e){return function mY(){if(null==Qb&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Qb=!0}))}finally{Qb=Qb||!1}return Qb}()?e:!!e.capture}function gY(){if(null==eg){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return eg=!1,eg;if("scrollBehavior"in document.documentElement.style)eg=!0;else{const e=Element.prototype.scrollTo;eg=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return eg}function dp(e){return e.composedPath?e.composedPath()[0]:e.target}function PS(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Aa(e,t){return Ai((i,n)=>{let r=0;i.subscribe(Mi(n,s=>e.call(t,s,r++)&&n.next(s)))})}function O5(e){return Aa((t,i)=>e<=i)}let vY=(()=>{var e;class t{create(n){return typeof MutationObserver>"u"?null:new MutationObserver(n)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),bY=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({providers:[vY]}),t})();const{isArray:xY}=Array,{getPrototypeOf:wY,prototype:CY,keys:EY}=Object;const{isArray:DY}=Array;function OS(e){return Un(t=>function TY(e,t){return DY(t)?e(...t):e(t)}(e,t))}function KC(...e){const t=Ls(e),i=function nf(e){return ni(Dd(e))?e.pop():void 0}(e),{args:n,keys:r}=function k5(e){if(1===e.length){const t=e[0];if(xY(t))return{args:t,keys:null};if(function MY(e){return e&&"object"==typeof e&&wY(e)===CY}(t)){const i=EY(t);return{args:i.map(n=>t[n]),keys:i}}}return{args:e,keys:null}}(e);if(0===n.length)return Pi([],t);const s=new On(function SY(e,t,i=Rs){return n=>{L5(t,()=>{const{length:r}=e,s=new Array(r);let u=r,h=r;for(let _=0;_<r;_++)L5(t,()=>{const x=Pi(e[_],t);let M=!1;x.subscribe(Mi(n,S=>{s[_]=S,M||(M=!0,h--),h||n.next(i(s.slice()))},()=>{--u||n.complete()}))},n)},n)}}(n,t,r?u=>function R5(e,t){return e.reduce((i,n,r)=>(i[n]=t[r],i),{})}(r,u):Rs));return i?s.pipe(OS(i)):s}function L5(e,t,i){e?la(i,e,t):t()}function ex(...e){return function IY(){return ca(1)}()(Pi(e,Ls(e)))}class AY extends Je{constructor(t,i){super()}schedule(t,i=0){return this}}const QC={setInterval(e,t,...i){const{delegate:n}=QC;return n?.setInterval?n.setInterval(e,t,...i):setInterval(e,t,...i)},clearInterval(e){const{delegate:t}=QC;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class kS extends AY{constructor(t,i){super(t,i),this.scheduler=t,this.work=i,this.pending=!1}schedule(t,i=0){var n;if(this.closed)return this;this.state=t;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,i)),this.pending=!0,this.delay=i,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(s,this.id,i),this}requestAsyncId(t,i,n=0){return QC.setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,i,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return i;null!=i&&QC.clearInterval(i)}execute(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,i);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,i){let r,n=!1;try{this.work(t)}catch(s){n=!0,r=s||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:i}=this,{actions:n}=i;this.work=this.state=this.scheduler=null,this.pending=!1,m(n,this),null!=t&&(this.id=this.recycleAsyncId(i,t,null)),this.delay=null,super.unsubscribe()}}}const RS={now:()=>(RS.delegate||Date).now(),delegate:void 0};class tx{constructor(t,i=tx.now){this.schedulerActionCtor=t,this.now=i}schedule(t,i=0,n){return new this.schedulerActionCtor(this,t).schedule(n,i)}}tx.now=RS.now;class LS extends tx{constructor(t,i=tx.now){super(t,i),this.actions=[],this._active=!1}flush(t){const{actions:i}=this;if(this._active)return void i.push(t);let n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=i.shift());if(this._active=!1,n){for(;t=i.shift();)t.unsubscribe();throw n}}}const JC=new LS(kS),PY=JC;function F5(...e){const t=Ls(e);return Ai((i,n)=>{(t?ex(e,i,t):ex(e,i)).subscribe(n)})}const N5=new Set;let tg,kY=(()=>{var e;class t{constructor(n,r){this._platform=n,this._nonce=r,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):LY}matchMedia(n){return(this._platform.WEBKIT||this._platform.BLINK)&&function RY(e,t){if(!N5.has(e))try{tg||(tg=document.createElement("style"),t&&(tg.nonce=t),tg.setAttribute("type","text/css"),document.head.appendChild(tg)),tg.sheet&&(tg.sheet.insertRule(`@media ${e} {body{ }}`,0),N5.add(e))}catch(i){console.error(i)}}(n,this._nonce),this._matchMedia(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Ia),st(Zf,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function LY(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let FY=(()=>{var e;class t{constructor(n,r){this._mediaMatcher=n,this._zone=r,this._queries=new Map,this._destroySubject=new hi}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(n){return z5(XC(n)).some(s=>this._registerQuery(s).mql.matches)}observe(n){let u=KC(z5(XC(n)).map(h=>this._registerQuery(h).observable));return u=ex(u.pipe(Hc(1)),u.pipe(O5(1),function OY(e,t=JC){return Ai((i,n)=>{let r=null,s=null,u=null;const h=()=>{if(r){r.unsubscribe(),r=null;const x=s;s=null,n.next(x)}};function _(){const x=u+e,M=t.now();if(M<x)return r=this.schedule(void 0,x-M),void n.add(r);h()}i.subscribe(Mi(n,x=>{s=x,u=t.now(),r||(r=t.schedule(_,e),n.add(r))},()=>{h(),n.complete()},void 0,()=>{s=r=null}))})}(0))),u.pipe(Un(h=>{const _={matches:!1,breakpoints:{}};return h.forEach(({matches:x,query:M})=>{_.matches=_.matches||x,_.breakpoints[M]=x}),_}))}_registerQuery(n){if(this._queries.has(n))return this._queries.get(n);const r=this._mediaMatcher.matchMedia(n),u={observable:new On(h=>{const _=x=>this._zone.run(()=>h.next(x));return r.addListener(_),()=>{r.removeListener(_)}}).pipe(F5(r),Un(({matches:h})=>({query:n,matches:h})),$l(this._destroySubject)),mql:r};return this._queries.set(n,u),u}}return(e=t).\u0275fac=function(n){return new(n||e)(st(kY),st(oi))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function z5(e){return e.map(t=>t.split(",")).reduce((t,i)=>t.concat(i)).map(t=>t.trim())}function eE(e,t){return(e.getAttribute(t)||"").match(/\S+/g)||[]}const V5="cdk-describedby-message",tE="cdk-describedby-host";let FS=0,BY=(()=>{var e;class t{constructor(n,r){this._platform=r,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+FS++,this._document=n,this._id=Vt(Ca)+"-"+FS++}describe(n,r,s){if(!this._canBeDescribed(n,r))return;const u=NS(r,s);"string"!=typeof r?(U5(r,this._id),this._messageRegistry.set(u,{messageElement:r,referenceCount:0})):this._messageRegistry.has(u)||this._createMessageElement(r,s),this._isElementDescribedByMessage(n,u)||this._addMessageReference(n,u)}removeDescription(n,r,s){if(!r||!this._isElementNode(n))return;const u=NS(r,s);if(this._isElementDescribedByMessage(n,u)&&this._removeMessageReference(n,u),"string"==typeof r){const h=this._messageRegistry.get(u);h&&0===h.referenceCount&&this._deleteMessageElement(u)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const n=this._document.querySelectorAll(`[${tE}="${this._id}"]`);for(let r=0;r<n.length;r++)this._removeCdkDescribedByReferenceIds(n[r]),n[r].removeAttribute(tE);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(n,r){const s=this._document.createElement("div");U5(s,this._id),s.textContent=n,r&&s.setAttribute("role",r),this._createMessagesContainer(),this._messagesContainer.appendChild(s),this._messageRegistry.set(NS(n,r),{messageElement:s,referenceCount:0})}_deleteMessageElement(n){this._messageRegistry.get(n)?.messageElement?.remove(),this._messageRegistry.delete(n)}_createMessagesContainer(){if(this._messagesContainer)return;const n="cdk-describedby-message-container",r=this._document.querySelectorAll(`.${n}[platform="server"]`);for(let u=0;u<r.length;u++)r[u].remove();const s=this._document.createElement("div");s.style.visibility="hidden",s.classList.add(n),s.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&s.setAttribute("platform","server"),this._document.body.appendChild(s),this._messagesContainer=s}_removeCdkDescribedByReferenceIds(n){const r=eE(n,"aria-describedby").filter(s=>0!=s.indexOf(V5));n.setAttribute("aria-describedby",r.join(" "))}_addMessageReference(n,r){const s=this._messageRegistry.get(r);(function NY(e,t,i){const n=eE(e,t);n.some(r=>r.trim()==i.trim())||(n.push(i.trim()),e.setAttribute(t,n.join(" ")))})(n,"aria-describedby",s.messageElement.id),n.setAttribute(tE,this._id),s.referenceCount++}_removeMessageReference(n,r){const s=this._messageRegistry.get(r);s.referenceCount--,function zY(e,t,i){const r=eE(e,t).filter(s=>s!=i.trim());r.length?e.setAttribute(t,r.join(" ")):e.removeAttribute(t)}(n,"aria-describedby",s.messageElement.id),n.removeAttribute(tE)}_isElementDescribedByMessage(n,r){const s=eE(n,"aria-describedby"),u=this._messageRegistry.get(r),h=u&&u.messageElement.id;return!!h&&-1!=s.indexOf(h)}_canBeDescribed(n,r){if(!this._isElementNode(n))return!1;if(r&&"object"==typeof r)return!0;const s=null==r?"":`${r}`.trim(),u=n.getAttribute("aria-label");return!(!s||u&&u.trim()===s)}_isElementNode(n){return n.nodeType===this._document.ELEMENT_NODE}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Qi),st(Ia))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function NS(e,t){return"string"==typeof e?`${t||""}/${e}`:e}function U5(e,t){e.id||(e.id=`${V5}-${t}-${FS++}`)}function $5(e){return 0===e.buttons||0===e.offsetX&&0===e.offsetY}function H5(e){const t=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}const GY=new kt("cdk-input-modality-detector-options"),qY={ignoreKeys:[18,17,224,91,16]},qy=Jb({passive:!0,capture:!0});let WY=(()=>{var e;class t{get mostRecentModality(){return this._modality.value}constructor(n,r,s,u){this._platform=n,this._mostRecentTarget=null,this._modality=new Sr(null),this._lastTouchMs=0,this._onKeydown=h=>{this._options?.ignoreKeys?.some(_=>_===h.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=dp(h))},this._onMousedown=h=>{Date.now()-this._lastTouchMs<650||(this._modality.next($5(h)?"keyboard":"mouse"),this._mostRecentTarget=dp(h))},this._onTouchstart=h=>{H5(h)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=dp(h))},this._options={...qY,...u},this.modalityDetected=this._modality.pipe(O5(1)),this.modalityChanged=this.modalityDetected.pipe(An()),n.isBrowser&&r.runOutsideAngular(()=>{s.addEventListener("keydown",this._onKeydown,qy),s.addEventListener("mousedown",this._onMousedown,qy),s.addEventListener("touchstart",this._onTouchstart,qy)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,qy),document.removeEventListener("mousedown",this._onMousedown,qy),document.removeEventListener("touchstart",this._onTouchstart,qy))}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Ia),st(oi),st(Qi),st(GY,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const XY=new kt("cdk-focus-monitor-default-options"),nE=Jb({passive:!0,capture:!0});let YY=(()=>{var e;class t{constructor(n,r,s,u,h){this._ngZone=n,this._platform=r,this._inputModalityDetector=s,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new hi,this._rootNodeFocusAndBlurListener=_=>{for(let M=dp(_);M;M=M.parentElement)"focus"===_.type?this._onFocus(_,M):this._onBlur(_,M)},this._document=u,this._detectionMode=h?.detectionMode||0}monitor(n,r=!1){const s=Hy(n);if(!this._platform.isBrowser||1!==s.nodeType)return Dt();const u=function yY(e){if(function _Y(){if(null==AS){const e=typeof document<"u"?document.head:null;AS=!(!e||!e.createShadowRoot&&!e.attachShadow)}return AS}()){const t=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(s)||this._getDocument(),h=this._elementInfo.get(s);if(h)return r&&(h.checkChildren=!0),h.subject;const _={checkChildren:r,subject:new hi,rootNode:u};return this._elementInfo.set(s,_),this._registerGlobalListeners(_),_.subject}stopMonitoring(n){const r=Hy(n),s=this._elementInfo.get(r);s&&(s.subject.complete(),this._setClasses(r),this._elementInfo.delete(r),this._removeGlobalListeners(s))}focusVia(n,r,s){const u=Hy(n);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([_,x])=>this._originChanged(_,r,x)):(this._setOrigin(r),"function"==typeof u.focus&&u.focus(s))}ngOnDestroy(){this._elementInfo.forEach((n,r)=>this.stopMonitoring(r))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(n){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(n)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:n&&this._isLastInteractionFromInputLabel(n)?"mouse":"program"}_shouldBeAttributedToTouch(n){return 1===this._detectionMode||!!n?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(n,r){n.classList.toggle("cdk-focused",!!r),n.classList.toggle("cdk-touch-focused","touch"===r),n.classList.toggle("cdk-keyboard-focused","keyboard"===r),n.classList.toggle("cdk-mouse-focused","mouse"===r),n.classList.toggle("cdk-program-focused","program"===r)}_setOrigin(n,r=!1){this._ngZone.runOutsideAngular(()=>{this._origin=n,this._originFromTouchInteraction="touch"===n&&r,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(n,r){const s=this._elementInfo.get(r),u=dp(n);!s||!s.checkChildren&&r!==u||this._originChanged(r,this._getFocusOrigin(u),s)}_onBlur(n,r){const s=this._elementInfo.get(r);!s||s.checkChildren&&n.relatedTarget instanceof Node&&r.contains(n.relatedTarget)||(this._setClasses(r),this._emitOrigin(s,null))}_emitOrigin(n,r){n.subject.observers.length&&this._ngZone.run(()=>n.subject.next(r))}_registerGlobalListeners(n){if(!this._platform.isBrowser)return;const r=n.rootNode,s=this._rootNodeFocusListenerCount.get(r)||0;s||this._ngZone.runOutsideAngular(()=>{r.addEventListener("focus",this._rootNodeFocusAndBlurListener,nE),r.addEventListener("blur",this._rootNodeFocusAndBlurListener,nE)}),this._rootNodeFocusListenerCount.set(r,s+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe($l(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(n){const r=n.rootNode;if(this._rootNodeFocusListenerCount.has(r)){const s=this._rootNodeFocusListenerCount.get(r);s>1?this._rootNodeFocusListenerCount.set(r,s-1):(r.removeEventListener("focus",this._rootNodeFocusAndBlurListener,nE),r.removeEventListener("blur",this._rootNodeFocusAndBlurListener,nE),this._rootNodeFocusListenerCount.delete(r))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(n,r,s){this._setClasses(n,r),this._emitOrigin(s,r),this._lastFocusOrigin=r}_getClosestElementsInfo(n){const r=[];return this._elementInfo.forEach((s,u)=>{(u===n||s.checkChildren&&u.contains(n))&&r.push([u,s])}),r}_isLastInteractionFromInputLabel(n){const{_mostRecentTarget:r,mostRecentModality:s}=this._inputModalityDetector;if("mouse"!==s||!r||r===n||"INPUT"!==n.nodeName&&"TEXTAREA"!==n.nodeName||n.disabled)return!1;const u=n.labels;if(u)for(let h=0;h<u.length;h++)if(u[h].contains(r))return!0;return!1}}return(e=t).\u0275fac=function(n){return new(n||e)(st(oi),st(Ia),st(WY),st(Qi,8),st(XY,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const q5="cdk-high-contrast-black-on-white",W5="cdk-high-contrast-white-on-black",zS="cdk-high-contrast-active";let Z5=(()=>{var e;class t{constructor(n,r){this._platform=n,this._document=r,this._breakpointSubscription=Vt(FY).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const n=this._document.createElement("div");n.style.backgroundColor="rgb(1,2,3)",n.style.position="absolute",this._document.body.appendChild(n);const r=this._document.defaultView||window,s=r&&r.getComputedStyle?r.getComputedStyle(n):null,u=(s&&s.backgroundColor||"").replace(/ /g,"");switch(n.remove(),u){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const n=this._document.body.classList;n.remove(zS,q5,W5),this._hasCheckedHighContrastMode=!0;const r=this.getHighContrastMode();1===r?n.add(zS,q5):2===r&&n.add(zS,W5)}}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Ia),st(Qi))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),KY=(()=>{var e;class t{constructor(n){n._applyBodyHighContrastModeCssClasses()}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Z5))},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({imports:[bY]}),t})();const QY=new kt("cdk-dir-doc",{providedIn:"root",factory:function JY(){return Vt(Qi)}}),eK=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function X5(e){const t=e?.toLowerCase()||"";return"auto"===t&&typeof navigator<"u"&&navigator?.language?eK.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}let iE=(()=>{var e;class t{constructor(n){this.value="ltr",this.change=new rr,n&&(this.value=X5((n.body?n.body.dir:null)||(n.documentElement?n.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}}return(e=t).\u0275fac=function(n){return new(n||e)(st(QY,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),tK=(()=>{var e;class t{constructor(){this._dir="ltr",this._isInitialized=!1,this.change=new rr}get dir(){return this._dir}set dir(n){const r=this._dir;this._dir=X5(n),this._rawDir=n,r!==this._dir&&this._isInitialized&&this.change.emit(this._dir)}get value(){return this.dir}ngAfterContentInit(){this._isInitialized=!0}ngOnDestroy(){this.change.complete()}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275dir=Pt({type:e,selectors:[["","dir",""]],hostVars:1,hostBindings:function(n,r){2&n&&Fl("dir",r._rawDir)},inputs:{dir:"dir"},outputs:{change:"dirChange"},exportAs:["dir"],features:[Ki([{provide:iE,useExisting:e}])]}),t})(),nx=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({}),t})();const nK=["addListener","removeListener"],iK=["addEventListener","removeEventListener"],rK=["on","off"];function BS(e,t,i,n){if(ni(i)&&(n=i,i=void 0),n)return BS(e,t,i).pipe(OS(n));const[r,s]=function aK(e){return ni(e.addEventListener)&&ni(e.removeEventListener)}(e)?iK.map(u=>h=>e[u](t,h,i)):function oK(e){return ni(e.addListener)&&ni(e.removeListener)}(e)?nK.map(Y5(e,t)):function sK(e){return ni(e.on)&&ni(e.off)}(e)?rK.map(Y5(e,t)):[];if(!r&&Be(e))return or(u=>BS(u,t,i))(Xn(e));if(!r)throw new TypeError("Invalid event target");return new On(u=>{const h=(..._)=>u.next(1<_.length?_:_[0]);return r(h),()=>s(h)})}function Y5(e,t){return i=>n=>e[i](t,n)}const ix={schedule(e){let t=requestAnimationFrame,i=cancelAnimationFrame;const{delegate:n}=ix;n&&(t=n.requestAnimationFrame,i=n.cancelAnimationFrame);const r=t(s=>{i=void 0,e(s)});return new Je(()=>i?.(r))},requestAnimationFrame(...e){const{delegate:t}=ix;return(t?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:t}=ix;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class cK extends LS{flush(t){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:n}=this;let r;t=t||n.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=n[0])&&t.id===i&&n.shift());if(this._active=!1,r){for(;(t=n[0])&&t.id===i&&n.shift();)t.unsubscribe();throw r}}}(class lK extends kS{constructor(t,i){super(t,i),this.scheduler=t,this.work=i}requestAsyncId(t,i,n=0){return null!==n&&n>0?super.requestAsyncId(t,i,n):(t.actions.push(this),t._scheduled||(t._scheduled=ix.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,i,n=0){var r;if(null!=n?n>0:this.delay>0)return super.recycleAsyncId(t,i,n);const{actions:s}=t;null!=i&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==i&&(ix.cancelAnimationFrame(i),t._scheduled=void 0)}});let VS,dK=1;const rE={};function K5(e){return e in rE&&(delete rE[e],!0)}const hK={setImmediate(e){const t=dK++;return rE[t]=!0,VS||(VS=Promise.resolve()),VS.then(()=>K5(t)&&e()),t},clearImmediate(e){K5(e)}},{setImmediate:fK,clearImmediate:pK}=hK,oE={setImmediate(...e){const{delegate:t}=oE;return(t?.setImmediate||fK)(...e)},clearImmediate(e){const{delegate:t}=oE;return(t?.clearImmediate||pK)(e)},delegate:void 0};new class gK extends LS{flush(t){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:n}=this;let r;t=t||n.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=n[0])&&t.id===i&&n.shift());if(this._active=!1,r){for(;(t=n[0])&&t.id===i&&n.shift();)t.unsubscribe();throw r}}}(class mK extends kS{constructor(t,i){super(t,i),this.scheduler=t,this.work=i}requestAsyncId(t,i,n=0){return null!==n&&n>0?super.requestAsyncId(t,i,n):(t.actions.push(this),t._scheduled||(t._scheduled=oE.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,i,n=0){var r;if(null!=n?n>0:this.delay>0)return super.recycleAsyncId(t,i,n);const{actions:s}=t;null!=i&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==i&&(oE.clearImmediate(i),t._scheduled===i&&(t._scheduled=void 0))}});function US(e=0,t,i=PY){let n=-1;return null!=t&&(da(t)?i=t:n=t),new On(r=>{let s=function vK(e){return e instanceof Date&&!isNaN(e)}(e)?+e-i.now():e;s<0&&(s=0);let u=0;return i.schedule(function(){r.closed||(r.next(u++),0<=n?this.schedule(void 0,n):r.complete())},s)})}function Q5(e,t=JC){return function yK(e){return Ai((t,i)=>{let n=!1,r=null,s=null,u=!1;const h=()=>{if(s?.unsubscribe(),s=null,n){n=!1;const x=r;r=null,i.next(x)}u&&i.complete()},_=()=>{s=null,u&&i.complete()};t.subscribe(Mi(i,x=>{n=!0,r=x,s||Xn(e(x)).subscribe(s=Mi(i,h,_))},()=>{u=!0,(!n||!s||s.closed)&&i.complete()}))})}(()=>US(e,t))}let J5=(()=>{var e;class t{constructor(n,r,s){this._ngZone=n,this._platform=r,this._scrolled=new hi,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=s}register(n){this.scrollContainers.has(n)||this.scrollContainers.set(n,n.elementScrolled().subscribe(()=>this._scrolled.next(n)))}deregister(n){const r=this.scrollContainers.get(n);r&&(r.unsubscribe(),this.scrollContainers.delete(n))}scrolled(n=20){return this._platform.isBrowser?new On(r=>{this._globalSubscription||this._addGlobalListener();const s=n>0?this._scrolled.pipe(Q5(n)).subscribe(r):this._scrolled.subscribe(r);return this._scrolledCount++,()=>{s.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Dt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((n,r)=>this.deregister(r)),this._scrolled.complete()}ancestorScrolled(n,r){const s=this.getAncestorScrollContainers(n);return this.scrolled(r).pipe(Aa(u=>!u||s.indexOf(u)>-1))}getAncestorScrollContainers(n){const r=[];return this.scrollContainers.forEach((s,u)=>{this._scrollableContainsElement(u,n)&&r.push(u)}),r}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(n,r){let s=Hy(r),u=n.getElementRef().nativeElement;do{if(s==u)return!0}while(s=s.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>BS(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(oi),st(Ia),st(Qi,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),e3=(()=>{var e;class t{constructor(n,r,s){this._platform=n,this._change=new hi,this._changeListener=u=>{this._change.next(u)},this._document=s,r.runOutsideAngular(()=>{if(n.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const n=this._getWindow();n.removeEventListener("resize",this._changeListener),n.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const n={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),n}getViewportRect(){const n=this.getViewportScrollPosition(),{width:r,height:s}=this.getViewportSize();return{top:n.top,left:n.left,bottom:n.top+s,right:n.left+r,height:s,width:r}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const n=this._document,r=this._getWindow(),s=n.documentElement,u=s.getBoundingClientRect();return{top:-u.top||n.body.scrollTop||r.scrollY||s.scrollTop||0,left:-u.left||n.body.scrollLeft||r.scrollX||s.scrollLeft||0}}change(n=20){return n>0?this._change.pipe(Q5(n)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const n=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:n.innerWidth,height:n.innerHeight}:{width:0,height:0}}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Ia),st(oi),st(Qi,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),jS=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({}),t})(),t3=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({imports:[nx,jS,nx,jS]}),t})();class $S{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class n3 extends $S{constructor(t,i,n,r,s){super(),this.component=t,this.viewContainerRef=i,this.injector=n,this.componentFactoryResolver=r,this.projectableNodes=s}}class wK extends $S{constructor(t,i,n,r){super(),this.templateRef=t,this.viewContainerRef=i,this.context=n,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,i=this.context){return this.context=i,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class CK extends $S{constructor(t){super(),this.element=t instanceof cr?t.nativeElement:t}}class EK{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof n3?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof wK?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof CK?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class MK extends EK{constructor(t,i,n,r,s){super(),this.outletElement=t,this._componentFactoryResolver=i,this._appRef=n,this._defaultInjector=r,this.attachDomPortal=u=>{const h=u.element,_=this._document.createComment("dom-portal");h.parentNode.insertBefore(_,h),this.outletElement.appendChild(h),this._attachedPortal=u,super.setDisposeFn(()=>{_.parentNode&&_.parentNode.replaceChild(h,_)})},this._document=s}attachComponentPortal(t){const n=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(n,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector,t.projectableNodes||void 0),this.setDisposeFn(()=>r.destroy())):(r=n.create(t.injector||this._defaultInjector||Do.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let i=t.viewContainerRef,n=i.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return n.rootNodes.forEach(r=>this.outletElement.appendChild(r)),n.detectChanges(),this.setDisposeFn(()=>{let r=i.indexOf(n);-1!==r&&i.remove(r)}),this._attachedPortal=t,n}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let DK=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({}),t})();const r3=gY();class TK{constructor(t,i){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=i}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=yo(-this._previousScrollPosition.left),t.style.top=yo(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,n=t.style,r=this._document.body.style,s=n.scrollBehavior||"",u=r.scrollBehavior||"";this._isEnabled=!1,n.left=this._previousHTMLStyles.left,n.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),r3&&(n.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),r3&&(n.scrollBehavior=s,r.scrollBehavior=u)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const i=this._document.body,n=this._viewportRuler.getViewportSize();return i.scrollHeight>n.height||i.scrollWidth>n.width}}class SK{constructor(t,i,n,r){this._scrollDispatcher=t,this._ngZone=i,this._viewportRuler=n,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0).pipe(Aa(i=>!i||!this._overlayRef.overlayElement.contains(i.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const i=this._viewportRuler.getViewportScrollPosition().top;Math.abs(i-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class o3{enable(){}disable(){}attach(){}}function HS(e,t){return t.some(i=>e.bottom<i.top||e.top>i.bottom||e.right<i.left||e.left>i.right)}function s3(e,t){return t.some(i=>e.top<i.top||e.bottom>i.bottom||e.left<i.left||e.right>i.right)}class IK{constructor(t,i,n,r){this._scrollDispatcher=t,this._viewportRuler=i,this._ngZone=n,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const i=this._overlayRef.overlayElement.getBoundingClientRect(),{width:n,height:r}=this._viewportRuler.getViewportSize();HS(i,[{width:n,height:r,bottom:r,right:n,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let AK=(()=>{var e;class t{constructor(n,r,s,u){this._scrollDispatcher=n,this._viewportRuler=r,this._ngZone=s,this.noop=()=>new o3,this.close=h=>new SK(this._scrollDispatcher,this._ngZone,this._viewportRuler,h),this.block=()=>new TK(this._viewportRuler,this._document),this.reposition=h=>new IK(this._scrollDispatcher,this._viewportRuler,this._ngZone,h),this._document=u}}return(e=t).\u0275fac=function(n){return new(n||e)(st(J5),st(e3),st(oi),st(Qi))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class PK{constructor(t){if(this.scrollStrategy=new o3,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const i=Object.keys(t);for(const n of i)void 0!==t[n]&&(this[n]=t[n])}}}class OK{constructor(t,i){this.connectionPair=t,this.scrollableViewProperties=i}}let a3=(()=>{var e;class t{constructor(n){this._attachedOverlays=[],this._document=n}ngOnDestroy(){this.detach()}add(n){this.remove(n),this._attachedOverlays.push(n)}remove(n){const r=this._attachedOverlays.indexOf(n);r>-1&&this._attachedOverlays.splice(r,1),0===this._attachedOverlays.length&&this.detach()}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Qi))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),kK=(()=>{var e;class t extends a3{constructor(n,r){super(n),this._ngZone=r,this._keydownListener=s=>{const u=this._attachedOverlays;for(let h=u.length-1;h>-1;h--)if(u[h]._keydownEvents.observers.length>0){const _=u[h]._keydownEvents;this._ngZone?this._ngZone.run(()=>_.next(s)):_.next(s);break}}}add(n){super.add(n),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Qi),st(oi,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),RK=(()=>{var e;class t extends a3{constructor(n,r,s){super(n),this._platform=r,this._ngZone=s,this._cursorStyleIsSet=!1,this._pointerDownListener=u=>{this._pointerDownEventTarget=dp(u)},this._clickListener=u=>{const h=dp(u),_="click"===u.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:h;this._pointerDownEventTarget=null;const x=this._attachedOverlays.slice();for(let M=x.length-1;M>-1;M--){const S=x[M];if(S._outsidePointerEvents.observers.length<1||!S.hasAttached())continue;if(S.overlayElement.contains(h)||S.overlayElement.contains(_))break;const P=S._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>P.next(u)):P.next(u)}}}add(n){if(super.add(n),!this._isAttached){const r=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(r)):this._addEventListeners(r),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=r.style.cursor,r.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const n=this._document.body;n.removeEventListener("pointerdown",this._pointerDownListener,!0),n.removeEventListener("click",this._clickListener,!0),n.removeEventListener("auxclick",this._clickListener,!0),n.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(n.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(n){n.addEventListener("pointerdown",this._pointerDownListener,!0),n.addEventListener("click",this._clickListener,!0),n.addEventListener("auxclick",this._clickListener,!0),n.addEventListener("contextmenu",this._clickListener,!0)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Qi),st(Ia),st(oi,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),l3=(()=>{var e;class t{constructor(n,r){this._platform=r,this._document=n}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const n="cdk-overlay-container";if(this._platform.isBrowser||PS()){const s=this._document.querySelectorAll(`.${n}[platform="server"], .${n}[platform="test"]`);for(let u=0;u<s.length;u++)s[u].remove()}const r=this._document.createElement("div");r.classList.add(n),PS()?r.setAttribute("platform","test"):this._platform.isBrowser||r.setAttribute("platform","server"),this._document.body.appendChild(r),this._containerElement=r}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Qi),st(Ia))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class LK{constructor(t,i,n,r,s,u,h,_,x,M=!1){this._portalOutlet=t,this._host=i,this._pane=n,this._config=r,this._ngZone=s,this._keyboardDispatcher=u,this._document=h,this._location=_,this._outsideClickDispatcher=x,this._animationsDisabled=M,this._backdropElement=null,this._backdropClick=new hi,this._attachments=new hi,this._detachments=new hi,this._locationChanges=Je.EMPTY,this._backdropClickHandler=S=>this._backdropClick.next(S),this._backdropTransitionendHandler=S=>{this._disposeBackdrop(S.target)},this._keydownEvents=new hi,this._outsidePointerEvents=new hi,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const i=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Hc(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof i?.onDestroy&&i.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),i}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config={...this._config,...t},this._updateElementSize()}setDirection(t){this._config={...this._config,direction:t},this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=yo(this._config.width),t.height=yo(this._config.height),t.minWidth=yo(this._config.minWidth),t.minHeight=yo(this._config.minHeight),t.maxWidth=yo(this._config.maxWidth),t.maxHeight=yo(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,i,n){const r=XC(i||[]).filter(s=>!!s);r.length&&(n?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe($l(Lt(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const c3="cdk-overlay-connected-position-bounding-box",FK=/([A-Za-z%]+)$/;class NK{get positions(){return this._preferredPositions}constructor(t,i,n,r,s){this._viewportRuler=i,this._document=n,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new hi,this._resizeSubscription=Je.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}attach(t){this._validatePositions(),t.hostElement.classList.add(c3),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,i=this._overlayRect,n=this._viewportRect,r=this._containerRect,s=[];let u;for(let h of this._preferredPositions){let _=this._getOriginPoint(t,r,h),x=this._getOverlayPoint(_,i,h),M=this._getOverlayFit(x,i,n,h);if(M.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(h,_);this._canFitWithFlexibleDimensions(M,x,n)?s.push({position:h,origin:_,overlayRect:i,boundingBoxRect:this._calculateBoundingBoxRect(_,h)}):(!u||u.overlayFit.visibleArea<M.visibleArea)&&(u={overlayFit:M,overlayPoint:x,originPoint:_,position:h,overlayRect:i})}if(s.length){let h=null,_=-1;for(const x of s){const M=x.boundingBoxRect.width*x.boundingBoxRect.height*(x.position.weight||1);M>_&&(_=M,h=x)}return this._isPushed=!1,void this._applyPosition(h.position,h.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(u.position,u.originPoint);this._applyPosition(u.position,u.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&ng(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(c3),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,i)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,i,n){let r,s;if("center"==n.originX)r=t.left+t.width/2;else{const u=this._isRtl()?t.right:t.left,h=this._isRtl()?t.left:t.right;r="start"==n.originX?u:h}return i.left<0&&(r-=i.left),s="center"==n.originY?t.top+t.height/2:"top"==n.originY?t.top:t.bottom,i.top<0&&(s-=i.top),{x:r,y:s}}_getOverlayPoint(t,i,n){let r,s;return r="center"==n.overlayX?-i.width/2:"start"===n.overlayX?this._isRtl()?-i.width:0:this._isRtl()?0:-i.width,s="center"==n.overlayY?-i.height/2:"top"==n.overlayY?0:-i.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,i,n,r){const s=d3(i);let{x:u,y:h}=t,_=this._getOffset(r,"x"),x=this._getOffset(r,"y");_&&(u+=_),x&&(h+=x);let P=0-h,F=h+s.height-n.height,$=this._subtractOverflows(s.width,0-u,u+s.width-n.width),W=this._subtractOverflows(s.height,P,F),X=$*W;return{visibleArea:X,isCompletelyWithinViewport:s.width*s.height===X,fitsInViewportVertically:W===s.height,fitsInViewportHorizontally:$==s.width}}_canFitWithFlexibleDimensions(t,i,n){if(this._hasFlexibleDimensions){const r=n.bottom-i.y,s=n.right-i.x,u=u3(this._overlayRef.getConfig().minHeight),h=u3(this._overlayRef.getConfig().minWidth);return(t.fitsInViewportVertically||null!=u&&u<=r)&&(t.fitsInViewportHorizontally||null!=h&&h<=s)}return!1}_pushOverlayOnScreen(t,i,n){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=d3(i),s=this._viewportRect,u=Math.max(t.x+r.width-s.width,0),h=Math.max(t.y+r.height-s.height,0),_=Math.max(s.top-n.top-t.y,0),x=Math.max(s.left-n.left-t.x,0);let M=0,S=0;return M=r.width<=s.width?x||-u:t.x<this._viewportMargin?s.left-n.left-t.x:0,S=r.height<=s.height?_||-h:t.y<this._viewportMargin?s.top-n.top-t.y:0,this._previousPushAmount={x:M,y:S},{x:t.x+M,y:t.y+S}}_applyPosition(t,i){if(this._setTransformOrigin(t),this._setOverlayElementStyles(i,t),this._setBoundingBoxStyles(i,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const n=this._getScrollVisibility(),r=new OK(t,n);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const i=this._boundingBox.querySelectorAll(this._transformOriginSelector);let n,r=t.overlayY;n="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<i.length;s++)i[s].style.transformOrigin=`${n} ${r}`}_calculateBoundingBoxRect(t,i){const n=this._viewportRect,r=this._isRtl();let s,u,h,M,S,P;if("top"===i.overlayY)u=t.y,s=n.height-u+this._viewportMargin;else if("bottom"===i.overlayY)h=n.height-t.y+2*this._viewportMargin,s=n.height-h+this._viewportMargin;else{const F=Math.min(n.bottom-t.y+n.top,t.y),$=this._lastBoundingBoxSize.height;s=2*F,u=t.y-F,s>$&&!this._isInitialRender&&!this._growAfterOpen&&(u=t.y-$/2)}if("end"===i.overlayX&&!r||"start"===i.overlayX&&r)P=n.width-t.x+this._viewportMargin,M=t.x-this._viewportMargin;else if("start"===i.overlayX&&!r||"end"===i.overlayX&&r)S=t.x,M=n.right-t.x;else{const F=Math.min(n.right-t.x+n.left,t.x),$=this._lastBoundingBoxSize.width;M=2*F,S=t.x-F,M>$&&!this._isInitialRender&&!this._growAfterOpen&&(S=t.x-$/2)}return{top:u,left:S,bottom:h,right:P,width:M,height:s}}_setBoundingBoxStyles(t,i){const n=this._calculateBoundingBoxRect(t,i);!this._isInitialRender&&!this._growAfterOpen&&(n.height=Math.min(n.height,this._lastBoundingBoxSize.height),n.width=Math.min(n.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,u=this._overlayRef.getConfig().maxWidth;r.height=yo(n.height),r.top=yo(n.top),r.bottom=yo(n.bottom),r.width=yo(n.width),r.left=yo(n.left),r.right=yo(n.right),r.alignItems="center"===i.overlayX?"center":"end"===i.overlayX?"flex-end":"flex-start",r.justifyContent="center"===i.overlayY?"center":"bottom"===i.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=yo(s)),u&&(r.maxWidth=yo(u))}this._lastBoundingBoxSize=n,ng(this._boundingBox.style,r)}_resetBoundingBoxStyles(){ng(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){ng(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,i){const n={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,u=this._overlayRef.getConfig();if(r){const M=this._viewportRuler.getViewportScrollPosition();ng(n,this._getExactOverlayY(i,t,M)),ng(n,this._getExactOverlayX(i,t,M))}else n.position="static";let h="",_=this._getOffset(i,"x"),x=this._getOffset(i,"y");_&&(h+=`translateX(${_}px) `),x&&(h+=`translateY(${x}px)`),n.transform=h.trim(),u.maxHeight&&(r?n.maxHeight=yo(u.maxHeight):s&&(n.maxHeight="")),u.maxWidth&&(r?n.maxWidth=yo(u.maxWidth):s&&(n.maxWidth="")),ng(this._pane.style,n)}_getExactOverlayY(t,i,n){let r={top:"",bottom:""},s=this._getOverlayPoint(i,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,n)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=yo(s.y),r}_getExactOverlayX(t,i,n){let u,r={left:"",right:""},s=this._getOverlayPoint(i,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,n)),u=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===u?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=yo(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),i=this._pane.getBoundingClientRect(),n=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:s3(t,n),isOriginOutsideView:HS(t,n),isOverlayClipped:s3(i,n),isOverlayOutsideView:HS(i,n)}}_subtractOverflows(t,...i){return i.reduce((n,r)=>n-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,i=this._document.documentElement.clientHeight,n=this._viewportRuler.getViewportScrollPosition();return{top:n.top+this._viewportMargin,left:n.left+this._viewportMargin,right:n.left+t-this._viewportMargin,bottom:n.top+i-this._viewportMargin,width:t-2*this._viewportMargin,height:i-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,i){return"x"===i?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&XC(t).forEach(i=>{""!==i&&-1===this._appliedPanelClasses.indexOf(i)&&(this._appliedPanelClasses.push(i),this._pane.classList.add(i))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof cr)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const i=t.width||0,n=t.height||0;return{top:t.y,bottom:t.y+n,left:t.x,right:t.x+i,height:n,width:i}}}function ng(e,t){for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function u3(e){if("number"!=typeof e&&null!=e){const[t,i]=e.split(FK);return i&&"px"!==i?null:parseFloat(t)}return e||null}function d3(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const h3="cdk-global-overlay-wrapper";class zK{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const i=t.getConfig();this._overlayRef=t,this._width&&!i.width&&t.updateSize({width:this._width}),this._height&&!i.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(h3),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:u,maxHeight:h}=n,_=!("100%"!==r&&"100vw"!==r||u&&"100%"!==u&&"100vw"!==u),x=!("100%"!==s&&"100vh"!==s||h&&"100%"!==h&&"100vh"!==h),M=this._xPosition,S=this._xOffset,P="rtl"===this._overlayRef.getConfig().direction;let F="",$="",W="";_?W="flex-start":"center"===M?(W="center",P?$=S:F=S):P?"left"===M||"end"===M?(W="flex-end",F=S):("right"===M||"start"===M)&&(W="flex-start",$=S):"left"===M||"start"===M?(W="flex-start",F=S):("right"===M||"end"===M)&&(W="flex-end",$=S),t.position=this._cssPosition,t.marginLeft=_?"0":F,t.marginTop=x?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=_?"0":$,i.justifyContent=W,i.alignItems=x?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement,n=i.style;i.classList.remove(h3),n.justifyContent=n.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let BK=(()=>{var e;class t{constructor(n,r,s,u){this._viewportRuler=n,this._document=r,this._platform=s,this._overlayContainer=u}global(){return new zK}flexibleConnectedTo(n){return new NK(n,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(e3),st(Qi),st(Ia),st(l3))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),VK=0,sE=(()=>{var e;class t{constructor(n,r,s,u,h,_,x,M,S,P,F,$){this.scrollStrategies=n,this._overlayContainer=r,this._componentFactoryResolver=s,this._positionBuilder=u,this._keyboardDispatcher=h,this._injector=_,this._ngZone=x,this._document=M,this._directionality=S,this._location=P,this._outsideClickDispatcher=F,this._animationsModuleType=$}create(n){const r=this._createHostElement(),s=this._createPaneElement(r),u=this._createPortalOutlet(s),h=new PK(n);return h.direction=h.direction||this._directionality.value,new LK(u,r,s,h,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(n){const r=this._document.createElement("div");return r.id="cdk-overlay-"+VK++,r.classList.add("cdk-overlay-pane"),n.appendChild(r),r}_createHostElement(){const n=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(n),n}_createPortalOutlet(n){return this._appRef||(this._appRef=this._injector.get(Ym)),new MK(n,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(AK),st(l3),st(Ms),st(BK),st(kK),st(Do),st(oi),st(Qi),st(iE),st(LC),st(RK),st(Rc,8))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const $K={provide:new kt("cdk-connected-overlay-scroll-strategy"),deps:[sE],useFactory:function jK(e){return()=>e.scrollStrategies.reposition()}};let HK=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({providers:[sE,$K],imports:[nx,DK,t3,t3]}),t})();const WK=new kt("mat-sanity-checks",{providedIn:"root",factory:function qK(){return!0}});let rx=(()=>{var e;class t{constructor(n,r,s){this._sanityChecks=r,this._document=s,this._hasDoneGlobalChecks=!1,n._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(n){return!PS()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[n])}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Z5),st(WK,8),st(Qi))},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({imports:[nx,nx]}),t})();function ZK(e,t){return class extends e{get color(){return this._color}set color(i){const n=i||this.defaultColor;n!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),n&&this._elementRef.nativeElement.classList.add(`mat-${n}`),this._color=n)}constructor(...i){super(...i),this.defaultColor=t,this.color=t}}}function XK(e){return class extends e{get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=up(t)}constructor(...t){super(...t),this._disableRipple=!1}}}class KK{constructor(t,i,n,r=!1){this._renderer=t,this.element=i,this.config=n,this._animationForciblyDisabledThroughCss=r,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const b3=Jb({passive:!0,capture:!0});class QK{constructor(){this._events=new Map,this._delegateEventHandler=t=>{const i=dp(t);i&&this._events.get(t.type)?.forEach((n,r)=>{(r===i||r.contains(i))&&n.forEach(s=>s.handleEvent(t))})}}addHandler(t,i,n,r){const s=this._events.get(i);if(s){const u=s.get(n);u?u.add(r):s.set(n,new Set([r]))}else this._events.set(i,new Map([[n,new Set([r])]])),t.runOutsideAngular(()=>{document.addEventListener(i,this._delegateEventHandler,b3)})}removeHandler(t,i,n){const r=this._events.get(t);if(!r)return;const s=r.get(i);s&&(s.delete(n),0===s.size&&r.delete(i),0===r.size&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,b3)))}}const x3={enterDuration:225,exitDuration:150},w3=Jb({passive:!0,capture:!0}),C3=["mousedown","touchstart"],E3=["mouseup","mouseleave","touchend","touchcancel"];class sx{constructor(t,i,n,r){this._target=t,this._ngZone=i,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=Hy(n))}fadeInRipple(t,i,n={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s={...x3,...n.animation};n.centered&&(t=r.left+r.width/2,i=r.top+r.height/2);const u=n.radius||function eQ(e,t,i){const n=Math.max(Math.abs(e-i.left),Math.abs(e-i.right)),r=Math.max(Math.abs(t-i.top),Math.abs(t-i.bottom));return Math.sqrt(n*n+r*r)}(t,i,r),h=t-r.left,_=i-r.top,x=s.enterDuration,M=document.createElement("div");M.classList.add("mat-ripple-element"),M.style.left=h-u+"px",M.style.top=_-u+"px",M.style.height=2*u+"px",M.style.width=2*u+"px",null!=n.color&&(M.style.backgroundColor=n.color),M.style.transitionDuration=`${x}ms`,this._containerElement.appendChild(M);const S=window.getComputedStyle(M),F=S.transitionDuration,$="none"===S.transitionProperty||"0s"===F||"0s, 0s"===F||0===r.width&&0===r.height,W=new KK(this,M,n,$);M.style.transform="scale3d(1, 1, 1)",W.state=0,n.persistent||(this._mostRecentTransientRipple=W);let X=null;return!$&&(x||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const K=()=>this._finishRippleTransition(W),Q=()=>this._destroyRipple(W);M.addEventListener("transitionend",K),M.addEventListener("transitioncancel",Q),X={onTransitionEnd:K,onTransitionCancel:Q}}),this._activeRipples.set(W,X),($||!x)&&this._finishRippleTransition(W),W}fadeOutRipple(t){if(2===t.state||3===t.state)return;const i=t.element,n={...x3,...t.config.animation};i.style.transitionDuration=`${n.exitDuration}ms`,i.style.opacity="0",t.state=2,(t._animationForciblyDisabledThroughCss||!n.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){const i=Hy(t);!this._platform.isBrowser||!i||i===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=i,C3.forEach(n=>{sx._eventManager.addHandler(this._ngZone,n,i,this)}))}handleEvent(t){"mousedown"===t.type?this._onMousedown(t):"touchstart"===t.type?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{E3.forEach(i=>{this._triggerElement.addEventListener(i,this,w3)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){0===t.state?this._startFadeOutTransition(t):2===t.state&&this._destroyRipple(t)}_startFadeOutTransition(t){const i=t===this._mostRecentTransientRipple,{persistent:n}=t.config;t.state=1,!n&&(!i||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){const i=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=3,null!==i&&(t.element.removeEventListener("transitionend",i.onTransitionEnd),t.element.removeEventListener("transitioncancel",i.onTransitionCancel)),t.element.remove()}_onMousedown(t){const i=$5(t),n=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!i&&!n&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!H5(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const i=t.changedTouches;if(i)for(let n=0;n<i.length;n++)this.fadeInRipple(i[n].clientX,i[n].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{!t.config.persistent&&(1===t.state||t.config.terminateOnPointerUp&&0===t.state)&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const t=this._triggerElement;t&&(C3.forEach(i=>sx._eventManager.removeHandler(i,t,this)),this._pointerUpEventsRegistered&&E3.forEach(i=>t.removeEventListener(i,this,w3)))}}sx._eventManager=new QK;const M3=new kt("mat-ripple-global-options");let D3=(()=>{var e;class t{get disabled(){return this._disabled}set disabled(n){n&&this.fadeOutAllNonPersistent(),this._disabled=n,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(n){this._trigger=n,this._setupTriggerEventsIfEnabled()}constructor(n,r,s,u,h){this._elementRef=n,this._animationMode=h,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new sx(this,r,n,s)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(n,r=0,s){return"number"==typeof n?this._rippleRenderer.fadeInRipple(n,r,{...this.rippleConfig,...s}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...n})}}return(e=t).\u0275fac=function(n){return new(n||e)(q(cr),q(oi),q(Ia),q(M3,8),q(Rc,8))},e.\u0275dir=Pt({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(n,r){2&n&&Io("mat-ripple-unbounded",r.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),t})(),tQ=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({imports:[rx,rx]}),t})();const nQ=["tooltip"],T3=new kt("mat-tooltip-scroll-strategy"),oQ={provide:T3,deps:[sE],useFactory:function rQ(e){return()=>e.scrollStrategies.reposition({scrollThrottle:20})}},aQ=new kt("mat-tooltip-default-options",{providedIn:"root",factory:function sQ(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),S3="tooltip-panel",I3=Jb({passive:!0});let fQ=(()=>{var e;class t{get position(){return this._position}set position(n){n!==this._position&&(this._position=n,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(n){this._positionAtOrigin=up(n),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(n){this._disabled=up(n),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(n){this._showDelay=nl(n)}get hideDelay(){return this._hideDelay}set hideDelay(n){this._hideDelay=nl(n),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(n){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=n?String(n).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(n){this._tooltipClass=n,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(n,r,s,u,h,_,x,M,S,P,F,$){this._overlay=n,this._elementRef=r,this._scrollDispatcher=s,this._viewContainerRef=u,this._ngZone=h,this._platform=_,this._ariaDescriber=x,this._focusMonitor=M,this._dir=P,this._defaultOptions=F,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="mat",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new hi,this._scrollStrategy=S,this._document=$,F&&(this._showDelay=F.showDelay,this._hideDelay=F.hideDelay,F.position&&(this.position=F.position),F.positionAtOrigin&&(this.positionAtOrigin=F.positionAtOrigin),F.touchGestures&&(this.touchGestures=F.touchGestures)),P.change.pipe($l(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe($l(this._destroyed)).subscribe(n=>{n?"keyboard"===n&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const n=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([r,s])=>{n.removeEventListener(r,s,I3)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(n,this.message,"tooltip"),this._focusMonitor.stopMonitoring(n)}show(n=this.showDelay,r){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const s=this._createOverlay(r);this._detach(),this._portal=this._portal||new n3(this._tooltipComponent,this._viewContainerRef);const u=this._tooltipInstance=s.attach(this._portal).instance;u._triggerElement=this._elementRef.nativeElement,u._mouseLeaveHideDelay=this._hideDelay,u.afterHidden().pipe($l(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),u.show(n)}hide(n=this.hideDelay){const r=this._tooltipInstance;r&&(r.isVisible()?r.hide(n):(r._cancelPendingAnimations(),this._detach()))}toggle(n){this._isTooltipVisible()?this.hide():this.show(void 0,n)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(n){if(this._overlayRef){const u=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!n)&&u._origin instanceof cr)return this._overlayRef;this._detach()}const r=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),s=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&n||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(r);return s.positionChanges.pipe($l(this._destroyed)).subscribe(u=>{this._updateCurrentPositionClass(u.connectionPair),this._tooltipInstance&&u.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:s,panelClass:`${this._cssClassPrefix}-${S3}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe($l(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe($l(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe($l(this._destroyed)).subscribe(u=>{this._isTooltipVisible()&&27===u.keyCode&&!function pY(e,...t){return t.length?t.some(i=>e[i]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(u)&&(u.preventDefault(),u.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(n){const r=n.getConfig().positionStrategy,s=this._getOrigin(),u=this._getOverlayPosition();r.withPositions([this._addOffset({...s.main,...u.main}),this._addOffset({...s.fallback,...u.fallback})])}_addOffset(n){return n}_getOrigin(){const n=!this._dir||"ltr"==this._dir.value,r=this.position;let s;"above"==r||"below"==r?s={originX:"center",originY:"above"==r?"top":"bottom"}:"before"==r||"left"==r&&n||"right"==r&&!n?s={originX:"start",originY:"center"}:("after"==r||"right"==r&&n||"left"==r&&!n)&&(s={originX:"end",originY:"center"});const{x:u,y:h}=this._invertPosition(s.originX,s.originY);return{main:s,fallback:{originX:u,originY:h}}}_getOverlayPosition(){const n=!this._dir||"ltr"==this._dir.value,r=this.position;let s;"above"==r?s={overlayX:"center",overlayY:"bottom"}:"below"==r?s={overlayX:"center",overlayY:"top"}:"before"==r||"left"==r&&n||"right"==r&&!n?s={overlayX:"end",overlayY:"center"}:("after"==r||"right"==r&&n||"left"==r&&!n)&&(s={overlayX:"start",overlayY:"center"});const{x:u,y:h}=this._invertPosition(s.overlayX,s.overlayY);return{main:s,fallback:{overlayX:u,overlayY:h}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Hc(1),$l(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(n){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=n,this._tooltipInstance._markForCheck())}_invertPosition(n,r){return"above"===this.position||"below"===this.position?"top"===r?r="bottom":"bottom"===r&&(r="top"):"end"===n?n="start":"start"===n&&(n="end"),{x:n,y:r}}_updateCurrentPositionClass(n){const{overlayY:r,originX:s,originY:u}=n;let h;if(h="center"===r?this._dir&&"rtl"===this._dir.value?"end"===s?"left":"right":"start"===s?"left":"right":"bottom"===r&&"top"===u?"above":"below",h!==this._currentPosition){const _=this._overlayRef;if(_){const x=`${this._cssClassPrefix}-${S3}-`;_.removePanelClass(x+this._currentPosition),_.addPanelClass(x+h)}this._currentPosition=h}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",n=>{let r;this._setupPointerExitEventsIfNeeded(),void 0!==n.x&&void 0!==n.y&&(r=n),this.show(void 0,r)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",n=>{const r=n.targetTouches?.[0],s=r?{x:r.clientX,y:r.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,s),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const n=[];if(this._platformSupportsMouseEvents())n.push(["mouseleave",r=>{const s=r.relatedTarget;(!s||!this._overlayRef?.overlayElement.contains(s))&&this.hide()}],["wheel",r=>this._wheelListener(r)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const r=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};n.push(["touchend",r],["touchcancel",r])}this._addListeners(n),this._passiveListeners.push(...n)}_addListeners(n){n.forEach(([r,s])=>{this._elementRef.nativeElement.addEventListener(r,s,I3)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(n){if(this._isTooltipVisible()){const r=this._document.elementFromPoint(n.clientX,n.clientY),s=this._elementRef.nativeElement;r!==s&&!s.contains(r)&&this.hide()}}_disableNativeGesturesIfNecessary(){const n=this.touchGestures;if("off"!==n){const r=this._elementRef.nativeElement,s=r.style;("on"===n||"INPUT"!==r.nodeName&&"TEXTAREA"!==r.nodeName)&&(s.userSelect=s.msUserSelect=s.webkitUserSelect=s.MozUserSelect="none"),("on"===n||!r.draggable)&&(s.webkitUserDrag="none"),s.touchAction="none",s.webkitTapHighlightColor="transparent"}}}return(e=t).\u0275fac=function(n){pe()},e.\u0275dir=Pt({type:e,inputs:{position:["matTooltipPosition","position"],positionAtOrigin:["matTooltipPositionAtOrigin","positionAtOrigin"],disabled:["matTooltipDisabled","disabled"],showDelay:["matTooltipShowDelay","showDelay"],hideDelay:["matTooltipHideDelay","hideDelay"],touchGestures:["matTooltipTouchGestures","touchGestures"],message:["matTooltip","message"],tooltipClass:["matTooltipClass","tooltipClass"]}}),t})(),GS=(()=>{var e;class t extends fQ{constructor(n,r,s,u,h,_,x,M,S,P,F,$){super(n,r,s,u,h,_,x,M,S,P,F,$),this._tooltipComponent=mQ,this._cssClassPrefix="mat-mdc",this._viewportMargin=8}_addOffset(n){const s=!this._dir||"ltr"==this._dir.value;return"top"===n.originY?n.offsetY=-8:"bottom"===n.originY?n.offsetY=8:"start"===n.originX?n.offsetX=s?-8:8:"end"===n.originX&&(n.offsetX=s?8:-8),n}}return(e=t).\u0275fac=function(n){return new(n||e)(q(sE),q(cr),q(J5),q(zl),q(oi),q(Ia),q(BY),q(YY),q(T3),q(iE,8),q(aQ,8),q(Qi))},e.\u0275dir=Pt({type:e,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(n,r){2&n&&Io("mat-mdc-tooltip-disabled",r.disabled)},exportAs:["matTooltip"],features:[Si]}),t})(),pQ=(()=>{var e;class t{constructor(n,r){this._changeDetectorRef=n,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new hi,this._animationsDisabled="NoopAnimations"===r}show(n){null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},n)}hide(n){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},n)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:n}){(!n||!this._triggerElement.contains(n))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){}_handleAnimationEnd({animationName:n}){(n===this._showAnimation||n===this._hideAnimation)&&this._finalizeAnimation(n===this._showAnimation)}_cancelPendingAnimations(){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(n){n?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(n){const r=this._tooltip.nativeElement,s=this._showAnimation,u=this._hideAnimation;if(r.classList.remove(n?u:s),r.classList.add(n?s:u),this._isVisible=n,n&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const h=getComputedStyle(r);("0s"===h.getPropertyValue("animation-duration")||"none"===h.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}n&&this._onShow(),this._animationsDisabled&&(r.classList.add("_mat-animation-noopable"),this._finalizeAnimation(n))}}return(e=t).\u0275fac=function(n){return new(n||e)(q(rd),q(Rc,8))},e.\u0275dir=Pt({type:e}),t})(),mQ=(()=>{var e;class t extends pQ{constructor(n,r,s){super(n,s),this._elementRef=r,this._isMultiline=!1,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide"}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const n=this._elementRef.nativeElement.getBoundingClientRect();return n.height>24&&n.width>=200}}return(e=t).\u0275fac=function(n){return new(n||e)(q(rd),q(cr),q(Rc,8))},e.\u0275cmp=ui({type:e,selectors:[["mat-tooltip-component"]],viewQuery:function(n,r){if(1&n&&Ch(nQ,7),2&n){let s;Bl(s=Vl())&&(r._tooltip=s.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(n,r){1&n&&Cr("mouseleave",function(u){return r._handleMouseLeave(u)}),2&n&&Nl("zoom",r.isVisible()?1:null)},features:[Si],decls:4,vars:4,consts:[[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"ngClass","animationend"],["tooltip",""],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(n,r){1&n&&(vt(0,"div",0,1),Cr("animationend",function(u){return r._handleAnimationEnd(u)}),vt(2,"div",2),sn(3),Tt()()),2&n&&(Io("mdc-tooltip--multiline",r._isMultiline),Ft("ngClass",r.tooltipClass),j(3),Yi(r.message))},dependencies:[e5],styles:['.mdc-tooltip__surface{word-break:break-all;word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip--showing-transition .mdc-tooltip__surface-animation{transition:opacity 150ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-tooltip--hide-transition .mdc-tooltip__surface-animation{transition:opacity 75ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - (2 * 8px));margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - (2 * 8px));align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mat-mdc-tooltip{--mdc-plain-tooltip-container-shape:4px;--mdc-plain-tooltip-supporting-text-line-height:16px}.mat-mdc-tooltip .mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color)}.mat-mdc-tooltip .mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__caret-surface-top,.mat-mdc-tooltip .mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color)}.mat-mdc-tooltip .mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0}),t})(),gQ=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({providers:[oQ],imports:[KY,yS,HK,rx,rx,jS]}),t})();const Hl=new kt("NgValueAccessor"),gJ=["knob"],_J=["valueIndicatorContainer"];function yJ(e,t){if(1&e&&(vt(0,"div",4,5)(2,"div",6)(3,"span",7),sn(4),Tt()()()),2&e){const i=dn();j(4),Yi(i.valueIndicatorText)}}const vJ=["trackActive"];function bJ(e,t){if(1&e&&zn(0,"div"),2&e){const i=t.$implicit,n=t.index,r=dn(3);f2(0===i?"mdc-slider__tick-mark--active":"mdc-slider__tick-mark--inactive"),Nl("transform",r._calcTickMarkTransform(n))}}function xJ(e,t){if(1&e&&(bh(0),yn(1,bJ,1,4,"div",11),xh()),2&e){const i=dn(2);j(1),Ft("ngForOf",i._tickMarks)}}function wJ(e,t){if(1&e&&(vt(0,"div",8,9),yn(2,xJ,2,1,"ng-container",10),Tt()),2&e){const i=dn();j(2),Ft("ngIf",i._cachedWidth)}}function CJ(e,t){if(1&e&&zn(0,"mat-slider-visual-thumb",7),2&e){const i=dn();Ft("discrete",i.discrete)("thumbPosition",1)("valueIndicatorText",i.startValueIndicatorText)}}const EJ=["*"],gE=new kt("_MatSlider"),kN=new kt("_MatSliderThumb"),RN=new kt("_MatSliderRangeThumb"),LN=new kt("_MatSliderVisualThumb");let MJ=(()=>{var e;class t{constructor(n,r,s,u){this._cdr=n,this._ngZone=r,this._slider=u,this._isHovered=!1,this._isActive=!1,this._isValueIndicatorVisible=!1,this._onPointerMove=h=>{if(this._sliderInput._isFocused)return;const _=this._hostElement.getBoundingClientRect(),x=this._slider._isCursorOnSliderThumb(h,_);this._isHovered=x,x?this._showHoverRipple():this._hideRipple(this._hoverRippleRef)},this._onMouseLeave=()=>{this._isHovered=!1,this._hideRipple(this._hoverRippleRef)},this._onFocus=()=>{this._hideRipple(this._hoverRippleRef),this._showFocusRipple(),this._hostElement.classList.add("mdc-slider__thumb--focused")},this._onBlur=()=>{this._isActive||this._hideRipple(this._focusRippleRef),this._isHovered&&this._showHoverRipple(),this._hostElement.classList.remove("mdc-slider__thumb--focused")},this._onDragStart=h=>{0===h.button&&(this._isActive=!0,this._showActiveRipple())},this._onDragEnd=()=>{this._isActive=!1,this._hideRipple(this._activeRippleRef),this._sliderInput._isFocused||this._hideRipple(this._focusRippleRef)},this._hostElement=s.nativeElement}ngAfterViewInit(){this._ripple.radius=24,this._sliderInput=this._slider._getInput(this.thumbPosition),this._sliderInputEl=this._sliderInput._hostElement;const n=this._sliderInputEl;this._ngZone.runOutsideAngular(()=>{n.addEventListener("pointermove",this._onPointerMove),n.addEventListener("pointerdown",this._onDragStart),n.addEventListener("pointerup",this._onDragEnd),n.addEventListener("pointerleave",this._onMouseLeave),n.addEventListener("focus",this._onFocus),n.addEventListener("blur",this._onBlur)})}ngOnDestroy(){const n=this._sliderInputEl;n.removeEventListener("pointermove",this._onPointerMove),n.removeEventListener("pointerdown",this._onDragStart),n.removeEventListener("pointerup",this._onDragEnd),n.removeEventListener("pointerleave",this._onMouseLeave),n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur)}_showHoverRipple(){this._isShowingRipple(this._hoverRippleRef)||(this._hoverRippleRef=this._showRipple({enterDuration:0,exitDuration:0}),this._hoverRippleRef?.element.classList.add("mat-mdc-slider-hover-ripple"))}_showFocusRipple(){this._isShowingRipple(this._focusRippleRef)||(this._focusRippleRef=this._showRipple({enterDuration:0,exitDuration:0},!0),this._focusRippleRef?.element.classList.add("mat-mdc-slider-focus-ripple"))}_showActiveRipple(){this._isShowingRipple(this._activeRippleRef)||(this._activeRippleRef=this._showRipple({enterDuration:225,exitDuration:400}),this._activeRippleRef?.element.classList.add("mat-mdc-slider-active-ripple"))}_isShowingRipple(n){return 0===n?.state||1===n?.state}_showRipple(n,r){if(!this._slider.disabled&&(this._showValueIndicator(),this._slider._isRange&&this._slider._getThumb(1===this.thumbPosition?2:1)._showValueIndicator(),!this._slider._globalRippleOptions?.disabled||r))return this._ripple.launch({animation:this._slider._noopAnimations?{enterDuration:0,exitDuration:0}:n,centered:!0,persistent:!0})}_hideRipple(n){if(n?.fadeOut(),this._isShowingAnyRipple())return;this._slider._isRange||this._hideValueIndicator();const r=this._getSibling();r._isShowingAnyRipple()||(this._hideValueIndicator(),r._hideValueIndicator())}_showValueIndicator(){this._hostElement.classList.add("mdc-slider__thumb--with-indicator")}_hideValueIndicator(){this._hostElement.classList.remove("mdc-slider__thumb--with-indicator")}_getSibling(){return this._slider._getThumb(1===this.thumbPosition?2:1)}_getValueIndicatorContainer(){return this._valueIndicatorContainer?.nativeElement}_getKnob(){return this._knob.nativeElement}_isShowingAnyRipple(){return this._isShowingRipple(this._hoverRippleRef)||this._isShowingRipple(this._focusRippleRef)||this._isShowingRipple(this._activeRippleRef)}}return(e=t).\u0275fac=function(n){return new(n||e)(q(rd),q(oi),q(cr),q(gE))},e.\u0275cmp=ui({type:e,selectors:[["mat-slider-visual-thumb"]],viewQuery:function(n,r){if(1&n&&(Ch(D3,5),Ch(gJ,5),Ch(_J,5)),2&n){let s;Bl(s=Vl())&&(r._ripple=s.first),Bl(s=Vl())&&(r._knob=s.first),Bl(s=Vl())&&(r._valueIndicatorContainer=s.first)}},hostAttrs:[1,"mdc-slider__thumb","mat-mdc-slider-visual-thumb"],inputs:{discrete:"discrete",thumbPosition:"thumbPosition",valueIndicatorText:"valueIndicatorText"},features:[Ki([{provide:LN,useExisting:e}])],decls:4,vars:2,consts:[["class","mdc-slider__value-indicator-container",4,"ngIf"],[1,"mdc-slider__thumb-knob"],["knob",""],["matRipple","",1,"mat-mdc-focus-indicator",3,"matRippleDisabled"],[1,"mdc-slider__value-indicator-container"],["valueIndicatorContainer",""],[1,"mdc-slider__value-indicator"],[1,"mdc-slider__value-indicator-text"]],template:function(n,r){1&n&&(yn(0,yJ,5,1,"div",0),zn(1,"div",1,2)(3,"div",3)),2&n&&(Ft("ngIf",r.discrete),j(3),Ft("matRippleDisabled",!0))},dependencies:[Sa,D3],styles:[".mat-mdc-slider-visual-thumb .mat-ripple{height:100%;width:100%}.mat-mdc-slider .mdc-slider__tick-marks{justify-content:start}.mat-mdc-slider .mdc-slider__tick-marks .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-marks .mdc-slider__tick-mark--inactive{position:absolute;left:2px}"],encapsulation:2,changeDetection:0}),t})();const DJ=ZK(XK(class{constructor(e){this._elementRef=e}}),"primary");let TJ=(()=>{var e;class t extends DJ{get disabled(){return this._disabled}set disabled(n){this._disabled=up(n);const r=this._getInput(2),s=this._getInput(1);r&&(r.disabled=this._disabled),s&&(s.disabled=this._disabled)}get discrete(){return this._discrete}set discrete(n){this._discrete=up(n),this._updateValueIndicatorUIs()}get showTickMarks(){return this._showTickMarks}set showTickMarks(n){this._showTickMarks=up(n)}get min(){return this._min}set min(n){const r=nl(n,this._min);this._min!==r&&this._updateMin(r)}_updateMin(n){const r=this._min;this._min=n,this._isRange?this._updateMinRange({old:r,new:n}):this._updateMinNonRange(n),this._onMinMaxOrStepChange()}_updateMinRange(n){const r=this._getInput(2),s=this._getInput(1),u=r.value,h=s.value;s.min=n.new,r.min=Math.max(n.new,s.value),s.max=Math.min(r.max,r.value),s._updateWidthInactive(),r._updateWidthInactive(),n.new<n.old?this._onTranslateXChangeBySideEffect(r,s):this._onTranslateXChangeBySideEffect(s,r),u!==r.value&&this._onValueChange(r),h!==s.value&&this._onValueChange(s)}_updateMinNonRange(n){const r=this._getInput(2);if(r){const s=r.value;r.min=n,r._updateThumbUIByValue(),this._updateTrackUI(r),s!==r.value&&this._onValueChange(r)}}get max(){return this._max}set max(n){const r=nl(n,this._max);this._max!==r&&this._updateMax(r)}_updateMax(n){const r=this._max;this._max=n,this._isRange?this._updateMaxRange({old:r,new:n}):this._updateMaxNonRange(n),this._onMinMaxOrStepChange()}_updateMaxRange(n){const r=this._getInput(2),s=this._getInput(1),u=r.value,h=s.value;r.max=n.new,s.max=Math.min(n.new,r.value),r.min=s.value,r._updateWidthInactive(),s._updateWidthInactive(),n.new>n.old?this._onTranslateXChangeBySideEffect(s,r):this._onTranslateXChangeBySideEffect(r,s),u!==r.value&&this._onValueChange(r),h!==s.value&&this._onValueChange(s)}_updateMaxNonRange(n){const r=this._getInput(2);if(r){const s=r.value;r.max=n,r._updateThumbUIByValue(),this._updateTrackUI(r),s!==r.value&&this._onValueChange(r)}}get step(){return this._step}set step(n){const r=nl(n,this._step);this._step!==r&&this._updateStep(r)}_updateStep(n){this._step=n,this._isRange?this._updateStepRange():this._updateStepNonRange(),this._onMinMaxOrStepChange()}_updateStepRange(){const n=this._getInput(2),r=this._getInput(1),s=n.value,u=r.value,h=r.value;n.min=this._min,r.max=this._max,n.step=this._step,r.step=this._step,this._platform.SAFARI&&(n.value=n.value,r.value=r.value),n.min=Math.max(this._min,r.value),r.max=Math.min(this._max,n.value),r._updateWidthInactive(),n._updateWidthInactive(),n.value<h?this._onTranslateXChangeBySideEffect(r,n):this._onTranslateXChangeBySideEffect(n,r),s!==n.value&&this._onValueChange(n),u!==r.value&&this._onValueChange(r)}_updateStepNonRange(){const n=this._getInput(2);if(n){const r=n.value;n.step=this._step,this._platform.SAFARI&&(n.value=n.value),n._updateThumbUIByValue(),r!==n.value&&this._onValueChange(n)}}constructor(n,r,s,u,h,_){super(s),this._ngZone=n,this._cdr=r,this._dir=u,this._globalRippleOptions=h,this._disabled=!1,this._discrete=!1,this._showTickMarks=!1,this._min=0,this._max=100,this._step=1,this.displayWith=x=>`${x}`,this._rippleRadius=24,this.startValueIndicatorText="",this.endValueIndicatorText="",this._isRange=!1,this._isRtl=!1,this._hasViewInitialized=!1,this._tickMarkTrackWidth=0,this._hasAnimation=!1,this._resizeTimer=null,this._platform=Vt(Ia),this._knobRadius=8,this._thumbsOverlap=!1,this._noopAnimations="NoopAnimations"===_,this._dirChangeSubscription=this._dir.change.subscribe(()=>this._onDirChange()),this._isRtl="rtl"===this._dir.value}ngAfterViewInit(){this._platform.isBrowser&&this._updateDimensions();const n=this._getInput(2),r=this._getInput(1);this._isRange=!!n&&!!r,this._cdr.detectChanges();const s=this._getThumb(2);this._rippleRadius=s._ripple.radius,this._inputPadding=this._rippleRadius-this._knobRadius,this._inputOffset=this._knobRadius,this._isRange?this._initUIRange(n,r):this._initUINonRange(n),this._updateTrackUI(n),this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._observeHostResize(),this._cdr.detectChanges()}_initUINonRange(n){n.initProps(),n.initUI(),this._updateValueIndicatorUI(n),this._hasViewInitialized=!0,n._updateThumbUIByValue()}_initUIRange(n,r){n.initProps(),n.initUI(),r.initProps(),r.initUI(),n._updateMinMax(),r._updateMinMax(),n._updateStaticStyles(),r._updateStaticStyles(),this._updateValueIndicatorUIs(),this._hasViewInitialized=!0,n._updateThumbUIByValue(),r._updateThumbUIByValue()}ngOnDestroy(){this._dirChangeSubscription.unsubscribe(),this._resizeObserver?.disconnect(),this._resizeObserver=null}_onDirChange(){this._isRtl="rtl"===this._dir.value,this._isRange?this._onDirChangeRange():this._onDirChangeNonRange(),this._updateTickMarkUI()}_onDirChangeRange(){const n=this._getInput(2),r=this._getInput(1);n._setIsLeftThumb(),r._setIsLeftThumb(),n.translateX=n._calcTranslateXByValue(),r.translateX=r._calcTranslateXByValue(),n._updateStaticStyles(),r._updateStaticStyles(),n._updateWidthInactive(),r._updateWidthInactive(),n._updateThumbUIByValue(),r._updateThumbUIByValue()}_onDirChangeNonRange(){this._getInput(2)._updateThumbUIByValue()}_observeHostResize(){typeof ResizeObserver>"u"||!ResizeObserver||this._ngZone.runOutsideAngular(()=>{this._resizeObserver=new ResizeObserver(()=>{this._isActive()||(this._resizeTimer&&clearTimeout(this._resizeTimer),this._onResize())}),this._resizeObserver.observe(this._elementRef.nativeElement)})}_isActive(){return this._getThumb(1)._isActive||this._getThumb(2)._isActive}_getValue(n=2){const r=this._getInput(n);return r?r.value:this.min}_skipUpdate(){return!(!this._getInput(1)?._skipUIUpdate&&!this._getInput(2)?._skipUIUpdate)}_updateDimensions(){this._cachedWidth=this._elementRef.nativeElement.offsetWidth,this._cachedLeft=this._elementRef.nativeElement.getBoundingClientRect().left}_setTrackActiveStyles(n){const r=this._trackActive.nativeElement.style;r.left=n.left,r.right=n.right,r.transformOrigin=n.transformOrigin,r.transform=n.transform}_calcTickMarkTransform(n){return`translateX(${n*(this._tickMarkTrackWidth/(this._tickMarks.length-1))}px`}_onTranslateXChange(n){this._hasViewInitialized&&(this._updateThumbUI(n),this._updateTrackUI(n),this._updateOverlappingThumbUI(n))}_onTranslateXChangeBySideEffect(n,r){this._hasViewInitialized&&(n._updateThumbUIByValue(),r._updateThumbUIByValue())}_onValueChange(n){this._hasViewInitialized&&(this._updateValueIndicatorUI(n),this._updateTickMarkUI(),this._cdr.detectChanges())}_onMinMaxOrStepChange(){this._hasViewInitialized&&(this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._cdr.markForCheck())}_onResize(){if(this._hasViewInitialized){if(this._updateDimensions(),this._isRange){const n=this._getInput(2),r=this._getInput(1);n._updateThumbUIByValue(),r._updateThumbUIByValue(),n._updateStaticStyles(),r._updateStaticStyles(),n._updateMinMax(),r._updateMinMax(),n._updateWidthInactive(),r._updateWidthInactive()}else{const n=this._getInput(2);n&&n._updateThumbUIByValue()}this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._cdr.detectChanges()}}_areThumbsOverlapping(){const n=this._getInput(1),r=this._getInput(2);return!(!n||!r)&&r.translateX-n.translateX<20}_updateOverlappingThumbClassNames(n){const r=n.getSibling(),s=this._getThumb(n.thumbPosition);this._getThumb(r.thumbPosition)._hostElement.classList.remove("mdc-slider__thumb--top"),s._hostElement.classList.toggle("mdc-slider__thumb--top",this._thumbsOverlap)}_updateOverlappingThumbUI(n){!this._isRange||this._skipUpdate()||this._thumbsOverlap!==this._areThumbsOverlapping()&&(this._thumbsOverlap=!this._thumbsOverlap,this._updateOverlappingThumbClassNames(n))}_updateThumbUI(n){this._skipUpdate()||(this._getThumb(2===n.thumbPosition?2:1)._hostElement.style.transform=`translateX(${n.translateX}px)`)}_updateValueIndicatorUI(n){if(this._skipUpdate())return;const r=this.displayWith(n.value);if(this._hasViewInitialized?n._valuetext=r:n._hostElement.setAttribute("aria-valuetext",r),this.discrete){1===n.thumbPosition?this.startValueIndicatorText=r:this.endValueIndicatorText=r;const s=this._getThumb(n.thumbPosition);r.length<3?s._hostElement.classList.add("mdc-slider__thumb--short-value"):s._hostElement.classList.remove("mdc-slider__thumb--short-value")}}_updateValueIndicatorUIs(){const n=this._getInput(2),r=this._getInput(1);n&&this._updateValueIndicatorUI(n),r&&this._updateValueIndicatorUI(r)}_updateTickMarkTrackUI(){if(!this.showTickMarks||this._skipUpdate())return;const n=this._step&&this._step>0?this._step:1,s=(Math.floor(this.max/n)*n-this.min)/(this.max-this.min);this._tickMarkTrackWidth=this._cachedWidth*s-6}_updateTrackUI(n){this._skipUpdate()||(this._isRange?this._updateTrackUIRange(n):this._updateTrackUINonRange(n))}_updateTrackUIRange(n){const r=n.getSibling();if(!r||!this._cachedWidth)return;const s=Math.abs(r.translateX-n.translateX)/this._cachedWidth;this._setTrackActiveStyles(n._isLeftThumb&&this._cachedWidth?{left:"auto",right:this._cachedWidth-r.translateX+"px",transformOrigin:"right",transform:`scaleX(${s})`}:{left:`${r.translateX}px`,right:"auto",transformOrigin:"left",transform:`scaleX(${s})`})}_updateTrackUINonRange(n){this._setTrackActiveStyles(this._isRtl?{left:"auto",right:"0px",transformOrigin:"right",transform:`scaleX(${1-n.fillPercentage})`}:{left:"0px",right:"auto",transformOrigin:"left",transform:`scaleX(${n.fillPercentage})`})}_updateTickMarkUI(){if(!this.showTickMarks||void 0===this.step||void 0===this.min||void 0===this.max)return;const n=this.step>0?this.step:1;this._isRange?this._updateTickMarkUIRange(n):this._updateTickMarkUINonRange(n),this._isRtl&&this._tickMarks.reverse()}_updateTickMarkUINonRange(n){const r=this._getValue();let s=Math.max(Math.round((r-this.min)/n),0),u=Math.max(Math.round((this.max-r)/n),0);this._isRtl?s++:u++,this._tickMarks=Array(s).fill(0).concat(Array(u).fill(1))}_updateTickMarkUIRange(n){const r=this._getValue(),s=this._getValue(1),u=Math.max(Math.floor((s-this.min)/n),0),h=Math.max(Math.floor((r-s)/n)+1,0),_=Math.max(Math.floor((this.max-r)/n),0);this._tickMarks=Array(u).fill(1).concat(Array(h).fill(0),Array(_).fill(1))}_getInput(n){return 2===n&&this._input?this._input:this._inputs?.length?1===n?this._inputs.first:this._inputs.last:void 0}_getThumb(n){return 2===n?this._thumbs?.last:this._thumbs?.first}_setTransition(n){this._hasAnimation=!this._platform.IOS&&n&&!this._noopAnimations,this._elementRef.nativeElement.classList.toggle("mat-mdc-slider-with-animation",this._hasAnimation)}_isCursorOnSliderThumb(n,r){const s=r.width/2,x=n.clientY-(r.y+s);return Math.pow(n.clientX-(r.x+s),2)+Math.pow(x,2)<Math.pow(s,2)}}return(e=t).\u0275fac=function(n){return new(n||e)(q(oi),q(rd),q(cr),q(iE,8),q(M3,8),q(Rc,8))},e.\u0275cmp=ui({type:e,selectors:[["mat-slider"]],contentQueries:function(n,r,s){if(1&n&&(MC(s,kN,5),MC(s,RN,4)),2&n){let u;Bl(u=Vl())&&(r._input=u.first),Bl(u=Vl())&&(r._inputs=u)}},viewQuery:function(n,r){if(1&n&&(Ch(vJ,5),Ch(LN,5)),2&n){let s;Bl(s=Vl())&&(r._trackActive=s.first),Bl(s=Vl())&&(r._thumbs=s)}},hostAttrs:[1,"mat-mdc-slider","mdc-slider"],hostVars:10,hostBindings:function(n,r){2&n&&Io("mdc-slider--range",r._isRange)("mdc-slider--disabled",r.disabled)("mdc-slider--discrete",r.discrete)("mdc-slider--tick-marks",r.showTickMarks)("_mat-animation-noopable",r._noopAnimations)},inputs:{color:"color",disableRipple:"disableRipple",disabled:"disabled",discrete:"discrete",showTickMarks:"showTickMarks",min:"min",max:"max",step:"step",displayWith:"displayWith"},exportAs:["matSlider"],features:[Ki([{provide:gE,useExisting:e}]),Si],ngContentSelectors:EJ,decls:9,vars:5,consts:[[1,"mdc-slider__track"],[1,"mdc-slider__track--inactive"],[1,"mdc-slider__track--active"],[1,"mdc-slider__track--active_fill"],["trackActive",""],["class","mdc-slider__tick-marks",4,"ngIf"],[3,"discrete","thumbPosition","valueIndicatorText",4,"ngIf"],[3,"discrete","thumbPosition","valueIndicatorText"],[1,"mdc-slider__tick-marks"],["tickMarkContainer",""],[4,"ngIf"],[3,"class","transform",4,"ngFor","ngForOf"]],template:function(n,r){1&n&&(Lb(),Fb(0),vt(1,"div",0),zn(2,"div",1),vt(3,"div",2),zn(4,"div",3,4),Tt(),yn(6,wJ,3,1,"div",5),Tt(),yn(7,CJ,1,3,"mat-slider-visual-thumb",6),zn(8,"mat-slider-visual-thumb",7)),2&n&&(j(6),Ft("ngIf",r.showTickMarks),j(1),Ft("ngIf",r._isRange),j(1),Ft("discrete",r.discrete)("thumbPosition",2)("valueIndicatorText",r.endValueIndicatorText))},dependencies:[Jm,Sa,MJ],styles:['.mdc-slider{cursor:pointer;height:48px;margin:0 24px;position:relative;touch-action:pan-y}.mdc-slider .mdc-slider__track{position:absolute;top:50%;transform:translateY(-50%);width:100%}.mdc-slider .mdc-slider__track--active,.mdc-slider .mdc-slider__track--inactive{display:flex;height:100%;position:absolute;width:100%}.mdc-slider .mdc-slider__track--active{overflow:hidden}.mdc-slider .mdc-slider__track--active_fill{border-top-style:solid;box-sizing:border-box;height:100%;width:100%;position:relative;-webkit-transform-origin:left;transform-origin:left}[dir=rtl] .mdc-slider .mdc-slider__track--active_fill,.mdc-slider .mdc-slider__track--active_fill[dir=rtl]{-webkit-transform-origin:right;transform-origin:right}.mdc-slider .mdc-slider__track--inactive{left:0;top:0}.mdc-slider .mdc-slider__track--inactive::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-slider .mdc-slider__track--inactive::before{border-color:CanvasText}}.mdc-slider .mdc-slider__value-indicator-container{bottom:44px;left:var(--slider-value-indicator-container-left, 50%);pointer-events:none;position:absolute;right:var(--slider-value-indicator-container-right);transform:var(--slider-value-indicator-container-transform, translateX(-50%))}.mdc-slider .mdc-slider__value-indicator{transition:transform 100ms 0ms cubic-bezier(0.4, 0, 1, 1);align-items:center;border-radius:4px;display:flex;height:32px;padding:0 12px;transform:scale(0);transform-origin:bottom}.mdc-slider .mdc-slider__value-indicator::before{border-left:6px solid rgba(0,0,0,0);border-right:6px solid rgba(0,0,0,0);border-top:6px solid;bottom:-5px;content:"";height:0;left:var(--slider-value-indicator-caret-left, 50%);position:absolute;right:var(--slider-value-indicator-caret-right);transform:var(--slider-value-indicator-caret-transform, translateX(-50%));width:0}.mdc-slider .mdc-slider__value-indicator::after{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-slider .mdc-slider__value-indicator::after{border-color:CanvasText}}.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator-container{pointer-events:auto}.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator{transition:transform 100ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale(1)}@media(prefers-reduced-motion){.mdc-slider .mdc-slider__value-indicator,.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator{transition:none}}.mdc-slider .mdc-slider__thumb{display:flex;left:-24px;outline:none;position:absolute;user-select:none;height:48px;width:48px}.mdc-slider .mdc-slider__thumb--top{z-index:1}.mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-style:solid;border-width:1px;box-sizing:content-box}.mdc-slider .mdc-slider__thumb-knob{box-sizing:border-box;left:50%;position:absolute;top:50%;transform:translate(-50%, -50%)}.mdc-slider .mdc-slider__tick-marks{align-items:center;box-sizing:border-box;display:flex;height:100%;justify-content:space-between;padding:0 1px;position:absolute;width:100%}.mdc-slider--discrete .mdc-slider__thumb,.mdc-slider--discrete .mdc-slider__track--active_fill{transition:transform 80ms ease}@media(prefers-reduced-motion){.mdc-slider--discrete .mdc-slider__thumb,.mdc-slider--discrete .mdc-slider__track--active_fill{transition:none}}.mdc-slider--disabled{cursor:auto}.mdc-slider--disabled .mdc-slider__thumb{pointer-events:none}.mdc-slider__input{cursor:pointer;left:2px;margin:0;height:44px;opacity:0;pointer-events:none;position:absolute;top:2px;width:44px}.mat-mdc-slider{display:inline-block;box-sizing:border-box;outline:none;vertical-align:middle;margin-left:8px;margin-right:8px;width:auto;min-width:112px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-slider .mdc-slider__thumb-knob{background-color:var(--mdc-slider-handle-color, var(--mdc-theme-primary, #6200ee));border-color:var(--mdc-slider-handle-color, var(--mdc-theme-primary, #6200ee))}.mat-mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb-knob{background-color:var(--mdc-slider-disabled-handle-color, var(--mdc-theme-on-surface, #000));border-color:var(--mdc-slider-disabled-handle-color, var(--mdc-theme-on-surface, #000))}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb::before,.mat-mdc-slider .mdc-slider__thumb::after{background-color:var(--mdc-slider-handle-color, var(--mdc-theme-primary, #6200ee))}.mat-mdc-slider .mdc-slider__thumb:hover::before,.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-surface--hover::before{opacity:var(--mdc-ripple-hover-opacity, 0.04)}.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-upgraded--background-focused::before,.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded):focus::before{transition-duration:75ms;opacity:var(--mdc-ripple-focus-opacity, 0.12)}.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded)::after{transition:opacity 150ms linear}.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded):active::after{transition-duration:75ms;opacity:var(--mdc-ripple-press-opacity, 0.12)}.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-ripple-press-opacity, 0.12)}.mat-mdc-slider .mdc-slider__track--active_fill{border-color:var(--mdc-slider-active-track-color, var(--mdc-theme-primary, #6200ee))}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__track--active_fill{border-color:var(--mdc-slider-disabled-active-track-color, var(--mdc-theme-on-surface, #000))}.mat-mdc-slider .mdc-slider__track--inactive{background-color:var(--mdc-slider-inactive-track-color, var(--mdc-theme-primary, #6200ee));opacity:.24}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__track--inactive{background-color:var(--mdc-slider-disabled-inactive-track-color, var(--mdc-theme-on-surface, #000));opacity:.24}.mat-mdc-slider .mdc-slider__tick-mark--active{background-color:var(--mdc-slider-with-tick-marks-active-container-color, var(--mdc-theme-on-primary, #fff));opacity:var(--mdc-slider-with-tick-marks-active-container-opacity, 0.6)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__tick-mark--active{background-color:var(--mdc-slider-with-tick-marks-active-container-color, var(--mdc-theme-on-primary, #fff));opacity:var(--mdc-slider-with-tick-marks-active-container-opacity, 0.6)}.mat-mdc-slider .mdc-slider__tick-mark--inactive{background-color:var(--mdc-slider-with-tick-marks-inactive-container-color, var(--mdc-theme-primary, #6200ee));opacity:var(--mdc-slider-with-tick-marks-inactive-container-opacity, 0.6)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__tick-mark--inactive{background-color:var(--mdc-slider-with-tick-marks-disabled-container-color, var(--mdc-theme-on-surface, #000));opacity:var(--mdc-slider-with-tick-marks-inactive-container-opacity, 0.6)}.mat-mdc-slider .mdc-slider__value-indicator{background-color:var(--mdc-slider-label-container-color, #666666);opacity:1}.mat-mdc-slider .mdc-slider__value-indicator::before{border-top-color:var(--mdc-slider-label-container-color, #666666)}.mat-mdc-slider .mdc-slider__value-indicator{color:var(--mdc-slider-label-label-text-color, var(--mdc-theme-on-primary, #fff))}.mat-mdc-slider .mdc-slider__track{height:var(--mdc-slider-inactive-track-height, 4px)}.mat-mdc-slider .mdc-slider__track--active{height:var(--mdc-slider-active-track-height, 6px);top:calc((var(--mdc-slider-inactive-track-height, 4px) - var(--mdc-slider-active-track-height, 6px)) / 2)}.mat-mdc-slider .mdc-slider__track--active_fill{border-top-width:var(--mdc-slider-active-track-height, 6px)}.mat-mdc-slider .mdc-slider__track--inactive{height:var(--mdc-slider-inactive-track-height, 4px)}.mat-mdc-slider .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-mark--inactive{height:var(--mdc-slider-with-tick-marks-container-size, 2px);width:var(--mdc-slider-with-tick-marks-container-size, 2px)}.mat-mdc-slider.mdc-slider--disabled{opacity:0.38}.mat-mdc-slider .mdc-slider__value-indicator-text{letter-spacing:var(--mdc-slider-label-label-text-tracking, 0.0071428571em);font-size:var(--mdc-slider-label-label-text-size, 0.875rem);font-family:var(--mdc-slider-label-label-text-font, Roboto, sans-serif);font-weight:var(--mdc-slider-label-label-text-weight, 500);line-height:var(--mdc-slider-label-label-text-line-height, 1.375rem)}.mat-mdc-slider .mdc-slider__track--active{border-radius:var(--mdc-slider-active-track-shape, 9999px)}.mat-mdc-slider .mdc-slider__track--inactive{border-radius:var(--mdc-slider-inactive-track-shape, 9999px)}.mat-mdc-slider .mdc-slider__thumb-knob{border-radius:var(--mdc-slider-handle-shape, 50%);width:var(--mdc-slider-handle-width, 20px);height:var(--mdc-slider-handle-height, 20px);border-style:solid;border-width:calc(var(--mdc-slider-handle-height, 20px) / 2) calc(var(--mdc-slider-handle-width, 20px) / 2)}.mat-mdc-slider .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-mark--inactive{border-radius:var(--mdc-slider-with-tick-marks-container-shape, 50%)}.mat-mdc-slider .mdc-slider__thumb-knob{box-shadow:var(--mdc-slider-handle-elevation, 0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px 0px rgba(0, 0, 0, 0.14), 0px 1px 3px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb-knob{background-color:var(--mdc-slider-hover-handle-color, var(--mdc-theme-primary, #6200ee));border-color:var(--mdc-slider-hover-handle-color, var(--mdc-theme-primary, #6200ee))}.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb-knob{background-color:var(--mdc-slider-focus-handle-color, var(--mdc-theme-primary, #6200ee));border-color:var(--mdc-slider-focus-handle-color, var(--mdc-theme-primary, #6200ee))}.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:var(--mdc-slider-with-overlap-handle-outline-color, #fff);border-width:var(--mdc-slider-with-overlap-handle-outline-width, 1px)}.mat-mdc-slider .mdc-slider__input{box-sizing:content-box;pointer-events:auto}.mat-mdc-slider .mdc-slider__input.mat-mdc-slider-input-no-pointer-events{pointer-events:none}.mat-mdc-slider .mdc-slider__input.mat-slider__right-input{left:auto;right:0}.mat-mdc-slider .mdc-slider__thumb,.mat-mdc-slider .mdc-slider__track--active_fill{transition-duration:0ms}.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__thumb,.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__track--active_fill{transition-duration:80ms}.mat-mdc-slider.mdc-slider--discrete .mdc-slider__thumb,.mat-mdc-slider.mdc-slider--discrete .mdc-slider__track--active_fill{transition-duration:0ms}.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__thumb,.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__track--active_fill{transition-duration:80ms}.mat-mdc-slider .mdc-slider__track,.mat-mdc-slider .mdc-slider__thumb{pointer-events:none}.mat-mdc-slider .mdc-slider__value-indicator{opacity:var(--mat-mdc-slider-value-indicator-opacity, 1)}.mat-mdc-slider .mat-ripple .mat-ripple-element{background-color:var(--mat-mdc-slider-ripple-color, transparent)}.mat-mdc-slider .mat-ripple .mat-mdc-slider-hover-ripple{background-color:var(--mat-mdc-slider-hover-ripple-color, transparent)}.mat-mdc-slider .mat-ripple .mat-mdc-slider-focus-ripple,.mat-mdc-slider .mat-ripple .mat-mdc-slider-active-ripple{background-color:var(--mat-mdc-slider-focus-ripple-color, transparent)}.mat-mdc-slider._mat-animation-noopable.mdc-slider--discrete .mdc-slider__thumb,.mat-mdc-slider._mat-animation-noopable.mdc-slider--discrete .mdc-slider__track--active_fill,.mat-mdc-slider._mat-animation-noopable .mdc-slider__value-indicator{transition:none}.mat-mdc-slider .mat-mdc-focus-indicator::before{border-radius:50%}.mdc-slider__thumb--focused .mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0}),t})();const IJ={provide:Hl,useExisting:Yn(()=>fI),multi:!0};let fI=(()=>{var e;class t{get value(){return nl(this._hostElement.value)}set value(n){const r=nl(n).toString();this._hasSetInitialValue?this._isActive||(this._hostElement.value=r,this._updateThumbUIByValue(),this._slider._onValueChange(this),this._cdr.detectChanges(),this._slider._cdr.markForCheck()):this._initialValue=r}get translateX(){return this._slider.min>=this._slider.max?(this._translateX=0,this._translateX):(void 0===this._translateX&&(this._translateX=this._calcTranslateXByValue()),this._translateX)}set translateX(n){this._translateX=n}get min(){return nl(this._hostElement.min)}set min(n){this._hostElement.min=nl(n).toString(),this._cdr.detectChanges()}get max(){return nl(this._hostElement.max)}set max(n){this._hostElement.max=nl(n).toString(),this._cdr.detectChanges()}get step(){return nl(this._hostElement.step)}set step(n){this._hostElement.step=nl(n).toString(),this._cdr.detectChanges()}get disabled(){return up(this._hostElement.disabled)}set disabled(n){this._hostElement.disabled=up(n),this._cdr.detectChanges(),this._slider.disabled!==this.disabled&&(this._slider.disabled=this.disabled)}get percentage(){return this._slider.min>=this._slider.max?this._slider._isRtl?1:0:(this.value-this._slider.min)/(this._slider.max-this._slider.min)}get fillPercentage(){return this._slider._cachedWidth?0===this._translateX?0:this.translateX/this._slider._cachedWidth:this._slider._isRtl?1:0}_setIsFocused(n){this._isFocused=n}constructor(n,r,s,u){this._ngZone=n,this._elementRef=r,this._cdr=s,this._slider=u,this.valueChange=new rr,this.dragStart=new rr,this.dragEnd=new rr,this.thumbPosition=2,this._knobRadius=8,this._isActive=!1,this._isFocused=!1,this._hasSetInitialValue=!1,this._destroyed=new hi,this._skipUIUpdate=!1,this._onTouchedFn=()=>{},this._isControlInitialized=!1,this._platform=Vt(Ia),this._hostElement=r.nativeElement,this._ngZone.runOutsideAngular(()=>{this._hostElement.addEventListener("pointerdown",this._onPointerDown.bind(this)),this._hostElement.addEventListener("pointermove",this._onPointerMove.bind(this)),this._hostElement.addEventListener("pointerup",this._onPointerUp.bind(this))})}ngOnDestroy(){this._hostElement.removeEventListener("pointerdown",this._onPointerDown),this._hostElement.removeEventListener("pointermove",this._onPointerMove),this._hostElement.removeEventListener("pointerup",this._onPointerUp),this._destroyed.next(),this._destroyed.complete(),this.dragStart.complete(),this.dragEnd.complete()}initProps(){this._updateWidthInactive(),this.disabled!==this._slider.disabled&&(this._slider.disabled=!0),this.step=this._slider.step,this.min=this._slider.min,this.max=this._slider.max,this._initValue()}initUI(){this._updateThumbUIByValue()}_initValue(){this._hasSetInitialValue=!0,void 0===this._initialValue?this.value=this._getDefaultValue():(this._hostElement.value=this._initialValue,this._updateThumbUIByValue(),this._slider._onValueChange(this),this._cdr.detectChanges())}_getDefaultValue(){return this.min}_onBlur(){this._setIsFocused(!1),this._onTouchedFn()}_onFocus(){this._setIsFocused(!0)}_onChange(){this.valueChange.emit(this.value),this._isActive&&this._updateThumbUIByValue({withAnimation:!0})}_onInput(){this._onChangeFn?.(this.value),(this._slider.step||!this._isActive)&&this._updateThumbUIByValue({withAnimation:!0}),this._slider._onValueChange(this)}_onNgControlValueChange(){(!this._isActive||!this._isFocused)&&(this._slider._onValueChange(this),this._updateThumbUIByValue()),this._slider.disabled=this._formControl.disabled}_onPointerDown(n){this.disabled||0!==n.button||(this._platform.IOS?this._slider._isCursorOnSliderThumb(n,this._slider._getThumb(this.thumbPosition)._hostElement.getBoundingClientRect())&&(this._isActive=!0):(this._isActive=!0,this._setIsFocused(!0)),this._updateWidthActive(),this._slider._updateDimensions(),this._slider.step||this._updateThumbUIByPointerEvent(n,{withAnimation:!0}),this.disabled||(this._handleValueCorrection(n),this.dragStart.emit({source:this,parent:this._slider,value:this.value})))}_handleValueCorrection(n){this._skipUIUpdate=!0,setTimeout(()=>{this._skipUIUpdate=!1,this._fixValue(n)},0)}_fixValue(n){const r=n.clientX-this._slider._cachedLeft,s=this._slider._cachedWidth,u=0===this._slider.step?1:this._slider.step,h=Math.floor((this._slider.max-this._slider.min)/u),M=Math.round((this._slider._isRtl?1-r/s:r/s)*h)/h*(this._slider.max-this._slider.min)+this._slider.min,S=Math.round(M/u)*u;if(S===this.value)return this._slider._onValueChange(this),void(this._slider.step>0?this._updateThumbUIByValue():this._updateThumbUIByPointerEvent(n,{withAnimation:this._slider._hasAnimation}));this.value=S,this.valueChange.emit(this.value),this._onChangeFn?.(this.value),this._slider._onValueChange(this),this._slider.step>0?this._updateThumbUIByValue():this._updateThumbUIByPointerEvent(n,{withAnimation:this._slider._hasAnimation})}_onPointerMove(n){!this._slider.step&&this._isActive&&this._updateThumbUIByPointerEvent(n)}_onPointerUp(){this._isActive&&(this._isActive=!1,this.dragEnd.emit({source:this,parent:this._slider,value:this.value}),setTimeout(()=>this._updateWidthInactive(),this._platform.IOS?10:0))}_clamp(n){return Math.max(Math.min(n,this._slider._cachedWidth),0)}_calcTranslateXByValue(){return this._slider._isRtl?(1-this.percentage)*this._slider._cachedWidth:this.percentage*this._slider._cachedWidth}_calcTranslateXByPointerEvent(n){return n.clientX-this._slider._cachedLeft}_updateWidthActive(){this._hostElement.style.padding=`0 ${this._slider._inputPadding}px`,this._hostElement.style.width=`calc(100% + ${this._slider._inputPadding}px)`}_updateWidthInactive(){this._hostElement.style.padding="0px",this._hostElement.style.width="calc(100% + 48px)",this._hostElement.style.left="-24px"}_updateThumbUIByValue(n){this.translateX=this._clamp(this._calcTranslateXByValue()),this._updateThumbUI(n)}_updateThumbUIByPointerEvent(n,r){this.translateX=this._clamp(this._calcTranslateXByPointerEvent(n)),this._updateThumbUI(r)}_updateThumbUI(n){this._slider._setTransition(!!n?.withAnimation),this._slider._onTranslateXChange(this)}writeValue(n){(this._isControlInitialized||null!==n)&&(this.value=n)}registerOnChange(n){this._onChangeFn=n,this._isControlInitialized=!0}registerOnTouched(n){this._onTouchedFn=n}setDisabledState(n){this.disabled=n}focus(){this._hostElement.focus()}blur(){this._hostElement.blur()}}return(e=t).\u0275fac=function(n){return new(n||e)(q(oi),q(cr),q(rd),q(gE))},e.\u0275dir=Pt({type:e,selectors:[["input","matSliderThumb",""]],hostAttrs:["type","range",1,"mdc-slider__input"],hostVars:1,hostBindings:function(n,r){1&n&&Cr("change",function(){return r._onChange()})("input",function(){return r._onInput()})("blur",function(){return r._onBlur()})("focus",function(){return r._onFocus()}),2&n&&Fl("aria-valuetext",r._valuetext)},inputs:{value:"value"},outputs:{valueChange:"valueChange",dragStart:"dragStart",dragEnd:"dragEnd"},exportAs:["matSliderThumb"],features:[Ki([IJ,{provide:kN,useExisting:e}])]}),t})(),OJ=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({imports:[rx,yS,tQ]}),t})();const _E=Rp(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function FN(e){return new On(t=>{Xn(e()).subscribe(t)})}function hx(e,t){const i=ni(e)?e:()=>e,n=r=>r.error(i());return new On(t?r=>t.schedule(n,0,r):n)}function pI(){return Ai((e,t)=>{let i=null;e._refCount++;const n=Mi(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(i=null);const r=e._connection,s=i;i=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(n),n.closed||(i=e.connect())})}class NN extends On{constructor(t,i){super(),this.source=t,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,wd(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Je;const i=this.getSubject();t.add(this.source.subscribe(Mi(i,void 0,()=>{this._teardown(),i.complete()},n=>{this._teardown(),i.error(n)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Je.EMPTY)}return t}refCount(){return pI()(this)}}function yE(e){return Ai((t,i)=>{let n=!1;t.subscribe(Mi(i,r=>{n=!0,i.next(r)},()=>{n||i.next(e),i.complete()}))})}function zN(e=RJ){return Ai((t,i)=>{let n=!1;t.subscribe(Mi(i,r=>{n=!0,i.next(r)},()=>n?i.complete():i.error(e())))})}function RJ(){return new _E}function og(e,t){const i=arguments.length>=2;return n=>n.pipe(e?Aa((r,s)=>e(r,s,n)):Rs,Hc(1),i?yE(t):zN(()=>new _E))}function Zy(e,t){return ni(t)?or(e,t,1):or(e,1)}function Ss(e,t,i){const n=ni(e)||t||i?{next:e,error:t,complete:i}:e;return n?Ai((r,s)=>{var u;null===(u=n.subscribe)||void 0===u||u.call(n);let h=!0;r.subscribe(Mi(s,_=>{var x;null===(x=n.next)||void 0===x||x.call(n,_),s.next(_)},()=>{var _;h=!1,null===(_=n.complete)||void 0===_||_.call(n),s.complete()},_=>{var x;h=!1,null===(x=n.error)||void 0===x||x.call(n,_),s.error(_)},()=>{var _,x;h&&(null===(_=n.unsubscribe)||void 0===_||_.call(n)),null===(x=n.finalize)||void 0===x||x.call(n)}))}):Rs}function mp(e){return Ai((t,i)=>{let s,n=null,r=!1;n=t.subscribe(Mi(i,void 0,void 0,u=>{s=Xn(e(u,mp(e)(t))),n?(n.unsubscribe(),n=null,s.subscribe(i)):r=!0})),r&&(n.unsubscribe(),n=null,s.subscribe(i))})}function mI(e){return e<=0?()=>Zo:Ai((t,i)=>{let n=[];t.subscribe(Mi(i,r=>{n.push(r),e<n.length&&n.shift()},()=>{for(const r of n)i.next(r);i.complete()},void 0,()=>{n=null}))})}function BN(e){return Un(()=>e)}function fx(e){return Ai((t,i)=>{try{t.subscribe(i)}finally{i.add(e)}})}const qn="primary",px=Symbol("RouteTitle");class zJ{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const i=this.params[t];return Array.isArray(i)?i[0]:i}return null}getAll(t){if(this.has(t)){const i=this.params[t];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}}function Xy(e){return new zJ(e)}function BJ(e,t,i){const n=i.path.split("/");if(n.length>e.length||"full"===i.pathMatch&&(t.hasChildren()||n.length<e.length))return null;const r={};for(let s=0;s<n.length;s++){const u=n[s],h=e[s];if(u.startsWith(":"))r[u.substring(1)]=h;else if(u!==h.path)return null}return{consumed:e.slice(0,n.length),posParams:r}}function od(e,t){const i=e?Object.keys(e):void 0,n=t?Object.keys(t):void 0;if(!i||!n||i.length!=n.length)return!1;let r;for(let s=0;s<i.length;s++)if(r=i[s],!VN(e[r],t[r]))return!1;return!0}function VN(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const i=[...e].sort(),n=[...t].sort();return i.every((r,s)=>n[s]===r)}return e===t}function UN(e){return e.length>0?e[e.length-1]:null}function gp(e){return function kJ(e){return!!e&&(e instanceof On||ni(e.lift)&&ni(e.subscribe))}(e)?e:Rb(e)?Pi(Promise.resolve(e)):Dt(e)}const UJ={exact:function HN(e,t,i){if(!sg(e.segments,t.segments)||!vE(e.segments,t.segments,i)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const n in t.children)if(!e.children[n]||!HN(e.children[n],t.children[n],i))return!1;return!0},subset:GN},jN={exact:function jJ(e,t){return od(e,t)},subset:function $J(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(i=>VN(e[i],t[i]))},ignored:()=>!0};function $N(e,t,i){return UJ[i.paths](e.root,t.root,i.matrixParams)&&jN[i.queryParams](e.queryParams,t.queryParams)&&!("exact"===i.fragment&&e.fragment!==t.fragment)}function GN(e,t,i){return qN(e,t,t.segments,i)}function qN(e,t,i,n){if(e.segments.length>i.length){const r=e.segments.slice(0,i.length);return!(!sg(r,i)||t.hasChildren()||!vE(r,i,n))}if(e.segments.length===i.length){if(!sg(e.segments,i)||!vE(e.segments,i,n))return!1;for(const r in t.children)if(!e.children[r]||!GN(e.children[r],t.children[r],n))return!1;return!0}{const r=i.slice(0,e.segments.length),s=i.slice(e.segments.length);return!!(sg(e.segments,r)&&vE(e.segments,r,n)&&e.children[qn])&&qN(e.children[qn],t,s,n)}}function vE(e,t,i){return t.every((n,r)=>jN[i](e[r].parameters,n.parameters))}class Yy{constructor(t=new Ji([],{}),i={},n=null){this.root=t,this.queryParams=i,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Xy(this.queryParams)),this._queryParamMap}toString(){return qJ.serialize(this)}}class Ji{constructor(t,i){this.segments=t,this.children=i,this.parent=null,Object.values(i).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return bE(this)}}class mx{constructor(t,i){this.path=t,this.parameters=i}get parameterMap(){return this._parameterMap||(this._parameterMap=Xy(this.parameters)),this._parameterMap}toString(){return XN(this)}}function sg(e,t){return e.length===t.length&&e.every((i,n)=>i.path===t[n].path)}let gx=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:function(){return new gI},providedIn:"root"}),t})();class gI{parse(t){const i=new iee(t);return new Yy(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(t){const i=`/${_x(t.root,!0)}`,n=function XJ(e){const t=Object.keys(e).map(i=>{const n=e[i];return Array.isArray(n)?n.map(r=>`${xE(i)}=${xE(r)}`).join("&"):`${xE(i)}=${xE(n)}`}).filter(i=>!!i);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${i}${n}${"string"==typeof t.fragment?`#${function WJ(e){return encodeURI(e)}(t.fragment)}`:""}`}}const qJ=new gI;function bE(e){return e.segments.map(t=>XN(t)).join("/")}function _x(e,t){if(!e.hasChildren())return bE(e);if(t){const i=e.children[qn]?_x(e.children[qn],!1):"",n=[];return Object.entries(e.children).forEach(([r,s])=>{r!==qn&&n.push(`${r}:${_x(s,!1)}`)}),n.length>0?`${i}(${n.join("//")})`:i}{const i=function GJ(e,t){let i=[];return Object.entries(e.children).forEach(([n,r])=>{n===qn&&(i=i.concat(t(r,n)))}),Object.entries(e.children).forEach(([n,r])=>{n!==qn&&(i=i.concat(t(r,n)))}),i}(e,(n,r)=>r===qn?[_x(e.children[qn],!1)]:[`${r}:${_x(n,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[qn]?`${bE(e)}/${i[0]}`:`${bE(e)}/(${i.join("//")})`}}function WN(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function xE(e){return WN(e).replace(/%3B/gi,";")}function _I(e){return WN(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function wE(e){return decodeURIComponent(e)}function ZN(e){return wE(e.replace(/\+/g,"%20"))}function XN(e){return`${_I(e.path)}${function ZJ(e){return Object.keys(e).map(t=>`;${_I(t)}=${_I(e[t])}`).join("")}(e.parameters)}`}const YJ=/^[^\/()?;#]+/;function yI(e){const t=e.match(YJ);return t?t[0]:""}const KJ=/^[^\/()?;=#]+/,JJ=/^[^=?&#]+/,tee=/^[^&#]+/;class iee{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Ji([],{}):new Ji([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(i).length>0)&&(n[qn]=new Ji(t,i)),n}parseSegment(){const t=yI(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new gt(4009,!1);return this.capture(t),new mx(wE(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const i=function QJ(e){const t=e.match(KJ);return t?t[0]:""}(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){const r=yI(this.remaining);r&&(n=r,this.capture(n))}t[wE(i)]=wE(n)}parseQueryParam(t){const i=function eee(e){const t=e.match(JJ);return t?t[0]:""}(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){const u=function nee(e){const t=e.match(tee);return t?t[0]:""}(this.remaining);u&&(n=u,this.capture(n))}const r=ZN(i),s=ZN(n);if(t.hasOwnProperty(r)){let u=t[r];Array.isArray(u)||(u=[u],t[r]=u),u.push(s)}else t[r]=s}parseParens(t){const i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=yI(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new gt(4010,!1);let s;n.indexOf(":")>-1?(s=n.slice(0,n.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=qn);const u=this.parseChildren();i[s]=1===Object.keys(u).length?u[qn]:new Ji([],u),this.consumeOptional("//")}return i}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new gt(4011,!1)}}function YN(e){return e.segments.length>0?new Ji([],{[qn]:e}):e}function KN(e){const t={};for(const n of Object.keys(e.children)){const s=KN(e.children[n]);if(n===qn&&0===s.segments.length&&s.hasChildren())for(const[u,h]of Object.entries(s.children))t[u]=h;else(s.segments.length>0||s.hasChildren())&&(t[n]=s)}return function ree(e){if(1===e.numberOfChildren&&e.children[qn]){const t=e.children[qn];return new Ji(e.segments.concat(t.segments),t.children)}return e}(new Ji(e.segments,t))}function ag(e){return e instanceof Yy}function QN(e){let t;const r=YN(function i(s){const u={};for(const _ of s.children){const x=i(_);u[_.outlet]=x}const h=new Ji(s.url,u);return s===e&&(t=h),h}(e.root));return t??r}function JN(e,t,i,n){let r=e;for(;r.parent;)r=r.parent;if(0===t.length)return vI(r,r,r,i,n);const s=function see(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new t4(!0,0,e);let t=0,i=!1;const n=e.reduce((r,s,u)=>{if("object"==typeof s&&null!=s){if(s.outlets){const h={};return Object.entries(s.outlets).forEach(([_,x])=>{h[_]="string"==typeof x?x.split("/"):x}),[...r,{outlets:h}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===u?(s.split("/").forEach((h,_)=>{0==_&&"."===h||(0==_&&""===h?i=!0:".."===h?t++:""!=h&&r.push(h))}),r):[...r,s]},[]);return new t4(i,t,n)}(t);if(s.toRoot())return vI(r,r,new Ji([],{}),i,n);const u=function aee(e,t,i){if(e.isAbsolute)return new EE(t,!0,0);if(!i)return new EE(t,!1,NaN);if(null===i.parent)return new EE(i,!0,0);const n=CE(e.commands[0])?0:1;return function lee(e,t,i){let n=e,r=t,s=i;for(;s>r;){if(s-=r,n=n.parent,!n)throw new gt(4005,!1);r=n.segments.length}return new EE(n,!1,r-s)}(i,i.segments.length-1+n,e.numberOfDoubleDots)}(s,r,e),h=u.processChildren?vx(u.segmentGroup,u.index,s.commands):n4(u.segmentGroup,u.index,s.commands);return vI(r,u.segmentGroup,h,i,n)}function CE(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function yx(e){return"object"==typeof e&&null!=e&&e.outlets}function vI(e,t,i,n,r){let u,s={};n&&Object.entries(n).forEach(([_,x])=>{s[_]=Array.isArray(x)?x.map(M=>`${M}`):`${x}`}),u=e===t?i:e4(e,t,i);const h=YN(KN(u));return new Yy(h,s,r)}function e4(e,t,i){const n={};return Object.entries(e.children).forEach(([r,s])=>{n[r]=s===t?i:e4(s,t,i)}),new Ji(e.segments,n)}class t4{constructor(t,i,n){if(this.isAbsolute=t,this.numberOfDoubleDots=i,this.commands=n,t&&n.length>0&&CE(n[0]))throw new gt(4003,!1);const r=n.find(yx);if(r&&r!==UN(n))throw new gt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class EE{constructor(t,i,n){this.segmentGroup=t,this.processChildren=i,this.index=n}}function n4(e,t,i){if(e||(e=new Ji([],{})),0===e.segments.length&&e.hasChildren())return vx(e,t,i);const n=function uee(e,t,i){let n=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<e.segments.length;){if(n>=i.length)return s;const u=e.segments[r],h=i[n];if(yx(h))break;const _=`${h}`,x=n<i.length-1?i[n+1]:null;if(r>0&&void 0===_)break;if(_&&x&&"object"==typeof x&&void 0===x.outlets){if(!r4(_,x,u))return s;n+=2}else{if(!r4(_,{},u))return s;n++}r++}return{match:!0,pathIndex:r,commandIndex:n}}(e,t,i),r=i.slice(n.commandIndex);if(n.match&&n.pathIndex<e.segments.length){const s=new Ji(e.segments.slice(0,n.pathIndex),{});return s.children[qn]=new Ji(e.segments.slice(n.pathIndex),e.children),vx(s,0,r)}return n.match&&0===r.length?new Ji(e.segments,{}):n.match&&!e.hasChildren()?bI(e,t,i):n.match?vx(e,0,r):bI(e,t,i)}function vx(e,t,i){if(0===i.length)return new Ji(e.segments,{});{const n=function cee(e){return yx(e[0])?e[0].outlets:{[qn]:e}}(i),r={};if(!n[qn]&&e.children[qn]&&1===e.numberOfChildren&&0===e.children[qn].segments.length){const s=vx(e.children[qn],t,i);return new Ji(e.segments,s.children)}return Object.entries(n).forEach(([s,u])=>{"string"==typeof u&&(u=[u]),null!==u&&(r[s]=n4(e.children[s],t,u))}),Object.entries(e.children).forEach(([s,u])=>{void 0===n[s]&&(r[s]=u)}),new Ji(e.segments,r)}}function bI(e,t,i){const n=e.segments.slice(0,t);let r=0;for(;r<i.length;){const s=i[r];if(yx(s)){const _=dee(s.outlets);return new Ji(n,_)}if(0===r&&CE(i[0])){n.push(new mx(e.segments[t].path,i4(i[0]))),r++;continue}const u=yx(s)?s.outlets[qn]:`${s}`,h=r<i.length-1?i[r+1]:null;u&&h&&CE(h)?(n.push(new mx(u,i4(h))),r+=2):(n.push(new mx(u,{})),r++)}return new Ji(n,{})}function dee(e){const t={};return Object.entries(e).forEach(([i,n])=>{"string"==typeof n&&(n=[n]),null!==n&&(t[i]=bI(new Ji([],{}),0,n))}),t}function i4(e){const t={};return Object.entries(e).forEach(([i,n])=>t[i]=`${n}`),t}function r4(e,t,i){return e==i.path&&od(t,i.parameters)}const bx="imperative";class sd{constructor(t,i){this.id=t,this.url=i}}class xI extends sd{constructor(t,i,n="imperative",r=null){super(t,i),this.type=0,this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class _p extends sd{constructor(t,i,n){super(t,i),this.urlAfterRedirects=n,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ME extends sd{constructor(t,i,n,r){super(t,i),this.reason=n,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class xx extends sd{constructor(t,i,n,r){super(t,i),this.reason=n,this.code=r,this.type=16}}class wI extends sd{constructor(t,i,n,r){super(t,i),this.error=n,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class hee extends sd{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fee extends sd{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class pee extends sd{constructor(t,i,n,r,s){super(t,i),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class mee extends sd{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gee extends sd{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _ee{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class yee{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class vee{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bee{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xee{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wee{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class o4{constructor(t,i,n){this.routerEvent=t,this.position=i,this.anchor=n,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Cee{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new wx,this.attachRef=null}}let wx=(()=>{var e;class t{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const s=this.getOrCreateContext(n);s.outlet=r,this.contexts.set(n,s)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new Cee,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class s4{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const i=this.pathFromRoot(t);return i.length>1?i[i.length-2]:null}children(t){const i=CI(t,this._root);return i?i.children.map(n=>n.value):[]}firstChild(t){const i=CI(t,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(t){const i=EI(t,this._root);return i.length<2?[]:i[i.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return EI(t,this._root).map(i=>i.value)}}function CI(e,t){if(e===t.value)return t;for(const i of t.children){const n=CI(e,i);if(n)return n}return null}function EI(e,t){if(e===t.value)return[t];for(const i of t.children){const n=EI(e,i);if(n.length)return n.unshift(t),n}return[]}class Th{constructor(t,i){this.value=t,this.children=i}toString(){return`TreeNode(${this.value})`}}function Ky(e){const t={};return e&&e.children.forEach(i=>t[i.value.outlet]=i),t}class a4 extends s4{constructor(t,i){super(t),this.snapshot=i,MI(this,t)}toString(){return this.snapshot.toString()}}function l4(e,t){const i=function Eee(e,t){const u=new DE([],{},{},"",{},qn,t,null,{});return new u4("",new Th(u,[]))}(0,t),n=new Sr([new mx("",{})]),r=new Sr({}),s=new Sr({}),u=new Sr({}),h=new Sr(""),_=new lg(n,r,u,h,s,qn,t,i.root);return _.snapshot=i.root,new a4(new Th(_,[]),i)}class lg{constructor(t,i,n,r,s,u,h,_){this.urlSubject=t,this.paramsSubject=i,this.queryParamsSubject=n,this.fragmentSubject=r,this.dataSubject=s,this.outlet=u,this.component=h,this._futureSnapshot=_,this.title=this.dataSubject?.pipe(Un(x=>x[px]))??Dt(void 0),this.url=t,this.params=i,this.queryParams=n,this.fragment=r,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Un(t=>Xy(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Un(t=>Xy(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function c4(e,t="emptyOnly"){const i=e.pathFromRoot;let n=0;if("always"!==t)for(n=i.length-1;n>=1;){const r=i[n],s=i[n-1];if(r.routeConfig&&""===r.routeConfig.path)n--;else{if(s.component)break;n--}}return function Mee(e){return e.reduce((t,i)=>({params:{...t.params,...i.params},data:{...t.data,...i.data},resolve:{...i.data,...t.resolve,...i.routeConfig?.data,...i._resolvedData}}),{params:{},data:{},resolve:{}})}(i.slice(n))}class DE{get title(){return this.data?.[px]}constructor(t,i,n,r,s,u,h,_,x){this.url=t,this.params=i,this.queryParams=n,this.fragment=r,this.data=s,this.outlet=u,this.component=h,this.routeConfig=_,this._resolve=x}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Xy(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Xy(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class u4 extends s4{constructor(t,i){super(i),this.url=t,MI(this,i)}toString(){return d4(this._root)}}function MI(e,t){t.value._routerState=e,t.children.forEach(i=>MI(e,i))}function d4(e){const t=e.children.length>0?` { ${e.children.map(d4).join(", ")} } `:"";return`${e.value}${t}`}function DI(e){if(e.snapshot){const t=e.snapshot,i=e._futureSnapshot;e.snapshot=i,od(t.queryParams,i.queryParams)||e.queryParamsSubject.next(i.queryParams),t.fragment!==i.fragment&&e.fragmentSubject.next(i.fragment),od(t.params,i.params)||e.paramsSubject.next(i.params),function VJ(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!od(e[i],t[i]))return!1;return!0}(t.url,i.url)||e.urlSubject.next(i.url),od(t.data,i.data)||e.dataSubject.next(i.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function TI(e,t){const i=od(e.params,t.params)&&function HJ(e,t){return sg(e,t)&&e.every((i,n)=>od(i.parameters,t[n].parameters))}(e.url,t.url);return i&&!(!e.parent!=!t.parent)&&(!e.parent||TI(e.parent,t.parent))}let SI=(()=>{var e;class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=qn,this.activateEvents=new rr,this.deactivateEvents=new rr,this.attachEvents=new rr,this.detachEvents=new rr,this.parentContexts=Vt(wx),this.location=Vt(zl),this.changeDetector=Vt(rd),this.environmentInjector=Vt(Xs),this.inputBinder=Vt(TE,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:r,previousValue:s}=n.name;if(r)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new gt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new gt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new gt(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new gt(4013,!1);this._activatedRoute=n;const s=this.location,h=n.snapshot.component,_=this.parentContexts.getOrCreateContext(this.name).children,x=new Dee(n,_,s.injector);this.activated=s.createComponent(h,{index:s.length,injector:x,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275dir=Pt({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Te]}),t})();class Dee{constructor(t,i,n){this.route=t,this.childContexts=i,this.parent=n}get(t,i){return t===lg?this.route:t===wx?this.childContexts:this.parent.get(t,i)}}const TE=new kt("");let h4=(()=>{var e;class t{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:r}=n,s=KC([r.queryParams,r.params,r.data]).pipe(Ar(([u,h,_],x)=>(_={...u,...h,..._},0===x?Dt(_):Promise.resolve(_)))).subscribe(u=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(n);const h=function zW(e){const t=Qn(e);if(!t)return null;const i=new Ib(t);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}(r.component);if(h)for(const{templateName:_}of h.inputs)n.activatedComponentRef.setInput(_,u[_]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,s)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();function Cx(e,t,i){if(i&&e.shouldReuseRoute(t.value,i.value.snapshot)){const n=i.value;n._futureSnapshot=t.value;const r=function See(e,t,i){return t.children.map(n=>{for(const r of i.children)if(e.shouldReuseRoute(n.value,r.value.snapshot))return Cx(e,n,r);return Cx(e,n)})}(e,t,i);return new Th(n,r)}{if(e.shouldAttach(t.value)){const s=e.retrieve(t.value);if(null!==s){const u=s.route;return u.value._futureSnapshot=t.value,u.children=t.children.map(h=>Cx(e,h)),u}}const n=function Iee(e){return new lg(new Sr(e.url),new Sr(e.params),new Sr(e.queryParams),new Sr(e.fragment),new Sr(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(s=>Cx(e,s));return new Th(n,r)}}const II="ngNavigationCancelingError";function f4(e,t){const{redirectTo:i,navigationBehaviorOptions:n}=ag(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=p4(!1,0,t);return r.url=i,r.navigationBehaviorOptions=n,r}function p4(e,t,i){const n=new Error("NavigationCancelingError: "+(e||""));return n[II]=!0,n.cancellationCode=t,i&&(n.url=i),n}function m4(e){return g4(e)&&ag(e.url)}function g4(e){return e&&e[II]}let _4=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["ng-component"]],standalone:!0,features:[hL],decls:1,vars:0,template:function(n,r){1&n&&zn(0,"router-outlet")},dependencies:[SI],encapsulation:2}),t})();function AI(e){const t=e.children&&e.children.map(AI),i=t?{...e,children:t}:{...e};return!i.component&&!i.loadComponent&&(t||i.loadChildren)&&i.outlet&&i.outlet!==qn&&(i.component=_4),i}function Gc(e){return e.outlet||qn}function Ex(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const i=t.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}class Fee{constructor(t,i,n,r,s){this.routeReuseStrategy=t,this.futureState=i,this.currState=n,this.forwardEvent=r,this.inputBindingEnabled=s}activate(t){const i=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,n,t),DI(this.futureState.root),this.activateChildRoutes(i,n,t)}deactivateChildRoutes(t,i,n){const r=Ky(i);t.children.forEach(s=>{const u=s.value.outlet;this.deactivateRoutes(s,r[u],n),delete r[u]}),Object.values(r).forEach(s=>{this.deactivateRouteAndItsChildren(s,n)})}deactivateRoutes(t,i,n){const r=t.value,s=i?i.value:null;if(r===s)if(r.component){const u=n.getContext(r.outlet);u&&this.deactivateChildRoutes(t,i,u.children)}else this.deactivateChildRoutes(t,i,n);else s&&this.deactivateRouteAndItsChildren(i,n)}deactivateRouteAndItsChildren(t,i){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,i):this.deactivateRouteAndOutlet(t,i)}detachAndStoreRouteSubtree(t,i){const n=i.getContext(t.value.outlet),r=n&&t.value.component?n.children:i,s=Ky(t);for(const u of Object.keys(s))this.deactivateRouteAndItsChildren(s[u],r);if(n&&n.outlet){const u=n.outlet.detach(),h=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:u,route:t,contexts:h})}}deactivateRouteAndOutlet(t,i){const n=i.getContext(t.value.outlet),r=n&&t.value.component?n.children:i,s=Ky(t);for(const u of Object.keys(s))this.deactivateRouteAndItsChildren(s[u],r);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(t,i,n){const r=Ky(i);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],n),this.forwardEvent(new wee(s.value.snapshot))}),t.children.length&&this.forwardEvent(new bee(t.value.snapshot))}activateRoutes(t,i,n){const r=t.value,s=i?i.value:null;if(DI(r),r===s)if(r.component){const u=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,i,u.children)}else this.activateChildRoutes(t,i,n);else if(r.component){const u=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const h=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),u.children.onOutletReAttached(h.contexts),u.attachRef=h.componentRef,u.route=h.route.value,u.outlet&&u.outlet.attach(h.componentRef,h.route.value),DI(h.route.value),this.activateChildRoutes(t,null,u.children)}else{const h=Ex(r.snapshot);u.attachRef=null,u.route=r,u.injector=h,u.outlet&&u.outlet.activateWith(r,u.injector),this.activateChildRoutes(t,null,u.children)}}else this.activateChildRoutes(t,null,n)}}class y4{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class SE{constructor(t,i){this.component=t,this.route=i}}function Nee(e,t,i){const n=e._root;return Mx(n,t?t._root:null,i,[n.value])}function Qy(e,t){const i=Symbol(),n=t.get(e,i);return n===i?"function"!=typeof e||function rf(e){return null!==ps(e)}(e)?t.get(e):e:n}function Mx(e,t,i,n,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Ky(t);return e.children.forEach(u=>{(function Bee(e,t,i,n,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,u=t?t.value:null,h=i?i.getContext(e.value.outlet):null;if(u&&s.routeConfig===u.routeConfig){const _=function Vee(e,t,i){if("function"==typeof i)return i(e,t);switch(i){case"pathParamsChange":return!sg(e.url,t.url);case"pathParamsOrQueryParamsChange":return!sg(e.url,t.url)||!od(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!TI(e,t)||!od(e.queryParams,t.queryParams);default:return!TI(e,t)}}(u,s,s.routeConfig.runGuardsAndResolvers);_?r.canActivateChecks.push(new y4(n)):(s.data=u.data,s._resolvedData=u._resolvedData),Mx(e,t,s.component?h?h.children:null:i,n,r),_&&h&&h.outlet&&h.outlet.isActivated&&r.canDeactivateChecks.push(new SE(h.outlet.component,u))}else u&&Dx(t,h,r),r.canActivateChecks.push(new y4(n)),Mx(e,null,s.component?h?h.children:null:i,n,r)})(u,s[u.value.outlet],i,n.concat([u.value]),r),delete s[u.value.outlet]}),Object.entries(s).forEach(([u,h])=>Dx(h,i.getContext(u),r)),r}function Dx(e,t,i){const n=Ky(e),r=e.value;Object.entries(n).forEach(([s,u])=>{Dx(u,r.component?t?t.children.getContext(s):null:t,i)}),i.canDeactivateChecks.push(new SE(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function Tx(e){return"function"==typeof e}function v4(e){return e instanceof _E||"EmptyError"===e?.name}const IE=Symbol("INITIAL_VALUE");function Jy(){return Ar(e=>KC(e.map(t=>t.pipe(Hc(1),F5(IE)))).pipe(Un(t=>{for(const i of t)if(!0!==i){if(i===IE)return IE;if(!1===i||i instanceof Yy)return i}return!0}),Aa(t=>t!==IE),Hc(1)))}function b4(e){return function Ln(...e){return nc(e)}(Ss(t=>{if(ag(t))throw f4(0,t)}),Un(t=>!0===t))}class AE{constructor(t){this.segmentGroup=t||null}}class x4{constructor(t){this.urlTree=t}}function e0(e){return hx(new AE(e))}function w4(e){return hx(new x4(e))}class ste{constructor(t,i){this.urlSerializer=t,this.urlTree=i}noMatchError(t){return new gt(4002,!1)}lineralizeSegments(t,i){let n=[],r=i.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Dt(n);if(r.numberOfChildren>1||!r.children[qn])return hx(new gt(4e3,!1));r=r.children[qn]}}applyRedirectCommands(t,i,n){return this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),t,n)}applyRedirectCreateUrlTree(t,i,n,r){const s=this.createSegmentGroup(t,i.root,n,r);return new Yy(s,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(t,i){const n={};return Object.entries(t).forEach(([r,s])=>{if("string"==typeof s&&s.startsWith(":")){const h=s.substring(1);n[r]=i[h]}else n[r]=s}),n}createSegmentGroup(t,i,n,r){const s=this.createSegments(t,i.segments,n,r);let u={};return Object.entries(i.children).forEach(([h,_])=>{u[h]=this.createSegmentGroup(t,_,n,r)}),new Ji(s,u)}createSegments(t,i,n,r){return i.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,n))}findPosParam(t,i,n){const r=n[i.path.substring(1)];if(!r)throw new gt(4001,!1);return r}findOrReturn(t,i){let n=0;for(const r of i){if(r.path===t.path)return i.splice(n),r;n++}return t}}const PI={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ate(e,t,i,n,r){const s=OI(e,t,i);return s.matched?(n=function Aee(e,t){return e.providers&&!e._injector&&(e._injector=C2(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,n),function ite(e,t,i,n){const r=t.canMatch;return r&&0!==r.length?Dt(r.map(u=>{const h=Qy(u,e);return gp(function qee(e){return e&&Tx(e.canMatch)}(h)?h.canMatch(t,i):e.runInContext(()=>h(t,i)))})).pipe(Jy(),b4()):Dt(!0)}(n,t,i).pipe(Un(u=>!0===u?s:{...PI}))):Dt(s)}function OI(e,t,i){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||i.length>0)?{...PI}:{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};const r=(t.matcher||BJ)(i,e,t);if(!r)return{...PI};const s={};Object.entries(r.posParams??{}).forEach(([h,_])=>{s[h]=_.path});const u=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:i.slice(r.consumed.length),parameters:u,positionalParamSegments:r.posParams??{}}}function C4(e,t,i,n){return i.length>0&&function ute(e,t,i){return i.some(n=>PE(e,t,n)&&Gc(n)!==qn)}(e,i,n)?{segmentGroup:new Ji(t,cte(n,new Ji(i,e.children))),slicedSegments:[]}:0===i.length&&function dte(e,t,i){return i.some(n=>PE(e,t,n))}(e,i,n)?{segmentGroup:new Ji(e.segments,lte(e,0,i,n,e.children)),slicedSegments:i}:{segmentGroup:new Ji(e.segments,e.children),slicedSegments:i}}function lte(e,t,i,n,r){const s={};for(const u of n)if(PE(e,i,u)&&!r[Gc(u)]){const h=new Ji([],{});s[Gc(u)]=h}return{...r,...s}}function cte(e,t){const i={};i[qn]=t;for(const n of e)if(""===n.path&&Gc(n)!==qn){const r=new Ji([],{});i[Gc(n)]=r}return i}function PE(e,t,i){return(!(e.hasChildren()||t.length>0)||"full"!==i.pathMatch)&&""===i.path}class mte{constructor(t,i,n,r,s,u,h){this.injector=t,this.configLoader=i,this.rootComponentType=n,this.config=r,this.urlTree=s,this.paramsInheritanceStrategy=u,this.urlSerializer=h,this.allowRedirects=!0,this.applyRedirects=new ste(this.urlSerializer,this.urlTree)}noMatchError(t){return new gt(4002,!1)}recognize(){const t=C4(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,qn).pipe(mp(i=>{if(i instanceof x4)return this.allowRedirects=!1,this.urlTree=i.urlTree,this.match(i.urlTree);throw i instanceof AE?this.noMatchError(i):i}),Un(i=>{const n=new DE([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},qn,this.rootComponentType,null,{}),r=new Th(n,i),s=new u4("",r),u=function oee(e,t,i=null,n=null){return JN(QN(e),t,i,n)}(n,[],this.urlTree.queryParams,this.urlTree.fragment);return u.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(u),this.inheritParamsAndData(s._root),{state:s,tree:u}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t.root,qn).pipe(mp(n=>{throw n instanceof AE?this.noMatchError(n):n}))}inheritParamsAndData(t){const i=t.value,n=c4(i,this.paramsInheritanceStrategy);i.params=Object.freeze(n.params),i.data=Object.freeze(n.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,i,n,r){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,i,n):this.processSegment(t,i,n,n.segments,r,!0)}processChildren(t,i,n){const r=[];for(const s of Object.keys(n.children))"primary"===s?r.unshift(s):r.push(s);return Pi(r).pipe(Zy(s=>{const u=n.children[s],h=function Ree(e,t){const i=e.filter(n=>Gc(n)===t);return i.push(...e.filter(n=>Gc(n)!==t)),i}(i,s);return this.processSegmentGroup(t,h,u,s)}),function FJ(e,t){return Ai(function LJ(e,t,i,n,r){return(s,u)=>{let h=i,_=t,x=0;s.subscribe(Mi(u,M=>{const S=x++;_=h?e(_,M,S):(h=!0,M),n&&u.next(_)},r&&(()=>{h&&u.next(_),u.complete()})))}}(e,t,arguments.length>=2,!0))}((s,u)=>(s.push(...u),s)),yE(null),function NJ(e,t){const i=arguments.length>=2;return n=>n.pipe(e?Aa((r,s)=>e(r,s,n)):Rs,mI(1),i?yE(t):zN(()=>new _E))}(),or(s=>{if(null===s)return e0(n);const u=E4(s);return function gte(e){e.sort((t,i)=>t.value.outlet===qn?-1:i.value.outlet===qn?1:t.value.outlet.localeCompare(i.value.outlet))}(u),Dt(u)}))}processSegment(t,i,n,r,s,u){return Pi(i).pipe(Zy(h=>this.processSegmentAgainstRoute(h._injector??t,i,h,n,r,s,u).pipe(mp(_=>{if(_ instanceof AE)return Dt(null);throw _}))),og(h=>!!h),mp(h=>{if(v4(h))return function fte(e,t,i){return 0===t.length&&!e.children[i]}(n,r,s)?Dt([]):e0(n);throw h}))}processSegmentAgainstRoute(t,i,n,r,s,u,h){return function hte(e,t,i,n){return!!(Gc(e)===n||n!==qn&&PE(t,i,e))&&("**"===e.path||OI(t,e,i).matched)}(n,r,s,u)?void 0===n.redirectTo?this.matchSegmentAgainstRoute(t,r,n,s,u,h):h&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,r,i,n,s,u):e0(r):e0(r)}expandSegmentAgainstRouteUsingRedirect(t,i,n,r,s,u){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,u):this.expandRegularSegmentAgainstRouteUsingRedirect(t,i,n,r,s,u)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,n,r){const s=this.applyRedirects.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?w4(s):this.applyRedirects.lineralizeSegments(n,s).pipe(or(u=>{const h=new Ji(u,{});return this.processSegment(t,i,h,u,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,i,n,r,s,u){const{matched:h,consumedSegments:_,remainingSegments:x,positionalParamSegments:M}=OI(i,r,s);if(!h)return e0(i);const S=this.applyRedirects.applyRedirectCommands(_,r.redirectTo,M);return r.redirectTo.startsWith("/")?w4(S):this.applyRedirects.lineralizeSegments(r,S).pipe(or(P=>this.processSegment(t,n,i,P.concat(x),u,!1)))}matchSegmentAgainstRoute(t,i,n,r,s,u){let h;if("**"===n.path){const _=r.length>0?UN(r).parameters:{};h=Dt({snapshot:new DE(r,_,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,M4(n),Gc(n),n.component??n._loadedComponent??null,n,D4(n)),consumedSegments:[],remainingSegments:[]}),i.children={}}else h=ate(i,n,r,t).pipe(Un(({matched:_,consumedSegments:x,remainingSegments:M,parameters:S})=>_?{snapshot:new DE(x,S,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,M4(n),Gc(n),n.component??n._loadedComponent??null,n,D4(n)),consumedSegments:x,remainingSegments:M}:null));return h.pipe(Ar(_=>null===_?e0(i):this.getChildConfig(t=n._injector??t,n,r).pipe(Ar(({routes:x})=>{const M=n._loadedInjector??t,{snapshot:S,consumedSegments:P,remainingSegments:F}=_,{segmentGroup:$,slicedSegments:W}=C4(i,P,F,x);if(0===W.length&&$.hasChildren())return this.processChildren(M,x,$).pipe(Un(K=>null===K?null:[new Th(S,K)]));if(0===x.length&&0===W.length)return Dt([new Th(S,[])]);const X=Gc(n)===s;return this.processSegment(M,x,$,W,X?qn:s,!0).pipe(Un(K=>[new Th(S,K)]))}))))}getChildConfig(t,i,n){return i.children?Dt({routes:i.children,injector:t}):i.loadChildren?void 0!==i._loadedRoutes?Dt({routes:i._loadedRoutes,injector:i._loadedInjector}):function nte(e,t,i,n){const r=t.canLoad;return void 0===r||0===r.length?Dt(!0):Dt(r.map(u=>{const h=Qy(u,e);return gp(function jee(e){return e&&Tx(e.canLoad)}(h)?h.canLoad(t,i):e.runInContext(()=>h(t,i)))})).pipe(Jy(),b4())}(t,i,n).pipe(or(r=>r?this.configLoader.loadChildren(t,i).pipe(Ss(s=>{i._loadedRoutes=s.routes,i._loadedInjector=s.injector})):function ote(e){return hx(p4(!1,3))}())):Dt({routes:[],injector:t})}}function _te(e){const t=e.value.routeConfig;return t&&""===t.path}function E4(e){const t=[],i=new Set;for(const n of e){if(!_te(n)){t.push(n);continue}const r=t.find(s=>n.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...n.children),i.add(r)):t.push(n)}for(const n of i){const r=E4(n.children);t.push(new Th(n.value,r))}return t.filter(n=>!i.has(n))}function M4(e){return e.data||{}}function D4(e){return e.resolve||{}}function T4(e){return"string"==typeof e.title||null===e.title}function kI(e){return Ar(t=>{const i=e(t);return i?Pi(i).pipe(Un(()=>t)):Dt(t)})}const t0=new kt("ROUTES");let RI=(()=>{var e;class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Vt(tF)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Dt(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=gp(n.loadComponent()).pipe(Un(S4),Ss(u=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=u}),fx(()=>{this.componentLoaders.delete(n)})),s=new NN(r,()=>new hi).pipe(pI());return this.componentLoaders.set(n,s),s}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Dt({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const u=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(Un(_=>{this.onLoadEndListener&&this.onLoadEndListener(r);let x,M;return Array.isArray(_)?M=_:(x=_.create(n).injector,M=x.get(t0,[],Zt.Self|Zt.Optional).flat()),{routes:M.map(AI),injector:x}}),fx(()=>{this.childrenLoaders.delete(r)})),h=new NN(u,()=>new hi).pipe(pI());return this.childrenLoaders.set(r,h),h}loadModuleFactoryOrRoutes(n){return gp(n()).pipe(Un(S4),or(r=>r instanceof uL||Array.isArray(r)?Dt(r):Pi(this.compiler.compileModuleAsync(r))))}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function S4(e){return function Ete(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let OE=(()=>{var e;class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new hi,this.configLoader=Vt(RI),this.environmentInjector=Vt(Xs),this.urlSerializer=Vt(gx),this.rootContexts=Vt(wx),this.inputBindingEnabled=null!==Vt(TE,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Dt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=s=>this.events.next(new yee(s)),this.configLoader.onLoadStartListener=s=>this.events.next(new _ee(s))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:r})}setupNavigations(n){return this.transitions=new Sr({id:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:bx,restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Aa(r=>0!==r.id),Un(r=>({...r,extractedUrl:n.urlHandlingStrategy.extract(r.rawUrl)})),Ar(r=>{let s=!1,u=!1;return Dt(r).pipe(Ss(h=>{this.currentNavigation={id:h.id,initialUrl:h.rawUrl,extractedUrl:h.extractedUrl,trigger:h.source,extras:h.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Ar(h=>{const _=n.browserUrlTree.toString(),x=!n.navigated||h.extractedUrl.toString()!==_||_!==n.currentUrlTree.toString();if(!x&&"reload"!==(h.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const S="";return this.events.next(new xx(h.id,n.serializeUrl(r.rawUrl),S,0)),n.rawUrlTree=h.rawUrl,h.resolve(null),Zo}if(n.urlHandlingStrategy.shouldProcessUrl(h.rawUrl))return I4(h.source)&&(n.browserUrlTree=h.extractedUrl),Dt(h).pipe(Ar(S=>{const P=this.transitions?.getValue();return this.events.next(new xI(S.id,this.urlSerializer.serialize(S.extractedUrl),S.source,S.restoredState)),P!==this.transitions?.getValue()?Zo:Promise.resolve(S)}),function yte(e,t,i,n,r,s){return or(u=>function pte(e,t,i,n,r,s,u="emptyOnly"){return new mte(e,t,i,n,r,u,s).recognize()}(e,t,i,n,u.extractedUrl,r,s).pipe(Un(({state:h,tree:_})=>({...u,targetSnapshot:h,urlAfterRedirects:_}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),Ss(S=>{if(r.targetSnapshot=S.targetSnapshot,r.urlAfterRedirects=S.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:S.urlAfterRedirects},"eager"===n.urlUpdateStrategy){if(!S.extras.skipLocationChange){const F=n.urlHandlingStrategy.merge(S.urlAfterRedirects,S.rawUrl);n.setBrowserUrl(F,S)}n.browserUrlTree=S.urlAfterRedirects}const P=new hee(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(P)}));if(x&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:S,extractedUrl:P,source:F,restoredState:$,extras:W}=h,X=new xI(S,this.urlSerializer.serialize(P),F,$);this.events.next(X);const K=l4(0,this.rootComponentType).snapshot;return Dt(r={...h,targetSnapshot:K,urlAfterRedirects:P,extras:{...W,skipLocationChange:!1,replaceUrl:!1}})}{const S="";return this.events.next(new xx(h.id,n.serializeUrl(r.extractedUrl),S,1)),n.rawUrlTree=h.rawUrl,h.resolve(null),Zo}}),Ss(h=>{const _=new fee(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(_)}),Un(h=>r={...h,guards:Nee(h.targetSnapshot,h.currentSnapshot,this.rootContexts)}),function Zee(e,t){return or(i=>{const{targetSnapshot:n,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:u}}=i;return 0===u.length&&0===s.length?Dt({...i,guardsResult:!0}):function Xee(e,t,i,n){return Pi(e).pipe(or(r=>function tte(e,t,i,n,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?Dt(s.map(h=>{const _=Ex(t)??r,x=Qy(h,_);return gp(function Gee(e){return e&&Tx(e.canDeactivate)}(x)?x.canDeactivate(e,t,i,n):_.runInContext(()=>x(e,t,i,n))).pipe(og())})).pipe(Jy()):Dt(!0)}(r.component,r.route,i,t,n)),og(r=>!0!==r,!0))}(u,n,r,e).pipe(or(h=>h&&function Uee(e){return"boolean"==typeof e}(h)?function Yee(e,t,i,n){return Pi(t).pipe(Zy(r=>ex(function Qee(e,t){return null!==e&&t&&t(new vee(e)),Dt(!0)}(r.route.parent,n),function Kee(e,t){return null!==e&&t&&t(new xee(e)),Dt(!0)}(r.route,n),function ete(e,t,i){const n=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(u=>function zee(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(u)).filter(u=>null!==u).map(u=>FN(()=>Dt(u.guards.map(_=>{const x=Ex(u.node)??i,M=Qy(_,x);return gp(function Hee(e){return e&&Tx(e.canActivateChild)}(M)?M.canActivateChild(n,e):x.runInContext(()=>M(n,e))).pipe(og())})).pipe(Jy())));return Dt(s).pipe(Jy())}(e,r.path,i),function Jee(e,t,i){const n=t.routeConfig?t.routeConfig.canActivate:null;if(!n||0===n.length)return Dt(!0);const r=n.map(s=>FN(()=>{const u=Ex(t)??i,h=Qy(s,u);return gp(function $ee(e){return e&&Tx(e.canActivate)}(h)?h.canActivate(t,e):u.runInContext(()=>h(t,e))).pipe(og())}));return Dt(r).pipe(Jy())}(e,r.route,i))),og(r=>!0!==r,!0))}(n,s,e,t):Dt(h)),Un(h=>({...i,guardsResult:h})))})}(this.environmentInjector,h=>this.events.next(h)),Ss(h=>{if(r.guardsResult=h.guardsResult,ag(h.guardsResult))throw f4(0,h.guardsResult);const _=new pee(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot,!!h.guardsResult);this.events.next(_)}),Aa(h=>!!h.guardsResult||(n.restoreHistory(h),this.cancelNavigationTransition(h,"",3),!1)),kI(h=>{if(h.guards.canActivateChecks.length)return Dt(h).pipe(Ss(_=>{const x=new mee(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(x)}),Ar(_=>{let x=!1;return Dt(_).pipe(function vte(e,t){return or(i=>{const{targetSnapshot:n,guards:{canActivateChecks:r}}=i;if(!r.length)return Dt(i);let s=0;return Pi(r).pipe(Zy(u=>function bte(e,t,i,n){const r=e.routeConfig,s=e._resolve;return void 0!==r?.title&&!T4(r)&&(s[px]=r.title),function xte(e,t,i,n){const r=function wte(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===r.length)return Dt({});const s={};return Pi(r).pipe(or(u=>function Cte(e,t,i,n){const r=Ex(t)??n,s=Qy(e,r);return gp(s.resolve?s.resolve(t,i):r.runInContext(()=>s(t,i)))}(e[u],t,i,n).pipe(og(),Ss(h=>{s[u]=h}))),mI(1),BN(s),mp(u=>v4(u)?Zo:hx(u)))}(s,e,t,n).pipe(Un(u=>(e._resolvedData=u,e.data=c4(e,i).resolve,r&&T4(r)&&(e.data[px]=r.title),null)))}(u.route,n,e,t)),Ss(()=>s++),mI(1),or(u=>s===r.length?Dt(i):Zo))})}(n.paramsInheritanceStrategy,this.environmentInjector),Ss({next:()=>x=!0,complete:()=>{x||(n.restoreHistory(_),this.cancelNavigationTransition(_,"",2))}}))}),Ss(_=>{const x=new gee(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(x)}))}),kI(h=>{const _=x=>{const M=[];x.routeConfig?.loadComponent&&!x.routeConfig._loadedComponent&&M.push(this.configLoader.loadComponent(x.routeConfig).pipe(Ss(S=>{x.component=S}),Un(()=>{})));for(const S of x.children)M.push(..._(S));return M};return KC(_(h.targetSnapshot.root)).pipe(yE(),Hc(1))}),kI(()=>this.afterPreactivation()),Un(h=>{const _=function Tee(e,t,i){const n=Cx(e,t._root,i?i._root:void 0);return new a4(n,t)}(n.routeReuseStrategy,h.targetSnapshot,h.currentRouterState);return r={...h,targetRouterState:_}}),Ss(h=>{n.currentUrlTree=h.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(h.urlAfterRedirects,h.rawUrl),n.routerState=h.targetRouterState,"deferred"===n.urlUpdateStrategy&&(h.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,h),n.browserUrlTree=h.urlAfterRedirects)}),((e,t,i,n)=>Un(r=>(new Fee(t,r.targetRouterState,r.currentRouterState,i,n).activate(e),r)))(this.rootContexts,n.routeReuseStrategy,h=>this.events.next(h),this.inputBindingEnabled),Hc(1),Ss({next:h=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new _p(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(h.targetRouterState.snapshot),h.resolve(!0)},complete:()=>{s=!0}}),fx(()=>{s||u||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),mp(h=>{if(u=!0,g4(h)){m4(h)||(n.navigated=!0,n.restoreHistory(r,!0));const _=new ME(r.id,this.urlSerializer.serialize(r.extractedUrl),h.message,h.cancellationCode);if(this.events.next(_),m4(h)){const x=n.urlHandlingStrategy.merge(h.url,n.rawUrlTree),M={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||I4(r.source)};n.scheduleNavigation(x,bx,null,M,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{n.restoreHistory(r,!0);const _=new wI(r.id,this.urlSerializer.serialize(r.extractedUrl),h,r.targetSnapshot??void 0);this.events.next(_);try{r.resolve(n.errorHandler(h))}catch(x){r.reject(x)}}return Zo}))}))}cancelNavigationTransition(n,r,s){const u=new ME(n.id,this.urlSerializer.serialize(n.extractedUrl),r,s);this.events.next(u),n.resolve(!1)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function I4(e){return e!==bx}let A4=(()=>{var e;class t{buildTitle(n){let r,s=n.root;for(;void 0!==s;)r=this.getResolvedTitleForRoute(s)??r,s=s.children.find(u=>u.outlet===qn);return r}getResolvedTitleForRoute(n){return n.data[px]}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:function(){return Vt(Mte)},providedIn:"root"}),t})(),Mte=(()=>{var e;class t extends A4{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(T5))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),Dte=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:function(){return Vt(Ste)},providedIn:"root"}),t})();class Tte{shouldDetach(t){return!1}store(t,i){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,i){return t.routeConfig===i.routeConfig}}let Ste=(()=>{var e;class t extends Tte{}return(e=t).\u0275fac=function(){let i;return function(r){return(i||(i=function no(e){return Yo(()=>{const t=e.prototype.constructor,i=t[Bs]||va(t),n=Object.prototype;let r=Object.getPrototypeOf(e.prototype).constructor;for(;r&&r!==n;){const s=r[Bs]||va(r);if(s&&s!==i)return s;r=Object.getPrototypeOf(r)}return s=>new s})}(e)))(r||e)}}(),e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const kE=new kt("",{providedIn:"root",factory:()=>({})});let Ite=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:function(){return Vt(Ate)},providedIn:"root"}),t})(),Ate=(()=>{var e;class t{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,r){return n}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();var Sx=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(Sx||{});function P4(e,t){e.events.pipe(Aa(i=>i instanceof _p||i instanceof ME||i instanceof wI||i instanceof xx),Un(i=>i instanceof _p||i instanceof xx?Sx.COMPLETE:i instanceof ME&&(0===i.code||1===i.code)?Sx.REDIRECTING:Sx.FAILED),Aa(i=>i!==Sx.REDIRECTING),Hc(1)).subscribe(()=>{t()})}function Pte(e){throw e}function Ote(e,t,i){return t.parse("/")}const kte={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Rte={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Is=(()=>{var e;class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Vt(eF),this.isNgZoneEnabled=!1,this.options=Vt(kE,{optional:!0})||{},this.pendingTasks=Vt(TC),this.errorHandler=this.options.errorHandler||Pte,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Ote,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Vt(Ite),this.routeReuseStrategy=Vt(Dte),this.titleStrategy=Vt(A4),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Vt(t0,{optional:!0})?.flat()??[],this.navigationTransitions=Vt(OE),this.urlSerializer=Vt(gx),this.location=Vt(LC),this.componentInputBindingEnabled=!!Vt(TE,{optional:!0}),this.isNgZoneEnabled=Vt(oi)instanceof oi&&oi.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Yy,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=l4(0,null),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId??0},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),bx,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,r,n.state)},0)}))}navigateToSyncWithBrowser(n,r,s){const u={replaceUrl:!0},h=s?.navigationId?s:null;if(s){const x={...s};delete x.navigationId,delete x.\u0275routerPageId,0!==Object.keys(x).length&&(u.state=x)}const _=this.parseUrl(n);this.scheduleNavigation(_,r,h,u)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(AI),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:s,queryParams:u,fragment:h,queryParamsHandling:_,preserveFragment:x}=r,M=x?this.currentUrlTree.fragment:h;let P,S=null;switch(_){case"merge":S={...this.currentUrlTree.queryParams,...u};break;case"preserve":S=this.currentUrlTree.queryParams;break;default:S=u||null}null!==S&&(S=this.removeEmptyProps(S));try{P=QN(s?s.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),P=this.currentUrlTree.root}return JN(P,n,S,M??null)}navigateByUrl(n,r={skipLocationChange:!1}){const s=ag(n)?n:this.parseUrl(n),u=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(u,bx,null,r)}navigate(n,r={skipLocationChange:!1}){return function Lte(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new gt(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(s){r=this.malformedUriErrorHandler(s,this.urlSerializer,n)}return r}isActive(n,r){let s;if(s=!0===r?{...kte}:!1===r?{...Rte}:r,ag(n))return $N(this.currentUrlTree,n,s);const u=this.parseUrl(n);return $N(this.currentUrlTree,u,s)}removeEmptyProps(n){return Object.keys(n).reduce((r,s)=>{const u=n[s];return null!=u&&(r[s]=u),r},{})}scheduleNavigation(n,r,s,u,h){if(this.disposed)return Promise.resolve(!1);let _,x,M;h?(_=h.resolve,x=h.reject,M=h.promise):M=new Promise((P,F)=>{_=P,x=F});const S=this.pendingTasks.add();return P4(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(S))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:u,resolve:_,reject:x,promise:M,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),M.catch(P=>Promise.reject(P))}setBrowserUrl(n,r){const s=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(s)||r.extras.replaceUrl){const h={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(s,"",h)}else{const u={...r.extras.state,...this.generateNgRouterState(r.id,(this.browserPageId??0)+1)};this.location.go(s,"",u)}}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-(this.browserPageId??this.currentPageId);0!==u?this.location.historyGo(u):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===u&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),n0=(()=>{var e;class t{constructor(n,r,s,u,h,_){this.router=n,this.route=r,this.tabIndexAttribute=s,this.renderer=u,this.el=h,this.locationStrategy=_,this.href=null,this.commands=null,this.onChanges=new hi,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const x=h.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===x||"area"===x,this.isAnchorElement?this.subscription=n.events.subscribe(M=>{M instanceof _p&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,r,s,u,h){return!!(null===this.urlTree||this.isAnchorElement&&(0!==n||r||s||u||h||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const n=null===this.href?null:function jw(e,t,i){return function FT(e,t){return"src"===t&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===t&&("base"===e||"link"===e)?rb:Pl}(t,i)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",n)}applyAttributeValue(n,r){const s=this.renderer,u=this.el.nativeElement;null!==r?s.setAttribute(u,n,r):s.removeAttribute(u,n)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return(e=t).\u0275fac=function(n){return new(n||e)(q(Is),q(lg),function hm(e){return function xv(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const i=e.attrs;if(i){const n=i.length;let r=0;for(;r<n;){const s=i[r];if(Yg(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<n&&"string"==typeof i[r];)r++;else{if(s===t)return i[r+1];r+=2}}}return null}(Kr(),e)}("tabindex"),q(Ka),q(cr),q(Qm))},e.\u0275dir=Pt({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(n,r){1&n&&Cr("click",function(u){return r.onClick(u.button,u.ctrlKey,u.shiftKey,u.altKey,u.metaKey)}),2&n&&Fl("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",jy],skipLocationChange:["skipLocationChange","skipLocationChange",jy],replaceUrl:["replaceUrl","replaceUrl",jy],routerLink:"routerLink"},standalone:!0,features:[Dk,Te]}),t})();class O4{}let zte=(()=>{var e;class t{constructor(n,r,s,u,h){this.router=n,this.injector=s,this.preloadingStrategy=u,this.loader=h}setUpPreloading(){this.subscription=this.router.events.pipe(Aa(n=>n instanceof _p),Zy(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const s=[];for(const u of r){u.providers&&!u._injector&&(u._injector=C2(u.providers,n,`Route: ${u.path}`));const h=u._injector??n,_=u._loadedInjector??h;(u.loadChildren&&!u._loadedRoutes&&void 0===u.canLoad||u.loadComponent&&!u._loadedComponent)&&s.push(this.preloadConfig(h,u)),(u.children||u._loadedRoutes)&&s.push(this.processRoutes(_,u.children??u._loadedRoutes))}return Pi(s).pipe(ca())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let s;s=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):Dt(null);const u=s.pipe(or(h=>null===h?Dt(void 0):(r._loadedRoutes=h.routes,r._loadedInjector=h.injector,this.processRoutes(h.injector??n,h.routes))));return r.loadComponent&&!r._loadedComponent?Pi([u,this.loader.loadComponent(r)]).pipe(ca()):u})}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Is),st(tF),st(Xs),st(O4),st(RI))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const LI=new kt("");let k4=(()=>{var e;class t{constructor(n,r,s,u,h={}){this.urlSerializer=n,this.transitions=r,this.viewportScroller=s,this.zone=u,this.options=h,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},h.scrollPositionRestoration=h.scrollPositionRestoration||"disabled",h.anchorScrolling=h.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof xI?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof _p?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof xx&&0===n.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof o4&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new o4(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return(e=t).\u0275fac=function(n){pe()},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();function Sh(e,t){return{\u0275kind:e,\u0275providers:t}}function L4(){const e=Vt(Do);return t=>{const i=e.get(Ym);if(t!==i.components[0])return;const n=e.get(Is),r=e.get(F4);1===e.get(FI)&&n.initialNavigation(),e.get(N4,null,Zt.Optional)?.setUpPreloading(),e.get(LI,null,Zt.Optional)?.init(),n.resetRootComponentType(i.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const F4=new kt("",{factory:()=>new hi}),FI=new kt("",{providedIn:"root",factory:()=>1}),N4=new kt("");function jte(e){return Sh(0,[{provide:N4,useExisting:zte},{provide:O4,useExisting:e}])}const z4=new kt("ROUTER_FORROOT_GUARD"),Hte=[LC,{provide:gx,useClass:gI},Is,wx,{provide:lg,useFactory:function R4(e){return e.routerState.root},deps:[Is]},RI,[]];function Gte(){return new fF("Router",Is)}let B4=(()=>{var e;class t{constructor(n){}static forRoot(n,r){return{ngModule:t,providers:[Hte,[],{provide:t0,multi:!0,useValue:n},{provide:z4,useFactory:Xte,deps:[[Is,new E_,new M_]]},{provide:kE,useValue:r||{}},r?.useHash?{provide:Qm,useClass:$W}:{provide:Qm,useClass:jF},{provide:LI,useFactory:()=>{const e=Vt(aX),t=Vt(oi),i=Vt(kE),n=Vt(OE),r=Vt(gx);return i.scrollOffset&&e.setOffset(i.scrollOffset),new k4(r,n,e,t,i)}},r?.preloadingStrategy?jte(r.preloadingStrategy).\u0275providers:[],{provide:fF,multi:!0,useFactory:Gte},r?.initialNavigation?Yte(r):[],r?.bindToComponentInputs?Sh(8,[h4,{provide:TE,useExisting:h4}]).\u0275providers:[],[{provide:V4,useFactory:L4},{provide:Z2,multi:!0,useExisting:V4}]]}}static forChild(n){return{ngModule:t,providers:[{provide:t0,multi:!0,useValue:n}]}}}return(e=t).\u0275fac=function(n){return new(n||e)(st(z4,8))},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({}),t})();function Xte(e){return"guarded"}function Yte(e){return["disabled"===e.initialNavigation?Sh(3,[{provide:z2,multi:!0,useFactory:()=>{const t=Vt(Is);return()=>{t.setUpLocationChangeListener()}}},{provide:FI,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Sh(2,[{provide:FI,useValue:0},{provide:z2,multi:!0,deps:[Do],useFactory:t=>{const i=t.get(UW,Promise.resolve());return()=>i.then(()=>new Promise(n=>{const r=t.get(Is),s=t.get(F4);P4(r,()=>{n(!0)}),t.get(OE).afterPreactivation=()=>(n(!0),s.closed?Dt(void 0):s),r.initialNavigation()}))}}]).\u0275providers:[]]}const V4=new kt("");let Qte=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-about"]],decls:11,vars:0,consts:[[1,"backdrop"],["routerLink","/munis","queryParamsHandling","merge"],[1,"about"],["routerLink","/munis",1,"entry"],[1,"hero"]],template:function(n,r){1&n&&(vt(0,"div",0),zn(1,"a",1),Tt(),vt(2,"div",2)(3,"div")(4,"h1"),sn(5,"\u05e4\u05e8\u05d5\u05d9\u05e7\u05d8 PRCC"),Tt(),vt(6,"h2"),sn(7,"\u05ea\u05db\u05e0\u05d5\u05df \u05d3\u05d9\u05d2\u05d9\u05d8\u05dc\u05d9 \u05dc\u05e7\u05d9\u05d3\u05d5\u05dd \u05d7\u05d5\u05e1\u05df \u05e2\u05d9\u05e8\u05d5\u05e0\u05d9 \u05d5\u05d4\u05e2\u05e8\u05db\u05d5\u05ea \u05dc\u05e9\u05d9\u05e0\u05d5\u05d9\u05d9 \u05d0\u05e7\u05dc\u05d9\u05dd"),Tt(),vt(8,"a",3),sn(9,"\u05db\u05e0\u05d9\u05e1\u05d4\xa0>"),Tt()(),zn(10,"div",4),Tt())},dependencies:[n0],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;position:relative;pointer-events:all!important}[_nghost-%COMP%]   .backdrop[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;background-color:#00000080;z-index:0}[_nghost-%COMP%]   .backdrop[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;width:100%;height:100%}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]{width:75%;height:50%;padding:50px 70px 50px 45px;display:flex;flex-flow:row;align-items:center;border-radius:5px;background:#fff;box-shadow:0 4px 8px #0000004d;position:relative;z-index:1;gap:30px}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:0 0 50%;display:flex;flex-flow:column;align-items:flex-start;justify-content:center;gap:30px}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#204e37;font-family:Secular One,sans-serif;font-style:normal;font-weight:400;line-height:80%;letter-spacing:-.56px;width:100%;margin:0}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#383838;font-size:18px;font-style:Normal;font-weight:400;line-height:24px;width:100%;margin:0}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   .entry[_ngcontent-%COMP%]{background:#64B883;padding:8px 12px 8px 20px;border-radius:5px;color:#fff;font-family:Noto Sans Hebrew;font-size:16px;font-weight:400;line-height:24px;letter-spacing:0em;text-align:right}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   .entry[_ngcontent-%COMP%]:link{text-decoration:none}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   .entry[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]   .about[_ngcontent-%COMP%]   div.hero[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain;background-image:url(prcc-hero.e5377c98b09734e8.svg);width:359px;height:305px}']}),t})();const Jte=yu,tne=Symbol("__destroy"),U4=Symbol("__decoratorApplied");function j4(e){return"string"==typeof e?Symbol(`__destroy__${e}`):tne}function $4(e,t){e[t]||(e[t]=new hi)}function H4(e,t){e[t]&&(e[t].next(),e[t].complete(),e[t]=null)}function G4(e){e instanceof Je&&e.unsubscribe()}function q4(e,t){return function(){if(e&&e.call(this),H4(this,j4()),t.arrayName&&function ine(e){Array.isArray(e)&&e.forEach(G4)}(this[t.arrayName]),t.checkProperties)for(const i in this)t.blackList?.includes(i)||G4(this[i])}}function RE(e={}){return t=>{!function ene(e){return!!e[Jte]}(t)?function rne(e,t){e.prototype.ngOnDestroy=q4(e.prototype.ngOnDestroy,t)}(t,e):function one(e,t){const i=e.\u0275pipe;i.onDestroy=q4(i.onDestroy,t)}(t,e),function nne(e){e.prototype[U4]=!0}(t)}}Symbol("CheckerHasBeenSet");function Ix(e,t){return i=>{const n=j4(t);"string"==typeof t?function cne(e,t,i){const n=e[t];$4(e,i),e[t]=function(){n.apply(this,arguments),H4(this,i),e[t]=n}}(e,t,n):$4(e,n);const r=e[n];return i.pipe($l(r))}}function Y4(e,t){return t?i=>ex(t.pipe(Hc(1),function dne(){return Ai((e,t)=>{e.subscribe(Mi(t,ls))})}()),i.pipe(Y4(e))):or((i,n)=>Xn(e(i,n)).pipe(Hc(1),BN(i)))}class zI extends hi{constructor(t=1/0,i=1/0,n=RS){super(),this._bufferSize=t,this._windowTime=i,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=i===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,i)}next(t){const{isStopped:i,_buffer:n,_infiniteTimeWindow:r,_timestampProvider:s,_windowTime:u}=this;i||(n.push(t),!r&&n.push(s.now()+u)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const i=this._innerSubscribe(t),{_infiniteTimeWindow:n,_buffer:r}=this,s=r.slice();for(let u=0;u<s.length&&!t.closed;u+=n?1:2)t.next(s[u]);return this._checkFinalizedStatuses(t),i}_trimBuffer(){const{_bufferSize:t,_timestampProvider:i,_buffer:n,_infiniteTimeWindow:r}=this,s=(r?1:2)*t;if(t<1/0&&s<n.length&&n.splice(0,n.length-s),!r){const u=i.now();let h=0;for(let _=1;_<n.length&&n[_]<=u;_+=2)h=_;h&&n.splice(0,h+1)}}}class r0{constructor(t,i,n,r){this.kind=t,this.label=i,this.code=n,this.name=r}toQueryParam(){const t=`${this.kind}:${this.code}`;return this.name?`${t}:${this.name}`:t}display(){return`<span class='kind'>${this.label?this.label+":":""}</span>&nbsp;<strong>${this.name||this.code}</strong>`}boundsQuery(){return null}treesQuery(){return null}mapFilters(){return{}}polygonGeometry(){return null}static fromQueryParam(t){const i=t.split(":");if(i.length>=2){if("muni"===i[0])return new fne(i[1],i[2]);if("stat-area"===i[0])return new pne(i[1]);if("parcel"===i[0])return new mne(i[1]);if("road"===i[0])return new gne(i[1]);if("polygon"===i[0])return new _ne(i[1])}return null}}class fne extends r0{constructor(t,i){super("muni","\u05e8\u05e9\u05d5\u05ea \u05de\u05e7\u05d5\u05de\u05d9\u05ea",t,i)}mapFilters(){return{trees:["==",["to-string",["get","muni"]],["literal",this.code]]}}boundsQuery(){return`SELECT bounds FROM munis WHERE muni_code='${this.code}'`}treesQuery(){return`muni_code='${this.code}'`}}class pne extends r0{constructor(t){super("stat-area","\u05d0\u05d6\u05d5\u05e8 \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9",t)}mapFilters(){return{trees:["==",["to-string",["get","stat_area"]],["literal",this.code]]}}boundsQuery(){return`SELECT bounds FROM stat_areas WHERE code='${this.code}'`}treesQuery(){return`stat_area_code='${this.code}'`}}class mne extends r0{constructor(t){super("parcel","\u05d2\u05d5\u05e9/\u05d7\u05dc\u05e7\u05d4",t)}mapFilters(){return{trees:["==",["to-string",["get","cad"]],["literal",this.code]]}}boundsQuery(){return`SELECT bounds FROM parcels WHERE code='${this.code}'`}treesQuery(){return`cad_code='${this.code}'`}}class gne extends r0{constructor(t){super("road","\u05e8\u05d7\u05d5\u05d1",t)}mapFilters(){return{trees:["==",["to-string",["get","road"]],["literal",this.code]],"roads-border":["==",["to-string",["get","road_id"]],["literal",this.code]]}}boundsQuery(){return`SELECT bounds FROM roads WHERE road_id='${this.code}'`}treesQuery(){return`road_id='${this.code}'`}}class _ne extends r0{constructor(t){super("polygon","","\u05d4\u05e4\u05d5\u05dc\u05d9\u05d2\u05d5\u05df \u05d4\u05e0\u05d1\u05d7\u05e8");let i=t.split(";").map(n=>n.split(",").map(r=>parseFloat(r)));this.geometry={type:"Polygon",coordinates:[i]}}mapFilters(){return{trees:["within",this.geometry]}}boundsQuery(){return null}treesQuery(){return`ST_Contains(\n            ST_GeomFromGeoJSON('${JSON.stringify(this.geometry)}'),\n            ST_SetSRID(ST_MakePoint("location-x", "location-y"), 4326)\n        )`}polygonGeometry(){return this.geometry}}class os{constructor(t,i,n){this.filter=t,this.paint=i,this.layout=n}}class Ax{constructor(t,i){this.title=t,this.chart=i}}class Vr{constructor(t,i,n=!1,r=!1,s="row",u=!1){this.color=t,this.label=i,this.separated=n,this.scaled=r,this.direction=s,this.label_on_color=u}}class LE{constructor(t,i,n,r=!1){this.title=t,this.items=i,this.tooltip=n,this.displayTitle=r}}class Hn{constructor(t,i){this.value=t,this.label=i}}class BI{constructor(t,i){this.id=t,this.kind=i,this.placeholder="",this.options=[]}}class yp extends BI{constructor(t,i,n){super(t,"select"),this.label=i,this.options=n}}class VI extends BI{constructor(t,i,n,r){super(t,"multi-select"),this.label=i,this.options=r,this.placeholder=n}}class cg{constructor(t,i,n={}){this.mode=t,this.id=i,this.filters=n,this.sql=[],this.downloadQuery=null,this.geo=null,this.processed=!1,this.layerConfig={},this.charts=[],this.legend=null,this.filterItems=[],this.focus=null,this.clearFilters=!1,this.popupLayers={},this.focus=this.filters.focus&&r0.fromQueryParam(this.filters.focus)||null,this.focusQuery=this.focus?.treesQuery()||"TRUE",this.clearFilters=this.filters&&Object.keys(this.filters).length>0}process(t){return Pi([!0])}isLayerVisible(t){return!!this.layerConfig[t]}getLayerConfig(t){return this.layerConfig[t]}handleData(t){}}const ug="rc",UI="temperature",jI="vegetation",K4="cluster",o0="car",$I="\u05dc\u05e4\u05d9 \u05d8\u05de\u05e4' \u05e4\u05e0\u05d9 \u05d4\u05e9\u05d8\u05d7",HI="\u05dc\u05e4\u05d9 \u05db\u05d9\u05e1\u05d5\u05d9 \u05e6\u05d5\u05de\u05d7",ez="\u05dc\u05e4\u05d9 \u05d0\u05e9\u05db\u05d5\u05dc \u05db\u05dc\u05db\u05dc\u05d9 \u05d7\u05d1\u05e8\u05ea\u05d9",tz="\u05db\u05dc \u05d4\u05de\u05d3\u05d3\u05d9\u05dd \u05d9\u05d7\u05d3\u05d9\u05d5",nz="\u05e9\u05db\u05d1\u05d5\u05ea \u05e8\u05e7\u05e2",iz="\u05d1\u05d7\u05e8 \u05e9\u05db\u05d1\u05d5\u05ea",rz="\u05d2\u05d5\u05e9 \u05d7\u05dc\u05e7\u05d4",oz='\u05e2\u05e6\u05d9 \u05d9\u05e2"\u05d3',sz='\u05d7\u05d5\u05e4\u05d5\u05ea \u05de\u05e4"\u05d9',az=new yp(ug,"\u05ea\u05e6\u05d5\u05d2\u05ea \u05de\u05d3\u05d3\u05d9\u05dd \u05e9\u05d5\u05e0\u05d9\u05dd \u05e9\u05dc \u05d4\u05de\u05e6\u05d1 \u05d4\u05e7\u05d9\u05d9\u05dd",[new Hn(UI,$I),new Hn(jI,HI),new Hn(K4,ez),new Hn("all",tz)]),xne=new yp(ug,"\u05e4\u05d9\u05e8\u05d5\u05d8 \u05de\u05d3\u05d3\u05d9 \u05e6\u05d9\u05d5\u05df \u05d4\u05d4\u05e6\u05dc\u05dc\u05d4:",[new Hn(UI,$I),new Hn(jI,HI),new Hn(K4,ez),new Hn("all",tz)]),wne=new yp(ug,"\u05e1\u05d5\u05d2 \u05dc\u05d5\u05d5\u05d9\u05df:",[new Hn(UI,$I),new Hn(jI,HI),new Hn("satellite","\u05ea\u05e6\u05dc\u05d5\u05dd \u05d0\u05d5\u05d9\u05e8")]),dg={quality:["match",["coalesce",["get","quality_score"],0],0,["to-color","#cccccc"],1,["to-color","#FFC700"],2,["to-color","#FF7F00"],3,["to-color","#00D315"],["to-color","#00D315"]]};dg[o0]=["interpolate",["exponential",.01],["get","canopy_area_ratio"],0,["to-color","#ccc"],.05,["to-color","#acecc2"],.4,["to-color","#155b2e"]],dg.cpc=["interpolate",["exponential",.99],["get","canopy_per_capita"],0,["to-color","#ccc"],10,["to-color","#acecc2"],150,["to-color","#155b2e"]];const vp={};vp.cluster=new LE("\u05d0\u05e9\u05db\u05d5\u05dc \u05db\u05dc\u05db\u05dc\u05d9 \u05d7\u05d1\u05e8\u05ea\u05d9",[new Vr("#1E1E4D","10",!1,!1,"row",!0),new Vr("#272361","9",!1,!1,"row",!0),new Vr("#314177","8",!1,!1,"row",!0),new Vr("#3C5E91","7",!1,!1,"row",!0),new Vr("#497DB0","6",!1,!1,"row",!0),new Vr("#54A4DB","5",!1,!1,"row",!0),new Vr("#66AFE1","4",!1,!1,"row",!0),new Vr("#78BBE7","3",!1,!1,"row",!0),new Vr("#89C8EE","2",!1,!1,"row",!0),new Vr("#9BD7F5","1",!1,!1,"row",!0)],"\u05de\u05e7\u05e8\u05d0: \u05d0\u05e9\u05db\u05d5\u05dc \u05db\u05dc\u05db\u05dc\u05d9 \u05d7\u05d1\u05e8\u05ea\u05d9",!0),vp.vegetation=new LE("\u05de\u05e7\u05e8\u05d0 \u05db\u05d9\u05e1\u05d5\u05d9 \u05e6\u05d5\u05de\u05d7",[new Vr("#2B5B34","\u05db\u05d9\u05e1\u05d5\u05d9 \u05d2\u05d1\u05d5\u05d4",!1,!1,"row-reverse"),new Vr("#4D734E",""),new Vr("#6D8F6E",""),new Vr("#90B192",""),new Vr("#BBDFC3","\u05db\u05d9\u05e1\u05d5\u05d9 \u05e0\u05de\u05d5\u05da"),new Vr("#D9D9D9","\u05d0\u05d9\u05df \u05de\u05d9\u05d3\u05e2",!0)],"\u05de\u05e7\u05e8\u05d0: \u05db\u05d9\u05e1\u05d5\u05d9 \u05e6\u05d5\u05de\u05d7"),vp.temperature=new LE("\u05de\u05e7\u05e8\u05d0 \u05d8\u05de\u05e4\u05e8\u05d8\u05d5\u05e8\u05d4",[new Vr("#EC1E26","\u05d8\u05de\u05e4\u05e8\u05d8\u05d5\u05e8\u05d4 \u05d2\u05d1\u05d5\u05d4\u05d4",!1,!1,"row-reverse"),new Vr("#DE5959",""),new Vr("#E58586",""),new Vr("#EDB1B2",""),new Vr("#F7DEDF","\u05d8\u05de\u05e4\u05e8\u05d8\u05d5\u05e8\u05d4 \u05e0\u05de\u05d5\u05db\u05d4"),new Vr("#D9D9D9","\u05d0\u05d9\u05df \u05de\u05d9\u05d3\u05e2",!0)],"\u05de\u05e7\u05e8\u05d0: \u05d8\u05de\u05e4\u05e8\u05d8\u05d5\u05e8\u05d4");const Ine=new VI("bglayers",nz,iz,[new Hn("gush",rz),new Hn("yaad",oz),new Hn("hupot",sz)]),Ane=new VI("sbglayers",nz,iz,[new Hn("gush",rz),new Hn("yaad",oz),new Hn("hupot",sz)]),Pne=[az,Ine],One=[az],lz=[xne,Ane],kne=[wne];class Rne extends cg{constructor(t,i){let n=-1;i.opacity&&(n=Number(i.opacity),n>0&&n<=1||(n=-1)),super("muni",t,i),console.log("MuniState constructor STARTED"),this.sql=[`SELECT * FROM munis WHERE "muni_code" = '${this.id}'`,`SELECT "meta-source" as name, count(1) as count FROM trees_processed WHERE "muni_code" = '${this.id}' GROUP BY 1 order by 2 desc`,`SELECT count(1) as total_count FROM trees_compact WHERE "muni_code" = '${this.id}'`];for(const h of["munis-label","munis-border","munis-fill"])this.layerConfig[h]=new os(["==",["get","muni_code"],["literal",this.id]],null,null);const r=this.filters[ug]||o0;this.legend=vp[r],this.layerConfig["munis-fill"].paint={"fill-color":dg[r],"fill-opacity":.8},this.layerConfig["munis-border"].paint={"line-color":"#ff871f","line-opacity":.4},this.legend=vp[r],this.filterItems=One;const s=this.calculate_paint_definition(r,n),u=this.calc_filter();this.layerConfig["prcc-settlements-data"]=new os(u,s,null),this.handle_background_layers("bglayers")}handle_background_layers(t){const i=[];if(this.filters[t]=(this.filters[t]||"").split(";").filter(n=>n.length>0),console.log("list of layers in multi select:",this.filters[t]),this.filters[t].length>0){const n=this.filters[t];console.log("selected layers:",n),n.includes("gush")&&(console.log("displaying Gush-Chelka layer"),i.push("parcels"),i.push("parcels-labels")),n.includes("yaad")&&(console.log("displaying Yaad Trees layer"),i.push("trees")),n.includes("hupot")&&(console.log("displaying Yaad Canopies layer"),i.push("canopies"))}console.log("bg layers:",i);for(const n of i)this.layerConfig[n]=new os(null,null,null),"trees"===n&&(this.layerConfig.trees.filter=["==",["get","muni"],["literal",this.id]],this.layerConfig.trees.paint={"circle-color":["case",["get","certainty"],["to-color","#204E37"],["to-color","#64B883"]],"circle-radius":["interpolate",["linear"],["zoom"],10,2,15,3,18,5],"circle-stroke-width":["interpolate",["linear"],["zoom"],15,0,18,3],"circle-stroke-color":"#ffffff"}),("parcels"===n||"parcels-labels"===n||"canopies"===n)&&(this.layerConfig[n].layout={visibility:"visible"})}calc_filter(){return["==",["get","CODE"],Number(this.id)]}calculate_paint_definition(t,i){let u=.6;-1!==i&&(console.log("overriding opacity with",i),u=i),console.log("using opacity ",u);let P=null;"vegetation"===t?P={"fill-color":["interpolate",["exponential",.01],["get","VegFrac"],0,["to-color","#ccc"],.5,["to-color","#acecc2"],.6,["to-color","#155b2e"]],"fill-opacity":.3}:"temperature"===t?P={"fill-color":["interpolate",["exponential",.01],["get","Temperatur"],30,["to-color","#FFFF00"],35,["to-color","#FFA500"],40,["to-color","#FF0000"]],"fill-opacity":.3}:"cluster"===t?P={"fill-color":["match",["coalesce",["get","cluster17"],0],0,["to-color","#9BD7F5"],1,["to-color","#9BD7F5"],2,["to-color","#89C8EE"],3,["to-color","#78BBE7"],4,["to-color","#66AFE1"],5,["to-color","#54A4DB"],6,["to-color","#497DB0"],7,["to-color","#3C5E91"],8,["to-color","#314177"],9,["to-color","#272361"],["to-color","#1E1E4D"]],"fill-opacity":.3}:"all"===t&&(P={"fill-color":["rgb",["-",255,["*",21.25,["-",42,["coalesce",["get","Temperatur"],32]]]],["*",255,["coalesce",["get","VegFrac"],.001]],["*",25,["coalesce",["get","cluster17"],0]]],"fill-opacity":.6})}handleData(t){t[0].length&&t[0][0]&&(this.geo={zoom:13,center:t[0][0].center})}}function Pa(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Px(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Ox(e){let t,i,n;function r(h,_,x=0,M=h.length){if(x<M){if(0!==t(_,_))return M;do{const S=x+M>>>1;i(h[S],_)<0?x=S+1:M=S}while(x<M)}return x}return 2!==e.length?(t=Pa,i=(h,_)=>Pa(e(h),_),n=(h,_)=>e(h)-_):(t=e===Pa||e===Px?e:Lne,i=e,n=e),{left:r,center:function u(h,_,x=0,M=h.length){const S=r(h,_,x,M-1);return S>x&&n(h[S-1],_)>-n(h[S],_)?S-1:S},right:function s(h,_,x=0,M=h.length){if(x<M){if(0!==t(_,_))return M;do{const S=x+M>>>1;i(h[S],_)<=0?x=S+1:M=S}while(x<M)}return x}}}function Lne(){return 0}function cz(e){return null===e?NaN:+e}const Nne=Ox(Pa).right,FE=(Ox(cz),Nne);function zne(e){return 0|e.length}function Bne(e){return!(e>0)}function Vne(e){return"object"!=typeof e||"length"in e?e:Array.from(e)}function $ne(e,t){var i=0,n=0;return Float64Array.from(e,void 0===t?r=>i+=+r||0:r=>i+=+t(r,n++,e)||0)}function dz(e,t){let n,i=0,r=0,s=0;if(void 0===t)for(let u of e)null!=u&&(u=+u)>=u&&(n=u-r,r+=n/++i,s+=n*(u-r));else{let u=-1;for(let h of e)null!=(h=t(h,++u,e))&&(h=+h)>=h&&(n=h-r,r+=n/++i,s+=n*(h-r))}if(i>1)return s/(i-1)}function hz(e,t){const i=dz(e,t);return i&&Math.sqrt(i)}function qc(e,t){let i,n;if(void 0===t)for(const r of e)null!=r&&(void 0===i?r>=r&&(i=n=r):(i>r&&(i=r),n<r&&(n=r)));else{let r=-1;for(let s of e)null!=(s=t(s,++r,e))&&(void 0===i?s>=s&&(i=n=s):(i>s&&(i=s),n<s&&(n=s)))}return[i,n]}class hg extends Map{constructor(t,i=mz){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:i}}),null!=t)for(const[n,r]of t)this.set(n,r)}get(t){return super.get(ZI(this,t))}has(t){return super.has(ZI(this,t))}set(t,i){return super.set(fz(this,t),i)}delete(t){return super.delete(pz(this,t))}}class WI extends Set{constructor(t,i=mz){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:i}}),null!=t)for(const n of t)this.add(n)}has(t){return super.has(ZI(this,t))}add(t){return super.add(fz(this,t))}delete(t){return super.delete(pz(this,t))}}function ZI({_intern:e,_key:t},i){const n=t(i);return e.has(n)?e.get(n):i}function fz({_intern:e,_key:t},i){const n=t(i);return e.has(n)?e.get(n):(e.set(n,i),i)}function pz({_intern:e,_key:t},i){const n=t(i);return e.has(n)&&(i=e.get(n),e.delete(n)),i}function mz(e){return null!==e&&"object"==typeof e?e.valueOf():e}function XI(e){return e}function YI(e,...t){return a0(e,XI,XI,t)}function s0(e,t,...i){return a0(e,XI,t,i)}function _z(e,t,...i){return a0(e,Array.from,t,i)}function a0(e,t,i,n){return function r(s,u){if(u>=n.length)return i(s);const h=new hg,_=n[u++];let x=-1;for(const M of s){const S=_(M,++x,s),P=h.get(S);P?P.push(M):h.set(S,[M])}for(const[M,S]of h)h.set(M,r(S,u));return t(h)}(e,0)}function kx(e,...t){if("function"!=typeof e[Symbol.iterator])throw new TypeError("values is not iterable");e=Array.from(e);let[i]=t;if(i&&2!==i.length||t.length>1){const n=Uint32Array.from(e,(r,s)=>s);return t.length>1?(t=t.map(r=>e.map(r)),n.sort((r,s)=>{for(const u of t){const h=NE(u[r],u[s]);if(h)return h}})):(i=e.map(i),n.sort((r,s)=>NE(i[r],i[s]))),function Gne(e,t){return Array.from(t,i=>e[i])}(e,n)}return e.sort(vz(i))}function vz(e=Pa){if(e===Pa)return NE;if("function"!=typeof e)throw new TypeError("compare is not a function");return(t,i)=>{const n=e(t,i);return n||0===n?n:(0===e(i,i))-(0===e(t,t))}}function NE(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))||(e<t?-1:e>t?1:0)}function KI(e,t,i){return(2!==t.length?kx(s0(e,t,i),([n,r],[s,u])=>Pa(r,u)||Pa(n,s)):kx(YI(e,i),([n,r],[s,u])=>t(r,u)||Pa(n,s))).map(([n])=>n)}function QI(e,t){let i=0;if(void 0===t)for(let n of e)null!=n&&(n=+n)>=n&&++i;else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&++i}return i}function ad(e,t){let i;if(void 0===t)for(const n of e)null!=n&&(i<n||void 0===i&&n>=n)&&(i=n);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(i<r||void 0===i&&r>=r)&&(i=r)}return i}function Ih(e,t){let i;if(void 0===t)for(const n of e)null!=n&&(i>n||void 0===i&&n>=n)&&(i=n);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(i>r||void 0===i&&r>=r)&&(i=r)}return i}function bz(e,t,i=0,n=1/0,r){if(t=Math.floor(t),i=Math.floor(Math.max(0,i)),n=Math.floor(Math.min(e.length-1,n)),!(i<=t&&t<=n))return e;for(r=void 0===r?NE:vz(r);n>i;){if(n-i>600){const _=n-i+1,x=t-i+1,M=Math.log(_),S=.5*Math.exp(2*M/3),P=.5*Math.sqrt(M*S*(_-S)/_)*(x-_/2<0?-1:1);bz(e,t,Math.max(i,Math.floor(t-x*S/_+P)),Math.min(n,Math.floor(t+(_-x)*S/_+P)),r)}const s=e[t];let u=i,h=n;for(Rx(e,i,t),r(e[n],s)>0&&Rx(e,i,n);u<h;){for(Rx(e,u,h),++u,--h;r(e[u],s)<0;)++u;for(;r(e[h],s)>0;)--h}0===r(e[i],s)?Rx(e,i,h):(++h,Rx(e,h,n)),h<=t&&(i=h+1),t<=h&&(n=h-1)}return e}function Rx(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function l0(e,t,i){if(e=Float64Array.from(function*Fne(e,t){if(void 0===t)for(let i of e)null!=i&&(i=+i)>=i&&(yield i);else{let i=-1;for(let n of e)null!=(n=t(n,++i,e))&&(n=+n)>=n&&(yield n)}}(e,i)),(n=e.length)&&!isNaN(t=+t)){if(t<=0||n<2)return Ih(e);if(t>=1)return ad(e);var n,r=(n-1)*t,s=Math.floor(r),u=ad(bz(e,s).subarray(0,s+1));return u+(Ih(e.subarray(s+1))-u)*(r-s)}}function qne(e,t,i=cz){if((n=e.length)&&!isNaN(t=+t)){if(t<=0||n<2)return+i(e[0],0,e);if(t>=1)return+i(e[n-1],n-1,e);var n,r=(n-1)*t,s=Math.floor(r),u=+i(e[s],s,e);return u+(+i(e[s+1],s+1,e)-u)*(r-s)}}function Wne(e,t,i){const n=QI(e),r=l0(e,.75)-l0(e,.25);return n&&r?Math.ceil((i-t)/(2*r*Math.pow(n,-1/3))):1}function xz(e,t,i){const n=QI(e),r=hz(e);return n&&r?Math.ceil((i-t)*Math.cbrt(n)/(3.49*r)):1}function Zne(e){return Math.max(1,Math.ceil(Math.log(QI(e))/Math.LN2)+1)}function Xne(e,t){let i,n=-1,r=-1;if(void 0===t)for(const s of e)++r,null!=s&&(i<s||void 0===i&&s>=s)&&(i=s,n=r);else for(let s of e)null!=(s=t(s,++r,e))&&(i<s||void 0===i&&s>=s)&&(i=s,n=r);return n}function Yne(e,t){let i=0,n=0;if(void 0===t)for(let r of e)null!=r&&(r=+r)>=r&&(++i,n+=r);else{let r=-1;for(let s of e)null!=(s=t(s,++r,e))&&(s=+s)>=s&&(++i,n+=s)}if(i)return n/i}function zE(e,t){return l0(e,.5,t)}function Kne(e,t){let i,n=-1,r=-1;if(void 0===t)for(const s of e)++r,null!=s&&(i>s||void 0===i&&s>=s)&&(i=s,n=r);else for(let s of e)null!=(s=t(s,++r,e))&&(i>s||void 0===i&&s>=s)&&(i=s,n=r);return n}function Qne(e,t){const i=new hg;if(void 0===t)for(let s of e)null!=s&&s>=s&&i.set(s,(i.get(s)||0)+1);else{let s=-1;for(let u of e)null!=(u=t(u,++s,e))&&u>=u&&i.set(u,(i.get(u)||0)+1)}let n,r=0;for(const[s,u]of i)u>r&&(r=u,n=s);return n}function eie(e,t){return[e,t]}function JI(e,t,i){e=+e,t=+t,i=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+i;for(var n=-1,r=0|Math.max(0,Math.ceil((t-e)/i)),s=new Array(r);++n<r;)s[n]=e+n*i;return s}function wz(e,t=Pa){let i,n=!1;if(1===t.length){let r;for(const s of e){const u=t(s);(n?Pa(u,r)>0:0===Pa(u,u))&&(i=s,r=u,n=!0)}}else for(const r of e)(n?t(r,i)>0:0===t(r,r))&&(i=r,n=!0);return i}function bp(e,t){let i=0;if(void 0===t)for(let n of e)(n=+n)&&(i+=n);else{let n=-1;for(let r of e)(r=+t(r,++n,e))&&(i+=r)}return i}const tie=Math.sqrt(50),nie=Math.sqrt(10),iie=Math.sqrt(2);function BE(e,t,i){const n=(t-e)/Math.max(0,i),r=Math.floor(Math.log10(n)),s=n/Math.pow(10,r),u=s>=tie?10:s>=nie?5:s>=iie?2:1;let h,_,x;return r<0?(x=Math.pow(10,-r)/u,h=Math.round(e*x),_=Math.round(t*x),h/x<e&&++h,_/x>t&&--_,x=-x):(x=Math.pow(10,r)*u,h=Math.round(e/x),_=Math.round(t/x),h*x<e&&++h,_*x>t&&--_),_<h&&.5<=i&&i<2?BE(e,t,2*i):[h,_,x]}function Lx(e,t,i){if(!((i=+i)>0))return[];if((e=+e)==(t=+t))return[e];const n=t<e,[r,s,u]=n?BE(t,e,i):BE(e,t,i);if(!(s>=r))return[];const h=s-r+1,_=new Array(h);if(n)if(u<0)for(let x=0;x<h;++x)_[x]=(s-x)/-u;else for(let x=0;x<h;++x)_[x]=(s-x)*u;else if(u<0)for(let x=0;x<h;++x)_[x]=(r+x)/-u;else for(let x=0;x<h;++x)_[x]=(r+x)*u;return _}function VE(e,t,i){return BE(e=+e,t=+t,i=+i)[2]}function eA(e,t,i){i=+i;const n=(t=+t)<(e=+e),r=n?VE(t,e,i):VE(e,t,i);return(n?-1:1)*(r<0?1/-r:r)}function UE(e){if("function"!=typeof e[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(e).reverse()}function rie(e){return e}var jE=1,$E=2,tA=3,Fx=4,Cz=1e-6;function oie(e){return"translate("+e+",0)"}function sie(e){return"translate(0,"+e+")"}function aie(e){return t=>+e(t)}function lie(e,t){return t=Math.max(0,e.bandwidth()-2*t)/2,e.round()&&(t=Math.round(t)),i=>+e(i)+t}function cie(){return!this.__axis}function HE(e,t){var i=[],n=null,r=null,s=6,u=6,h=3,_=typeof window<"u"&&window.devicePixelRatio>1?0:.5,x=e===jE||e===Fx?-1:1,M=e===Fx||e===$E?"x":"y",S=e===jE||e===tA?oie:sie;function P(F){var $=n??(t.ticks?t.ticks.apply(t,i):t.domain()),W=r??(t.tickFormat?t.tickFormat.apply(t,i):rie),X=Math.max(s,0)+h,K=t.range(),Q=+K[0]+_,he=+K[K.length-1]+_,le=(t.bandwidth?lie:aie)(t.copy(),_),ye=F.selection?F.selection():F,Se=ye.selectAll(".domain").data([null]),Ue=ye.selectAll(".tick").data($,t).order(),Xe=Ue.exit(),mt=Ue.enter().append("g").attr("class","tick"),bt=Ue.select("line"),qe=Ue.select("text");Se=Se.merge(Se.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Ue=Ue.merge(mt),bt=bt.merge(mt.append("line").attr("stroke","currentColor").attr(M+"2",x*s)),qe=qe.merge(mt.append("text").attr("fill","currentColor").attr(M,x*X).attr("dy",e===jE?"0em":e===tA?"0.71em":"0.32em")),F!==ye&&(Se=Se.transition(F),Ue=Ue.transition(F),bt=bt.transition(F),qe=qe.transition(F),Xe=Xe.transition(F).attr("opacity",Cz).attr("transform",function(St){return isFinite(St=le(St))?S(St+_):this.getAttribute("transform")}),mt.attr("opacity",Cz).attr("transform",function(St){var Nt=this.parentNode.__axis;return S((Nt&&isFinite(Nt=Nt(St))?Nt:le(St))+_)})),Xe.remove(),Se.attr("d",e===Fx||e===$E?u?"M"+x*u+","+Q+"H"+_+"V"+he+"H"+x*u:"M"+_+","+Q+"V"+he:u?"M"+Q+","+x*u+"V"+_+"H"+he+"V"+x*u:"M"+Q+","+_+"H"+he),Ue.attr("opacity",1).attr("transform",function(St){return S(le(St)+_)}),bt.attr(M+"2",x*s),qe.attr(M,x*X).text(W),ye.filter(cie).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===$E?"start":e===Fx?"end":"middle"),ye.each(function(){this.__axis=le})}return P.scale=function(F){return arguments.length?(t=F,P):t},P.ticks=function(){return i=Array.from(arguments),P},P.tickArguments=function(F){return arguments.length?(i=null==F?[]:Array.from(F),P):i.slice()},P.tickValues=function(F){return arguments.length?(n=null==F?null:Array.from(F),P):n&&n.slice()},P.tickFormat=function(F){return arguments.length?(r=F,P):r},P.tickSize=function(F){return arguments.length?(s=u=+F,P):s},P.tickSizeInner=function(F){return arguments.length?(s=+F,P):s},P.tickSizeOuter=function(F){return arguments.length?(u=+F,P):u},P.tickPadding=function(F){return arguments.length?(h=+F,P):h},P.offset=function(F){return arguments.length?(_=+F,P):_},P}function die(){}function nA(e){return null==e?die:function(){return this.querySelector(e)}}function pie(){return[]}function Ez(e){return null==e?pie:function(){return this.querySelectorAll(e)}}function Mz(e){return function(){return this.matches(e)}}function Dz(e){return function(t){return t.matches(e)}}var _ie=Array.prototype.find;function vie(){return this.firstElementChild}var xie=Array.prototype.filter;function wie(){return Array.from(this.children)}function Tz(e){return new Array(e.length)}function GE(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function Sie(e,t,i,n,r,s){for(var h,u=0,_=t.length,x=s.length;u<x;++u)(h=t[u])?(h.__data__=s[u],n[u]=h):i[u]=new GE(e,s[u]);for(;u<_;++u)(h=t[u])&&(r[u]=h)}function Iie(e,t,i,n,r,s,u){var h,_,F,x=new Map,M=t.length,S=s.length,P=new Array(M);for(h=0;h<M;++h)(_=t[h])&&(P[h]=F=u.call(_,_.__data__,h,t)+"",x.has(F)?r[h]=_:x.set(F,_));for(h=0;h<S;++h)F=u.call(e,s[h],h,s)+"",(_=x.get(F))?(n[h]=_,_.__data__=s[h],x.delete(F)):i[h]=new GE(e,s[h]);for(h=0;h<M;++h)(_=t[h])&&x.get(P[h])===_&&(r[h]=_)}function Aie(e){return e.__data__}function Oie(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function zie(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}GE.prototype={constructor:GE,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var iA="http://www.w3.org/1999/xhtml";const c0={svg:"http://www.w3.org/2000/svg",xhtml:iA,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function qE(e){var t=e+="",i=t.indexOf(":");return i>=0&&"xmlns"!==(t=e.slice(0,i))&&(e=e.slice(i+1)),c0.hasOwnProperty(t)?{space:c0[t],local:e}:e}function Gie(e){return function(){this.removeAttribute(e)}}function qie(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Wie(e,t){return function(){this.setAttribute(e,t)}}function Zie(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Xie(e,t){return function(){var i=t.apply(this,arguments);null==i?this.removeAttribute(e):this.setAttribute(e,i)}}function Yie(e,t){return function(){var i=t.apply(this,arguments);null==i?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,i)}}function Sz(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Qie(e){return function(){this.style.removeProperty(e)}}function Jie(e,t,i){return function(){this.style.setProperty(e,t,i)}}function ere(e,t,i){return function(){var n=t.apply(this,arguments);null==n?this.style.removeProperty(e):this.style.setProperty(e,n,i)}}function u0(e,t){return e.style.getPropertyValue(t)||Sz(e).getComputedStyle(e,null).getPropertyValue(t)}function nre(e){return function(){delete this[e]}}function ire(e,t){return function(){this[e]=t}}function rre(e,t){return function(){var i=t.apply(this,arguments);null==i?delete this[e]:this[e]=i}}function Iz(e){return e.trim().split(/^|\s+/)}function rA(e){return e.classList||new Az(e)}function Az(e){this._node=e,this._names=Iz(e.getAttribute("class")||"")}function Pz(e,t){for(var i=rA(e),n=-1,r=t.length;++n<r;)i.add(t[n])}function Oz(e,t){for(var i=rA(e),n=-1,r=t.length;++n<r;)i.remove(t[n])}function sre(e){return function(){Pz(this,e)}}function are(e){return function(){Oz(this,e)}}function lre(e,t){return function(){(t.apply(this,arguments)?Pz:Oz)(this,e)}}function ure(){this.textContent=""}function dre(e){return function(){this.textContent=e}}function hre(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function pre(){this.innerHTML=""}function mre(e){return function(){this.innerHTML=e}}function gre(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function yre(){this.nextSibling&&this.parentNode.appendChild(this)}function bre(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function wre(e){return function(){var t=this.ownerDocument,i=this.namespaceURI;return i===iA&&t.documentElement.namespaceURI===iA?t.createElement(e):t.createElementNS(i,e)}}function Cre(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function WE(e){var t=qE(e);return(t.local?Cre:wre)(t)}function Mre(){return null}function Tre(){var e=this.parentNode;e&&e.removeChild(this)}function Ire(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Are(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Lre(e){return function(){var t=this.__on;if(t){for(var s,i=0,n=-1,r=t.length;i<r;++i)s=t[i],e.type&&s.type!==e.type||s.name!==e.name?t[++n]=s:this.removeEventListener(s.type,s.listener,s.options);++n?t.length=n:delete this.__on}}}function Fre(e,t,i){return function(){var r,n=this.__on,s=function kre(e){return function(t){e.call(this,t,this.__data__)}}(t);if(n)for(var u=0,h=n.length;u<h;++u)if((r=n[u]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=i),void(r.value=t);this.addEventListener(e.type,s,i),r={type:e.type,name:e.name,value:t,listener:s,options:i},n?n.push(r):this.__on=[r]}}function kz(e,t,i){var n=Sz(e),r=n.CustomEvent;"function"==typeof r?r=new r(t,i):(r=n.document.createEvent("Event"),i?(r.initEvent(t,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function zre(e,t){return function(){return kz(this,e,t)}}function Bre(e,t){return function(){return kz(this,e,t.apply(this,arguments))}}Az.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var Rz=[null];function il(e,t){this._groups=e,this._parents=t}function Lz(){return new il([[document.documentElement]],Rz)}il.prototype=Lz.prototype={constructor:il,select:function hie(e){"function"!=typeof e&&(e=nA(e));for(var t=this._groups,i=t.length,n=new Array(i),r=0;r<i;++r)for(var _,x,s=t[r],u=s.length,h=n[r]=new Array(u),M=0;M<u;++M)(_=s[M])&&(x=e.call(_,_.__data__,M,s))&&("__data__"in _&&(x.__data__=_.__data__),h[M]=x);return new il(n,this._parents)},selectAll:function gie(e){e="function"==typeof e?function mie(e){return function(){return function fie(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}(e):Ez(e);for(var t=this._groups,i=t.length,n=[],r=[],s=0;s<i;++s)for(var _,u=t[s],h=u.length,x=0;x<h;++x)(_=u[x])&&(n.push(e.call(_,_.__data__,x,u)),r.push(_));return new il(n,r)},selectChild:function bie(e){return this.select(null==e?vie:function yie(e){return function(){return _ie.call(this.children,e)}}("function"==typeof e?e:Dz(e)))},selectChildren:function Eie(e){return this.selectAll(null==e?wie:function Cie(e){return function(){return xie.call(this.children,e)}}("function"==typeof e?e:Dz(e)))},filter:function Mie(e){"function"!=typeof e&&(e=Mz(e));for(var t=this._groups,i=t.length,n=new Array(i),r=0;r<i;++r)for(var _,s=t[r],u=s.length,h=n[r]=[],x=0;x<u;++x)(_=s[x])&&e.call(_,_.__data__,x,s)&&h.push(_);return new il(n,this._parents)},data:function Pie(e,t){if(!arguments.length)return Array.from(this,Aie);var i=t?Iie:Sie,n=this._parents,r=this._groups;"function"!=typeof e&&(e=function Tie(e){return function(){return e}}(e));for(var s=r.length,u=new Array(s),h=new Array(s),_=new Array(s),x=0;x<s;++x){var M=n[x],S=r[x],P=S.length,F=Oie(e.call(M,M&&M.__data__,x,n)),$=F.length,W=h[x]=new Array($),X=u[x]=new Array($);i(M,S,W,X,_[x]=new Array(P),F,t);for(var le,ye,Q=0,he=0;Q<$;++Q)if(le=W[Q]){for(Q>=he&&(he=Q+1);!(ye=X[he])&&++he<$;);le._next=ye||null}}return(u=new il(u,n))._enter=h,u._exit=_,u},enter:function Die(){return new il(this._enter||this._groups.map(Tz),this._parents)},exit:function kie(){return new il(this._exit||this._groups.map(Tz),this._parents)},join:function Rie(e,t,i){var n=this.enter(),r=this,s=this.exit();return"function"==typeof e?(n=e(n))&&(n=n.selection()):n=n.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==i?s.remove():i(s),n&&r?n.merge(r).order():r},merge:function Lie(e){for(var t=e.selection?e.selection():e,i=this._groups,n=t._groups,r=i.length,u=Math.min(r,n.length),h=new Array(r),_=0;_<u;++_)for(var F,x=i[_],M=n[_],S=x.length,P=h[_]=new Array(S),$=0;$<S;++$)(F=x[$]||M[$])&&(P[$]=F);for(;_<r;++_)h[_]=i[_];return new il(h,this._parents)},selection:function jre(){return this},order:function Fie(){for(var e=this._groups,t=-1,i=e.length;++t<i;)for(var u,n=e[t],r=n.length-1,s=n[r];--r>=0;)(u=n[r])&&(s&&4^u.compareDocumentPosition(s)&&s.parentNode.insertBefore(u,s),s=u);return this},sort:function Nie(e){function t(S,P){return S&&P?e(S.__data__,P.__data__):!S-!P}e||(e=zie);for(var i=this._groups,n=i.length,r=new Array(n),s=0;s<n;++s){for(var x,u=i[s],h=u.length,_=r[s]=new Array(h),M=0;M<h;++M)(x=u[M])&&(_[M]=x);_.sort(t)}return new il(r,this._parents).order()},call:function Bie(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function Vie(){return Array.from(this)},node:function Uie(){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var n=e[t],r=0,s=n.length;r<s;++r){var u=n[r];if(u)return u}return null},size:function jie(){let e=0;for(const t of this)++e;return e},empty:function $ie(){return!this.node()},each:function Hie(e){for(var t=this._groups,i=0,n=t.length;i<n;++i)for(var h,r=t[i],s=0,u=r.length;s<u;++s)(h=r[s])&&e.call(h,h.__data__,s,r);return this},attr:function Kie(e,t){var i=qE(e);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((null==t?i.local?qie:Gie:"function"==typeof t?i.local?Yie:Xie:i.local?Zie:Wie)(i,t))},style:function tre(e,t,i){return arguments.length>1?this.each((null==t?Qie:"function"==typeof t?ere:Jie)(e,t,i??"")):u0(this.node(),e)},property:function ore(e,t){return arguments.length>1?this.each((null==t?nre:"function"==typeof t?rre:ire)(e,t)):this.node()[e]},classed:function cre(e,t){var i=Iz(e+"");if(arguments.length<2){for(var n=rA(this.node()),r=-1,s=i.length;++r<s;)if(!n.contains(i[r]))return!1;return!0}return this.each(("function"==typeof t?lre:t?sre:are)(i,t))},text:function fre(e){return arguments.length?this.each(null==e?ure:("function"==typeof e?hre:dre)(e)):this.node().textContent},html:function _re(e){return arguments.length?this.each(null==e?pre:("function"==typeof e?gre:mre)(e)):this.node().innerHTML},raise:function vre(){return this.each(yre)},lower:function xre(){return this.each(bre)},append:function Ere(e){var t="function"==typeof e?e:WE(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function Dre(e,t){var i="function"==typeof e?e:WE(e),n=null==t?Mre:"function"==typeof t?t:nA(t);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})},remove:function Sre(){return this.each(Tre)},clone:function Pre(e){return this.select(e?Are:Ire)},datum:function Ore(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function Nre(e,t,i){var r,u,n=function Rre(e){return e.trim().split(/^|\s+/).map(function(t){var i="",n=t.indexOf(".");return n>=0&&(i=t.slice(n+1),t=t.slice(0,n)),{type:t,name:i}})}(e+""),s=n.length;if(!(arguments.length<2)){for(h=t?Fre:Lre,r=0;r<s;++r)this.each(h(n[r],t,i));return this}var h=this.node().__on;if(h)for(var M,_=0,x=h.length;_<x;++_)for(r=0,M=h[_];r<s;++r)if((u=n[r]).type===M.type&&u.name===M.name)return M.value},dispatch:function Vre(e,t){return this.each(("function"==typeof t?Bre:zre)(e,t))},[Symbol.iterator]:function*Ure(){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var u,n=e[t],r=0,s=n.length;r<s;++r)(u=n[r])&&(yield u)}};const Nx=Lz;var $re={value:()=>{}};function Fz(){for(var n,e=0,t=arguments.length,i={};e<t;++e){if(!(n=arguments[e]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new ZE(i)}function ZE(e){this._=e}function Gre(e,t){for(var r,i=0,n=e.length;i<n;++i)if((r=e[i]).name===t)return r.value}function Nz(e,t,i){for(var n=0,r=e.length;n<r;++n)if(e[n].name===t){e[n]=$re,e=e.slice(0,n).concat(e.slice(n+1));break}return null!=i&&e.push({name:t,value:i}),e}ZE.prototype=Fz.prototype={constructor:ZE,on:function(e,t){var r,i=this._,n=function Hre(e,t){return e.trim().split(/^|\s+/).map(function(i){var n="",r=i.indexOf(".");if(r>=0&&(n=i.slice(r+1),i=i.slice(0,r)),i&&!t.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}(e+"",i),s=-1,u=n.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++s<u;)if(r=(e=n[s]).type)i[r]=Nz(i[r],e.name,t);else if(null==t)for(r in i)i[r]=Nz(i[r],e.name,null);return this}for(;++s<u;)if((r=(e=n[s]).type)&&(r=Gre(i[r],e.name)))return r},copy:function(){var e={},t=this._;for(var i in t)e[i]=t[i].slice();return new ZE(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var r,s,i=new Array(r),n=0;n<r;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(n=0,r=(s=this._[e]).length;n<r;++n)s[n].value.apply(t,i)},apply:function(e,t,i){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],r=0,s=n.length;r<s;++r)n[r].value.apply(t,i)}};const qre=Fz;var XE,Vx,d0=0,zx=0,Bx=0,zz=1e3,YE=0,fg=0,KE=0,Ux="object"==typeof performance&&performance.now?performance:Date,Bz="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function oA(){return fg||(Bz(Wre),fg=Ux.now()+KE)}function Wre(){fg=0}function QE(){this._call=this._time=this._next=null}function Vz(e,t,i){var n=new QE;return n.restart(e,t,i),n}function Uz(){fg=(YE=Ux.now())+KE,d0=zx=0;try{!function Zre(){oA(),++d0;for(var t,e=XE;e;)(t=fg-e._time)>=0&&e._call.call(void 0,t),e=e._next;--d0}()}finally{d0=0,function Yre(){for(var e,i,t=XE,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(i=t._next,t._next=null,t=e?e._next=i:XE=i);Vx=e,sA(n)}(),fg=0}}function Xre(){var e=Ux.now(),t=e-YE;t>zz&&(KE-=t,YE=e)}function sA(e){d0||(zx&&(zx=clearTimeout(zx)),e-fg>24?(e<1/0&&(zx=setTimeout(Uz,e-Ux.now()-KE)),Bx&&(Bx=clearInterval(Bx))):(Bx||(YE=Ux.now(),Bx=setInterval(Xre,zz)),d0=1,Bz(Uz)))}function jz(e,t,i){var n=new QE;return n.restart(r=>{n.stop(),e(r+t)},t=null==t?0:+t,i),n}QE.prototype=Vz.prototype={constructor:QE,restart:function(e,t,i){if("function"!=typeof e)throw new TypeError("callback is not a function");i=(null==i?oA():+i)+(null==t?0:+t),!this._next&&Vx!==this&&(Vx?Vx._next=this:XE=this,Vx=this),this._call=e,this._time=i,sA()},stop:function(){this._call&&(this._call=null,this._time=1/0,sA())}};var Kre=qre("start","end","cancel","interrupt"),Qre=[],$z=0,JE=3;function tM(e,t,i,n,r,s){var u=e.__transition;if(u){if(i in u)return}else e.__transition={};!function Jre(e,t,i){var r,n=e.__transition;function u(x){var M,S,P,F;if(1!==i.state)return _();for(M in n)if((F=n[M]).name===i.name){if(F.state===JE)return jz(u);4===F.state?(F.state=6,F.timer.stop(),F.on.call("interrupt",e,e.__data__,F.index,F.group),delete n[M]):+M<t&&(F.state=6,F.timer.stop(),F.on.call("cancel",e,e.__data__,F.index,F.group),delete n[M])}if(jz(function(){i.state===JE&&(i.state=4,i.timer.restart(h,i.delay,i.time),h(x))}),i.state=2,i.on.call("start",e,e.__data__,i.index,i.group),2===i.state){for(i.state=JE,r=new Array(P=i.tween.length),M=0,S=-1;M<P;++M)(F=i.tween[M].value.call(e,e.__data__,i.index,i.group))&&(r[++S]=F);r.length=S+1}}function h(x){for(var M=x<i.duration?i.ease.call(null,x/i.duration):(i.timer.restart(_),i.state=5,1),S=-1,P=r.length;++S<P;)r[S].call(e,M);5===i.state&&(i.on.call("end",e,e.__data__,i.index,i.group),_())}function _(){for(var x in i.state=6,i.timer.stop(),delete n[t],n)return;delete e.__transition}n[t]=i,i.timer=Vz(function s(x){i.state=1,i.timer.restart(u,i.delay,i.time),i.delay<=x&&u(x-i.delay)},0,i.time)}(e,i,{name:t,index:n,group:r,on:Kre,tween:Qre,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:$z})}function cA(e,t){var i=Wc(e,t);if(i.state>$z)throw new Error("too late; already scheduled");return i}function ld(e,t){var i=Wc(e,t);if(i.state>JE)throw new Error("too late; already running");return i}function Wc(e,t){var i=e.__transition;if(!i||!(i=i[t]))throw new Error("transition not found");return i}function As(e,t){return e=+e,t=+t,function(i){return e*(1-i)+t*i}}var nM,qz=180/Math.PI,uA={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Wz(e,t,i,n,r,s){var u,h,_;return(u=Math.sqrt(e*e+t*t))&&(e/=u,t/=u),(_=e*i+t*n)&&(i-=e*_,n-=t*_),(h=Math.sqrt(i*i+n*n))&&(i/=h,n/=h,_/=h),e*n<t*i&&(e=-e,t=-t,_=-_,u=-u),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*qz,skewX:Math.atan(_)*qz,scaleX:u,scaleY:h}}function Zz(e,t,i,n){function r(x){return x.length?x.pop()+" ":""}return function(x,M){var S=[],P=[];return x=e(x),M=e(M),function s(x,M,S,P,F,$){if(x!==S||M!==P){var W=F.push("translate(",null,t,null,i);$.push({i:W-4,x:As(x,S)},{i:W-2,x:As(M,P)})}else(S||P)&&F.push("translate("+S+t+P+i)}(x.translateX,x.translateY,M.translateX,M.translateY,S,P),function u(x,M,S,P){x!==M?(x-M>180?M+=360:M-x>180&&(x+=360),P.push({i:S.push(r(S)+"rotate(",null,n)-2,x:As(x,M)})):M&&S.push(r(S)+"rotate("+M+n)}(x.rotate,M.rotate,S,P),function h(x,M,S,P){x!==M?P.push({i:S.push(r(S)+"skewX(",null,n)-2,x:As(x,M)}):M&&S.push(r(S)+"skewX("+M+n)}(x.skewX,M.skewX,S,P),function _(x,M,S,P,F,$){if(x!==S||M!==P){var W=F.push(r(F)+"scale(",null,",",null,")");$.push({i:W-4,x:As(x,S)},{i:W-2,x:As(M,P)})}else(1!==S||1!==P)&&F.push(r(F)+"scale("+S+","+P+")")}(x.scaleX,x.scaleY,M.scaleX,M.scaleY,S,P),x=M=null,function(F){for(var X,$=-1,W=P.length;++$<W;)S[(X=P[$]).i]=X.x(F);return S.join("")}}}var roe=Zz(function noe(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?uA:Wz(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),ooe=Zz(function ioe(e){return null!=e&&(nM||(nM=document.createElementNS("http://www.w3.org/2000/svg","g")),nM.setAttribute("transform",e),e=nM.transform.baseVal.consolidate())?Wz((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):uA},", ",")",")");function soe(e,t){var i,n;return function(){var r=ld(this,e),s=r.tween;if(s!==i)for(var u=0,h=(n=i=s).length;u<h;++u)if(n[u].name===t){(n=n.slice()).splice(u,1);break}r.tween=n}}function aoe(e,t,i){var n,r;if("function"!=typeof i)throw new Error;return function(){var s=ld(this,e),u=s.tween;if(u!==n){r=(n=u).slice();for(var h={name:t,value:i},_=0,x=r.length;_<x;++_)if(r[_].name===t){r[_]=h;break}_===x&&r.push(h)}s.tween=r}}function dA(e,t,i){var n=e._id;return e.each(function(){var r=ld(this,n);(r.value||(r.value={}))[t]=i.apply(this,arguments)}),function(r){return Wc(r,n).value[t]}}function h0(e,t,i){e.prototype=t.prototype=i,i.constructor=e}function jx(e,t){var i=Object.create(e.prototype);for(var n in t)i[n]=t[n];return i}function xp(){}var f0=1/.7,p0="\\s*([+-]?\\d+)\\s*",$x="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",cd="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",coe=/^#([0-9a-f]{3,8})$/,uoe=new RegExp(`^rgb\\(${p0},${p0},${p0}\\)$`),doe=new RegExp(`^rgb\\(${cd},${cd},${cd}\\)$`),hoe=new RegExp(`^rgba\\(${p0},${p0},${p0},${$x}\\)$`),foe=new RegExp(`^rgba\\(${cd},${cd},${cd},${$x}\\)$`),poe=new RegExp(`^hsl\\(${$x},${cd},${cd}\\)$`),moe=new RegExp(`^hsla\\(${$x},${cd},${cd},${$x}\\)$`),Xz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Yz(){return this.rgb().formatHex()}function Kz(){return this.rgb().formatRgb()}function wp(e){var t,i;return e=(e+"").trim().toLowerCase(),(t=coe.exec(e))?(i=t[1].length,t=parseInt(t[1],16),6===i?Qz(t):3===i?new jo(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===i?iM(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===i?iM(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=uoe.exec(e))?new jo(t[1],t[2],t[3],1):(t=doe.exec(e))?new jo(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=hoe.exec(e))?iM(t[1],t[2],t[3],t[4]):(t=foe.exec(e))?iM(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=poe.exec(e))?tB(t[1],t[2]/100,t[3]/100,1):(t=moe.exec(e))?tB(t[1],t[2]/100,t[3]/100,t[4]):Xz.hasOwnProperty(e)?Qz(Xz[e]):"transparent"===e?new jo(NaN,NaN,NaN,0):null}function Qz(e){return new jo(e>>16&255,e>>8&255,255&e,1)}function iM(e,t,i,n){return n<=0&&(e=t=i=NaN),new jo(e,t,i,n)}function hA(e){return e instanceof xp||(e=wp(e)),e?new jo((e=e.rgb()).r,e.g,e.b,e.opacity):new jo}function Cp(e,t,i,n){return 1===arguments.length?hA(e):new jo(e,t,i,n??1)}function jo(e,t,i,n){this.r=+e,this.g=+t,this.b=+i,this.opacity=+n}function Jz(){return`#${gg(this.r)}${gg(this.g)}${gg(this.b)}`}function eB(){const e=rM(this.opacity);return`${1===e?"rgb(":"rgba("}${mg(this.r)}, ${mg(this.g)}, ${mg(this.b)}${1===e?")":`, ${e})`}`}function rM(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function mg(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function gg(e){return((e=mg(e))<16?"0":"")+e.toString(16)}function tB(e,t,i,n){return n<=0?e=t=i=NaN:i<=0||i>=1?e=t=NaN:t<=0&&(e=NaN),new Zc(e,t,i,n)}function nB(e){if(e instanceof Zc)return new Zc(e.h,e.s,e.l,e.opacity);if(e instanceof xp||(e=wp(e)),!e)return new Zc;if(e instanceof Zc)return e;var t=(e=e.rgb()).r/255,i=e.g/255,n=e.b/255,r=Math.min(t,i,n),s=Math.max(t,i,n),u=NaN,h=s-r,_=(s+r)/2;return h?(u=t===s?(i-n)/h+6*(i<n):i===s?(n-t)/h+2:(t-i)/h+4,h/=_<.5?s+r:2-s-r,u*=60):h=_>0&&_<1?0:u,new Zc(u,h,_,e.opacity)}function fA(e,t,i,n){return 1===arguments.length?nB(e):new Zc(e,t,i,n??1)}function Zc(e,t,i,n){this.h=+e,this.s=+t,this.l=+i,this.opacity=+n}function iB(e){return(e=(e||0)%360)<0?e+360:e}function oM(e){return Math.max(0,Math.min(1,e||0))}function pA(e,t,i){return 255*(e<60?t+(i-t)*e/60:e<180?i:e<240?t+(i-t)*(240-e)/60:t)}function rB(e,t,i,n,r){var s=e*e,u=s*e;return((1-3*e+3*s-u)*t+(4-6*s+3*u)*i+(1+3*e+3*s-3*u)*n+u*r)/6}h0(xp,wp,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Yz,formatHex:Yz,formatHex8:function goe(){return this.rgb().formatHex8()},formatHsl:function _oe(){return nB(this).formatHsl()},formatRgb:Kz,toString:Kz}),h0(jo,Cp,jx(xp,{brighter(e){return e=null==e?f0:Math.pow(f0,e),new jo(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new jo(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new jo(mg(this.r),mg(this.g),mg(this.b),rM(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Jz,formatHex:Jz,formatHex8:function yoe(){return`#${gg(this.r)}${gg(this.g)}${gg(this.b)}${gg(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:eB,toString:eB})),h0(Zc,fA,jx(xp,{brighter(e){return e=null==e?f0:Math.pow(f0,e),new Zc(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new Zc(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*t,r=2*i-n;return new jo(pA(e>=240?e-240:e+120,r,n),pA(e,r,n),pA(e<120?e+240:e-120,r,n),this.opacity)},clamp(){return new Zc(iB(this.h),oM(this.s),oM(this.l),rM(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=rM(this.opacity);return`${1===e?"hsl(":"hsla("}${iB(this.h)}, ${100*oM(this.s)}%, ${100*oM(this.l)}%${1===e?")":`, ${e})`}`}}));const sM=e=>()=>e;function oB(e,t){return function(i){return e+i*t}}function mA(e,t){var i=t-e;return i?oB(e,i>180||i<-180?i-360*Math.round(i/360):i):sM(isNaN(e)?t:e)}function $o(e,t){var i=t-e;return i?oB(e,i):sM(isNaN(e)?t:e)}const _g=function e(t){var i=function woe(e){return 1==(e=+e)?$o:function(t,i){return i-t?function xoe(e,t,i){return e=Math.pow(e,i),t=Math.pow(t,i)-e,i=1/i,function(n){return Math.pow(e+n*t,i)}}(t,i,e):sM(isNaN(t)?i:t)}}(t);function n(r,s){var u=i((r=Cp(r)).r,(s=Cp(s)).r),h=i(r.g,s.g),_=i(r.b,s.b),x=$o(r.opacity,s.opacity);return function(M){return r.r=u(M),r.g=h(M),r.b=_(M),r.opacity=x(M),r+""}}return n.gamma=e,n}(1);function sB(e){return function(t){var u,h,i=t.length,n=new Array(i),r=new Array(i),s=new Array(i);for(u=0;u<i;++u)h=Cp(t[u]),n[u]=h.r||0,r[u]=h.g||0,s[u]=h.b||0;return n=e(n),r=e(r),s=e(s),h.opacity=1,function(_){return h.r=n(_),h.g=r(_),h.b=s(_),h+""}}}var Coe=sB(function voe(e){var t=e.length-1;return function(i){var n=i<=0?i=0:i>=1?(i=1,t-1):Math.floor(i*t),r=e[n],s=e[n+1];return rB((i-n/t)*t,n>0?e[n-1]:2*r-s,r,s,n<t-1?e[n+2]:2*s-r)}}),gA=(sB(function boe(e){var t=e.length;return function(i){var n=Math.floor(((i%=1)<0?++i:i)*t);return rB((i-n/t)*t,e[(n+t-1)%t],e[n%t],e[(n+1)%t],e[(n+2)%t])}}),/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g),_A=new RegExp(gA.source,"g");function aB(e,t){var n,r,s,i=gA.lastIndex=_A.lastIndex=0,u=-1,h=[],_=[];for(e+="",t+="";(n=gA.exec(e))&&(r=_A.exec(t));)(s=r.index)>i&&(s=t.slice(i,s),h[u]?h[u]+=s:h[++u]=s),(n=n[0])===(r=r[0])?h[u]?h[u]+=r:h[++u]=r:(h[++u]=null,_.push({i:u,x:As(n,r)})),i=_A.lastIndex;return i<t.length&&(s=t.slice(i),h[u]?h[u]+=s:h[++u]=s),h.length<2?_[0]?function Moe(e){return function(t){return e(t)+""}}(_[0].x):function Eoe(e){return function(){return e}}(t):(t=_.length,function(x){for(var S,M=0;M<t;++M)h[(S=_[M]).i]=S.x(x);return h.join("")})}function lB(e,t){var i;return("number"==typeof t?As:t instanceof wp?_g:(i=wp(t))?(t=i,_g):aB)(e,t)}function Doe(e){return function(){this.removeAttribute(e)}}function Toe(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Soe(e,t,i){var n,s,r=i+"";return function(){var u=this.getAttribute(e);return u===r?null:u===n?s:s=t(n=u,i)}}function Ioe(e,t,i){var n,s,r=i+"";return function(){var u=this.getAttributeNS(e.space,e.local);return u===r?null:u===n?s:s=t(n=u,i)}}function Aoe(e,t,i){var n,r,s;return function(){var u,_,h=i(this);return null==h?void this.removeAttribute(e):(u=this.getAttribute(e))===(_=h+"")?null:u===n&&_===r?s:(r=_,s=t(n=u,h))}}function Poe(e,t,i){var n,r,s;return function(){var u,_,h=i(this);return null==h?void this.removeAttributeNS(e.space,e.local):(u=this.getAttributeNS(e.space,e.local))===(_=h+"")?null:u===n&&_===r?s:(r=_,s=t(n=u,h))}}function Loe(e,t){var i,n;function r(){var s=t.apply(this,arguments);return s!==n&&(i=(n=s)&&function Roe(e,t){return function(i){this.setAttributeNS(e.space,e.local,t.call(this,i))}}(e,s)),i}return r._value=t,r}function Foe(e,t){var i,n;function r(){var s=t.apply(this,arguments);return s!==n&&(i=(n=s)&&function koe(e,t){return function(i){this.setAttribute(e,t.call(this,i))}}(e,s)),i}return r._value=t,r}function zoe(e,t){return function(){cA(this,e).delay=+t.apply(this,arguments)}}function Boe(e,t){return t=+t,function(){cA(this,e).delay=t}}function Uoe(e,t){return function(){ld(this,e).duration=+t.apply(this,arguments)}}function joe(e,t){return t=+t,function(){ld(this,e).duration=t}}var ise=Nx.prototype.constructor;function cB(e){return function(){this.style.removeProperty(e)}}var xse=0;function Ah(e,t,i,n){this._groups=e,this._parents=t,this._name=i,this._id=n}function uB(){return++xse}var Ph=Nx.prototype;Ah.prototype=function wse(e){return Nx().transition(e)}.prototype={constructor:Ah,select:function tse(e){var t=this._name,i=this._id;"function"!=typeof e&&(e=nA(e));for(var n=this._groups,r=n.length,s=new Array(r),u=0;u<r;++u)for(var M,S,h=n[u],_=h.length,x=s[u]=new Array(_),P=0;P<_;++P)(M=h[P])&&(S=e.call(M,M.__data__,P,h))&&("__data__"in M&&(S.__data__=M.__data__),x[P]=S,tM(x[P],t,i,P,x,Wc(M,i)));return new Ah(s,this._parents,t,i)},selectAll:function nse(e){var t=this._name,i=this._id;"function"!=typeof e&&(e=Ez(e));for(var n=this._groups,r=n.length,s=[],u=[],h=0;h<r;++h)for(var M,_=n[h],x=_.length,S=0;S<x;++S)if(M=_[S]){for(var F,P=e.call(M,M.__data__,S,_),$=Wc(M,i),W=0,X=P.length;W<X;++W)(F=P[W])&&tM(F,t,i,W,P,$);s.push(P),u.push(M)}return new Ah(s,u,t,i)},selectChild:Ph.selectChild,selectChildren:Ph.selectChildren,filter:function Zoe(e){"function"!=typeof e&&(e=Mz(e));for(var t=this._groups,i=t.length,n=new Array(i),r=0;r<i;++r)for(var _,s=t[r],u=s.length,h=n[r]=[],x=0;x<u;++x)(_=s[x])&&e.call(_,_.__data__,x,s)&&h.push(_);return new Ah(n,this._parents,this._name,this._id)},merge:function Xoe(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,i=e._groups,n=t.length,s=Math.min(n,i.length),u=new Array(n),h=0;h<s;++h)for(var P,_=t[h],x=i[h],M=_.length,S=u[h]=new Array(M),F=0;F<M;++F)(P=_[F]||x[F])&&(S[F]=P);for(;h<n;++h)u[h]=t[h];return new Ah(u,this._parents,this._name,this._id)},selection:function rse(){return new ise(this._groups,this._parents)},transition:function vse(){for(var e=this._name,t=this._id,i=uB(),n=this._groups,r=n.length,s=0;s<r;++s)for(var _,u=n[s],h=u.length,x=0;x<h;++x)if(_=u[x]){var M=Wc(_,t);tM(_,e,i,x,u,{time:M.time+M.delay+M.duration,delay:0,duration:M.duration,ease:M.ease})}return new Ah(n,this._parents,e,i)},call:Ph.call,nodes:Ph.nodes,node:Ph.node,size:Ph.size,empty:Ph.empty,each:Ph.each,on:function Qoe(e,t){var i=this._id;return arguments.length<2?Wc(this.node(),i).on.on(e):this.each(function Koe(e,t,i){var n,r,s=function Yoe(e){return(e+"").trim().split(/^|\s+/).every(function(t){var i=t.indexOf(".");return i>=0&&(t=t.slice(0,i)),!t||"start"===t})}(t)?cA:ld;return function(){var u=s(this,e),h=u.on;h!==n&&(r=(n=h).copy()).on(t,i),u.on=r}}(i,e,t))},attr:function Ooe(e,t){var i=qE(e),n="transform"===i?ooe:lB;return this.attrTween(e,"function"==typeof t?(i.local?Poe:Aoe)(i,n,dA(this,"attr."+e,t)):null==t?(i.local?Toe:Doe)(i):(i.local?Ioe:Soe)(i,n,t))},attrTween:function Noe(e,t){var i="attr."+e;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw new Error;var n=qE(e);return this.tween(i,(n.local?Loe:Foe)(n,t))},style:function cse(e,t,i){var n="transform"==(e+="")?roe:lB;return null==t?this.styleTween(e,function ose(e,t){var i,n,r;return function(){var s=u0(this,e),u=(this.style.removeProperty(e),u0(this,e));return s===u?null:s===i&&u===n?r:r=t(i=s,n=u)}}(e,n)).on("end.style."+e,cB(e)):"function"==typeof t?this.styleTween(e,function ase(e,t,i){var n,r,s;return function(){var u=u0(this,e),h=i(this),_=h+"";return null==h&&(this.style.removeProperty(e),_=h=u0(this,e)),u===_?null:u===n&&_===r?s:(r=_,s=t(n=u,h))}}(e,n,dA(this,"style."+e,t))).each(function lse(e,t){var i,n,r,h,s="style."+t,u="end."+s;return function(){var _=ld(this,e),x=_.on,M=null==_.value[s]?h||(h=cB(t)):void 0;(x!==i||r!==M)&&(n=(i=x).copy()).on(u,r=M),_.on=n}}(this._id,e)):this.styleTween(e,function sse(e,t,i){var n,s,r=i+"";return function(){var u=u0(this,e);return u===r?null:u===n?s:s=t(n=u,i)}}(e,n,t),i).on("end.style."+e,null)},styleTween:function hse(e,t,i){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;return this.tween(n,function dse(e,t,i){var n,r;function s(){var u=t.apply(this,arguments);return u!==r&&(n=(r=u)&&function use(e,t,i){return function(n){this.style.setProperty(e,t.call(this,n),i)}}(e,u,i)),n}return s._value=t,s}(e,t,i??""))},text:function mse(e){return this.tween("text","function"==typeof e?function pse(e){return function(){var t=e(this);this.textContent=t??""}}(dA(this,"text",e)):function fse(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function yse(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function _se(e){var t,i;function n(){var r=e.apply(this,arguments);return r!==i&&(t=(i=r)&&function gse(e){return function(t){this.textContent=e.call(this,t)}}(r)),t}return n._value=e,n}(e))},remove:function ese(){return this.on("end.remove",function Joe(e){return function(){var t=this.parentNode;for(var i in this.__transition)if(+i!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function loe(e,t){var i=this._id;if(e+="",arguments.length<2){for(var u,n=Wc(this.node(),i).tween,r=0,s=n.length;r<s;++r)if((u=n[r]).name===e)return u.value;return null}return this.each((null==t?soe:aoe)(i,e,t))},delay:function Voe(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?zoe:Boe)(t,e)):Wc(this.node(),t).delay},duration:function $oe(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?Uoe:joe)(t,e)):Wc(this.node(),t).duration},ease:function Goe(e){var t=this._id;return arguments.length?this.each(function Hoe(e,t){if("function"!=typeof t)throw new Error;return function(){ld(this,e).ease=t}}(t,e)):Wc(this.node(),t).ease},easeVarying:function Woe(e){if("function"!=typeof e)throw new Error;return this.each(function qoe(e,t){return function(){var i=t.apply(this,arguments);if("function"!=typeof i)throw new Error;ld(this,e).ease=i}}(this._id,e))},end:function bse(){var e,t,i=this,n=i._id,r=i.size();return new Promise(function(s,u){var h={value:u},_={value:function(){0==--r&&s()}};i.each(function(){var x=ld(this,n),M=x.on;M!==e&&((t=(e=M).copy())._.cancel.push(h),t._.interrupt.push(h),t._.end.push(_)),x.on=t}),0===r&&s()})},[Symbol.iterator]:Ph[Symbol.iterator]};var Ese={time:null,delay:0,duration:250,ease:function Cse(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Mse(e,t){for(var i;!(i=e.__transition)||!(i=i[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return i}Nx.prototype.interrupt=function toe(e){return this.each(function(){!function eoe(e,t){var n,r,u,i=e.__transition,s=!0;if(i){for(u in t=null==t?null:t+"",i)(n=i[u]).name===t?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete i[u]):s=!1;s&&delete e.__transition}}(this,e)})},Nx.prototype.transition=function Dse(e){var t,i;e instanceof Ah?(t=e._id,e=e._name):(t=uB(),(i=Ese).time=oA(),e=null==e?null:e+"");for(var n=this._groups,r=n.length,s=0;s<r;++s)for(var _,u=n[s],h=u.length,x=0;x<h;++x)(_=u[x])&&tM(_,e,t,x,u,i||Mse(_,t));return new Ah(n,this._parents,e,t)};Math;function Hx(e){return{type:e}}function cM(e,t){if((i=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var i,n=e.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+e.slice(i+1)]}function _0(e){return(e=cM(Math.abs(e)))?e[1]:NaN}["w","e"].map(Hx),["n","s"].map(Hx),["n","w","e","s","nw","ne","sw","se"].map(Hx);var gB,Nse=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Gx(e){if(!(t=Nse.exec(e)))throw new Error("invalid format: "+e);var t;return new wA({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function wA(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function _B(e,t){var i=cM(e,t);if(!i)return e+"";var n=i[0],r=i[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}Gx.prototype=wA.prototype,wA.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const yB={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function Rse(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>_B(100*e,t),r:_B,s:function Bse(e,t){var i=cM(e,t);if(!i)return e+"";var n=i[0],r=i[1],s=r-(gB=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,u=n.length;return s===u?n:s>u?n+new Array(s-u+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+cM(e,Math.max(0,t+s-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function vB(e){return e}var uM,qx,wB,bB=Array.prototype.map,xB=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];!function Use(e){uM=function Vse(e){var t=void 0===e.grouping||void 0===e.thousands?vB:function Lse(e,t){return function(i,n){for(var r=i.length,s=[],u=0,h=e[0],_=0;r>0&&h>0&&(_+h+1>n&&(h=Math.max(1,n-_)),s.push(i.substring(r-=h,r+h)),!((_+=h+1)>n));)h=e[u=(u+1)%e.length];return s.reverse().join(t)}}(bB.call(e.grouping,Number),e.thousands+""),i=void 0===e.currency?"":e.currency[0]+"",n=void 0===e.currency?"":e.currency[1]+"",r=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?vB:function Fse(e){return function(t){return t.replace(/[0-9]/g,function(i){return e[+i]})}}(bB.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",h=void 0===e.minus?"\u2212":e.minus+"",_=void 0===e.nan?"NaN":e.nan+"";function x(S){var P=(S=Gx(S)).fill,F=S.align,$=S.sign,W=S.symbol,X=S.zero,K=S.width,Q=S.comma,he=S.precision,le=S.trim,ye=S.type;"n"===ye?(Q=!0,ye="g"):yB[ye]||(void 0===he&&(he=12),le=!0,ye="g"),(X||"0"===P&&"="===F)&&(X=!0,P="0",F="=");var Se="$"===W?i:"#"===W&&/[boxX]/.test(ye)?"0"+ye.toLowerCase():"",Ue="$"===W?n:/[%p]/.test(ye)?u:"",Xe=yB[ye],mt=/[defgprs%]/.test(ye);function bt(qe){var Ee,Ie,Ce,St=Se,Nt=Ue;if("c"===ye)Nt=Xe(qe)+Nt,qe="";else{var je=(qe=+qe)<0||1/qe<0;if(qe=isNaN(qe)?_:Xe(Math.abs(qe),he),le&&(qe=function zse(e){e:for(var r,t=e.length,i=1,n=-1;i<t;++i)switch(e[i]){case".":n=r=i;break;case"0":0===n&&(n=i),r=i;break;default:if(!+e[i])break e;n>0&&(n=0)}return n>0?e.slice(0,n)+e.slice(r+1):e}(qe)),je&&0==+qe&&"+"!==$&&(je=!1),St=(je?"("===$?$:h:"-"===$||"("===$?"":$)+St,Nt=("s"===ye?xB[8+gB/3]:"")+Nt+(je&&"("===$?")":""),mt)for(Ee=-1,Ie=qe.length;++Ee<Ie;)if(48>(Ce=qe.charCodeAt(Ee))||Ce>57){Nt=(46===Ce?r+qe.slice(Ee+1):qe.slice(Ee))+Nt,qe=qe.slice(0,Ee);break}}Q&&!X&&(qe=t(qe,1/0));var rt=St.length+qe.length+Nt.length,Ke=rt<K?new Array(K-rt+1).join(P):"";switch(Q&&X&&(qe=t(Ke+qe,Ke.length?K-Nt.length:1/0),Ke=""),F){case"<":qe=St+qe+Nt+Ke;break;case"=":qe=St+Ke+qe+Nt;break;case"^":qe=Ke.slice(0,rt=Ke.length>>1)+St+qe+Nt+Ke.slice(rt);break;default:qe=Ke+St+qe+Nt}return s(qe)}return he=void 0===he?6:/[gprs]/.test(ye)?Math.max(1,Math.min(21,he)):Math.max(0,Math.min(20,he)),bt.toString=function(){return S+""},bt}return{format:x,formatPrefix:function M(S,P){var F=x(((S=Gx(S)).type="f",S)),$=3*Math.max(-8,Math.min(8,Math.floor(_0(P)/3))),W=Math.pow(10,-$),X=xB[8+$/3];return function(K){return F(W*K)+X}}}}(e),qx=uM.format,wB=uM.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});var Wn=1e-6,CB=1e-12,si=Math.PI,Jr=si/2,EB=si/4,rl=2*si,na=180/si,eo=si/180,er=Math.abs,y0=Math.atan,kh=Math.atan2,ti=Math.cos,MB=(Math,Math.exp),dM=(Math,Math,Math.log),CA=Math.pow,Gn=Math.sin,Gl=Math.sign||function(e){return e>0?1:e<0?-1:0},Oa=Math.sqrt,EA=Math.tan;function DB(e){return e>1?0:e<-1?si:Math.acos(e)}function ql(e){return e>1?Jr:e<-1?-Jr:Math.asin(e)}function Wl(){}function TB(){var t,e=[];return{point:function(i,n,r){t.push([i,n,r])},lineStart:function(){e.push(t=[])},lineEnd:Wl,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var i=e;return e=[],t=null,i}}}function hM(e,t){return er(e[0]-t[0])<Wn&&er(e[1]-t[1])<Wn}function fM(e,t,i,n){this.x=e,this.z=t,this.o=i,this.e=n,this.v=!1,this.n=this.p=null}function SB(e,t,i,n,r){var h,_,s=[],u=[];if(e.forEach(function($){if(!((W=$.length-1)<=0)){var W,Q,X=$[0],K=$[W];if(hM(X,K)){if(!X[2]&&!K[2]){for(r.lineStart(),h=0;h<W;++h)r.point((X=$[h])[0],X[1]);return void r.lineEnd()}K[0]+=2*Wn}s.push(Q=new fM(X,$,null,!0)),u.push(Q.o=new fM(X,null,Q,!1)),s.push(Q=new fM(K,$,null,!1)),u.push(Q.o=new fM(K,null,Q,!0))}}),s.length){for(u.sort(t),IB(s),IB(u),h=0,_=u.length;h<_;++h)u[h].e=i=!i;for(var M,S,x=s[0];;){for(var P=x,F=!0;P.v;)if((P=P.n)===x)return;M=P.z,r.lineStart();do{if(P.v=P.o.v=!0,P.e){if(F)for(h=0,_=M.length;h<_;++h)r.point((S=M[h])[0],S[1]);else n(P.x,P.n.x,1,r);P=P.n}else{if(F)for(h=(M=P.p.z).length-1;h>=0;--h)r.point((S=M[h])[0],S[1]);else n(P.x,P.p.x,-1,r);P=P.p}M=(P=P.o).z,F=!F}while(!P.v);r.lineEnd()}}}function IB(e){if(t=e.length){for(var t,r,i=0,n=e[0];++i<t;)n.n=r=e[i],r.p=n,n=r;n.n=r=e[0],r.p=n}}function AB(e){return Array.from(function*$se(e){for(const t of e)yield*t}(e))}var Wx=1e9,pM=-Wx;function PB(e,t,i,n){function r(x,M){return e<=x&&x<=i&&t<=M&&M<=n}function s(x,M,S,P){var F=0,$=0;if(null==x||(F=u(x,S))!==($=u(M,S))||_(x,M)<0^S>0)do{P.point(0===F||3===F?e:i,F>1?n:t)}while((F=(F+S+4)%4)!==$);else P.point(M[0],M[1])}function u(x,M){return er(x[0]-e)<Wn?M>0?0:3:er(x[0]-i)<Wn?M>0?2:1:er(x[1]-t)<Wn?M>0?1:0:M>0?3:2}function h(x,M){return _(x.x,M.x)}function _(x,M){var S=u(x,1),P=u(M,1);return S!==P?S-P:0===S?M[1]-x[1]:1===S?x[0]-M[0]:2===S?x[1]-M[1]:M[0]-x[0]}return function(x){var P,F,$,W,X,K,Q,he,le,ye,Se,M=x,S=TB(),Ue={point:Xe,lineStart:function St(){Ue.point=Ee,F&&F.push($=[]),ye=!0,le=!1,Q=he=NaN},lineEnd:function Nt(){P&&(Ee(W,X),K&&le&&S.rejoin(),P.push(S.result())),Ue.point=Xe,le&&M.lineEnd()},polygonStart:function bt(){M=S,P=[],F=[],Se=!0},polygonEnd:function qe(){var Ie=function mt(){for(var Ie=0,Ce=0,je=F.length;Ce<je;++Ce)for(var At,rn,rt=F[Ce],Ke=1,wt=rt.length,It=rt[0],vn=It[0],pi=It[1];Ke<wt;++Ke)At=vn,rn=pi,vn=(It=rt[Ke])[0],pi=It[1],rn<=n?pi>n&&(vn-At)*(n-rn)>(pi-rn)*(e-At)&&++Ie:pi<=n&&(vn-At)*(n-rn)<(pi-rn)*(e-At)&&--Ie;return Ie}(),Ce=Se&&Ie,je=(P=AB(P)).length;(Ce||je)&&(x.polygonStart(),Ce&&(x.lineStart(),s(null,null,1,x),x.lineEnd()),je&&SB(P,h,Ie,s,x),x.polygonEnd()),M=x,P=F=$=null}};function Xe(Ie,Ce){r(Ie,Ce)&&M.point(Ie,Ce)}function Ee(Ie,Ce){var je=r(Ie,Ce);if(F&&$.push([Ie,Ce]),ye)W=Ie,X=Ce,K=je,ye=!1,je&&(M.lineStart(),M.point(Ie,Ce));else if(je&&le)M.point(Ie,Ce);else{var rt=[Q=Math.max(pM,Math.min(Wx,Q)),he=Math.max(pM,Math.min(Wx,he))],Ke=[Ie=Math.max(pM,Math.min(Wx,Ie)),Ce=Math.max(pM,Math.min(Wx,Ce))];!function jse(e,t,i,n,r,s){var $,u=e[0],h=e[1],M=0,S=1,P=t[0]-u,F=t[1]-h;if($=i-u,P||!($>0)){if($/=P,P<0){if($<M)return;$<S&&(S=$)}else if(P>0){if($>S)return;$>M&&(M=$)}if($=r-u,P||!($<0)){if($/=P,P<0){if($>S)return;$>M&&(M=$)}else if(P>0){if($<M)return;$<S&&(S=$)}if($=n-h,F||!($>0)){if($/=F,F<0){if($<M)return;$<S&&(S=$)}else if(F>0){if($>S)return;$>M&&(M=$)}if($=s-h,F||!($<0)){if($/=F,F<0){if($>S)return;$>M&&(M=$)}else if(F>0){if($<M)return;$<S&&(S=$)}return M>0&&(e[0]=u+M*P,e[1]=h+M*F),S<1&&(t[0]=u+S*P,t[1]=h+S*F),!0}}}}}(rt,Ke,e,t,i,n)?je&&(M.lineStart(),M.point(Ie,Ce),Se=!1):(le||(M.lineStart(),M.point(rt[0],rt[1])),M.point(Ke[0],Ke[1]),je||M.lineEnd(),Se=!1)}Q=Ie,he=Ce,le=je}return Ue}}const MA=e=>e;function mM(e,t){e&&kB.hasOwnProperty(e.type)&&kB[e.type](e,t)}var OB={Feature:function(e,t){mM(e.geometry,t)},FeatureCollection:function(e,t){for(var i=e.features,n=-1,r=i.length;++n<r;)mM(i[n].geometry,t)}},kB={Sphere:function(e,t){t.sphere()},Point:function(e,t){t.point((e=e.coordinates)[0],e[1],e[2])},MultiPoint:function(e,t){for(var i=e.coordinates,n=-1,r=i.length;++n<r;)t.point((e=i[n])[0],e[1],e[2])},LineString:function(e,t){DA(e.coordinates,t,0)},MultiLineString:function(e,t){for(var i=e.coordinates,n=-1,r=i.length;++n<r;)DA(i[n],t,0)},Polygon:function(e,t){RB(e.coordinates,t)},MultiPolygon:function(e,t){for(var i=e.coordinates,n=-1,r=i.length;++n<r;)RB(i[n],t)},GeometryCollection:function(e,t){for(var i=e.geometries,n=-1,r=i.length;++n<r;)mM(i[n],t)}};function DA(e,t,i){var s,n=-1,r=e.length-i;for(t.lineStart();++n<r;)t.point((s=e[n])[0],s[1],s[2]);t.lineEnd()}function RB(e,t){var i=-1,n=e.length;for(t.polygonStart();++i<n;)DA(e[i],t,1);t.polygonEnd()}function yg(e,t){e&&OB.hasOwnProperty(e.type)?OB[e.type](e,t):mM(e,t)}class Rh{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const i=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const s=i[r],u=t+s,h=Math.abs(t)<Math.abs(s)?t-(u-s):s-(u-t);h&&(i[n++]=h),t=u}return i[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let n,r,s,i=this._n,u=0;if(i>0){for(u=t[--i];i>0&&(n=u,r=t[--i],u=n+r,s=r-(u-n),!s););i>0&&(s<0&&t[i-1]<0||s>0&&t[i-1]>0)&&(r=2*s,n=u+r,r==n-u&&(u=n))}return u}}var LB,FB,IA,AA,TA=new Rh,SA=new Rh,Ep={point:Wl,lineStart:Wl,lineEnd:Wl,polygonStart:function(){Ep.lineStart=Hse,Ep.lineEnd=qse},polygonEnd:function(){Ep.lineStart=Ep.lineEnd=Ep.point=Wl,TA.add(er(SA)),SA=new Rh},result:function(){var e=TA/2;return TA=new Rh,e}};function Hse(){Ep.point=Gse}function Gse(e,t){Ep.point=NB,LB=IA=e,FB=AA=t}function NB(e,t){SA.add(AA*e-IA*t),IA=e,AA=t}function qse(){NB(LB,FB)}const zB=Ep;var v0=1/0,gM=v0,Zx=-v0,_M=Zx;const yM={point:function Zse(e,t){e<v0&&(v0=e),e>Zx&&(Zx=e),t<gM&&(gM=t),t>_M&&(_M=t)},lineStart:Wl,lineEnd:Wl,polygonStart:Wl,polygonEnd:Wl,result:function(){var e=[[v0,gM],[Zx,_M]];return Zx=_M=-(gM=v0=1/0),e}};var BB,VB,ud,dd,PA=0,OA=0,Xx=0,vM=0,bM=0,b0=0,kA=0,RA=0,Yx=0,Xc={point:vg,lineStart:UB,lineEnd:jB,polygonStart:function(){Xc.lineStart=Kse,Xc.lineEnd=Qse},polygonEnd:function(){Xc.point=vg,Xc.lineStart=UB,Xc.lineEnd=jB},result:function(){var e=Yx?[kA/Yx,RA/Yx]:b0?[vM/b0,bM/b0]:Xx?[PA/Xx,OA/Xx]:[NaN,NaN];return PA=OA=Xx=vM=bM=b0=kA=RA=Yx=0,e}};function vg(e,t){PA+=e,OA+=t,++Xx}function UB(){Xc.point=Xse}function Xse(e,t){Xc.point=Yse,vg(ud=e,dd=t)}function Yse(e,t){var i=e-ud,n=t-dd,r=Oa(i*i+n*n);vM+=r*(ud+e)/2,bM+=r*(dd+t)/2,b0+=r,vg(ud=e,dd=t)}function jB(){Xc.point=vg}function Kse(){Xc.point=Jse}function Qse(){$B(BB,VB)}function Jse(e,t){Xc.point=$B,vg(BB=ud=e,VB=dd=t)}function $B(e,t){var i=e-ud,n=t-dd,r=Oa(i*i+n*n);vM+=r*(ud+e)/2,bM+=r*(dd+t)/2,b0+=r,kA+=(r=dd*e-ud*t)*(ud+e),RA+=r*(dd+t),Yx+=3*r,vg(ud=e,dd=t)}const HB=Xc;function GB(e){this._context=e}GB.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,rl)}},result:Wl};var FA,qB,WB,Kx,Qx,LA=new Rh,xM={point:Wl,lineStart:function(){xM.point=eae},lineEnd:function(){FA&&ZB(qB,WB),xM.point=Wl},polygonStart:function(){FA=!0},polygonEnd:function(){FA=null},result:function(){var e=+LA;return LA=new Rh,e}};function eae(e,t){xM.point=ZB,qB=Kx=e,WB=Qx=t}function ZB(e,t){LA.add(Oa((Kx-=e)*Kx+(Qx-=t)*Qx)),Kx=e,Qx=t}const XB=xM;let YB,wM,KB,QB;class JB{constructor(t){this._append=null==t?e6:function tae(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return e6;if(t!==YB){const i=10**t;YB=t,wM=function(r){let s=1;this._+=r[0];for(const u=r.length;s<u;++s)this._+=Math.round(arguments[s]*i)/i+r[s]}}return wM}(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(t,i){switch(this._point){case 0:this._append`M${t},${i}`,this._point=1;break;case 1:this._append`L${t},${i}`;break;default:if(this._append`M${t},${i}`,this._radius!==KB||this._append!==wM){const n=this._radius,r=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,KB=n,wM=this._append,QB=this._,this._=r}this._+=QB}}result(){const t=this._;return this._="",t.length?t:null}}function e6(e){let t=1;this._+=e[0];for(const i=e.length;t<i;++t)this._+=arguments[t]+e[t]}function t6(e,t){let r,s,i=3,n=4.5;function u(h){return h&&("function"==typeof n&&s.pointRadius(+n.apply(this,arguments)),yg(h,r(s))),s.result()}return u.area=function(h){return yg(h,r(zB)),zB.result()},u.measure=function(h){return yg(h,r(XB)),XB.result()},u.bounds=function(h){return yg(h,r(yM)),yM.result()},u.centroid=function(h){return yg(h,r(HB)),HB.result()},u.projection=function(h){return arguments.length?(r=null==h?(e=null,MA):(e=h).stream,u):e},u.context=function(h){return arguments.length?(s=null==h?(t=null,new JB(i)):new GB(t=h),"function"!=typeof n&&s.pointRadius(n),u):t},u.pointRadius=function(h){return arguments.length?(n="function"==typeof h?h:(s.pointRadius(+h),+h),u):n},u.digits=function(h){if(!arguments.length)return i;if(null==h)i=null;else{const _=Math.floor(h);if(!(_>=0))throw new RangeError(`invalid digits: ${h}`);i=_}return null===t&&(s=new JB(i)),u},u.projection(e).digits(i).context(t)}function NA(e){return[kh(e[1],e[0]),ql(e[2])]}function x0(e){var t=e[0],i=e[1],n=ti(i);return[n*ti(t),n*Gn(t),Gn(i)]}function CM(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function EM(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function zA(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function MM(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function BA(e){var t=Oa(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function VA(e){return er(e[0])<=si?e[0]:Gl(e[0])*((er(e[0])+si)%rl-si)}function n6(e,t,i,n){return function(r){var x,M,S,s=t(r),u=TB(),h=t(u),_=!1,P={point:F,lineStart:W,lineEnd:X,polygonStart:function(){P.point=K,P.lineStart=Q,P.lineEnd=he,M=[],x=[]},polygonEnd:function(){P.point=F,P.lineStart=W,P.lineEnd=X,M=AB(M);var le=function nae(e,t){var i=VA(t),n=t[1],r=Gn(n),s=[Gn(i),-ti(i),0],u=0,h=0,_=new Rh;1===r?n=Jr+Wn:-1===r&&(n=-Jr-Wn);for(var x=0,M=e.length;x<M;++x)if(P=(S=e[x]).length)for(var S,P,F=S[P-1],$=VA(F),W=F[1]/2+EB,X=Gn(W),K=ti(W),Q=0;Q<P;++Q,$=le,X=Se,K=Ue,F=he){var he=S[Q],le=VA(he),ye=he[1]/2+EB,Se=Gn(ye),Ue=ti(ye),Xe=le-$,mt=Xe>=0?1:-1,bt=mt*Xe,qe=bt>si,St=X*Se;if(_.add(kh(St*mt*Gn(bt),K*Ue+St*ti(bt))),u+=qe?Xe+mt*rl:Xe,qe^$>=i^le>=i){var Nt=EM(x0(F),x0(he));BA(Nt);var Ee=EM(s,Nt);BA(Ee);var Ie=(qe^Xe>=0?-1:1)*ql(Ee[2]);(n>Ie||n===Ie&&(Nt[0]||Nt[1]))&&(h+=qe^Xe>=0?1:-1)}}return(u<-Wn||u<Wn&&_<-CB)^1&h}(x,n);M.length?(_||(r.polygonStart(),_=!0),SB(M,rae,le,i,r)):le&&(_||(r.polygonStart(),_=!0),r.lineStart(),i(null,null,1,r),r.lineEnd()),_&&(r.polygonEnd(),_=!1),M=x=null},sphere:function(){r.polygonStart(),r.lineStart(),i(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function F(le,ye){e(le,ye)&&r.point(le,ye)}function $(le,ye){s.point(le,ye)}function W(){P.point=$,s.lineStart()}function X(){P.point=F,s.lineEnd()}function K(le,ye){S.push([le,ye]),h.point(le,ye)}function Q(){h.lineStart(),S=[]}function he(){K(S[0][0],S[0][1]),h.lineEnd();var Se,Xe,mt,bt,le=h.clean(),ye=u.result(),Ue=ye.length;if(S.pop(),x.push(S),S=null,Ue){if(1&le){if((Xe=(mt=ye[0]).length-1)>0){for(_||(r.polygonStart(),_=!0),r.lineStart(),Se=0;Se<Xe;++Se)r.point((bt=mt[Se])[0],bt[1]);r.lineEnd()}return}Ue>1&&2&le&&ye.push(ye.pop().concat(ye.shift())),M.push(ye.filter(iae))}}return P}}function iae(e){return e.length>1}function rae(e,t){return((e=e.x)[0]<0?e[1]-Jr-Wn:Jr-e[1])-((t=t.x)[0]<0?t[1]-Jr-Wn:Jr-t[1])}const i6=n6(function(){return!0},function oae(e){var r,t=NaN,i=NaN,n=NaN;return{lineStart:function(){e.lineStart(),r=1},point:function(s,u){var h=s>0?si:-si,_=er(s-t);er(_-si)<Wn?(e.point(t,i=(i+u)/2>0?Jr:-Jr),e.point(n,i),e.lineEnd(),e.lineStart(),e.point(h,i),e.point(s,i),r=0):n!==h&&_>=si&&(er(t-n)<Wn&&(t-=n*Wn),er(s-h)<Wn&&(s-=h*Wn),i=function sae(e,t,i,n){var r,s,u=Gn(e-i);return er(u)>Wn?y0((Gn(t)*(s=ti(n))*Gn(i)-Gn(n)*(r=ti(t))*Gn(e))/(r*s*u)):(t+n)/2}(t,i,s,u),e.point(n,i),e.lineEnd(),e.lineStart(),e.point(h,i),r=0),e.point(t=s,i=u),n=h},lineEnd:function(){e.lineEnd(),t=i=NaN},clean:function(){return 2-r}}},function aae(e,t,i,n){var r;if(null==e)n.point(-si,r=i*Jr),n.point(0,r),n.point(si,r),n.point(si,0),n.point(si,-r),n.point(0,-r),n.point(-si,-r),n.point(-si,0),n.point(-si,r);else if(er(e[0]-t[0])>Wn){var s=e[0]<t[0]?si:-si;n.point(-s,r=i*s/2),n.point(0,r),n.point(s,r)}else n.point(t[0],t[1])},[-si,-Jr]);function o6(e,t){(t=x0(t))[0]-=e,BA(t);var i=DB(-t[1]);return((-t[2]<0?-i:i)+rl-Wn)%rl}function UA(e,t){function i(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(i.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),i}function jA(e,t){return er(e)>si&&(e-=Math.round(e/rl)*rl),[e,t]}function s6(e,t,i){return(e%=rl)?t||i?UA(l6(e),c6(t,i)):l6(e):t||i?c6(t,i):jA}function a6(e){return function(t,i){return er(t+=e)>si&&(t-=Math.round(t/rl)*rl),[t,i]}}function l6(e){var t=a6(e);return t.invert=a6(-e),t}function c6(e,t){var i=ti(e),n=Gn(e),r=ti(t),s=Gn(t);function u(h,_){var x=ti(_),M=ti(h)*x,S=Gn(h)*x,P=Gn(_),F=P*i+M*n;return[kh(S*r-F*s,M*i-P*n),ql(F*r+S*s)]}return u.invert=function(h,_){var x=ti(_),M=ti(h)*x,S=Gn(h)*x,P=Gn(_),F=P*r-S*s;return[kh(S*r+P*s,M*i+F*n),ql(F*i-M*n)]},u}function $A(e){return{stream:DM(e)}}function DM(e){return function(t){var i=new HA;for(var n in e)i[n]=e[n];return i.stream=t,i}}function HA(){}function GA(e,t,i){var n=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=n&&e.clipExtent(null),yg(i,e.stream(yM)),t(yM.result()),null!=n&&e.clipExtent(n),e}function qA(e,t,i){return GA(e,function(n){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],u=Math.min(r/(n[1][0]-n[0][0]),s/(n[1][1]-n[0][1])),h=+t[0][0]+(r-u*(n[1][0]+n[0][0]))/2,_=+t[0][1]+(s-u*(n[1][1]+n[0][1]))/2;e.scale(150*u).translate([h,_])},i)}function u6(e,t,i){return qA(e,[[0,0],t],i)}function d6(e,t,i){return GA(e,function(n){var r=+t,s=r/(n[1][0]-n[0][0]),u=(r-s*(n[1][0]+n[0][0]))/2,h=-s*n[0][1];e.scale(150*s).translate([u,h])},i)}function h6(e,t,i){return GA(e,function(n){var r=+t,s=r/(n[1][1]-n[0][1]),u=-s*n[0][0],h=(r-s*(n[1][1]+n[0][1]))/2;e.scale(150*s).translate([u,h])},i)}jA.invert=jA,HA.prototype={constructor:HA,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var f6=16,uae=ti(30*eo);function p6(e,t){return+t?function hae(e,t){function i(n,r,s,u,h,_,x,M,S,P,F,$,W,X){var K=x-n,Q=M-r,he=K*K+Q*Q;if(he>4*t&&W--){var le=u+P,ye=h+F,Se=_+$,Ue=Oa(le*le+ye*ye+Se*Se),Xe=ql(Se/=Ue),mt=er(er(Se)-1)<Wn||er(s-S)<Wn?(s+S)/2:kh(ye,le),bt=e(mt,Xe),qe=bt[0],St=bt[1],Nt=qe-n,Ee=St-r,Ie=Q*Nt-K*Ee;(Ie*Ie/he>t||er((K*Nt+Q*Ee)/he-.5)>.3||u*P+h*F+_*$<uae)&&(i(n,r,s,u,h,_,qe,St,mt,le/=Ue,ye/=Ue,Se,W,X),X.point(qe,St),i(qe,St,mt,le,ye,Se,x,M,S,P,F,$,W,X))}}return function(n){var r,s,u,h,_,x,M,S,P,F,$,W,X={point:K,lineStart:Q,lineEnd:le,polygonStart:function(){n.polygonStart(),X.lineStart=ye},polygonEnd:function(){n.polygonEnd(),X.lineStart=Q}};function K(Xe,mt){Xe=e(Xe,mt),n.point(Xe[0],Xe[1])}function Q(){S=NaN,X.point=he,n.lineStart()}function he(Xe,mt){var bt=x0([Xe,mt]),qe=e(Xe,mt);i(S,P,M,F,$,W,S=qe[0],P=qe[1],M=Xe,F=bt[0],$=bt[1],W=bt[2],f6,n),n.point(S,P)}function le(){X.point=K,n.lineEnd()}function ye(){Q(),X.point=Se,X.lineEnd=Ue}function Se(Xe,mt){he(r=Xe,mt),s=S,u=P,h=F,_=$,x=W,X.point=he}function Ue(){i(S,P,M,F,$,W,s,u,r,h,_,x,f6,n),X.lineEnd=le,le()}return X}}(e,t):function dae(e){return DM({point:function(t,i){t=e(t,i),this.stream.point(t[0],t[1])}})}(e)}var fae=DM({point:function(e,t){this.stream.point(e*eo,t*eo)}});function m6(e,t,i,n,r,s){if(!s)return function mae(e,t,i,n,r){function s(u,h){return[t+e*(u*=n),i-e*(h*=r)]}return s.invert=function(u,h){return[(u-t)/e*n,(i-h)/e*r]},s}(e,t,i,n,r);var u=ti(s),h=Gn(s),_=u*e,x=h*e,M=u/e,S=h/e,P=(h*i-u*t)/e,F=(h*t+u*i)/e;function $(W,X){return[_*(W*=n)-x*(X*=r)+t,i-x*W-_*X]}return $.invert=function(W,X){return[n*(M*W-S*X+P),r*(F-S*W-M*X)]},$}function Mp(e){return g6(function(){return e})()}function g6(e){var t,M,K,Q,he,Se,Ue,Xe,mt,bt,i=150,n=480,r=250,s=0,u=0,h=0,_=0,x=0,S=0,P=1,F=1,$=null,W=i6,X=null,le=MA,ye=.5;function qe(Ie){return Xe(Ie[0]*eo,Ie[1]*eo)}function St(Ie){return(Ie=Xe.invert(Ie[0],Ie[1]))&&[Ie[0]*na,Ie[1]*na]}function Nt(){var Ie=m6(i,0,0,P,F,S).apply(null,t(s,u)),Ce=m6(i,n-Ie[0],r-Ie[1],P,F,S);return M=s6(h,_,x),Ue=UA(t,Ce),Xe=UA(M,Ue),Se=p6(Ue,ye),Ee()}function Ee(){return mt=bt=null,qe}return qe.stream=function(Ie){return mt&&bt===Ie?mt:mt=fae(function pae(e){return DM({point:function(t,i){var n=e(t,i);return this.stream.point(n[0],n[1])}})}(M)(W(Se(le(bt=Ie)))))},qe.preclip=function(Ie){return arguments.length?(W=Ie,$=void 0,Ee()):W},qe.postclip=function(Ie){return arguments.length?(le=Ie,X=K=Q=he=null,Ee()):le},qe.clipAngle=function(Ie){return arguments.length?(W=+Ie?function lae(e){var t=ti(e),i=6*eo,n=t>0,r=er(t)>Wn;function u(M,S){return ti(M)*ti(S)>t}function _(M,S,P){var W=[1,0,0],X=EM(x0(M),x0(S)),K=CM(X,X),Q=X[0],he=K-Q*Q;if(!he)return!P&&M;var le=t*K/he,ye=-t*Q/he,Se=EM(W,X),Ue=MM(W,le);zA(Ue,MM(X,ye));var mt=Se,bt=CM(Ue,mt),qe=CM(mt,mt),St=bt*bt-qe*(CM(Ue,Ue)-1);if(!(St<0)){var Nt=Oa(St),Ee=MM(mt,(-bt-Nt)/qe);if(zA(Ee,Ue),Ee=NA(Ee),!P)return Ee;var Ke,Ie=M[0],Ce=S[0],je=M[1],rt=S[1];Ce<Ie&&(Ke=Ie,Ie=Ce,Ce=Ke);var wt=Ce-Ie,It=er(wt-si)<Wn;if(!It&&rt<je&&(Ke=je,je=rt,rt=Ke),It||wt<Wn?It?je+rt>0^Ee[1]<(er(Ee[0]-Ie)<Wn?je:rt):je<=Ee[1]&&Ee[1]<=rt:wt>si^(Ie<=Ee[0]&&Ee[0]<=Ce)){var rn=MM(mt,(-bt+Nt)/qe);return zA(rn,Ue),[Ee,NA(rn)]}}}function x(M,S){var P=n?e:si-e,F=0;return M<-P?F|=1:M>P&&(F|=2),S<-P?F|=4:S>P&&(F|=8),F}return n6(u,function h(M){var S,P,F,$,W;return{lineStart:function(){$=F=!1,W=1},point:function(X,K){var he,Q=[X,K],le=u(X,K),ye=n?le?0:x(X,K):le?x(X+(X<0?si:-si),K):0;if(!S&&($=F=le)&&M.lineStart(),le!==F&&(!(he=_(S,Q))||hM(S,he)||hM(Q,he))&&(Q[2]=1),le!==F)W=0,le?(M.lineStart(),he=_(Q,S),M.point(he[0],he[1])):(he=_(S,Q),M.point(he[0],he[1],2),M.lineEnd()),S=he;else if(r&&S&&n^le){var Se;!(ye&P)&&(Se=_(Q,S,!0))&&(W=0,n?(M.lineStart(),M.point(Se[0][0],Se[0][1]),M.point(Se[1][0],Se[1][1]),M.lineEnd()):(M.point(Se[1][0],Se[1][1]),M.lineEnd(),M.lineStart(),M.point(Se[0][0],Se[0][1],3)))}le&&(!S||!hM(S,Q))&&M.point(Q[0],Q[1]),S=Q,F=le,P=ye},lineEnd:function(){F&&M.lineEnd(),S=null},clean:function(){return W|($&&F)<<1}}},function s(M,S,P,F){!function r6(e,t,i,n,r,s){if(i){var u=ti(t),h=Gn(t),_=n*i;null==r?(r=t+n*rl,s=t-_/2):(r=o6(u,r),s=o6(u,s),(n>0?r<s:r>s)&&(r+=n*rl));for(var x,M=r;n>0?M>s:M<s;M-=_)x=NA([u,-h*ti(M),-h*Gn(M)]),e.point(x[0],x[1])}}(F,e,i,P,M,S)},n?[0,-e]:[-si,e-si])}($=Ie*eo):($=null,i6),Ee()):$*na},qe.clipExtent=function(Ie){return arguments.length?(le=null==Ie?(X=K=Q=he=null,MA):PB(X=+Ie[0][0],K=+Ie[0][1],Q=+Ie[1][0],he=+Ie[1][1]),Ee()):null==X?null:[[X,K],[Q,he]]},qe.scale=function(Ie){return arguments.length?(i=+Ie,Nt()):i},qe.translate=function(Ie){return arguments.length?(n=+Ie[0],r=+Ie[1],Nt()):[n,r]},qe.center=function(Ie){return arguments.length?(s=Ie[0]%360*eo,u=Ie[1]%360*eo,Nt()):[s*na,u*na]},qe.rotate=function(Ie){return arguments.length?(h=Ie[0]%360*eo,_=Ie[1]%360*eo,x=Ie.length>2?Ie[2]%360*eo:0,Nt()):[h*na,_*na,x*na]},qe.angle=function(Ie){return arguments.length?(S=Ie%360*eo,Nt()):S*na},qe.reflectX=function(Ie){return arguments.length?(P=Ie?-1:1,Nt()):P<0},qe.reflectY=function(Ie){return arguments.length?(F=Ie?-1:1,Nt()):F<0},qe.precision=function(Ie){return arguments.length?(Se=p6(Ue,ye=Ie*Ie),Ee()):Oa(ye)},qe.fitExtent=function(Ie,Ce){return qA(qe,Ie,Ce)},qe.fitSize=function(Ie,Ce){return u6(qe,Ie,Ce)},qe.fitWidth=function(Ie,Ce){return d6(qe,Ie,Ce)},qe.fitHeight=function(Ie,Ce){return h6(qe,Ie,Ce)},function(){return t=e.apply(this,arguments),qe.invert=t.invert&&St,Nt()}}function WA(e){var t=0,i=si/3,n=g6(e),r=n(t,i);return r.parallels=function(s){return arguments.length?n(t=s[0]*eo,i=s[1]*eo):[t*na,i*na]},r}function _ae(e,t){var i=Gn(e),n=(i+Gn(t))/2;if(er(n)<Wn)return function gae(e){var t=ti(e);function i(n,r){return[n*t,Gn(r)/t]}return i.invert=function(n,r){return[n/t,ql(r*t)]},i}(e);var r=1+i*(2*n-i),s=Oa(r)/n;function u(h,_){var x=Oa(r-2*n*Gn(_))/n;return[x*Gn(h*=n),s-x*ti(h)]}return u.invert=function(h,_){var x=s-_,M=kh(h,er(x))*Gl(x);return x*n<0&&(M-=si*Gl(h)*Gl(x)),[M/n,ql((r-(h*h+x*x)*n*n)/(2*n))]},u}function TM(){return WA(_ae).scale(155.424).center([0,33.6442])}function _6(){return TM().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function vae(){var e,t,n,s,h,_,i=_6(),r=TM().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=TM().rotate([157,0]).center([-3,19.9]).parallels([8,18]),x={point:function(P,F){_=[P,F]}};function M(P){var F=P[0],$=P[1];return _=null,n.point(F,$),_||(s.point(F,$),_)||(h.point(F,$),_)}function S(){return e=t=null,M}return M.invert=function(P){var F=i.scale(),$=i.translate(),W=(P[0]-$[0])/F,X=(P[1]-$[1])/F;return(X>=.12&&X<.234&&W>=-.425&&W<-.214?r:X>=.166&&X<.234&&W>=-.214&&W<-.115?u:i).invert(P)},M.stream=function(P){return e&&t===P?e:e=function yae(e){var t=e.length;return{point:function(i,n){for(var r=-1;++r<t;)e[r].point(i,n)},sphere:function(){for(var i=-1;++i<t;)e[i].sphere()},lineStart:function(){for(var i=-1;++i<t;)e[i].lineStart()},lineEnd:function(){for(var i=-1;++i<t;)e[i].lineEnd()},polygonStart:function(){for(var i=-1;++i<t;)e[i].polygonStart()},polygonEnd:function(){for(var i=-1;++i<t;)e[i].polygonEnd()}}}([i.stream(t=P),r.stream(P),u.stream(P)])},M.precision=function(P){return arguments.length?(i.precision(P),r.precision(P),u.precision(P),S()):i.precision()},M.scale=function(P){return arguments.length?(i.scale(P),r.scale(.35*P),u.scale(P),M.translate(i.translate())):i.scale()},M.translate=function(P){if(!arguments.length)return i.translate();var F=i.scale(),$=+P[0],W=+P[1];return n=i.translate(P).clipExtent([[$-.455*F,W-.238*F],[$+.455*F,W+.238*F]]).stream(x),s=r.translate([$-.307*F,W+.201*F]).clipExtent([[$-.425*F+Wn,W+.12*F+Wn],[$-.214*F-Wn,W+.234*F-Wn]]).stream(x),h=u.translate([$-.205*F,W+.212*F]).clipExtent([[$-.214*F+Wn,W+.166*F+Wn],[$-.115*F-Wn,W+.234*F-Wn]]).stream(x),S()},M.fitExtent=function(P,F){return qA(M,P,F)},M.fitSize=function(P,F){return u6(M,P,F)},M.fitWidth=function(P,F){return d6(M,P,F)},M.fitHeight=function(P,F){return h6(M,P,F)},M.scale(1070)}function y6(e){return function(t,i){var n=ti(t),r=ti(i),s=e(n*r);return s===1/0?[2,0]:[s*r*Gn(t),s*Gn(i)]}}function Jx(e){return function(t,i){var n=Oa(t*t+i*i),r=e(n),s=Gn(r),u=ti(r);return[kh(t*s,n*u),ql(n&&i*s/n)]}}var v6=y6(function(e){return Oa(2/(1+e))});function bae(){return Mp(v6).scale(124.75).clipAngle(179.999)}v6.invert=Jx(function(e){return 2*ql(e/2)});var b6=y6(function(e){return(e=DB(e))&&e/Gn(e)});function xae(){return Mp(b6).scale(79.4188).clipAngle(179.999)}function SM(e,t){return[e,dM(EA((Jr+t)/2))]}function wae(){return x6(SM).scale(961/rl)}function x6(e){var h,_,x,t=Mp(e),i=t.center,n=t.scale,r=t.translate,s=t.clipExtent,u=null;function M(){var S=si*n(),P=t(function cae(e){function t(i){return(i=e(i[0]*eo,i[1]*eo))[0]*=na,i[1]*=na,i}return e=s6(e[0]*eo,e[1]*eo,e.length>2?e[2]*eo:0),t.invert=function(i){return(i=e.invert(i[0]*eo,i[1]*eo))[0]*=na,i[1]*=na,i},t}(t.rotate()).invert([0,0]));return s(null==u?[[P[0]-S,P[1]-S],[P[0]+S,P[1]+S]]:e===SM?[[Math.max(P[0]-S,u),h],[Math.min(P[0]+S,_),x]]:[[u,Math.max(P[1]-S,h)],[_,Math.min(P[1]+S,x)]])}return t.scale=function(S){return arguments.length?(n(S),M()):n()},t.translate=function(S){return arguments.length?(r(S),M()):r()},t.center=function(S){return arguments.length?(i(S),M()):i()},t.clipExtent=function(S){return arguments.length?(null==S?u=h=_=x=null:(u=+S[0][0],h=+S[0][1],_=+S[1][0],x=+S[1][1]),M()):null==u?null:[[u,h],[_,x]]},M()}function IM(e){return EA((Jr+e)/2)}function Cae(e,t){var i=ti(e),n=e===t?Gn(e):dM(i/ti(t))/dM(IM(t)/IM(e)),r=i*CA(IM(e),n)/n;if(!n)return SM;function s(u,h){r>0?h<-Jr+Wn&&(h=-Jr+Wn):h>Jr-Wn&&(h=Jr-Wn);var _=r/CA(IM(h),n);return[_*Gn(n*u),r-_*ti(n*u)]}return s.invert=function(u,h){var _=r-h,x=Gl(n)*Oa(u*u+_*_),M=kh(u,er(_))*Gl(_);return _*n<0&&(M-=si*Gl(u)*Gl(_)),[M/n,2*y0(CA(r/x,1/n))-Jr]},s}function Eae(){return WA(Cae).scale(109.5).parallels([30,30])}function AM(e,t){return[e,t]}function Mae(){return Mp(AM).scale(152.63)}function Dae(e,t){var i=ti(e),n=e===t?Gn(e):(i-ti(t))/(t-e),r=i/n+e;if(er(n)<Wn)return AM;function s(u,h){var _=r-h,x=n*u;return[_*Gn(x),r-_*ti(x)]}return s.invert=function(u,h){var _=r-h,x=kh(u,er(_))*Gl(_);return _*n<0&&(x-=si*Gl(u)*Gl(_)),[x/n,r-Gl(n)*Oa(u*u+_*_)]},s}function Tae(){return WA(Dae).scale(131.154).center([0,13.9389])}b6.invert=Jx(function(e){return e}),SM.invert=function(e,t){return[e,2*y0(MB(t))-Jr]},AM.invert=AM;var e1=1.340264,t1=-.081106,n1=893e-6,r1=.003796,PM=Oa(3)/2;function w6(e,t){var i=ql(PM*Gn(t)),n=i*i,r=n*n*n;return[e*ti(i)/(PM*(e1+3*t1*n+r*(7*n1+9*r1*n))),i*(e1+t1*n+r*(n1+r1*n))]}function Iae(){return Mp(w6).scale(177.158)}function C6(e,t){var i=ti(t),n=ti(e)*i;return[i*Gn(e)/n,Gn(t)/n]}function Aae(){return Mp(C6).scale(144.049).clipAngle(60)}function E6(e,t){return[ti(t)*Gn(e),Gn(t)]}function Pae(){return Mp(E6).scale(249.5).clipAngle(90+Wn)}function M6(e,t){var i=ti(t),n=1+ti(e)*i;return[i*Gn(e)/n,Gn(t)/n]}function Oae(){return Mp(M6).scale(250).clipAngle(142)}function D6(e,t){return[dM(EA((Jr+t)/2)),-e]}function kae(){var e=x6(D6),t=e.center,i=e.rotate;return e.center=function(n){return arguments.length?t([-n[1],n[0]]):[(n=t())[1],-n[0]]},e.rotate=function(n){return arguments.length?i([n[0],n[1],n.length>2?n[2]+90:90]):[(n=i())[0],n[1],n[2]-90]},i([0,0,90]).scale(159.155)}function ZA(e,t){return e=+e,t=+t,function(i){return Math.round(e*(1-i)+t*i)}}function T6(e){return function(t,i){var n=e((t=fA(t)).h,(i=fA(i)).h),r=$o(t.s,i.s),s=$o(t.l,i.l),u=$o(t.opacity,i.opacity);return function(h){return t.h=n(h),t.s=r(h),t.l=s(h),t.opacity=u(h),t+""}}}w6.invert=function(e,t){for(var u,i=t,n=i*i,r=n*n*n,s=0;s<12&&(r=(n=(i-=u=(i*(e1+t1*n+r*(n1+r1*n))-t)/(e1+3*t1*n+r*(7*n1+9*r1*n)))*i)*n*n,!(er(u)<CB));++s);return[PM*e*(e1+3*t1*n+r*(7*n1+9*r1*n))/ti(i),ql(Gn(i)/PM)]},C6.invert=Jx(y0),E6.invert=Jx(ql),M6.invert=Jx(function(e){return 2*y0(e)}),D6.invert=function(e,t){return[-t,2*y0(MB(e))-Jr]};const Rae=T6(mA);T6($o);const S6=Math.PI/180,I6=180/Math.PI,A6=.96422,P6=1,O6=.82521,k6=4/29,w0=6/29,R6=3*w0*w0,Lae=w0*w0*w0;function L6(e){if(e instanceof Yc)return new Yc(e.l,e.a,e.b,e.opacity);if(e instanceof hd)return N6(e);e instanceof jo||(e=hA(e));var s,u,t=JA(e.r),i=JA(e.g),n=JA(e.b),r=YA((.2225045*t+.7168786*i+.0606169*n)/P6);return t===i&&i===n?s=u=r:(s=YA((.4360747*t+.3850649*i+.1430804*n)/A6),u=YA((.0139322*t+.0971045*i+.7141733*n)/O6)),new Yc(116*r-16,500*(s-r),200*(r-u),e.opacity)}function XA(e,t,i,n){return 1===arguments.length?L6(e):new Yc(e,t,i,n??1)}function Yc(e,t,i,n){this.l=+e,this.a=+t,this.b=+i,this.opacity=+n}function YA(e){return e>Lae?Math.pow(e,1/3):e/R6+k6}function KA(e){return e>w0?e*e*e:R6*(e-k6)}function QA(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function JA(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function eP(e,t,i,n){return 1===arguments.length?function F6(e){if(e instanceof hd)return new hd(e.h,e.c,e.l,e.opacity);if(e instanceof Yc||(e=L6(e)),0===e.a&&0===e.b)return new hd(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*I6;return new hd(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}(e):new hd(e,t,i,n??1)}function hd(e,t,i,n){this.h=+e,this.c=+t,this.l=+i,this.opacity=+n}function N6(e){if(isNaN(e.h))return new Yc(e.l,0,0,e.opacity);var t=e.h*S6;return new Yc(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function z6(e){return function(t,i){var n=e((t=eP(t)).h,(i=eP(i)).h),r=$o(t.c,i.c),s=$o(t.l,i.l),u=$o(t.opacity,i.opacity);return function(h){return t.h=n(h),t.c=r(h),t.l=s(h),t.opacity=u(h),t+""}}}h0(Yc,XA,jx(xp,{brighter(e){return new Yc(this.l+18*(e??1),this.a,this.b,this.opacity)},darker(e){return new Yc(this.l-18*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,i=isNaN(this.b)?e:e-this.b/200;return new jo(QA(3.1338561*(t=A6*KA(t))-1.6168667*(e=P6*KA(e))-.4906146*(i=O6*KA(i))),QA(-.9787684*t+1.9161415*e+.033454*i),QA(.0719453*t-.2289914*e+1.4052427*i),this.opacity)}})),h0(hd,eP,jx(xp,{brighter(e){return new hd(this.h,this.c,this.l+18*(e??1),this.opacity)},darker(e){return new hd(this.h,this.c,this.l-18*(e??1),this.opacity)},rgb(){return N6(this).rgb()}}));const Nae=z6(mA);function B6(e,t){var u,i=t?t.length:0,n=e?Math.min(i,e.length):0,r=new Array(n),s=new Array(i);for(u=0;u<n;++u)r[u]=o1(e[u],t[u]);for(;u<i;++u)s[u]=t[u];return function(h){for(u=0;u<n;++u)s[u]=r[u](h);return s}}function zae(e,t){var i=new Date;return e=+e,t=+t,function(n){return i.setTime(e*(1-n)+t*n),i}}function Bae(e,t){var r,i={},n={};for(r in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)r in e?i[r]=o1(e[r],t[r]):n[r]=t[r];return function(s){for(r in i)n[r]=i[r](s);return n}}function Vae(e,t){t||(t=[]);var r,i=e?Math.min(t.length,e.length):0,n=t.slice();return function(s){for(r=0;r<i;++r)n[r]=e[r]*(1-s)+t[r]*s;return n}}function o1(e,t){var n,i=typeof t;return null==t||"boolean"===i?sM(t):("number"===i?As:"string"===i?(n=wp(t))?(t=n,_g):aB:t instanceof wp?_g:t instanceof Date?zae:function Uae(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?Vae:Array.isArray(t)?B6:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Bae:As)(e,t)}function kM(e,t){void 0===t&&(t=e,e=o1);for(var i=0,n=t.length-1,r=t[0],s=new Array(n<0?0:n);i<n;)s[i]=e(r,r=t[++i]);return function(u){var h=Math.max(0,Math.min(n-1,Math.floor(u*=n)));return s[h](u-h)}}function Kc(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e(n/(t-1));return i}z6($o);const tP=Math.PI,nP=2*tP,bg=1e-6,jae=nP-bg;function V6(e){this._+=e[0];for(let t=1,i=e.length;t<i;++t)this._+=arguments[t]+e[t]}class iP{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?V6:function $ae(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return V6;const i=10**t;return function(n){this._+=n[0];for(let r=1,s=n.length;r<s;++r)this._+=Math.round(arguments[r]*i)/i+n[r]}}(t)}moveTo(t,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,i){this._append`L${this._x1=+t},${this._y1=+i}`}quadraticCurveTo(t,i,n,r){this._append`Q${+t},${+i},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(t,i,n,r,s,u){this._append`C${+t},${+i},${+n},${+r},${this._x1=+s},${this._y1=+u}`}arcTo(t,i,n,r,s){if(t=+t,i=+i,n=+n,r=+r,(s=+s)<0)throw new Error(`negative radius: ${s}`);let u=this._x1,h=this._y1,_=n-t,x=r-i,M=u-t,S=h-i,P=M*M+S*S;if(null===this._x1)this._append`M${this._x1=t},${this._y1=i}`;else if(P>bg)if(Math.abs(S*_-x*M)>bg&&s){let F=n-u,$=r-h,W=_*_+x*x,X=F*F+$*$,K=Math.sqrt(W),Q=Math.sqrt(P),he=s*Math.tan((tP-Math.acos((W+P-X)/(2*K*Q)))/2),le=he/Q,ye=he/K;Math.abs(le-1)>bg&&this._append`L${t+le*M},${i+le*S}`,this._append`A${s},${s},0,0,${+(S*F>M*$)},${this._x1=t+ye*_},${this._y1=i+ye*x}`}else this._append`L${this._x1=t},${this._y1=i}`}arc(t,i,n,r,s,u){if(t=+t,i=+i,u=!!u,(n=+n)<0)throw new Error(`negative radius: ${n}`);let h=n*Math.cos(r),_=n*Math.sin(r),x=t+h,M=i+_,S=1^u,P=u?r-s:s-r;null===this._x1?this._append`M${x},${M}`:(Math.abs(this._x1-x)>bg||Math.abs(this._y1-M)>bg)&&this._append`L${x},${M}`,n&&(P<0&&(P=P%nP+nP),P>jae?this._append`A${n},${n},0,1,${S},${t-h},${i-_}A${n},${n},0,1,${S},${this._x1=x},${this._y1=M}`:P>bg&&this._append`A${n},${n},0,${+(P>=tP)},${S},${this._x1=t+n*Math.cos(s)},${this._y1=i+n*Math.sin(s)}`)}rect(t,i,n,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}}function rP(e=3){return new iP(+e)}function fd(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function RM(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const oP=Symbol("implicit");function sP(){var e=new hg,t=[],i=[],n=oP;function r(s){let u=e.get(s);if(void 0===u){if(n!==oP)return n;e.set(s,u=t.push(s)-1)}return i[u%i.length]}return r.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new hg;for(const u of s)e.has(u)||e.set(u,t.push(u)-1);return r},r.range=function(s){return arguments.length?(i=Array.from(s),r):i.slice()},r.unknown=function(s){return arguments.length?(n=s,r):n},r.copy=function(){return sP(t,i).unknown(n)},fd.apply(r,arguments),r}function LM(){var s,u,e=sP().unknown(void 0),t=e.domain,i=e.range,n=0,r=1,h=!1,_=0,x=0,M=.5;function S(){var P=t().length,F=r<n,$=F?r:n,W=F?n:r;s=(W-$)/Math.max(1,P-_+2*x),h&&(s=Math.floor(s)),$+=(W-$-s*(P-_))*M,u=s*(1-_),h&&($=Math.round($),u=Math.round(u));var X=JI(P).map(function(K){return $+s*K});return i(F?X.reverse():X)}return delete e.unknown,e.domain=function(P){return arguments.length?(t(P),S()):t()},e.range=function(P){return arguments.length?([n,r]=P,n=+n,r=+r,S()):[n,r]},e.rangeRound=function(P){return[n,r]=P,n=+n,r=+r,h=!0,S()},e.bandwidth=function(){return u},e.step=function(){return s},e.round=function(P){return arguments.length?(h=!!P,S()):h},e.padding=function(P){return arguments.length?(_=Math.min(1,x=+P),S()):_},e.paddingInner=function(P){return arguments.length?(_=Math.min(1,P),S()):_},e.paddingOuter=function(P){return arguments.length?(x=+P,S()):x},e.align=function(P){return arguments.length?(M=Math.max(0,Math.min(1,P)),S()):M},e.copy=function(){return LM(t(),[n,r]).round(h).paddingInner(_).paddingOuter(x).align(M)},fd.apply(S(),arguments)}function U6(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return U6(t())},e}function Gae(){return U6(LM.apply(null,arguments).paddingInner(1))}function aP(e){return+e}var j6=[0,1];function Zl(e){return e}function lP(e,t){return(t-=e=+e)?function(i){return(i-e)/t}:function qae(e){return function(){return e}}(isNaN(t)?NaN:.5)}function Zae(e,t,i){var n=e[0],r=e[1],s=t[0],u=t[1];return r<n?(n=lP(r,n),s=i(u,s)):(n=lP(n,r),s=i(s,u)),function(h){return s(n(h))}}function Xae(e,t,i){var n=Math.min(e.length,t.length)-1,r=new Array(n),s=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++u<n;)r[u]=lP(e[u],e[u+1]),s[u]=i(t[u],t[u+1]);return function(h){var _=FE(e,h,1,n)-1;return s[_](r[_](h))}}function s1(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function FM(){var n,r,s,h,_,x,e=j6,t=j6,i=o1,u=Zl;function M(){var P=Math.min(e.length,t.length);return u!==Zl&&(u=function Wae(e,t){var i;return e>t&&(i=e,e=t,t=i),function(n){return Math.max(e,Math.min(t,n))}}(e[0],e[P-1])),h=P>2?Xae:Zae,_=x=null,S}function S(P){return null==P||isNaN(P=+P)?s:(_||(_=h(e.map(n),t,i)))(n(u(P)))}return S.invert=function(P){return u(r((x||(x=h(t,e.map(n),As)))(P)))},S.domain=function(P){return arguments.length?(e=Array.from(P,aP),M()):e.slice()},S.range=function(P){return arguments.length?(t=Array.from(P),M()):t.slice()},S.rangeRound=function(P){return t=Array.from(P),i=ZA,M()},S.clamp=function(P){return arguments.length?(u=!!P||Zl,M()):u!==Zl},S.interpolate=function(P){return arguments.length?(i=P,M()):i},S.unknown=function(P){return arguments.length?(s=P,S):s},function(P,F){return n=P,r=F,M()}}function $6(){return FM()(Zl,Zl)}function a1(e){var t=e.domain;return e.ticks=function(i){var n=t();return Lx(n[0],n[n.length-1],i??10)},e.tickFormat=function(i,n){var r=t();return function Jae(e,t,i,n){var s,r=eA(e,t,i);switch((n=Gx(n??",f")).type){case"s":var u=Math.max(Math.abs(e),Math.abs(t));return null==n.precision&&!isNaN(s=function Yae(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(_0(t)/3)))-_0(Math.abs(e)))}(r,u))&&(n.precision=s),wB(n,u);case"":case"e":case"g":case"p":case"r":null==n.precision&&!isNaN(s=function Kae(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,_0(t)-_0(e))+1}(r,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=s-("e"===n.type));break;case"f":case"%":null==n.precision&&!isNaN(s=function Qae(e){return Math.max(0,-_0(Math.abs(e)))}(r))&&(n.precision=s-2*("%"===n.type))}return qx(n)}(r[0],r[r.length-1],i??10,n)},e.nice=function(i){null==i&&(i=10);var _,x,n=t(),r=0,s=n.length-1,u=n[r],h=n[s],M=10;for(h<u&&(x=u,u=h,h=x,x=r,r=s,s=x);M-- >0;){if((x=VE(u,h,i))===_)return n[r]=u,n[s]=h,t(n);if(x>0)u=Math.floor(u/x)*x,h=Math.ceil(h/x)*x;else{if(!(x<0))break;u=Math.ceil(u*x)/x,h=Math.floor(h*x)/x}_=x}return e},e}function cP(){var e=$6();return e.copy=function(){return s1(e,cP())},fd.apply(e,arguments),a1(e)}function H6(e){var t;function i(n){return null==n||isNaN(n=+n)?t:n}return i.invert=i,i.domain=i.range=function(n){return arguments.length?(e=Array.from(n,aP),i):e.slice()},i.unknown=function(n){return arguments.length?(t=n,i):t},i.copy=function(){return H6(e).unknown(t)},e=arguments.length?Array.from(e,aP):[0,1],a1(i)}function G6(e,t){var u,i=0,n=(e=e.slice()).length-1,r=e[i],s=e[n];return s<r&&(u=i,i=n,n=u,u=r,r=s,s=u),e[i]=t.floor(r),e[n]=t.ceil(s),e}function q6(e){return Math.log(e)}function W6(e){return Math.exp(e)}function ele(e){return-Math.log(-e)}function tle(e){return-Math.exp(-e)}function nle(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Z6(e){return(t,i)=>-e(-t,i)}function X6(e){const t=e(q6,W6),i=t.domain;let r,s,n=10;function u(){return r=function rle(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(n),s=function ile(e){return 10===e?nle:e===Math.E?Math.exp:t=>Math.pow(e,t)}(n),i()[0]<0?(r=Z6(r),s=Z6(s),e(ele,tle)):e(q6,W6),t}return t.base=function(h){return arguments.length?(n=+h,u()):n},t.domain=function(h){return arguments.length?(i(h),u()):i()},t.ticks=h=>{const _=i();let x=_[0],M=_[_.length-1];const S=M<x;S&&([x,M]=[M,x]);let $,W,P=r(x),F=r(M);const X=null==h?10:+h;let K=[];if(!(n%1)&&F-P<X){if(P=Math.floor(P),F=Math.ceil(F),x>0){for(;P<=F;++P)for($=1;$<n;++$)if(W=P<0?$/s(-P):$*s(P),!(W<x)){if(W>M)break;K.push(W)}}else for(;P<=F;++P)for($=n-1;$>=1;--$)if(W=P>0?$/s(-P):$*s(P),!(W<x)){if(W>M)break;K.push(W)}2*K.length<X&&(K=Lx(x,M,X))}else K=Lx(P,F,Math.min(F-P,X)).map(s);return S?K.reverse():K},t.tickFormat=(h,_)=>{if(null==h&&(h=10),null==_&&(_=10===n?"s":","),"function"!=typeof _&&(!(n%1)&&null==(_=Gx(_)).precision&&(_.trim=!0),_=qx(_)),h===1/0)return _;const x=Math.max(1,n*h/t.ticks().length);return M=>{let S=M/s(Math.round(r(M)));return S*n<n-.5&&(S*=n),S<=x?_(M):""}},t.nice=()=>i(G6(i(),{floor:h=>s(Math.floor(r(h))),ceil:h=>s(Math.ceil(r(h)))})),t}function Y6(){const e=X6(FM()).domain([1,10]);return e.copy=()=>s1(e,Y6()).base(e.base()),fd.apply(e,arguments),e}function K6(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Q6(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function J6(e){var t=1,i=e(K6(t),Q6(t));return i.constant=function(n){return arguments.length?e(K6(t=+n),Q6(t)):t},a1(i)}function e8(){var e=J6(FM());return e.copy=function(){return s1(e,e8()).constant(e.constant())},fd.apply(e,arguments)}function t8(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ole(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function sle(e){return e<0?-e*e:e*e}function n8(e){var t=e(Zl,Zl),i=1;return t.exponent=function(r){return arguments.length?(i=+r,function n(){return 1===i?e(Zl,Zl):.5===i?e(ole,sle):e(t8(i),t8(1/i))}()):i},a1(t)}function uP(){var e=n8(FM());return e.copy=function(){return s1(e,uP()).exponent(e.exponent())},fd.apply(e,arguments),e}function i8(){var n,e=[],t=[],i=[];function r(){var u=0,h=Math.max(1,t.length);for(i=new Array(h-1);++u<h;)i[u-1]=qne(e,u/h);return s}function s(u){return null==u||isNaN(u=+u)?n:t[FE(i,u)]}return s.invertExtent=function(u){var h=t.indexOf(u);return h<0?[NaN,NaN]:[h>0?i[h-1]:e[0],h<i.length?i[h]:e[e.length-1]]},s.domain=function(u){if(!arguments.length)return e.slice();e=[];for(let h of u)null!=h&&!isNaN(h=+h)&&e.push(h);return e.sort(Pa),r()},s.range=function(u){return arguments.length?(t=Array.from(u),r()):t.slice()},s.unknown=function(u){return arguments.length?(n=u,s):n},s.quantiles=function(){return i.slice()},s.copy=function(){return i8().domain(e).range(t).unknown(n)},fd.apply(s,arguments)}function r8(){var i,e=[.5],t=[0,1],n=1;function r(s){return null!=s&&s<=s?t[FE(e,s,0,n)]:i}return r.domain=function(s){return arguments.length?(e=Array.from(s),n=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(s){return arguments.length?(t=Array.from(s),n=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(s){var u=t.indexOf(s);return[e[u-1],e[u]]},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return r8().domain(e).range(t).unknown(i)},fd.apply(r,arguments)}const Lh=1e3,Xl=6e4,Fh=60*Xl,Nh=24*Fh,dP=7*Nh,o8=30*Nh,hP=365*Nh,fP=new Date,pP=new Date;function Ao(e,t,i,n){function r(s){return e(s=0===arguments.length?new Date:new Date(+s)),s}return r.floor=s=>(e(s=new Date(+s)),s),r.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),r.round=s=>{const u=r(s),h=r.ceil(s);return s-u<h-s?u:h},r.offset=(s,u)=>(t(s=new Date(+s),null==u?1:Math.floor(u)),s),r.range=(s,u,h)=>{const _=[];if(s=r.ceil(s),h=null==h?1:Math.floor(h),!(s<u&&h>0))return _;let x;do{_.push(x=new Date(+s)),t(s,h),e(s)}while(x<s&&s<u);return _},r.filter=s=>Ao(u=>{if(u>=u)for(;e(u),!s(u);)u.setTime(u-1)},(u,h)=>{if(u>=u)if(h<0)for(;++h<=0;)for(;t(u,-1),!s(u););else for(;--h>=0;)for(;t(u,1),!s(u););}),i&&(r.count=(s,u)=>(fP.setTime(+s),pP.setTime(+u),e(fP),e(pP),Math.floor(i(fP,pP))),r.every=s=>(s=Math.floor(s),isFinite(s)&&s>0?s>1?r.filter(n?u=>n(u)%s==0:u=>r.count(0,u)%s==0):r:null)),r}const NM=Ao(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);NM.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?Ao(t=>{t.setTime(Math.floor(t/e)*e)},(t,i)=>{t.setTime(+t+i*e)},(t,i)=>(i-t)/e):NM:null);const zh=Ao(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Lh)},(e,t)=>(t-e)/Lh,e=>e.getUTCSeconds()),zM=Ao(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Lh)},(e,t)=>{e.setTime(+e+t*Xl)},(e,t)=>(t-e)/Xl,e=>e.getMinutes()),BM=Ao(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Xl)},(e,t)=>(t-e)/Xl,e=>e.getUTCMinutes()),VM=Ao(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Lh-e.getMinutes()*Xl)},(e,t)=>{e.setTime(+e+t*Fh)},(e,t)=>(t-e)/Fh,e=>e.getHours()),UM=Ao(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Fh)},(e,t)=>(t-e)/Fh,e=>e.getUTCHours()),C0=Ao(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Xl)/Nh,e=>e.getDate()-1),jM=Ao(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Nh,e=>e.getUTCDate()-1),mP=Ao(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Nh,e=>Math.floor(e/Nh));function xg(e){return Ao(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,i)=>{t.setDate(t.getDate()+7*i)},(t,i)=>(i-t-(i.getTimezoneOffset()-t.getTimezoneOffset())*Xl)/dP)}const E0=xg(0),l1=xg(1),s8=xg(2),a8=xg(3),wg=xg(4),l8=xg(5),c8=xg(6);function Cg(e){return Ao(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,i)=>{t.setUTCDate(t.getUTCDate()+7*i)},(t,i)=>(i-t)/dP)}const M0=Cg(0),c1=Cg(1),u8=Cg(2),d8=Cg(3),Eg=Cg(4),h8=Cg(5),f8=Cg(6),$M=Ao(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear()),e=>e.getMonth()),HM=Ao(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear()),e=>e.getUTCMonth()),Qc=Ao(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Qc.every=e=>isFinite(e=Math.floor(e))&&e>0?Ao(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,i)=>{t.setFullYear(t.getFullYear()+i*e)}):null;const Jc=Ao(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());function p8(e,t,i,n,r,s){const u=[[zh,1,Lh],[zh,5,5e3],[zh,15,15e3],[zh,30,3e4],[s,1,Xl],[s,5,5*Xl],[s,15,15*Xl],[s,30,30*Xl],[r,1,Fh],[r,3,3*Fh],[r,6,6*Fh],[r,12,12*Fh],[n,1,Nh],[n,2,2*Nh],[i,1,dP],[t,1,o8],[t,3,3*o8],[e,1,hP]];function _(x,M,S){const P=Math.abs(M-x)/S,F=Ox(([,,X])=>X).right(u,P);if(F===u.length)return e.every(eA(x/hP,M/hP,S));if(0===F)return NM.every(Math.max(eA(x,M,S),1));const[$,W]=u[P/u[F-1][2]<u[F][2]/P?F-1:F];return $.every(W)}return[function h(x,M,S){const P=M<x;P&&([x,M]=[M,x]);const F=S&&"function"==typeof S.range?S:_(x,M,S),$=F?F.range(x,+M+1):[];return P?$.reverse():$},_]}Jc.every=e=>isFinite(e=Math.floor(e))&&e>0?Ao(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,i)=>{t.setUTCFullYear(t.getUTCFullYear()+i*e)}):null;const[ale,m8]=p8(Jc,HM,M0,mP,UM,BM),[lle,cle]=p8(Qc,$M,E0,C0,VM,zM);function gP(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function _P(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function u1(e,t,i){return{y:e,m:t,d:i,H:0,M:0,S:0,L:0}}var D0,GM,f1,g8={"-":"",_:" ",0:"0"},Ho=/^\s*\d+/,dle=/^%/,hle=/[\\^$*+?|[\]().{}]/g;function Li(e,t,i){var n=e<0?"-":"",r=(n?-e:e)+"",s=r.length;return n+(s<i?new Array(i-s+1).join(t)+r:r)}function fle(e){return e.replace(hle,"\\$&")}function d1(e){return new RegExp("^(?:"+e.map(fle).join("|")+")","i")}function h1(e){return new Map(e.map((t,i)=>[t.toLowerCase(),i]))}function ple(e,t,i){var n=Ho.exec(t.slice(i,i+1));return n?(e.w=+n[0],i+n[0].length):-1}function mle(e,t,i){var n=Ho.exec(t.slice(i,i+1));return n?(e.u=+n[0],i+n[0].length):-1}function gle(e,t,i){var n=Ho.exec(t.slice(i,i+2));return n?(e.U=+n[0],i+n[0].length):-1}function _le(e,t,i){var n=Ho.exec(t.slice(i,i+2));return n?(e.V=+n[0],i+n[0].length):-1}function yle(e,t,i){var n=Ho.exec(t.slice(i,i+2));return n?(e.W=+n[0],i+n[0].length):-1}function _8(e,t,i){var n=Ho.exec(t.slice(i,i+4));return n?(e.y=+n[0],i+n[0].length):-1}function y8(e,t,i){var n=Ho.exec(t.slice(i,i+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function vle(e,t,i){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(i,i+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function ble(e,t,i){var n=Ho.exec(t.slice(i,i+1));return n?(e.q=3*n[0]-3,i+n[0].length):-1}function xle(e,t,i){var n=Ho.exec(t.slice(i,i+2));return n?(e.m=n[0]-1,i+n[0].length):-1}function v8(e,t,i){var n=Ho.exec(t.slice(i,i+2));return n?(e.d=+n[0],i+n[0].length):-1}function wle(e,t,i){var n=Ho.exec(t.slice(i,i+3));return n?(e.m=0,e.d=+n[0],i+n[0].length):-1}function b8(e,t,i){var n=Ho.exec(t.slice(i,i+2));return n?(e.H=+n[0],i+n[0].length):-1}function Cle(e,t,i){var n=Ho.exec(t.slice(i,i+2));return n?(e.M=+n[0],i+n[0].length):-1}function Ele(e,t,i){var n=Ho.exec(t.slice(i,i+2));return n?(e.S=+n[0],i+n[0].length):-1}function Mle(e,t,i){var n=Ho.exec(t.slice(i,i+3));return n?(e.L=+n[0],i+n[0].length):-1}function Dle(e,t,i){var n=Ho.exec(t.slice(i,i+6));return n?(e.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function Tle(e,t,i){var n=dle.exec(t.slice(i,i+1));return n?i+n[0].length:-1}function Sle(e,t,i){var n=Ho.exec(t.slice(i));return n?(e.Q=+n[0],i+n[0].length):-1}function Ile(e,t,i){var n=Ho.exec(t.slice(i));return n?(e.s=+n[0],i+n[0].length):-1}function x8(e,t){return Li(e.getDate(),t,2)}function Ale(e,t){return Li(e.getHours(),t,2)}function Ple(e,t){return Li(e.getHours()%12||12,t,2)}function Ole(e,t){return Li(1+C0.count(Qc(e),e),t,3)}function w8(e,t){return Li(e.getMilliseconds(),t,3)}function kle(e,t){return w8(e,t)+"000"}function Rle(e,t){return Li(e.getMonth()+1,t,2)}function Lle(e,t){return Li(e.getMinutes(),t,2)}function Fle(e,t){return Li(e.getSeconds(),t,2)}function Nle(e){var t=e.getDay();return 0===t?7:t}function zle(e,t){return Li(E0.count(Qc(e)-1,e),t,2)}function C8(e){var t=e.getDay();return t>=4||0===t?wg(e):wg.ceil(e)}function Ble(e,t){return e=C8(e),Li(wg.count(Qc(e),e)+(4===Qc(e).getDay()),t,2)}function Vle(e){return e.getDay()}function Ule(e,t){return Li(l1.count(Qc(e)-1,e),t,2)}function jle(e,t){return Li(e.getFullYear()%100,t,2)}function $le(e,t){return Li((e=C8(e)).getFullYear()%100,t,2)}function Hle(e,t){return Li(e.getFullYear()%1e4,t,4)}function Gle(e,t){var i=e.getDay();return Li((e=i>=4||0===i?wg(e):wg.ceil(e)).getFullYear()%1e4,t,4)}function qle(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Li(t/60|0,"0",2)+Li(t%60,"0",2)}function E8(e,t){return Li(e.getUTCDate(),t,2)}function Wle(e,t){return Li(e.getUTCHours(),t,2)}function Zle(e,t){return Li(e.getUTCHours()%12||12,t,2)}function Xle(e,t){return Li(1+jM.count(Jc(e),e),t,3)}function M8(e,t){return Li(e.getUTCMilliseconds(),t,3)}function Yle(e,t){return M8(e,t)+"000"}function Kle(e,t){return Li(e.getUTCMonth()+1,t,2)}function Qle(e,t){return Li(e.getUTCMinutes(),t,2)}function Jle(e,t){return Li(e.getUTCSeconds(),t,2)}function ece(e){var t=e.getUTCDay();return 0===t?7:t}function tce(e,t){return Li(M0.count(Jc(e)-1,e),t,2)}function D8(e){var t=e.getUTCDay();return t>=4||0===t?Eg(e):Eg.ceil(e)}function nce(e,t){return e=D8(e),Li(Eg.count(Jc(e),e)+(4===Jc(e).getUTCDay()),t,2)}function ice(e){return e.getUTCDay()}function rce(e,t){return Li(c1.count(Jc(e)-1,e),t,2)}function oce(e,t){return Li(e.getUTCFullYear()%100,t,2)}function sce(e,t){return Li((e=D8(e)).getUTCFullYear()%100,t,2)}function ace(e,t){return Li(e.getUTCFullYear()%1e4,t,4)}function lce(e,t){var i=e.getUTCDay();return Li((e=i>=4||0===i?Eg(e):Eg.ceil(e)).getUTCFullYear()%1e4,t,4)}function cce(){return"+0000"}function T8(){return"%"}function S8(e){return+e}function I8(e){return Math.floor(+e/1e3)}function fce(e){return new Date(e)}function pce(e){return e instanceof Date?+e:+new Date(+e)}function yP(e,t,i,n,r,s,u,h,_,x){var M=$6(),S=M.invert,P=M.domain,F=x(".%L"),$=x(":%S"),W=x("%I:%M"),X=x("%I %p"),K=x("%a %d"),Q=x("%b %d"),he=x("%B"),le=x("%Y");function ye(Se){return(_(Se)<Se?F:h(Se)<Se?$:u(Se)<Se?W:s(Se)<Se?X:n(Se)<Se?r(Se)<Se?K:Q:i(Se)<Se?he:le)(Se)}return M.invert=function(Se){return new Date(S(Se))},M.domain=function(Se){return arguments.length?P(Array.from(Se,pce)):P().map(fce)},M.ticks=function(Se){var Ue=P();return e(Ue[0],Ue[Ue.length-1],Se??10)},M.tickFormat=function(Se,Ue){return null==Ue?ye:x(Ue)},M.nice=function(Se){var Ue=P();return(!Se||"function"!=typeof Se.range)&&(Se=t(Ue[0],Ue[Ue.length-1],Se??10)),Se?P(G6(Ue,Se)):M},M.copy=function(){return s1(M,yP(e,t,i,n,r,s,u,h,_,x))},M}function Dp(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function WM(){var r,s,u,h,_,M,P,e=0,t=.5,i=1,n=1,x=Zl,S=!1;function F(W){return isNaN(W=+W)?P:(W=.5+((W=+M(W))-s)*(n*W<n*s?h:_),x(S?Math.max(0,Math.min(1,W)):W))}function $(W){return function(X){var K,Q,he;return arguments.length?([K,Q,he]=X,x=kM(W,[K,Q,he]),F):[x(0),x(.5),x(1)]}}return F.domain=function(W){return arguments.length?([e,t,i]=W,r=M(e=+e),s=M(t=+t),u=M(i=+i),h=r===s?0:.5/(s-r),_=s===u?0:.5/(u-s),n=s<r?-1:1,F):[e,t,i]},F.clamp=function(W){return arguments.length?(S=!!W,F):S},F.interpolator=function(W){return arguments.length?(x=W,F):x},F.range=$(o1),F.rangeRound=$(ZA),F.unknown=function(W){return arguments.length?(P=W,F):P},function(W){return M=W,r=W(e),s=W(t),u=W(i),h=r===s?0:.5/(s-r),_=s===u?0:.5/(u-s),n=s<r?-1:1,F}}function P8(){var e=a1(WM()(Zl));return e.copy=function(){return Dp(e,P8())},RM.apply(e,arguments)}function O8(){var e=X6(WM()).domain([.1,1,10]);return e.copy=function(){return Dp(e,O8()).base(e.base())},RM.apply(e,arguments)}function k8(){var e=J6(WM());return e.copy=function(){return Dp(e,k8()).constant(e.constant())},RM.apply(e,arguments)}function vP(){var e=n8(WM());return e.copy=function(){return Dp(e,vP()).exponent(e.exponent())},RM.apply(e,arguments)}function Zn(e){for(var t=e.length/6|0,i=new Array(t),n=0;n<t;)i[n]="#"+e.slice(6*n,6*++n);return i}!function hce(e){D0=function ule(e){var t=e.dateTime,i=e.date,n=e.time,r=e.periods,s=e.days,u=e.shortDays,h=e.months,_=e.shortMonths,x=d1(r),M=h1(r),S=d1(s),P=h1(s),F=d1(u),$=h1(u),W=d1(h),X=h1(h),K=d1(_),Q=h1(_),he={a:function je(ot){return u[ot.getDay()]},A:function rt(ot){return s[ot.getDay()]},b:function Ke(ot){return _[ot.getMonth()]},B:function wt(ot){return h[ot.getMonth()]},c:null,d:x8,e:x8,f:kle,g:$le,G:Gle,H:Ale,I:Ple,j:Ole,L:w8,m:Rle,M:Lle,p:function It(ot){return r[+(ot.getHours()>=12)]},q:function At(ot){return 1+~~(ot.getMonth()/3)},Q:S8,s:I8,S:Fle,u:Nle,U:zle,V:Ble,w:Vle,W:Ule,x:null,X:null,y:jle,Y:Hle,Z:qle,"%":T8},le={a:function rn(ot){return u[ot.getUTCDay()]},A:function vn(ot){return s[ot.getUTCDay()]},b:function pi(ot){return _[ot.getUTCMonth()]},B:function pr(ot){return h[ot.getUTCMonth()]},c:null,d:E8,e:E8,f:Yle,g:sce,G:lce,H:Wle,I:Zle,j:Xle,L:M8,m:Kle,M:Qle,p:function Wt(ot){return r[+(ot.getUTCHours()>=12)]},q:function Kt(ot){return 1+~~(ot.getUTCMonth()/3)},Q:S8,s:I8,S:Jle,u:ece,U:tce,V:nce,w:ice,W:rce,x:null,X:null,y:oce,Y:ace,Z:cce,"%":T8},ye={a:function bt(ot,Qt,tn){var tt=F.exec(Qt.slice(tn));return tt?(ot.w=$.get(tt[0].toLowerCase()),tn+tt[0].length):-1},A:function qe(ot,Qt,tn){var tt=S.exec(Qt.slice(tn));return tt?(ot.w=P.get(tt[0].toLowerCase()),tn+tt[0].length):-1},b:function St(ot,Qt,tn){var tt=K.exec(Qt.slice(tn));return tt?(ot.m=Q.get(tt[0].toLowerCase()),tn+tt[0].length):-1},B:function Nt(ot,Qt,tn){var tt=W.exec(Qt.slice(tn));return tt?(ot.m=X.get(tt[0].toLowerCase()),tn+tt[0].length):-1},c:function Ee(ot,Qt,tn){return Xe(ot,t,Qt,tn)},d:v8,e:v8,f:Dle,g:y8,G:_8,H:b8,I:b8,j:wle,L:Mle,m:xle,M:Cle,p:function mt(ot,Qt,tn){var tt=x.exec(Qt.slice(tn));return tt?(ot.p=M.get(tt[0].toLowerCase()),tn+tt[0].length):-1},q:ble,Q:Sle,s:Ile,S:Ele,u:mle,U:gle,V:_le,w:ple,W:yle,x:function Ie(ot,Qt,tn){return Xe(ot,i,Qt,tn)},X:function Ce(ot,Qt,tn){return Xe(ot,n,Qt,tn)},y:y8,Y:_8,Z:vle,"%":Tle};function Se(ot,Qt){return function(tn){var ci,nn,mr,tt=[],hn=-1,Bn=0,Ii=ot.length;for(tn instanceof Date||(tn=new Date(+tn));++hn<Ii;)37===ot.charCodeAt(hn)&&(tt.push(ot.slice(Bn,hn)),null!=(nn=g8[ci=ot.charAt(++hn)])?ci=ot.charAt(++hn):nn="e"===ci?" ":"0",(mr=Qt[ci])&&(ci=mr(tn,nn)),tt.push(ci),Bn=hn+1);return tt.push(ot.slice(Bn,hn)),tt.join("")}}function Ue(ot,Qt){return function(tn){var Bn,Ii,tt=u1(1900,void 0,1);if(Xe(tt,ot,tn+="",0)!=tn.length)return null;if("Q"in tt)return new Date(tt.Q);if("s"in tt)return new Date(1e3*tt.s+("L"in tt?tt.L:0));if(Qt&&!("Z"in tt)&&(tt.Z=0),"p"in tt&&(tt.H=tt.H%12+12*tt.p),void 0===tt.m&&(tt.m="q"in tt?tt.q:0),"V"in tt){if(tt.V<1||tt.V>53)return null;"w"in tt||(tt.w=1),"Z"in tt?(Ii=(Bn=_P(u1(tt.y,0,1))).getUTCDay(),Bn=Ii>4||0===Ii?c1.ceil(Bn):c1(Bn),Bn=jM.offset(Bn,7*(tt.V-1)),tt.y=Bn.getUTCFullYear(),tt.m=Bn.getUTCMonth(),tt.d=Bn.getUTCDate()+(tt.w+6)%7):(Ii=(Bn=gP(u1(tt.y,0,1))).getDay(),Bn=Ii>4||0===Ii?l1.ceil(Bn):l1(Bn),Bn=C0.offset(Bn,7*(tt.V-1)),tt.y=Bn.getFullYear(),tt.m=Bn.getMonth(),tt.d=Bn.getDate()+(tt.w+6)%7)}else("W"in tt||"U"in tt)&&("w"in tt||(tt.w="u"in tt?tt.u%7:"W"in tt?1:0),Ii="Z"in tt?_P(u1(tt.y,0,1)).getUTCDay():gP(u1(tt.y,0,1)).getDay(),tt.m=0,tt.d="W"in tt?(tt.w+6)%7+7*tt.W-(Ii+5)%7:tt.w+7*tt.U-(Ii+6)%7);return"Z"in tt?(tt.H+=tt.Z/100|0,tt.M+=tt.Z%100,_P(tt)):gP(tt)}}function Xe(ot,Qt,tn,tt){for(var ci,nn,hn=0,Bn=Qt.length,Ii=tn.length;hn<Bn;){if(tt>=Ii)return-1;if(37===(ci=Qt.charCodeAt(hn++))){if(ci=Qt.charAt(hn++),!(nn=ye[ci in g8?Qt.charAt(hn++):ci])||(tt=nn(ot,tn,tt))<0)return-1}else if(ci!=tn.charCodeAt(tt++))return-1}return tt}return he.x=Se(i,he),he.X=Se(n,he),he.c=Se(t,he),le.x=Se(i,le),le.X=Se(n,le),le.c=Se(t,le),{format:function(ot){var Qt=Se(ot+="",he);return Qt.toString=function(){return ot},Qt},parse:function(ot){var Qt=Ue(ot+="",!1);return Qt.toString=function(){return ot},Qt},utcFormat:function(ot){var Qt=Se(ot+="",le);return Qt.toString=function(){return ot},Qt},utcParse:function(ot){var Qt=Ue(ot+="",!0);return Qt.toString=function(){return ot},Qt}}}(e),GM=D0.format,f1=D0.utcFormat}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});const bce=Zn("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),xce=Zn("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),wce=Zn("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),Cce=Zn("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),Ece=Zn("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),Mce=Zn("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Dce=Zn("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),Tce=Zn("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Sce=Zn("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),Ice=Zn("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),fr=e=>Coe(e[e.length-1]);var R8=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(Zn);const L8=fr(R8);var F8=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(Zn);const N8=fr(F8);var z8=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(Zn);const B8=fr(z8);var V8=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(Zn);const U8=fr(V8);var bP=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Zn);const ZM=fr(bP);var j8=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(Zn);const $8=fr(j8);var xP=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(Zn);const XM=fr(xP);var H8=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Zn);const G8=fr(H8);var q8=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(Zn);const W8=fr(q8);var Z8=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Zn);const X8=fr(Z8);var Y8=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Zn);const K8=fr(Y8);var Q8=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Zn);const J8=fr(Q8);var eV=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Zn);const tV=fr(eV);var nV=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Zn);const iV=fr(nV);var rV=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Zn);const oV=fr(rV);var sV=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Zn);const aV=fr(sV);var lV=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Zn);const cV=fr(lV);var uV=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Zn);const dV=fr(uV);var hV=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Zn);const fV=fr(hV);var pV=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Zn);const mV=fr(pV);var gV=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Zn);const _V=fr(gV);var yV=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Zn);const vV=fr(yV);var bV=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Zn);const xV=fr(bV);var wV=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Zn);const CV=fr(wV);var EV=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Zn);const MV=fr(EV);var DV=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Zn);const TV=fr(DV);var SV=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Zn);const IV=fr(SV);function AV(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-2710.57*e)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-67.37*e)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-2475.67*e)))))))+")"}var wP=1.78277,CP=-.29227,YM=-.90649,p1=1.97294,OV=p1*YM,kV=p1*wP,RV=wP*CP- -.14861*YM;function pd(e,t,i,n){return 1===arguments.length?function Ace(e){if(e instanceof Mg)return new Mg(e.h,e.s,e.l,e.opacity);e instanceof jo||(e=hA(e));var i=e.g/255,n=e.b/255,r=(RV*n+OV*(e.r/255)-kV*i)/(RV+OV-kV),s=n-r,u=(p1*(i-r)-CP*s)/YM,h=Math.sqrt(u*u+s*s)/(p1*r*(1-r)),_=h?Math.atan2(u,s)*I6-120:NaN;return new Mg(_<0?_+360:_,h,r,e.opacity)}(e):new Mg(e,t,i,n??1)}function Mg(e,t,i,n){this.h=+e,this.s=+t,this.l=+i,this.opacity=+n}function LV(e){return function t(i){function n(r,s){var u=e((r=pd(r)).h,(s=pd(s)).h),h=$o(r.s,s.s),_=$o(r.l,s.l),x=$o(r.opacity,s.opacity);return function(M){return r.h=u(M),r.s=h(M),r.l=_(Math.pow(M,i)),r.opacity=x(M),r+""}}return i=+i,n.gamma=t,n}(1)}h0(Mg,pd,jx(xp,{brighter(e){return e=null==e?f0:Math.pow(f0,e),new Mg(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new Mg(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*S6,t=+this.l,i=isNaN(this.s)?0:this.s*t*(1-t),n=Math.cos(e),r=Math.sin(e);return new jo(255*(t+i*(-.14861*n+wP*r)),255*(t+i*(CP*n+YM*r)),255*(t+i*(p1*n)),this.opacity)}})),LV(mA);var EP=LV($o);const FV=EP(pd(300,.5,0),pd(-240,.5,1));var NV=EP(pd(-100,.75,.35),pd(80,1.5,.8)),zV=EP(pd(260,.75,.35),pd(80,1.5,.8)),KM=pd();function BV(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return KM.h=360*e-100,KM.s=1.5-1.5*t,KM.l=.8-.9*t,KM+""}var QM=Cp(),Pce=Math.PI/3,Oce=2*Math.PI/3;function VV(e){var t;return e=(.5-e)*Math.PI,QM.r=255*(t=Math.sin(e))*t,QM.g=255*(t=Math.sin(e+Pce))*t,QM.b=255*(t=Math.sin(e+Oce))*t,QM+""}function UV(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-14825.05*e)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+707.56*e)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-6838.66*e)))))))+")"}function JM(e){var t=e.length;return function(i){return e[Math.max(0,Math.min(t-1,Math.floor(i*t)))]}}const jV=JM(Zn("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var $V=JM(Zn("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),HV=JM(Zn("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),GV=JM(Zn("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function m1(e){return"string"==typeof e?new il([[document.querySelector(e)]],[document.documentElement]):new il([[e]],Rz)}Math,Math;const qV=Math.cos,MP=(Math,Math.min),eD=Math.sin,Po=Math.sqrt,T0=Math.PI,tD=2*T0,Lce=Po(3),ZV={draw(e,t){const i=.59436*Po(t+MP(t/28,.75)),n=i/2,r=n*Lce;e.moveTo(0,i),e.lineTo(0,-i),e.moveTo(-r,-n),e.lineTo(r,n),e.moveTo(-r,n),e.lineTo(r,-n)}},DP={draw(e,t){const i=Po(t/T0);e.moveTo(i,0),e.arc(0,0,i,0,tD)}},XV={draw(e,t){const i=Po(t/5)/2;e.moveTo(-3*i,-i),e.lineTo(-i,-i),e.lineTo(-i,-3*i),e.lineTo(i,-3*i),e.lineTo(i,-i),e.lineTo(3*i,-i),e.lineTo(3*i,i),e.lineTo(i,i),e.lineTo(i,3*i),e.lineTo(-i,3*i),e.lineTo(-i,i),e.lineTo(-3*i,i),e.closePath()}},YV=Po(1/3),Fce=2*YV,KV={draw(e,t){const i=Po(t/Fce),n=i*YV;e.moveTo(0,-i),e.lineTo(n,0),e.lineTo(0,i),e.lineTo(-n,0),e.closePath()}},QV={draw(e,t){const i=.62625*Po(t);e.moveTo(0,-i),e.lineTo(i,0),e.lineTo(0,i),e.lineTo(-i,0),e.closePath()}},JV={draw(e,t){const i=.87559*Po(t-MP(t/7,2));e.moveTo(-i,0),e.lineTo(i,0),e.moveTo(0,i),e.lineTo(0,-i)}},eU={draw(e,t){const i=Po(t),n=-i/2;e.rect(n,n,i,i)}},tU={draw(e,t){const i=.4431*Po(t);e.moveTo(i,i),e.lineTo(i,-i),e.lineTo(-i,-i),e.lineTo(-i,i),e.closePath()}},nU=eD(T0/10)/eD(7*T0/10),zce=eD(tD/10)*nU,Bce=-qV(tD/10)*nU,iU={draw(e,t){const i=Po(.8908130915292852*t),n=zce*i,r=Bce*i;e.moveTo(0,-i),e.lineTo(n,r);for(let s=1;s<5;++s){const u=tD*s/5,h=qV(u),_=eD(u);e.lineTo(_*i,-h*i),e.lineTo(h*n-_*r,_*n+h*r)}e.closePath()}},TP=Po(3),rU={draw(e,t){const i=-Po(t/(3*TP));e.moveTo(0,2*i),e.lineTo(-TP*i,-i),e.lineTo(TP*i,-i),e.closePath()}},Vce=Po(3),oU={draw(e,t){const i=.6824*Po(t),n=i/2,r=i*Vce/2;e.moveTo(0,-i),e.lineTo(r,n),e.lineTo(-r,n),e.closePath()}},Yl=-.5,Kl=Po(3)/2,SP=1/Po(12),Uce=3*(SP/2+1),sU={draw(e,t){const i=Po(t/Uce),n=i/2,r=i*SP,s=n,u=i*SP+i,h=-s,_=u;e.moveTo(n,r),e.lineTo(s,u),e.lineTo(h,_),e.lineTo(Yl*n-Kl*r,Kl*n+Yl*r),e.lineTo(Yl*s-Kl*u,Kl*s+Yl*u),e.lineTo(Yl*h-Kl*_,Kl*h+Yl*_),e.lineTo(Yl*n+Kl*r,Yl*r-Kl*n),e.lineTo(Yl*s+Kl*u,Yl*u-Kl*s),e.lineTo(Yl*h+Kl*_,Yl*_-Kl*h),e.closePath()}},aU={draw(e,t){const i=.6189*Po(t-MP(t/6,1.7));e.moveTo(-i,-i),e.lineTo(i,i),e.moveTo(-i,i),e.lineTo(i,-i)}},jce=[DP,XV,KV,eU,iU,rU,sU],$ce=[DP,JV,aU,oU,ZV,tU,QV];function S0(e,t,i){this.k=e,this.x=t,this.y=i}function Dg(e){return null!=e&&!Number.isNaN(e)}function eu(e,t){return+Dg(t)-+Dg(e)||Pa(e,t)}function nD(e,t){return+Dg(t)-+Dg(e)||Px(e,t)}function cU(e){return null!=e&&""!=`${e}`}function uU(e){return isFinite(e)?e:NaN}function IP(e){return e>0&&isFinite(e)?e:NaN}function dU(e){return e<0&&isFinite(e)?e:NaN}S0.prototype={constructor:S0,scale:function(e){return 1===e?this:new S0(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new S0(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new S0(1,0,0);const Kce=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function hU(e,t){return Kce.test(e+="")?new Date(e):"function"==typeof t?t(e):t}const PP=36e5,g1=24*PP,fU=30*g1,_1=[["millisecond",500],["second",1e3],["second",3e4],["minute",6e4],["minute",18e5],["hour",PP],["hour",12*PP],["day",g1],["day",2*g1],["week",6048e5],["month",fU],["month",3*fU],["year",31536e6]],eue=new Map([["second",zh],["minute",zM],["hour",VM],["day",C0],["week",E0],["month",$M],["year",Qc],["monday",l1],["tuesday",s8],["wednesday",a8],["thursday",wg],["friday",l8],["saturday",c8],["sunday",E0]]),tue=new Map([["second",zh],["minute",BM],["hour",UM],["day",mP],["week",M0],["month",HM],["year",Jc],["monday",c1],["tuesday",u8],["wednesday",d8],["thursday",Eg],["friday",h8],["saturday",f8],["sunday",M0]]);function pU(e,t){let i=`${e}`.toLowerCase();i.endsWith("s")&&(i=i.slice(0,-1));let n=1;const r=/^(?:(\d+)\s+)/.exec(i);switch(r&&(i=i.slice(r[0].length),n=+r[1]),i){case"quarter":i="month",n*=3;break;case"half":i="month",n*=6}let s=t.get(i);if(!s)throw new Error(`unknown interval: ${e}`);if(!(n>1))return s;if(!s.every)throw new Error(`non-periodic interval: ${i}`);return s.every(n)}function nue(e){return pU(e,eue)}function mU(e){return pU(e,tue)}function Tg(e,t,i){return(n,r,s)=>{const u=e(n,r),h=t(n,r),_=r-A0(s);return r!==_&&void 0!==s[_]&&h===t(s[_],_)?u:i(u,h)}}const y1=Object.getPrototypeOf(Uint8Array),aue=Object.prototype.toString;function Go(e,t,i){const n=typeof t;return"string"===n?gU(e,yU(t),i):"function"===n?gU(e,t,i):"number"===n||t instanceof Date||"boolean"===n?Oo(e,v1(t),i):function _U(e,t){return void 0===t?sl(e):e instanceof t?e:t.prototype instanceof y1&&!(e instanceof y1)?t.from(e,RP):t.from(e)}("function"==typeof t?.transform?t.transform(e):t,i)}function gU(e,t,i){return Oo(e,i?.prototype instanceof y1?function lue(e){return(t,i)=>RP(e(t,i))}(t):t,i)}const rD=[null],yU=e=>t=>t[e],oD={transform:md},ss={transform:e=>e},cue=()=>1,uue=()=>!0,ia=e=>null==e?e:`${e}`,Dr=e=>null==e?e:+e,OP=e=>e?e[0]:void 0,kP=e=>e?e[1]:void 0,v1=e=>()=>e;function sD(e){return e instanceof y1?e:Oo(e,RP,Float64Array)}function RP(e){return null==e?NaN:Number(e)}function hue(e){return Oo(e,vU)}function vU(e){return e instanceof Date&&!isNaN(e)?e:"string"==typeof e?hU(e):null==e||isNaN(e=+e)?void 0:new Date(e)}function Bh(e,t){return void 0===e&&(e=t),null===e?[void 0,"none"]:dD(e)?[void 0,e]:[e,void 0]}function ol(e,t){return void 0===e&&(e=t),null===e||"number"==typeof e?[void 0,e]:[e,void 0]}function aD(e,t,i){if(null!=e)return Vh(e,t,i)}function Vh(e,t,i){const n=`${e}`.toLowerCase();if(!i.includes(n))throw new Error(`invalid ${t}: ${e}`);return n}function sl(e){return null==e||e instanceof Array||e instanceof y1?e:Array.from(e)}function Oo(e,t,i=Array){return null==e?e:e instanceof i?e.map(t):i.from(e,t)}function LP(e,t=Array){return e instanceof t?e.slice():t.from(e)}function bU({x:e,x1:t,x2:i}){return void 0!==e||void 0!==t||void 0!==i}function xU({y:e,y1:t,y2:i}){return void 0!==e||void 0!==t||void 0!==i}function FP(e){return bU(e)||xU(e)||void 0!==e.interval}function Sg(e){return e?.toString===aue}function NP(e){return Sg(e)&&(void 0!==e.type||void 0!==e.domain)}function zP(e){return Sg(e)&&"function"!=typeof e.transform}function b1(e){return zP(e)&&void 0===e.value&&void 0===e.channel}function wU(e,t,i,n=ss){return void 0===t&&void 0===i?(t=0,i=void 0===e?n:e):void 0===t?t=void 0===e?0:e:void 0===i&&(i=void 0===e?0:e),[t,i]}function CU(e,t){return void 0===e&&void 0===t?[OP,kP]:[e,t]}function md(e){const t=e.length,i=new Uint32Array(t);for(let n=0;n<t;++n)i[n]=n;return i}function BP(e,t){return Oo(t,i=>e[i])}function pue(e,t,i){return e.subarray?e.subarray(t,i):e.slice(t,i)}function lD(e){return null!==e&&"object"==typeof e?e.valueOf():e}function cD(e){let t;return[{transform:()=>t,label:Ig(e)},i=>t=i]}function Uh(e){return null==e?[e]:cD(e)}function Ig(e,t){return"string"==typeof e?e:e&&void 0!==e.label?e.label:t}function uD(e,t){return{transform(i){const n=e.transform(i),r=t.transform(i);return tu(n)||tu(r)?Oo(n,(s,u)=>new Date((+n[u]+ +r[u])/2)):Oo(n,(s,u)=>(+n[u]+ +r[u])/2,Float64Array)},label:e.label}}function EU(e,t){const i=MU(t?.interval,t?.type);return i?Oo(e,i):e}function MU(e,t){const i=VP(e,t);return i&&(n=>Dg(n)?i.floor(n):n)}function VP(e,t){if(null!=e){if("number"==typeof e){0<e&&e<1&&Number.isInteger(1/e)&&(e=-1/e);const i=Math.abs(e);return e<0?{floor:n=>Math.floor(n*i)/i,offset:n=>(n*i+1)/i,range:(n,r)=>JI(Math.ceil(n*i),r*i).map(s=>s/i)}:{floor:n=>Math.floor(n/i)*i,offset:n=>n+i,range:(n,r)=>JI(Math.ceil(n/i),r/i).map(s=>s*i)}}if("string"==typeof e)return("time"===t?nue:mU)(e);if("function"!=typeof e.floor)throw new Error("invalid interval; missing floor method");if("function"!=typeof e.offset)throw new Error("invalid interval; missing offset method");return e}}function I0(e,t){if((e=VP(e,t))&&"function"!=typeof e.range)throw new Error("invalid interval: missing range method");return e}function x1(e){return void 0===e||zP(e)?e:{value:e}}function gd(e){return e&&"function"==typeof e[Symbol.iterator]}function DU(e){for(const t of e)if(null!=t)return"object"!=typeof t||t instanceof Date}function TU(e){for(const t of e){if(null==t)continue;const i=typeof t;return"string"===i||"boolean"===i}}function tu(e){for(const t of e)if(null!=t)return t instanceof Date}function yue(e){for(const t of e)if(null!=t)return"string"==typeof t&&isNaN(t)&&hU(t)}function vue(e){for(const t of e)if(null!=t){if("string"!=typeof t)return!1;if(t.trim())return!isNaN(t)}}function UP(e,t){let i;for(const n of e)if(null!=n){if(!t(n))return!1;i=!0}return i}function dD(e){return"string"==typeof e&&("none"===(e=e.toLowerCase().trim())||"currentcolor"===e||e.startsWith("url(")&&e.endsWith(")")||e.startsWith("var(")&&e.endsWith(")")||null!==wp(e))}function xue(e){return"number"==typeof e&&(0<=e&&e<=1||isNaN(e))}function ka(e){return null==e||w1(e)}function w1(e){return/^\s*none\s*$/i.test(e)}function SU(e,t){return aD(e,t,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function jP(e="middle"){return SU(e,"frameAnchor")}function A0(e){if(null!=e)return Px(e[0],e[e.length-1])}function IU(e){return gd(e)?function Eue(e){console.warn("named iterables are deprecated; please use an object instead");const t=new Set;return Object.fromEntries(Array.from(e,i=>{const{name:n}=i;if(null==n)throw new Error("missing name");const r=`${n}`;if("__proto__"===r)throw new Error(`illegal name: ${r}`);if(t.has(r))throw new Error(`duplicate name: ${r}`);return t.add(r),[n,i]}))}(e):e}const _d=Symbol("position"),jh=Symbol("color"),hD=Symbol("radius"),fD=Symbol("length"),pD=Symbol("opacity"),mD=Symbol("symbol"),Mue=Symbol("projection"),to=new Map([["x",_d],["y",_d],["fx",_d],["fy",_d],["r",hD],["color",jh],["opacity",pD],["symbol",mD],["length",fD],["projection",Mue]]),Due=2/Math.sqrt(3),$P=new Map([["asterisk",ZV],["circle",DP],["cross",XV],["diamond",KV],["diamond2",QV],["hexagon",{draw(e,t){const i=Math.sqrt(t/Math.PI),n=i*Due,r=n/2;e.moveTo(0,n),e.lineTo(i,r),e.lineTo(i,-r),e.lineTo(0,-n),e.lineTo(-i,-r),e.lineTo(-i,r),e.closePath()}}],["plus",JV],["square",eU],["square2",tU],["star",iU],["times",aU],["triangle",rU],["triangle2",oU],["wye",sU]]);function HP(e){return e&&"function"==typeof e.draw}function Sue(e){return!!HP(e)||"string"==typeof e&&$P.has(e.toLowerCase())}function GP(e){if(null==e||HP(e))return e;const t=$P.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid symbol: ${e}`)}function P0(e,...t){for(const{name:i}of e)if(t.includes(i))return!0;return!1}function qP(e,t,i,n=WP){let r;Sg(t)&&"reduce"in t&&(r=t.scale,t=t.reduce);const s=n(e,t,i),[u,h]=cD(s.label);let _;return{name:e,output:void 0===r?u:{value:u,scale:r},initialize(x){s.initialize(x),_=h([])},scope(x,M){s.scope(x,M)},reduce(x,M){_.push(s.reduce(x,M))}}}function WP(e,t,i,n=_D){const r=function mue(e,t){if(void 0!==t[e])return t[e];switch(e){case"x1":case"x2":e="x";break;case"y1":case"y2":e="y"}return t[e]}(e,i),s=n(t,r);let u,h;return{label:Ig(s===yD?null:r,s.label),initialize(_){u=void 0===r?_:Go(_,r),"data"===s.scope&&(h=s.reduceIndex(md(_),u))},scope(_,x){s.scope===_&&(h=s.reduceIndex(x,u))},reduce:(_,x)=>null==s.scope?s.reduceIndex(_,u,x):s.reduceIndex(_,u,h,x)}}function C1(e,t){return t?kx(YI(e,i=>t[i]),OP):[[,e]]}function _D(e,t,i=Aue){if(null==e)return i(e);if("function"==typeof e.reduceIndex)return e;if("function"==typeof e.reduce&&Sg(e))return function Pue(e){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...e,reduceIndex:e.reduce.bind(e)}}(e);if("function"==typeof e)return function Oue(e){return{reduceIndex:(t,i,n)=>e(BP(i,t),n)}}(e);if(/^p\d{2}$/i.test(e))return $h(function due(e){const t=+`${e}`.slice(1)/100;return(i,n)=>l0(i,t,n)}(e));switch(`${e}`.toLowerCase()){case"first":return RU;case"last":return Rue;case"identity":return ZP;case"count":return yD;case"distinct":return Lue;case"sum":return null==t?yD:Fue;case"proportion":return LU(t,"data");case"proportion-facet":return LU(t,"facet");case"deviation":return $h(hz);case"min":return $h(Ih);case"min-index":return $h(Kne);case"max":return $h(ad);case"max-index":return $h(Xne);case"mean":return kU(Yne);case"median":return kU(zE);case"variance":return $h(dz);case"mode":return $h(Qne)}return i(e)}function Aue(e){throw new Error(`invalid reduce: ${e}`)}function $h(e){return{reduceIndex:(t,i)=>e(t,n=>i[n])}}function kU(e){return{reduceIndex(t,i){const n=e(t,r=>i[r]);return tu(i)?new Date(n):n}}}const ZP={reduceIndex:(e,t)=>BP(t,e)},RU={reduceIndex:(e,t)=>t[e[0]]},kue={reduceIndex(e,t){const n=kx(s0(e,s=>s.length,s=>t[s]),kP),r=n.slice(-5).reverse();if(r.length<n.length){const s=n.slice(0,-4);r[4]=[`\u2026 ${s.length.toLocaleString("en-US")} more`,bp(s,kP)]}return r.map(([s,u])=>`${s} (${u.toLocaleString("en-US")})`).join("\n")}},Rue={reduceIndex:(e,t)=>t[e[e.length-1]]},yD={label:"Frequency",reduceIndex:e=>e.length},Lue={label:"Distinct",reduceIndex(e,t){const i=new WI;for(const n of e)i.add(t[n]);return i.size}},Fue=$h(bp);function LU(e,t){return null==e?{scope:t,label:"Frequency",reduceIndex:(i,n,r=1)=>i.length/r}:{scope:t,reduceIndex:(i,n,r=1)=>bp(i,s=>n[s])/r}}function E1(e,{scale:t,type:i,value:n,filter:r,hint:s},u){return void 0===s&&"function"==typeof n?.transform&&(s=n.hint),FU(u,{scale:t,type:i,value:Go(e,n),label:Ig(n),filter:r,hint:s})}function FU(e,t){const{scale:i,value:n}=t;if(!0===i||"auto"===i)switch(e){case"fill":case"stroke":case"color":t.scale=!0!==i&&UP(n,dD)?null:"color";break;case"fillOpacity":case"strokeOpacity":case"opacity":t.scale=!0!==i&&UP(n,xue)?null:"opacity";break;case"symbol":!0!==i&&UP(n,Sue)?(t.scale=null,t.value=Oo(n,GP)):t.scale="symbol";break;default:t.scale=to.has(e)?e:null}else if(!1===i)t.scale=null;else if(null!=i&&!to.has(i))throw new Error(`unknown scale: ${i}`);return t}function Vue(e,t){for(const i in e){const n=e[i];if(n.scale===t)return n}}function Uue(e,t){const i=e.original;if(i===e)return t;const n=t.value,r=t.value=[];for(let s=0;s<i.length;++s){const u=n[i[s][0]];for(const h of e[s])r[h]=u}return t}function NU(e,t,i){const n=XP(e,t);return Oo(XP(e,i),(s,u)=>Math.abs(s-n[u]),Float64Array)}function XP(e,t,i){let n=e[t];if(!n&&void 0!==i&&(n=e[i]),n)return n.value;throw new Error(`missing channel: ${t}`)}function jue(e){if(null==e||"function"==typeof e)return e;switch(`${e}`.toLowerCase()){case"ascending":return zU;case"descending":return BU}throw new Error(`invalid order: ${e}`)}function zU([e,t],[i,n]){return eu(t,n)||eu(e,i)}function BU([e,t],[i,n]){return nD(t,n)||eu(e,i)}function $ue(e,t){let i=e[t];if(i){for(;i.source;)i=i.source;return null===i.source?null:i}}function YP(e={}){const{document:t=(typeof window<"u"?window.document:void 0)}=e;return{document:t}}function ra(e,{document:t}){return m1(WE(e).call(t.documentElement))}let KP=0;function O0(e){console.warn(e),++KP}const VU=Math.PI,Hh=2*VU,UU=.618;function jU(e){switch(`${e}`.toLowerCase()){case"albers-usa":return nu(vae,.7463,.4673);case"albers":return vD(_6,.7463,.4673);case"azimuthal-equal-area":return nu(bae,4,4);case"azimuthal-equidistant":return nu(xae,Hh,Hh);case"conic-conformal":return vD(Eae,Hh,Hh);case"conic-equal-area":return vD(TM,6.1702,2.9781);case"conic-equidistant":return vD(Tae,7.312,3.6282);case"equal-earth":return nu(Iae,5.4133,2.6347);case"equirectangular":return nu(Mae,Hh,VU);case"gnomonic":return nu(Aae,3.4641,3.4641);case"identity":return{type:$U};case"reflect-y":return{type:Wue};case"mercator":return nu(wae,Hh,Hh);case"orthographic":return nu(Pae,2,2);case"stereographic":return nu(Oae,2,2);case"transverse-mercator":return nu(kae,Hh,Hh);default:throw new Error(`unknown projection type: ${e}`)}}function nu(e,t,i){return{type:({width:n,height:r,rotate:s,precision:u=.15,clip:h})=>{const _=e();return null!=u&&_.precision?.(u),null!=s&&_.rotate?.(s),"number"==typeof h&&_.clipAngle?.(h),_.scale(Math.min(n/t,r/i)),_.translate([n/2,r/2]),_},aspectRatio:i/t}}function vD(e,t,i){const{type:n,aspectRatio:r}=nu(e,t,i);return{type:s=>{const{parallels:u,domain:h,width:_,height:x}=s,M=n(s);return null!=u&&(M.parallels(u),void 0===h&&M.fitSize([_,x],{type:"Sphere"})),M},aspectRatio:r}}const $U=v1({stream:e=>e}),Wue=v1($A({point(e,t){this.stream.point(e,-t)}}));function HU(e,t,i,n){const r=i[e],s=i[t],u=r.length,h=i[e]=new Float64Array(u).fill(NaN),_=i[t]=new Float64Array(u).fill(NaN);let x;const M=n.stream({point(S,P){h[x]=S,_[x]=P}});for(x=0;x<u;++x)M.point(r[x],s[x])}function Zue({projection:e}={}){return null!=e&&("function"==typeof e.stream||(Sg(e)&&(e=e.type),null!=e))}function Yue(e){const t=[],i=[],n={scale:"x",value:t},r={scale:"y",value:i},s={point(u,h){t.push(u),i.push(h)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(const u of e.value)yg(u,s);return[n,r]}const GU=new Map([["accent",xce],["category10",bce],["dark2",wce],["paired",Cce],["pastel1",Ece],["pastel2",Mce],["set1",Dce],["set2",Tce],["set3",Sce],["tableau10",Ice]]),qU=new Map([...GU,["brbg",Gh(R8,L8)],["prgn",Gh(F8,N8)],["piyg",Gh(z8,B8)],["puor",Gh(V8,U8)],["rdbu",Gh(bP,ZM)],["rdgy",Gh(j8,$8)],["rdylbu",Gh(xP,XM)],["rdylgn",Gh(H8,G8)],["spectral",Gh(q8,W8)],["burd",WU(bP,ZM)],["buylrd",WU(xP,XM)],["blues",qo(yV,vV)],["greens",qo(bV,xV)],["greys",qo(wV,CV)],["oranges",qo(SV,IV)],["purples",qo(EV,MV)],["reds",qo(DV,TV)],["turbo",qh(UV)],["viridis",qh(jV)],["magma",qh($V)],["inferno",qh(HV)],["plasma",qh(GV)],["cividis",qh(AV)],["cubehelix",qh(FV)],["warm",qh(NV)],["cool",qh(zV)],["bugn",qo(Z8,X8)],["bupu",qo(Y8,K8)],["gnbu",qo(Q8,J8)],["orrd",qo(eV,tV)],["pubu",qo(rV,oV)],["pubugn",qo(nV,iV)],["purd",qo(sV,aV)],["rdpu",qo(lV,cV)],["ylgn",qo(hV,fV)],["ylgnbu",qo(uV,dV)],["ylorbr",qo(pV,mV)],["ylorrd",qo(gV,_V)],["rainbow",ZU(BV)],["sinebow",ZU(VV)]]);function qo(e,t){return({length:i})=>1===i?[e[3][1]]:2===i?[e[3][1],e[3][2]]:(i=Math.max(3,Math.floor(i)))>9?Kc(t,i):e[i]}function Gh(e,t){return({length:i})=>2===i?[e[3][0],e[3][2]]:(i=Math.max(3,Math.floor(i)))>11?Kc(t,i):e[i]}function WU(e,t){return({length:i})=>2===i?[e[3][2],e[3][0]]:(i=Math.max(3,Math.floor(i)))>11?Kc(n=>t(1-n),i):e[i].slice().reverse()}function qh(e){return({length:t})=>Kc(e,Math.max(2,Math.floor(t)))}function ZU(e){return({length:t})=>Kc(e,Math.floor(t)+1).slice(0,-1)}function XU(e){const t=`${e}`.toLowerCase();if(!qU.has(t))throw new Error(`unknown ordinal scheme: ${t}`);return qU.get(t)}function bD(e,t){const i=XU(e),n="function"==typeof i?i({length:t}):i;return n.length!==t?n.slice(0,t):n}const YU=new Map([["brbg",L8],["prgn",N8],["piyg",B8],["puor",U8],["rdbu",ZM],["rdgy",$8],["rdylbu",XM],["rdylgn",G8],["spectral",W8],["burd",e=>ZM(1-e)],["buylrd",e=>XM(1-e)],["blues",vV],["greens",xV],["greys",CV],["purples",MV],["reds",TV],["oranges",IV],["turbo",UV],["viridis",jV],["magma",$V],["inferno",HV],["plasma",GV],["cividis",AV],["cubehelix",FV],["warm",NV],["cool",zV],["bugn",X8],["bupu",K8],["gnbu",J8],["orrd",tV],["pubugn",iV],["pubu",oV],["purd",aV],["rdpu",cV],["ylgnbu",dV],["ylgn",fV],["ylorbr",mV],["ylorrd",_V],["rainbow",BV],["sinebow",VV]]);function QP(e){const t=`${e}`.toLowerCase();if(!YU.has(t))throw new Error(`unknown quantitative scheme: ${t}`);return YU.get(t)}const Jue=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]),KU=e=>t=>e(1-t),JP=[0,1],QU=new Map([["number",As],["rgb",_g],["hsl",Rae],["hcl",Nae],["lab",function Fae(e,t){var i=$o((e=XA(e)).l,(t=XA(t)).l),n=$o(e.a,t.a),r=$o(e.b,t.b),s=$o(e.opacity,t.opacity);return function(u){return e.l=i(u),e.a=n(u),e.b=r(u),e.opacity=s(u),e+""}}]]);function JU(e){const t=`${e}`.toLowerCase();if(!QU.has(t))throw new Error(`unknown interpolator: ${t}`);return QU.get(t)}function M1(e,t,i,{type:n,nice:r,clamp:s,zero:u,domain:h=tj(e,i),unknown:_,round:x,scheme:M,interval:S,range:P=(to.get(e)===hD?dde(i,h):to.get(e)===fD?hde(i,h):to.get(e)===pD?JP:void 0),interpolate:F=(to.get(e)===jh?null==M&&void 0!==P?_g:QP(void 0!==M?M:"cyclical"===n?"rainbow":"turbo"):x?ZA:As),reverse:$}){if(S=I0(S,n),("cyclical"===n||"sequential"===n)&&(n="linear"),"function"!=typeof F&&(F=JU(F)),$=!!$,void 0!==P&&(h=sl(h)).length!==(P=sl(P)).length){if(1===F.length)throw new Error("invalid piecewise interpolator");F=kM(F,P),P=void 0}if(1===F.length?($&&(F=KU(F),$=!1),void 0===P&&2===(P=Float64Array.from(h,(W,X)=>X/(h.length-1))).length&&(P=JP),t.interpolate((P===JP?v1:tO)(F))):t.interpolate(F),u){const[W,X]=qc(h);(W>0||X<0)&&(A0(h=LP(h))!==Math.sign(W)?h[h.length-1]=0:h[0]=0)}return $&&(h=UE(h)),t.domain(h).unknown(_),r&&(t.nice(function tde(e,t){return!0===e?void 0:"number"==typeof e?e:function gue(e,t){if((e=I0(e,t))&&"function"!=typeof e.ceil)throw new Error("invalid interval: missing ceil method");return e}(e,t)}(r,n)),h=t.domain()),void 0!==P&&t.range(P),s&&t.clamp(s),{type:n,domain:h,range:P,scale:t,interpolate:F,interval:S}}function ej(e,t,{exponent:i=1,...n}){return M1(e,uP().exponent(i),t,{...n,type:"pow"})}function rde(e,t,{base:i=10,domain:n=fde(t),...r}){return M1(e,Y6().base(i),t,{...r,domain:n})}function ode(e,t,{constant:i=1,...n}){return M1(e,e8().constant(i),t,n)}function sde(e,t,{range:i,quantiles:n=(void 0===i?5:(i=[...i]).length),n:r=n,scheme:s="rdylbu",domain:u=pde(t),unknown:h,interpolate:_,reverse:x}){return void 0===i&&(i=void 0!==_?Kc(_,r):to.get(e)===jh?bD(s,r):void 0),u.length>0&&(u=i8(u,void 0===i?{length:r}:i).quantiles()),eO(e,0,{domain:u,range:i,reverse:x,unknown:h})}function eO(e,t,{domain:i=[0],unknown:n,scheme:r="rdylbu",interpolate:s,range:u=(void 0!==s?Kc(s,i.length+1):to.get(e)===jh?bD(r,i.length+1):void 0),reverse:h}){const _=A0(i=sl(i));if(!isNaN(_)&&!function lde(e,t){for(let i=1,n=e.length,r=e[0];i<n;++i){const s=Px(r,r=e[i]);if(0!==s&&s!==t)return!1}return!0}(i,_))throw new Error(`the ${e} scale has a non-monotonic domain`);return h&&(u=UE(u)),{type:"threshold",scale:r8(_<0?UE(i):i,void 0===u?[]:u).unknown(n),domain:i,range:u}}function D1(e,t=uU){return e.length?[Ih(e,({value:i})=>void 0===i?i:Ih(i,t)),ad(e,({value:i})=>void 0===i?i:ad(i,t))]:[0,1]}function tj(e,t){const i=to.get(e);return(i===hD||i===pD||i===fD?ude:D1)(t)}function ude(e){return[0,e.length?ad(e,({value:t})=>void 0===t?t:ad(t,uU)):1]}function dde(e,t){const i=e.find(({radius:u})=>void 0!==u);if(void 0!==i)return[0,i.radius];const n=l0(e,.5,({value:u})=>void 0===u?NaN:l0(u,.25,IP)),r=t.map(u=>3*Math.sqrt(u/n)),s=30/ad(r);return s<1?r.map(u=>u*s):r}function hde(e,t){const i=zE(e,({value:s})=>void 0===s?NaN:zE(s,Math.abs)),n=t.map(s=>12*s/i),r=60/ad(n);return r<1?n.map(s=>s*r):n}function fde(e){for(const{value:t}of e)if(void 0!==t)for(let i of t){if(i>0)return D1(e,IP);if(i<0)return D1(e,dU)}return[1,10]}function pde(e){const t=[];for(const{value:i}of e)if(void 0!==i)for(const n of i)t.push(n);return t}function tO(e){return(t,i)=>n=>e(t+n*(i-t))}function xD(e,t,i,n,{type:r,nice:s,clamp:u,domain:h=D1(n),unknown:_,pivot:x=0,scheme:M,range:S,symmetric:P=!0,interpolate:F=(to.get(e)===jh?null==M&&void 0!==S?_g:QP(void 0!==M?M:"rdbu"):As),reverse:$}){x=+x,h=sl(h);let[W,X]=h;if(h.length>2&&O0(`Warning: the diverging ${e} scale domain contains extra elements.`),Px(W,X)<0&&([W,X]=[X,W],$=!$),W=Math.min(W,x),X=Math.max(X,x),"function"!=typeof F&&(F=JU(F)),void 0!==S&&(F=1===F.length?tO(F)(...S):kM(F,S)),$&&(F=KU(F)),P){const K=i.apply(x),Q=K-i.apply(W),he=i.apply(X)-K;Q<he?W=i.invert(K-he):Q>he&&(X=i.invert(K+Q))}return t.domain([W,x,X]).unknown(_).interpolator(F),u&&t.clamp(u),s&&t.nice(s),{type:r,domain:[W,X],pivot:x,interpolate:F,scale:t}}function mde(e,t,i){return xD(e,P8(),vde,t,i)}function nj(e,t,{exponent:i=1,...n}){return xD(e,vP().exponent(i=+i),function wde(e){return.5===e?xde:{apply:t=>Math.sign(t)*Math.pow(Math.abs(t),e),invert:t=>Math.sign(t)*Math.pow(Math.abs(t),1/e)}}(i),t,{...n,type:"diverging-pow"})}function _de(e,t,{base:i=10,pivot:n=1,domain:r=D1(t,n<0?dU:IP),...s}){return xD(e,O8().base(i=+i),bde,t,{domain:r,pivot:n,...s})}function yde(e,t,{constant:i=1,...n}){return xD(e,k8().constant(i=+i),function Cde(e){return{apply:t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),invert:t=>Math.sign(t)*Math.expm1(Math.abs(t))*e}}(i),t,n)}const vde={apply:e=>e,invert:e=>e},bde={apply:Math.log,invert:Math.exp},xde={apply:e=>Math.sign(e)*Math.sqrt(Math.abs(e)),invert:e=>Math.sign(e)*(e*e)};function ij(e,t,i,n){return M1(e,t,i,n)}const T1=Symbol("ordinal");function rj(e,t,i,{type:n,interval:r,domain:s,range:u,reverse:h,hint:_}){return r=I0(r,n),void 0===s&&(s=sj(i,r,e)),("categorical"===n||n===T1)&&(n="ordinal"),h&&(s=UE(s)),t.domain(s),void 0!==u&&("function"==typeof u&&(u=u(s)),t.range(u)),{type:n,domain:s,range:u,scale:t,hint:_,interval:r}}function oj(e,t,i,n){let{round:r}=i;return void 0!==r&&e.round(r=!!r),(e=rj(n,e,t,i)).round=r,e}function sj(e,t,i){const n=new WI;for(const{value:r,domain:s}of e){if(void 0!==s)return s();if(void 0!==r)for(const u of r)n.add(u)}if(void 0!==t){const[r,s]=qc(n).map(t.floor,t);return t.range(r,t.offset(s))}if(n.size>1e4&&to.get(i)===_d)throw new Error(`implicit ordinal domain of ${i} scale has more than 10,000 values`);return kx(n,eu)}function aj(e,t){let i;for(const{hint:n}of e){const r=n?.[t];if(void 0!==r)if(void 0===i)i=r;else if(i!==r)return}return i}function nO(e,{label:t,inset:i=0,insetTop:n=i,insetRight:r=i,insetBottom:s=i,insetLeft:u=i,round:h,nice:_,clamp:x,zero:M,align:S,padding:P,projection:F,facet:{label:$=t}={},...W}={}){const X={};for(const[K,Q]of e){const he=W[K],le=pj(K,Q,{round:to.get(K)===_d?h:void 0,nice:_,clamp:x,zero:M,align:S,padding:P,projection:F,...he});if(le){let{label:ye=("fx"===K||"fy"===K?$:t),percent:Se,transform:Ue,inset:Xe,insetTop:mt=(void 0!==Xe?Xe:"y"===K?n:0),insetRight:bt=(void 0!==Xe?Xe:"x"===K?r:0),insetBottom:qe=(void 0!==Xe?Xe:"y"===K?s:0),insetLeft:St=(void 0!==Xe?Xe:"x"===K?u:0)}=he||{};if(null==Ue)Ue=void 0;else if("function"!=typeof Ue)throw new Error("invalid scale transform; not a function");le.percent=!!Se,le.label=void 0===ye?Ode(Q,le):ye,le.transform=Ue,"x"===K||"fx"===K?(le.insetLeft=+St,le.insetRight=+bt):("y"===K||"fy"===K)&&(le.insetTop=+mt,le.insetBottom=+qe),X[K]=le}}return X}function lj(e){return Object.fromEntries(Object.entries(e).filter(([,{scale:t}])=>t).map(([t,{scale:i,type:n,interval:r,label:s}])=>(i.type=n,null!=r&&(i.interval=r),null!=s&&(i.label=s),[t,i])))}function Ode(e=[],t){let i;for(const{label:n}of e)if(void 0!==n)if(void 0===i)i=n;else if(i!==n)return;if(void 0!==i)return!Ag(t)&&t.percent&&(i=`${i} (%)`),{inferred:!0,toString:()=>i}}function iO(e){const{marginTop:t,marginRight:i,marginBottom:n,marginLeft:r,width:s,height:u,facet:{marginTop:h,marginRight:_,marginBottom:x,marginLeft:M}}=e;return{marginTop:Math.max(t,h),marginRight:Math.max(i,_),marginBottom:Math.max(n,x),marginLeft:Math.max(r,M),width:s,height:u}}function cj({fx:e,fy:t},i){const{marginTop:n,marginRight:r,marginBottom:s,marginLeft:u,width:h,height:_}=iO(i);return{marginTop:n,marginRight:r,marginBottom:s,marginLeft:u,width:e?e.scale.bandwidth()+u+r:h,height:t?t.scale.bandwidth()+n+s:_,facet:{width:h,height:_}}}function uj(e,t){if(void 0===e.range){const{insetLeft:i,insetRight:n}=e,{width:r,marginLeft:s=0,marginRight:u=0}=t,h=s+i;e.range=[h,Math.max(h,r-u-n)],Ag(e)||(e.range=fj(e)),e.scale.range(e.range)}hj(e)}function dj(e,t){if(void 0===e.range){const{insetTop:i,insetBottom:n}=e,{height:r,marginTop:s=0,marginBottom:u=0}=t,h=s+i;e.range=[Math.max(h,r-u-n),h],Ag(e)?e.range.reverse():e.range=fj(e),e.scale.range(e.range)}hj(e)}function hj(e){void 0===e.round&&function Fde({type:e}){return"point"===e||"band"===e}(e)&&function kde({scale:e}){const t=e.domain().length,[i,n]=e.range(),r=e.paddingInner?e.paddingInner():1,s=e.paddingOuter?e.paddingOuter():e.padding(),u=t-r,h=Math.abs(n-i)/Math.max(1,u+2*s);return(h-Math.floor(h))*u}(e)<=30&&e.scale.round(!0)}function fj(e){const t=e.scale.domain().length+gj(e);if(!(t>2))return e.range;const[i,n]=e.range;return Array.from({length:t},(r,s)=>i+s/(t-1)*(n-i))}function pj(e,t=[],i={}){const n=function Lde(e,t,{type:i,domain:n,range:r,scheme:s,pivot:u,projection:h}){if("fx"===e||"fy"===e)return"band";("x"===e||"y"===e)&&null!=h&&(i=mj);for(const{type:x}of t)if(void 0!==x)if(void 0===i)i=x;else if(i!==x)throw new Error(`scale incompatible with channel: ${i} !== ${x}`);if(i===mj)return;if(void 0!==i)return i;if(void 0===n&&!t.some(({value:x})=>void 0!==x))return;const _=to.get(e);if(_===hD)return"sqrt";if(_===pD||_===fD)return"linear";if(_===mD)return"ordinal";if((n||r||[]).length>2)return rO(_);if(void 0!==n){if(TU(n))return rO(_);if(tu(n))return"utc"}else{const x=t.map(({value:M})=>M).filter(M=>void 0!==M);if(x.some(TU))return rO(_);if(x.some(tu))return"utc"}if(_===jh){if(null!=u||function ede(e){return null!=e&&Jue.has(`${e}`.toLowerCase())}(s))return"diverging";if(function Kue(e){return null!=e&&GU.has(`${e}`.toLowerCase())}(s))return"categorical"}return"linear"}(e,t,i);if(void 0===i.type&&void 0===i.domain&&void 0===i.range&&null==i.interval&&"fx"!==e&&"fy"!==e&&Ag({type:n})){const r=t.map(({value:s})=>s).filter(s=>void 0!==s);r.some(tu)?O0(`Warning: some data associated with the ${e} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${k0(n)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${e} scale to "${k0(n)}".`):r.some(yue)?O0(`Warning: some data associated with the ${e} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${k0(n)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${e} scale to "${k0(n)}".`):r.some(vue)&&O0(`Warning: some data associated with the ${e} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${k0(n)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${e} scale to "${k0(n)}".`)}switch(i.type=n,n){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":i=wD(t,i,sD);break;case"identity":switch(to.get(e)){case _d:i=wD(t,i,sD);break;case mD:i=wD(t,i,Nde)}break;case"utc":case"time":i=wD(t,i,hue)}switch(n){case"diverging":return mde(e,t,i);case"diverging-sqrt":return function gde(e,t,i){return nj(e,t,{...i,exponent:.5})}(e,t,i);case"diverging-pow":return nj(e,t,i);case"diverging-log":return _de(e,t,i);case"diverging-symlog":return yde(e,t,i);case"categorical":case"ordinal":case T1:return function Dde(e,t,{type:i,interval:n,domain:r,range:s,scheme:u,unknown:h,..._}){let x;if(n=I0(n,i),void 0===r&&(r=sj(t,n,e)),to.get(e)===mD)x=function Ide(e){return{fill:aj(e,"fill"),stroke:aj(e,"stroke")}}(t),s=void 0===s?function Ade(e){return ka(e.fill)?$ce:jce}(x):Oo(s,GP);else if(to.get(e)===jh&&(void 0===s&&("ordinal"===i||i===T1)&&(s=function Que(e,t="greys"){const i=new Set,[n,r]=bD(t,2);for(const s of e)if(null!=s)if(!0===s)i.add(r);else{if(!1!==s)return;i.add(n)}return[...i]}(r,u),void 0!==s&&(u=void 0)),void 0===u&&void 0===s&&(u="ordinal"===i?"turbo":"tableau10"),void 0!==u))if(void 0!==s){const M=QP(u),S=s[0],P=s[1]-s[0];s=({length:F})=>Kc($=>M(S+P*$),F)}else s=XU(u);if(h===oP)throw new Error(`implicit unknown on ${e} scale is not supported`);return rj(e,sP().unknown(h),t,{..._,type:i,domain:r,range:s,hint:x})}(e,t,i);case"cyclical":case"sequential":case"linear":return function nde(e,t,i){return M1(e,cP(),t,i)}(e,t,i);case"sqrt":return function ide(e,t,i){return ej(e,t,{...i,exponent:.5})}(e,t,i);case"threshold":return eO(e,0,i);case"quantile":return sde(e,t,i);case"quantize":return function ade(e,t,{range:i,n=void 0===i?5:(i=[...i]).length,scheme:r="rdylbu",domain:s=tj(e,t),unknown:u,interpolate:h,reverse:_}){const[x,M]=qc(s);let S;return void 0===i?(S=Lx(x,M,n),S[0]<=x&&S.splice(0,1),S[S.length-1]>=M&&S.pop(),n=S.length+1,i=void 0!==h?Kc(h,n):to.get(e)===jh?bD(r,n):void 0):(S=Kc(As(x,M),n+1).slice(1,-1),x instanceof Date&&(S=S.map(P=>new Date(P)))),A0(sl(s))<0&&S.reverse(),eO(e,0,{domain:S,range:i,reverse:_,unknown:u})}(e,t,i);case"pow":return ej(e,t,i);case"log":return rde(e,t,i);case"symlog":return ode(e,t,i);case"utc":return function Mde(e,t,i){return ij(e,function gce(){return fd.apply(yP(ale,m8,Jc,HM,M0,jM,UM,BM,zh,f1).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}(),t,i)}(e,t,i);case"time":return function Ede(e,t,i){return ij(e,function mce(){return fd.apply(yP(lle,cle,Qc,$M,E0,C0,VM,zM,zh,GM).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}(),t,i)}(e,t,i);case"point":return function Tde(e,t,{align:i=.5,padding:n=.5,...r}){return oj(Gae().align(i).padding(n),t,r,e)}(e,t,i);case"band":return function Sde(e,t,{align:i=.5,padding:n=.1,paddingInner:r=n,paddingOuter:s=("fx"===e||"fy"===e?0:n),...u}){return oj(LM().align(i).paddingInner(r).paddingOuter(s),t,u,e)}(e,t,i);case"identity":return to.get(e)===_d?function cde(){return{type:"identity",scale:H6()}}():{type:"identity"};case void 0:return;default:throw new Error(`unknown scale type: ${n}`)}}function k0(e){return"symbol"==typeof e?e.description:e}const mj={toString:()=>"projection"};function rO(e){switch(e){case _d:return"point";case jh:return T1;default:return"ordinal"}}function oO({type:e}){return"time"===e||"utc"===e}function Ag({type:e}){return"ordinal"===e||"point"===e||"band"===e||e===T1}function gj({type:e}){return"threshold"===e}function Ql(e){if(void 0===e)return!0;const t=e.domain(),i=e(t[0]);for(let n=1,r=t.length;n<r;++n)if(e(t[n])-i)return!1;return!0}function wD(e,{domain:t,...i},n){for(const r of e)void 0!==r.value&&(r.value=n(r.value));return{domain:void 0===t?t:n(t),...i}}function Nde(e){return Oo(e,GP)}function Wh(e,t){return`${e}`.padStart(t,"0")}function sO(e){let t,i;return(...n)=>((i?.length!==n.length||i.some((r,s)=>r!==n[s]))&&(i=n,t=e(...n)),t)}const Ude=sO(e=>new Intl.NumberFormat(e));function Gde(e){return function Bde(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return"function"==typeof t?t(e):t;const i=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),s=e.getUTCMilliseconds();return`${function Vde(e){return e<0?`-${Wh(-e,6)}`:e>9999?`+${Wh(e,6)}`:Wh(e,4)}(e.getUTCFullYear())}-${Wh(e.getUTCMonth()+1,2)}-${Wh(e.getUTCDate(),2)}${i||n||r||s?`T${Wh(i,2)}:${Wh(n,2)}${r||s?`:${Wh(r,2)}${s?`.${Wh(s,3)}`:""}`:""}Z`:""}`}(e,"Invalid Date")}sO((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{month:t}})),sO((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{weekday:t}}));const Tp=function qde(e="en-US"){const t=function Hde(e="en-US"){const t=Ude(e);return i=>null==i||isNaN(i)?void 0:t.format(i)}(e);return i=>(i instanceof Date?Gde:"number"==typeof i?t:ia)(i)}(),al=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5;let Wde=0;function yj(){return"plot-clip-"+ ++Wde}function Zde(e,{title:t,href:i,ariaLabel:n,ariaDescription:r,ariaHidden:s,target:u,fill:h,fillOpacity:_,stroke:x,strokeWidth:M,strokeOpacity:S,strokeLinejoin:P,strokeLinecap:F,strokeMiterlimit:$,strokeDasharray:W,strokeDashoffset:X,opacity:K,mixBlendMode:Q,imageFilter:he,paintOrder:le,pointerEvents:ye,shapeRendering:Se,channels:Ue},{ariaLabel:Xe,fill:mt="currentColor",fillOpacity:bt,stroke:qe="none",strokeOpacity:St,strokeWidth:Nt,strokeLinecap:Ee,strokeLinejoin:Ie,strokeMiterlimit:Ce,paintOrder:je}){null===mt&&(h=null,_=null),null===qe&&(x=null,S=null),ka(mt)?!ka(qe)&&(!ka(h)||Ue?.fill)&&(qe="none"):ka(qe)&&(!ka(x)||Ue?.stroke)&&(mt="none");const[rt,Ke]=Bh(h,mt),[wt,It]=ol(_,bt),[At,rn]=Bh(x,qe),[vn,pi]=ol(S,St),[pr,Wt]=ol(K);w1(rn)||(void 0===M&&(M=Nt),void 0===F&&(F=Ee),void 0===P&&(P=Ie),void 0===$&&!function wue(e){return/^\s*round\s*$/i.test(e)}(P)&&($=Ce),!w1(Ke)&&void 0===le&&(le=je));const[Kt,ot]=ol(M);return null!==mt&&(e.fill=ko(Ke,"currentColor"),e.fillOpacity=S1(It,1)),null!==qe&&(e.stroke=ko(rn,"none"),e.strokeWidth=S1(ot,1),e.strokeOpacity=S1(pi,1),e.strokeLinejoin=ko(P,"miter"),e.strokeLinecap=ko(F,"butt"),e.strokeMiterlimit=S1($,4),e.strokeDasharray=ko(W,"none"),e.strokeDashoffset=ko(X,"0")),e.target=ia(u),e.ariaLabel=ia(Xe),e.ariaDescription=ia(r),e.ariaHidden=ia(s),e.opacity=S1(Wt,1),e.mixBlendMode=ko(Q,"normal"),e.imageFilter=ko(he,"none"),e.paintOrder=ko(le,"normal"),e.pointerEvents=ko(ye,"auto"),e.shapeRendering=ko(Se,"auto"),{title:{value:t,optional:!0,filter:null},href:{value:i,optional:!0,filter:null},ariaLabel:{value:n,optional:!0,filter:null},fill:{value:rt,scale:"auto",optional:!0},fillOpacity:{value:wt,scale:"auto",optional:!0},stroke:{value:At,scale:"auto",optional:!0},strokeOpacity:{value:vn,scale:"auto",optional:!0},strokeWidth:{value:Kt,optional:!0},opacity:{value:pr,scale:"auto",optional:!0}}}function Kde(e,t){t&&e.text(i=>Tp(t[i]))}function Pg(e,{target:t,tip:i},{ariaLabel:n,title:r,fill:s,fillOpacity:u,stroke:h,strokeOpacity:_,strokeWidth:x,opacity:M,href:S}){n&&$n(e,"aria-label",P=>n[P]),s&&$n(e,"fill",P=>s[P]),u&&$n(e,"fill-opacity",P=>u[P]),h&&$n(e,"stroke",P=>h[P]),_&&$n(e,"stroke-opacity",P=>_[P]),x&&$n(e,"stroke-width",P=>x[P]),M&&$n(e,"opacity",P=>M[P]),S&&function vj(e,t,i){e.each(function(n){const r=t(n);if(null!=r){const s=this.ownerDocument.createElementNS(c0.svg,"a");s.setAttribute("fill","inherit"),s.setAttributeNS(c0.xlink,"href",r),null!=i&&s.setAttribute("target",i),this.parentNode.insertBefore(s,this).appendChild(this)}})}(e,P=>S[P],t),i||function Xde(e,t){t&&e.filter(i=>cU(t[i])).append("title").call(Kde,t)}(e,r)}function Sp(e,t,i,n){(function nhe(e,t,i,n){let r;switch(t.clip){case"frame":{const{width:s,height:u,marginLeft:h,marginRight:_,marginTop:x,marginBottom:M}=i,S=yj();r=`url(#${S})`,e=ra("svg:g",n).call(P=>P.append("svg:clipPath").attr("id",S).append("rect").attr("x",h).attr("y",x).attr("width",s-_-h).attr("height",u-x-M)).each(function(){this.appendChild(e.node()),e.node=()=>this});break}case"sphere":{const{projection:s}=n;if(!s)throw new Error('the "sphere" clip option requires a projection');const u=yj();r=`url(#${u})`,e.append("clipPath").attr("id",u).append("path").attr("d",t6(s)({type:"Sphere"}));break}}$n(e,"aria-label",t.ariaLabel),$n(e,"aria-description",t.ariaDescription),$n(e,"aria-hidden",t.ariaHidden),$n(e,"clip-path",r)})(e,t,i,n),$n(e,"fill",t.fill),$n(e,"fill-opacity",t.fillOpacity),$n(e,"stroke",t.stroke),$n(e,"stroke-width",t.strokeWidth),$n(e,"stroke-opacity",t.strokeOpacity),$n(e,"stroke-linejoin",t.strokeLinejoin),$n(e,"stroke-linecap",t.strokeLinecap),$n(e,"stroke-miterlimit",t.strokeMiterlimit),$n(e,"stroke-dasharray",t.strokeDasharray),$n(e,"stroke-dashoffset",t.strokeDashoffset),$n(e,"shape-rendering",t.shapeRendering),$n(e,"filter",t.imageFilter),$n(e,"paint-order",t.paintOrder);const{pointerEvents:r=(!1===n.pointerSticky?"none":void 0)}=t;$n(e,"pointer-events",r)}function Ip(e,t){(function ihe(e,t,i){null!=i&&e.style(t,i)})(e,"mix-blend-mode",t.mixBlendMode),$n(e,"opacity",t.opacity)}function $n(e,t,i){null!=i&&e.attr(t,i)}function Zh(e,t,{x:i,y:n},r=al,s=al){r+=t.dx,s+=t.dy,i?.bandwidth&&(r+=i.bandwidth()/2),n?.bandwidth&&(s+=n.bandwidth()/2),(r||s)&&e.attr("transform",`translate(${r},${s})`)}function ko(e,t){if((e=ia(e))!==t)return e}function S1(e,t){if((e=Dr(e))!==t)return e}const rhe=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function aO(e){if(void 0===e)return"plot-d6a7b5";if(!rhe.test(e=`${e}`))throw new Error(`invalid class name: ${e}`);return e}function lO(e,t){if("string"==typeof t)e.property("style",t);else if(null!=t)for(const i of e)Object.assign(i.style,t)}function CD({frameAnchor:e},{width:t,height:i,marginTop:n,marginRight:r,marginBottom:s,marginLeft:u}){return[/left$/.test(e)?u:/right$/.test(e)?t-r:(u+t-r)/2,/^top/.test(e)?n:/^bottom/.test(e)?i-s:(n+i-s)/2]}function she({x:e,y:t,fy:i,fx:n},{projection:r,aspectRatio:s},{width:u,marginTopDefault:h,marginRightDefault:_,marginBottomDefault:x,marginLeftDefault:M}){const S=i?i.scale.domain().length:1,P=function Xue(e){if("function"==typeof e?.stream)return UU;if(Sg(e)&&(e=e.type),null!=e){if("function"!=typeof e){const{aspectRatio:t}=jU(e);if(t)return t}return UU}}(r);if(P){const $=n?n.scale.domain().length:1,X=Math.max(.1,Math.min(10,(1.1*S-.1)/(1.1*$-.1)*P));return Math.round((u-M-_)*X+h+x)}const F=t?Ag(t)?t.scale.domain().length:Math.max(7,17/S):1;if(null!=s){if(s=+s,!(isFinite(s)&&s>0))throw new Error(`invalid aspectRatio: ${s}`);const $=bj("y",t)/(bj("x",e)*s),W=n?n.scale.bandwidth():1,X=i?i.scale.bandwidth():1;return($*(W*(u-M-_)-e.insetLeft-e.insetRight)+t.insetTop+t.insetBottom)/X+h+x}return!(!t&&!i)*Math.max(1,Math.min(60,F*S))*20+30*!!n+60}function bj(e,t){if(!t)throw new Error(`aspectRatio requires ${e} scale`);const{type:i,domain:n}=t;let r;switch(i){case"linear":case"utc":case"time":r=Number;break;case"pow":{const h=t.scale.exponent();r=_=>Math.pow(_,h);break}case"log":r=Math.log;break;case"point":case"band":return n.length;default:throw new Error(`unsupported ${e} scale for aspectRatio: ${i}`)}const[s,u]=qc(n);return Math.abs(r(u)-r(s))}function cO(e,{fx:t,fy:i}){const n=md(e),r=t?.value,s=i?.value;return t&&i?s0(n,u=>(u.fx=r[u[0]],u.fy=s[u[0]],u),u=>r[u],u=>s[u]):t?s0(n,u=>(u.fx=r[u[0]],u),u=>r[u]):s0(n,u=>(u.fy=s[u[0]],u),u=>s[u])}function uhe(e){const t=[],i=new Uint32Array(bp(e,n=>n.length));for(const n of e){let r=0;for(const s of e)n!==s&&(i.set(s,r),r+=s.length);t.push(i.slice(0,r))}return t}const dhe=new Map([["top",dO],["right",pO],["bottom",hO],["left",fO],["top-left",MD(dO,fO)],["top-right",MD(dO,pO)],["bottom-left",MD(hO,fO)],["bottom-right",MD(hO,pO)],["top-empty",function phe(e,{y:t},{x:i,y:n,empty:r}){if(r)return!1;if(!t)return;const s=Ap(t,n);return s>0?ED(e,i,t[s-1]):void 0}],["right-empty",function _he(e,{x:t},{x:i,y:n,empty:r}){if(r)return!1;if(!t)return;const s=Ap(t,i);return s<t.length-1?ED(e,t[s+1],n):void 0}],["bottom-empty",function mhe(e,{y:t},{x:i,y:n,empty:r}){if(r)return!1;if(!t)return;const s=Ap(t,n);return s<t.length-1?ED(e,i,t[s+1]):void 0}],["left-empty",function ghe(e,{x:t},{x:i,y:n,empty:r}){if(r)return!1;if(!t)return;const s=Ap(t,i);return s>0?ED(e,t[s-1],n):void 0}],["empty",function yhe(e,t,{empty:i}){return i}]]),xj=new WeakMap;function uO(e){let t=xj.get(e);return t||xj.set(e,t=new hg(Oo(e,(i,n)=>[i,n]))),t}function Ap(e,t){return uO(e).get(t)}function ED(e,t,i){return function fhe(e,t,i){return t=lD(t),i=lD(i),e.find(n=>Object.is(lD(n.x),t)&&Object.is(lD(n.y),i))}(e,t,i)?.empty}function dO(e,{y:t},{y:i}){return!t||0===Ap(t,i)}function hO(e,{y:t},{y:i}){return!t||Ap(t,i)===t.length-1}function fO(e,{x:t},{x:i}){return!t||0===Ap(t,i)}function pO(e,{x:t},{x:i}){return!t||Ap(t,i)===t.length-1}function MD(e,t){return function(){return e.apply(null,arguments)&&t.apply(null,arguments)}}function mO(e,{channels:{fx:t,fy:i},groups:n}){return e.map(t&&i?({x:r,y:s})=>n.get(r)?.get(s)??[]:t?({x:r})=>n.get(r)??[]:({y:r})=>n.get(r)??[])}function DD({filter:e,sort:t,reverse:i,transform:n,initializer:r,...s}={},u){if(void 0===n&&(null!=e&&(n=yO(e)),null!=t&&!b1(t)&&(n=gO(n,bO(t))),i&&(n=gO(n,vO))),null!=u&&null!=r)throw new Error("transforms cannot be applied after initializers");return{...s,...(null===t||b1(t))&&{sort:t},transform:gO(n,u)}}function R0({filter:e,sort:t,reverse:i,initializer:n,...r}={},s){return void 0===n&&(null!=e&&(n=yO(e)),null!=t&&!b1(t)&&(n=_O(n,bO(t))),i&&(n=_O(n,vO))),{...r,...(null===t||b1(t))&&{sort:t},initializer:_O(n,s)}}function gO(e,t){return null==e?null===t?void 0:t:null==t?null===e?void 0:e:function(i,n,r){return({data:i,facets:n}=e.call(this,i,n,r)),t.call(this,sl(i),n,r)}}function _O(e,t){return null==e?null===t?void 0:t:null==t?null===e?void 0:e:function(i,n,r,...s){let u,h,_,x,M,S;return({data:h=i,facets:_=n,channels:u}=e.call(this,i,n,r,...s)),({data:M=h,facets:S=_,channels:x}=t.call(this,h,_,{...r,...u},...s)),{data:M,facets:S,channels:{...u,...x}}}}function yO(e){return(t,i)=>{const n=Go(t,e);return{data:t,facets:i.map(r=>r.filter(s=>n[s]))}}}function vO(e,t){return{data:e,facets:t.map(i=>i.slice().reverse())}}function bO(e){return("function"==typeof e&&1!==e.length?vhe:wj)(e)}function vhe(e){return(t,i)=>{const n=(r,s)=>e(t[r],t[s]);return{data:t,facets:i.map(r=>r.slice().sort(n))}}}function wj(e){let t,i;({channel:t,value:e,order:i}={...x1(e)});const n=t?.startsWith("-");if(n&&(t=t.slice(1)),void 0===i&&(i=n?nD:eu),"function"!=typeof i)switch(`${i}`.toLowerCase()){case"ascending":i=eu;break;case"descending":i=nD;break;default:throw new Error(`invalid order: ${i}`)}return(r,s,u)=>{let h;if(void 0===t)h=Go(r,e);else{if(void 0===u)throw new Error("channel sort requires an initializer");if(h=u[t],!h)return{};h=h.value}const _=(x,M)=>i(h[x],h[M]);return{data:r,facets:s.map(x=>x.slice().sort(_))}}}class iu{constructor(t,i={},n={},r){const{facet:s="auto",facetAnchor:u,fx:h,fy:_,sort:x,dx:M=0,dy:S=0,margin:P=0,marginTop:F=P,marginRight:$=P,marginBottom:W=P,marginLeft:X=P,clip:K,channels:Q,tip:he,render:le}=n;if(this.data=t,this.sort=b1(x)?x:null,this.initializer=R0(n).initializer,this.transform=this.initializer?n.transform:DD(n).transform,null===s||!1===s?this.facet=null:(this.facet=Vh(!0===s?"include":s,"facet",["auto","include","exclude","super"]),this.fx=t===rD&&"string"==typeof h?[h]:h,this.fy=t===rD&&"string"==typeof _?[_]:_),this.facetAnchor=function hhe(e){if(null==e)return null;const t=dhe.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid facet anchor: ${e}`)}(u),i=IU(i),void 0!==Q&&(i={...(e=Q,Object.fromEntries(Object.entries(IU(e)).map(([t,i])=>(void 0===(i=x1(i)).filter&&null==i.scale&&(i={...i,filter:null}),[t,i])))),...i}),void 0!==r&&(i={...Zde(this,n,r),...i}),this.channels=Object.fromEntries(Object.entries(i).map(([ye,Se])=>{if(zP(Se.value)){const{value:Ue,scale:Xe=Se.scale}=Se.value;Se={...Se,scale:Xe,value:Ue}}if(t===rD&&"string"==typeof Se.value){const{value:Ue}=Se;Se={...Se,value:[Ue]}}return[ye,Se]}).filter(([ye,{value:Se,optional:Ue}])=>{if(null!=Se)return!0;if(Ue)return!1;throw new Error(`missing channel value: ${ye}`)})),this.dx=+M,this.dy=+S,this.marginTop=+F,this.marginRight=+$,this.marginBottom=+W,this.marginLeft=+X,this.clip=function the(e){return!0===e?e="frame":!1===e&&(e=null),aD(e,"clip",["frame","sphere"])}(K),this.tip=function xhe(e){return!0===e?"xy":!1===e?null:aD(e,"tip",["x","y","xy"])}(he),"super"===this.facet){if(h||_)throw new Error("super-faceting cannot use fx or fy");for(const ye in this.channels){const{scale:Se}=i[ye];if("x"===Se||"y"===Se)throw new Error("super-faceting cannot use x or y")}}var e;null!=le&&(this.render=Ej(le,this.render))}initialize(t,i,n){let r=sl(this.data);void 0===t&&null!=r&&(t=[md(r)]);const s=t;null!=this.transform&&(({facets:t,data:r}=this.transform(r,t,n)),r=sl(r)),void 0!==t&&(t.original=s);const u=function Nue(e,t){return Object.fromEntries(Object.entries(e).map(([i,n])=>[i,E1(t,n,i)]))}(this.channels,r);return null!=this.sort&&function Bue(e,t,i,n,r){const{order:s,reverse:u,reduce:h=!0,limit:_}=r;for(const x in r){if(!to.has(x))continue;let{value:M,order:S=s,reverse:P=u,reduce:F=h,limit:$=_}=x1(r[x]);const W=M?.startsWith("-");if(W&&(M=M.slice(1)),S=void 0===S?W!==("width"===M||"height"===M)?BU:zU:jue(S),null==F||!1===F)continue;const X="fx"===x||"fy"===x?Uue(t,n[x]):Vue(i,x);if(!X)throw new Error(`missing channel for scale: ${x}`);const K=X.value,[Q=0,he=1/0]=gd($)?$:$<0?[$]:[0,$];if(null==M)X.domain=()=>{let le=Array.from(new WI(K));return P&&(le=le.reverse()),(0!==Q||he!==1/0)&&(le=le.slice(Q,he)),le};else{const le="data"===M?e:"height"===M?NU(i,"y1","y2"):"width"===M?NU(i,"x1","x2"):XP(i,M,"y"===M?"y2":"x"===M?"x2":void 0),ye=_D(!0===F?"max":F,le);X.domain=()=>{let Se=_z(md(K),Ue=>ye.reduceIndex(Ue,le),Ue=>K[Ue]);return S&&Se.sort(S),P&&Se.reverse(),(0!==Q||he!==1/0)&&(Se=Se.slice(Q,he)),Se.map(OP)}}}}(r,t,u,i,this.sort),{data:r,facets:t,channels:u}}filter(t,i,n){for(const r in i){const{filter:s=Dg}=i[r];if(null!==s){const u=n[r];t=t.filter(h=>s(u[h]))}}return t}project(t,i,n){for(const r in t)if("x"===t[r].scale&&/^x|x$/.test(r)){const s=r.replace(/^x|x$/,"y");s in t&&"y"===t[s].scale&&HU(r,s,i,n.projection)}}scale(t,i,n){const r=function zue(e,t){const i=Object.fromEntries(Object.entries(e).map(([n,{scale:r,value:s}])=>{const u=null==r?null:t[r];return[n,null==u?s:Oo(s,u)]}));return i.channels=e,i}(t,i);return n.projection&&this.project(t,r,n),r}}function Cj(...e){return e.plot=iu.prototype.plot,e}function Ej(e,t){if(null==e)return null===t?void 0:t;if(null==t)return null===e?void 0:e;if("function"!=typeof e)throw new TypeError(`invalid render transform: ${e}`);if("function"!=typeof t)throw new TypeError(`invalid render transform: ${t}`);return function(i,n,r,s,u,h){return e.call(this,i,n,r,s,u,(_,x,M,S,P)=>t.call(this,_,x,M,S,P,h))}}function SD(e,t){return!0===e?.tip?{...e,tip:t}:e}const Mj=new WeakMap;function xO(e,t,{x:i,y:n,px:r,py:s,maxRadius:u=40,channels:h,render:_,...x}={}){return u=+u,null!=r&&(i??=null,h={...h,px:{value:r,scale:"x"}}),null!=s&&(n??=null,h={...h,py:{value:s,scale:"y"}}),{x:i,y:n,channels:h,...x,render:Ej(function(M,S,P,F,$,W){const X=($={...$,pointerSticky:!1}).ownerSVGElement,{data:K}=$.getMarkState(this);let Q=Mj.get(X);Q||Mj.set(X,Q={sticky:!1,roots:[],renders:[]});let he=Q.renders.push(rn)-1;const{x:le,y:ye,fx:Se,fy:Ue}=S;let Xe=Se?Se(M.fx)-F.marginLeft:0,mt=Ue?Ue(M.fy)-F.marginTop:0;le?.bandwidth&&(Xe+=le.bandwidth()/2),ye?.bandwidth&&(mt+=ye.bandwidth()/2);const bt=null!=M.fi;let qe;if(bt){let Wt=Q.facetStates;Wt||(Q.facetStates=Wt=new Map),qe=Wt.get(this),qe||Wt.set(this,qe=new Map)}const[St,Nt]=CD(this,F),{px:Ee,py:Ie}=P,Ce=Ee?Wt=>Ee[Wt]:Dj(P,St),je=Ie?Wt=>Ie[Wt]:Tj(P,Nt);let rt,Ke,wt,It;function At(Wt,Kt){if(bt){if(It&&(It=cancelAnimationFrame(It)),null!=Wt)return qe.set(M.fi,Kt),void(It=requestAnimationFrame(()=>{It=null;for(const ot of qe.values())if(ot<Kt){Wt=null;break}rn(Wt)}));qe.delete(M.fi)}rn(Wt)}function rn(Wt){if(rt===Wt&&wt===Q.sticky)return;rt=Wt,wt=$.pointerSticky=Q.sticky;const Kt=null==rt?[]:[rt];bt&&(Kt.fx=M.fx,Kt.fy=M.fy,Kt.fi=M.fi);const ot=W(Kt,S,P,F,$);if(Ke){if(bt){const Qt=Ke.parentNode,tn=Ke.getAttribute("transform"),tt=ot.getAttribute("transform");tn?ot.setAttribute("transform",tn):ot.removeAttribute("transform"),tt?Qt.setAttribute("transform",tt):Qt.removeAttribute("transform"),ot.removeAttribute("aria-label"),ot.removeAttribute("aria-description"),ot.removeAttribute("aria-hidden")}Ke.replaceWith(ot)}return Q.roots[he]=Ke=ot,$.dispatchValue(null==rt?null:K[rt]),ot}function vn(Wt){if(Q.sticky||"mouse"===Wt.pointerType&&1===Wt.buttons)return;let[Kt,ot]=function Rce(e,t){if(e=function kce(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var i=t.ownerSVGElement||t;if(i.createSVGPoint){var n=i.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,[(n=n.matrixTransform(t.getScreenCTM().inverse())).x,n.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}(Wt);Kt-=Xe,ot-=mt;let Qt=null,tn=u*u;for(const tt of M){const hn=e*(Ce(tt)-Kt),Bn=t*(je(tt)-ot),Ii=hn*hn+Bn*Bn;Ii<=tn&&(Qt=tt,tn=Ii)}At(Qt,tn)}return X.addEventListener("pointerenter",vn),X.addEventListener("pointermove",vn),X.addEventListener("pointerdown",function pi(Wt){"mouse"===Wt.pointerType&&null!=rt&&(Q.sticky&&Q.roots.some(Kt=>Kt?.contains(Wt.target))||(Q.sticky?(Q.sticky=!1,Q.renders.forEach(Kt=>Kt(null))):(Q.sticky=!0,rn(rt)),Wt.stopImmediatePropagation()))}),X.addEventListener("pointerleave",function pr(Wt){"mouse"===Wt.pointerType&&(Q.sticky||At(null))}),rn(null)},_)}}function whe(e){return xO(1,1,e)}function Che(e){return xO(1,.01,e)}function Ehe(e){return xO(.01,1,e)}function Dj({x1:e,x2:t,x:i=e},n){return e&&t?r=>(e[r]+t[r])/2:i?r=>i[r]:()=>n}function Tj({y1:e,y2:t,y:i=e},n){return e&&t?r=>(e[r]+t[r])/2:i?r=>i[r]:()=>n}function Sj(e){return Ag(e)&&void 0===e.interval?void 0:"tabular-nums"}const Ij=Math.PI/180;function Aj(e,{marker:t,markerStart:i=t,markerMid:n=t,markerEnd:r=t}={}){e.markerStart=wO(i),e.markerMid=wO(n),e.markerEnd=wO(r)}function wO(e){if(null==e||!1===e)return null;if(!0===e)return Oj;if("function"==typeof e)return e;switch(`${e}`.toLowerCase()){case"none":return null;case"arrow":return Pj("auto");case"arrow-reverse":return Pj("auto-start-reverse");case"dot":return Dhe;case"circle":case"circle-fill":return Oj;case"circle-stroke":return The}throw new Error(`invalid marker: ${e}`)}function Pj(e){return(t,i)=>ra("svg:marker",i).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",e).attr("fill","none").attr("stroke",t).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(n=>n.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function Dhe(e,t){return ra("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","none").call(i=>i.append("circle").attr("r",2.5)).node()}function Oj(e,t){return ra("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","white").attr("stroke-width",1.5).call(i=>i.append("circle").attr("r",3)).node()}function The(e,t){return ra("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","white").attr("stroke",e).attr("stroke-width",1.5).call(i=>i.append("circle").attr("r",3)).node()}let She=0;function kj(e,t,{stroke:i},n){return function Rj(e,{markerStart:t,markerMid:i,markerEnd:n,stroke:r},s=(()=>r),u){const h=new Map;function _(x){return function(M){const S=s(M);let P=h.get(x);P||h.set(x,P=new Map);let F=P.get(S);if(!F){const $=this.parentNode.insertBefore(x(S,u),this),W="plot-marker-"+ ++She;$.setAttribute("id",W),P.set(S,F=`url(#${W})`)}return F}}t&&e.attr("marker-start",_(t)),i&&e.attr("marker-mid",_(i)),n&&e.attr("marker-end",_(n))}(e,t,i&&(r=>i[r]),n)}function ID({inset:e,insetLeft:t,insetRight:i,...n}={}){return[t,i]=Fj(e,t,i),{inset:e,insetLeft:t,insetRight:i,...n}}function Lj({inset:e,insetTop:t,insetBottom:i,...n}={}){return[t,i]=Fj(e,t,i),{inset:e,insetTop:t,insetBottom:i,...n}}function Fj(e,t,i){return void 0===e&&void 0===t&&void 0===i?al?[1,0]:[.5,.5]:[t,i]}function Nj(e,{interval:t}){return(e={...x1(e)}).interval=VP(void 0===e.interval?t:e.interval),e}function AD(e,t,i,n){const{[e]:r,[`${e}1`]:s,[`${e}2`]:u}=i,{value:h,interval:_}=Nj(r,i);if(null==h||null==_&&!n)return i;const x=Ig(r);if(null==_){let F;const $={transform:W=>F||(F=Go(W,h)),label:x};return{...i,[e]:void 0,[`${e}1`]:void 0===s?$:s,[`${e}2`]:void 0===u?$:u}}let M,S;function P(F){return void 0!==S&&F===M?S:S=Oo(Go(M=F,h),$=>_.floor($))}return t({...i,[e]:void 0,[`${e}1`]:void 0===s?{transform:P,label:x}:s,[`${e}2`]:void 0===u?{transform:F=>P(F).map($=>_.offset($)),label:x}:u})}function zj(e,t,i){const{[e]:n}=i,{value:r,interval:s}=Nj(n,i);return null==r||null==s?i:t({...i,[e]:{label:Ig(n),transform:u=>{const h=Oo(Go(u,r),x=>s.floor(x)),_=h.map(x=>s.offset(x));return h.map(tu(h)?(x,M)=>null==x||isNaN(x=+x)||null==(M=_[M])||isNaN(M=+M)?void 0:new Date((x+M)/2):(x,M)=>null==x||null==(M=_[M])?NaN:(+x+ +M)/2)}}})}function Bj(e={}){return AD("x",ID,e)}function Vj(e={}){return AD("y",Lj,e)}const Uj={ariaLabel:"rule",fill:null,stroke:"currentColor"};class Ohe extends iu{constructor(t,i={}){const{x:n,y1:r,y2:s,inset:u=0,insetTop:h=u,insetBottom:_=u}=i;super(t,{x:{value:n,scale:"x",optional:!0},y1:{value:r,scale:"y",optional:!0},y2:{value:s,scale:"y",optional:!0}},SD(i,"x"),Uj),this.insetTop=Dr(h),this.insetBottom=Dr(_),Aj(this,i)}render(t,i,n,r,s){const{x:u,y:h}=i,{x:_,y1:x,y2:M}=n,{width:S,height:P,marginTop:F,marginRight:$,marginLeft:W,marginBottom:X}=r,{insetTop:K,insetBottom:Q}=this;return ra("svg:g",s).call(Sp,this,r,s).call(Zh,this,{x:_&&u},al,0).call(he=>he.selectAll().data(t).enter().append("line").call(Ip,this).attr("x1",_?le=>_[le]:(W+S-$)/2).attr("x2",_?le=>_[le]:(W+S-$)/2).attr("y1",x&&!Ql(h)?le=>x[le]+K:F+K).attr("y2",M&&!Ql(h)?h.bandwidth?le=>M[le]+h.bandwidth()-Q:le=>M[le]-Q:P-X-Q).call(Pg,this,n).call(kj,this,n,s)).node()}}class khe extends iu{constructor(t,i={}){const{x1:n,x2:r,y:s,inset:u=0,insetRight:h=u,insetLeft:_=u}=i;super(t,{y:{value:s,scale:"y",optional:!0},x1:{value:n,scale:"x",optional:!0},x2:{value:r,scale:"x",optional:!0}},SD(i,"y"),Uj),this.insetRight=Dr(h),this.insetLeft=Dr(_),Aj(this,i)}render(t,i,n,r,s){const{x:u,y:h}=i,{y:_,x1:x,x2:M}=n,{width:S,height:P,marginTop:F,marginRight:$,marginLeft:W,marginBottom:X}=r,{insetLeft:K,insetRight:Q}=this;return ra("svg:g",s).call(Sp,this,r,s).call(Zh,this,{y:_&&h},0,al).call(he=>he.selectAll().data(t).enter().append("line").call(Ip,this).attr("x1",x&&!Ql(u)?le=>x[le]+K:W+K).attr("x2",M&&!Ql(u)?u.bandwidth?le=>M[le]+u.bandwidth()-Q:le=>M[le]-Q:S-$-Q).attr("y1",_?le=>_[le]:(F+P-X)/2).attr("y2",_?le=>_[le]:(F+P-X)/2).call(Pg,this,n).call(kj,this,n,s)).node()}}function PD(e,t){let{x:i=ss,y:n,y1:r,y2:s,...u}=Vj(t);return[r,s]=jj(n,r,s),new Ohe(e,{...u,x:i,y1:r,y2:s})}function CO(e,t){let{y:i=ss,x:n,x1:r,x2:s,...u}=Bj(t);return[r,s]=jj(n,r,s),new khe(e,{...u,y:i,x1:r,x2:s})}function jj(e,t,i){if(null==e){if(void 0===t){if(void 0!==i)return[0,i]}else if(void 0===i)return[0,t]}else{if(void 0===t)return void 0===i?[0,e]:[e,i];if(void 0===i)return[e,t]}return[t,i]}function $j(e,...t){let i=t.length;for(let n=0,r=!0;n<i;++n)"function"!=typeof t[n]&&(r&&(e=e.slice(),r=!1),e.splice(n,2,e[n]+t[n]+e[n+1]),t.splice(n,1),--n,--i);return n=>{let r=e[0];for(let s=0;s<i;++s)r+=t[s](n)+e[s+1];return r}}const Rhe={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},Hj="\xad";class EO extends iu{constructor(t,i={}){const{x:n,y:r,text:s=(gd(t)&&DU(t)?ss:oD),frameAnchor:u,textAnchor:h=(/right$/i.test(u)?"end":/left$/i.test(u)?"start":"middle"),lineAnchor:_=(/^top/i.test(u)?"top":/^bottom/i.test(u)?"bottom":"middle"),lineHeight:x=1,lineWidth:M=1/0,textOverflow:S,monospace:P,fontFamily:F=(P?"ui-monospace, monospace":void 0),fontSize:$,fontStyle:W,fontVariant:X,fontWeight:K,rotate:Q}=i,[he,le]=ol(Q,0),[ye,Se]=function Vhe(e){return null==e||"number"==typeof e?[void 0,e]:"string"!=typeof e?[e,void 0]:(e=e.trim().toLowerCase(),Bhe.has(e)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(e)?[void 0,e]:[e,void 0])}($);if(super(t,{x:{value:n,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},fontSize:{value:ye,optional:!0},rotate:{value:(e=he,null==e?null:{transform:t=>Go(t,e,Float64Array),label:Ig(e)}),optional:!0},text:{value:s,filter:cU,optional:!0}},i,Rhe),this.rotate=le,this.textAnchor=ko(h,"middle"),this.lineAnchor=Vh(_,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+x,this.lineWidth=+M,this.textOverflow=Gj(S),this.monospace=!!P,this.fontFamily=ia(F),this.fontSize=Se,this.fontStyle=ia(W),this.fontVariant=ia(X),this.fontWeight=ia(K),this.frameAnchor=jP(u),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${M}`);var e;this.splitLines=Zj(this),this.clipLine=Xj(this)}render(t,i,n,r,s){const{x:u,y:h}=i,{x:_,y:x,rotate:M,text:S,title:P,fontSize:F}=n,{rotate:$}=this,[W,X]=CD(this,r);return ra("svg:g",s).call(Sp,this,r,s).call(qj,this,S,r).call(Zh,this,{x:_&&u,y:x&&h}).call(K=>K.selectAll().data(t).enter().append("text").call(Ip,this).call(Lhe,this,S,P).attr("transform",$j`translate(${_?Q=>_[Q]:W},${x?Q=>x[Q]:X})${M?Q=>` rotate(${M[Q]})`:$?` rotate(${$})`:""}`).call($n,"font-size",F&&(Q=>F[Q])).call(Pg,this,n)).node()}}function Gj(e){return null==e?null:Vh(e,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function Lhe(e,t,i,n){if(!i)return;const{lineAnchor:r,lineHeight:s,textOverflow:u,splitLines:h,clipLine:_}=t;e.each(function(x){const M=h(Tp(i[x])??"").map(_),S=M.length,P="top"===r?.71:"bottom"===r?1-S:(164-100*S)/200;if(S>1){let F=0;for(let $=0;$<S;++$){if(++F,!M[$])continue;const W=this.ownerDocument.createElementNS(c0.svg,"tspan");W.setAttribute("x",0),$===F-1?W.setAttribute("y",(P+$)*s+"em"):W.setAttribute("dy",F*s+"em"),W.textContent=M[$],this.appendChild(W),F=0}}else P&&this.setAttribute("y",P*s+"em"),this.textContent=M[0];if(u&&!n&&M[0]!==i[x]){const F=this.ownerDocument.createElementNS(c0.svg,"title");F.textContent=i[x],this.appendChild(F)}})}function I1(e,{x:t,y:i,...n}={}){return void 0===n.frameAnchor&&([t,i]=CU(t,i)),new EO(e,{...n,x:t,y:i})}function Fhe(e,{x:t=ss,...i}={}){return new EO(e,function Phe(e={}){return zj("y",Lj,e)}({...i,x:t}))}function Nhe(e,{y:t=ss,...i}={}){return new EO(e,function Ahe(e={}){return zj("x",ID,e)}({...i,y:t}))}function qj(e,t,i){$n(e,"text-anchor",t.textAnchor),$n(e,"font-family",t.fontFamily),$n(e,"font-size",t.fontSize),$n(e,"font-style",t.fontStyle),$n(e,"font-variant",void 0===t.fontVariant?function zhe(e){return e&&(function bue(e){for(const t of e)if(null!=t)return"number"==typeof t}(e)||tu(e))?"tabular-nums":void 0}(i):t.fontVariant),$n(e,"font-weight",t.fontWeight)}const Bhe=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);const Wj={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"\u2018":31,"\u2019":31,"\u201c":47,"\u201d":47,"\u2026":82};function MO(e,t=0,i=e.length){let n=0;for(let r=t;r<i;r=N0(e,r))n+=Wj[e[r]]??(e7(e,r)?120:Wj.e);return n}function DO(e,t=0,i=e.length){let n=0;for(let r=t;r<i;r=N0(e,r))n+=e7(e,r)?200:100;return n}function Zj({monospace:e,lineWidth:t,textOverflow:i}){if(null!=i||t==1/0)return s=>s.split(/\r\n?|\n/g);const n=e?DO:MO,r=100*t;return s=>function Uhe(e,t,i){const n=[];let r,s=0;for(const[u,h,_]of function*jhe(e){let t=0,i=0;const n=e.length;for(;i<n;){let r=1;switch(e[i]){case Hj:case"-":++i,yield[t,i,!1],t=i;break;case" ":for(yield[t,i,!1];" "===e[++i];);t=i;break;case"\r":"\n"===e[i+1]&&++r;case"\n":yield[t,i,!0],i+=r,t=i;break;default:++i}}yield[t,i,!0]}(e))void 0===r&&(r=u),s>r&&i(e,r,h)>t&&(n.push(e.slice(r,s)+(e[s-1]===Hj?"-":"")),r=u),_?(n.push(e.slice(r,h)),r=void 0):s=h;return n}(s,r,n)}function Xj({monospace:e,lineWidth:t,textOverflow:i}){if(null==i||t==1/0)return s=>s;const n=e?DO:MO,r=100*t;switch(i){case"clip-start":return s=>Kj(s,r,n,"");case"clip-end":return s=>Yj(s,r,n,"");case"ellipsis-start":return s=>Kj(s,r,n,L0);case"ellipsis-middle":return s=>function $he(e,t,i,n){const r=i(e=e.trim());if(r<=t)return e;const s=i(n)/2,[u,h]=F0(e,t/2,i,s),[_]=F0(e,r-t/2-h+s,i,-s);return _<0?n:e.slice(0,u).trimEnd()+n+e.slice(N0(e,_)).trimStart()}(s,r,n,L0);case"ellipsis-end":return s=>Yj(s,r,n,L0)}}const L0="\u2026";function F0(e,t,i,n){const r=[];let s=0;for(let u=0,h=0,_=e.length;u<_;u=h){h=N0(e,u);const x=i(e,u,h);if(s+x>t){for(s+=n;s>t&&u>0;)h=u,u=r.pop(),s-=i(e,u,h);return[u,t-s]}s+=x,r.push(u)}return[-1,0]}function Yj(e,t,i,n){e=e.trim();const r=i(n),[s]=F0(e,t,i,r);return s<0?e:e.slice(0,s).trimEnd()+n}function Kj(e,t,i,n){const r=i(e=e.trim());if(r<=t)return e;const s=i(n),[u]=F0(e,r-t+s,i,-s);return u<0?n:n+e.slice(N0(e,u)).trimStart()}const TO=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,Qj=/\p{Extended_Pictographic}/uy;function N0(e,t){return t+=function Hhe(e,t){const i=e.charCodeAt(t);if(i>=55296&&i<56320){const n=e.charCodeAt(t+1);return n>=56320&&n<57344}return!1}(e,t)?2:1,function qhe(e,t){return!Jj(e,t)&&(TO.lastIndex=t,TO.test(e))}(e,t)&&(t=TO.lastIndex),function Ghe(e,t){return 8205===e.charCodeAt(t)}(e,t)?N0(e,t+1):t}function Jj(e,t){return e.charCodeAt(t)<128}function e7(e,t){return!Jj(e,t)&&(Qj.lastIndex=t,Qj.test(e))}const t7={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},n7=3.5,Whe=5*n7,i7={draw(e,t,i){const n=t*i/Whe;e.moveTo(0,0),e.lineTo(0,-t),e.moveTo(-n,n-t),e.lineTo(0,-t),e.lineTo(n,n-t)}},Zhe=new Map([["arrow",i7],["spike",{draw(e,t,i){e.moveTo(-i,0),e.lineTo(0,-t),e.lineTo(i,0)}}]]);class SO extends iu{constructor(t,i={}){const{x:n,y:r,r:s=n7,length:u,rotate:h,shape:_=i7,anchor:x="middle",frameAnchor:M}=i,[S,P]=ol(u,12),[F,$]=ol(h,0);super(t,{x:{value:n,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},length:{value:S,scale:"length",optional:!0},rotate:{value:F,optional:!0}},i,t7),this.r=+s,this.length=P,this.rotate=$,this.shape=function Yhe(e){if(function Xhe(e){return e&&"function"==typeof e.draw}(e))return e;const t=Zhe.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid shape: ${e}`)}(_),this.anchor=Vh(x,"anchor",["start","middle","end"]),this.frameAnchor=jP(M)}render(t,i,n,r,s){const{x:u,y:h}=i,{x:_,y:x,length:M,rotate:S}=n,{length:P,rotate:F,anchor:$,shape:W,r:X}=this,[K,Q]=CD(this,r);return ra("svg:g",s).call(Sp,this,r,s).call(Zh,this,{x:_&&u,y:x&&h}).call(he=>he.selectAll().data(t).enter().append("path").call(Ip,this).attr("transform",$j`translate(${_?le=>_[le]:K},${x?le=>x[le]:Q})${S?le=>` rotate(${S[le]})`:F?` rotate(${F})`:""}${"start"===$?"":"end"===$?M?le=>` translate(0,${M[le]})`:` translate(0,${P})`:M?le=>` translate(0,${M[le]/2})`:` translate(0,${P/2})`}`).attr("d",M?le=>{const ye=rP();return W.draw(ye,M[le],X),ye}:(()=>{const le=rP();return W.draw(le,P,X),le})()).call(Pg,this,n)).node()}}function Qhe(e,t={}){const{x:i=ss,...n}=t;return new SO(e,{...n,x:i})}function Jhe(e,t={}){const{y:i=ss,...n}=t;return new SO(e,{...n,y:i})}function Pp(e,t){return arguments.length<2&&!gd(e)&&(t=e,e=null),void 0===t&&(t={}),[e,t]}function OD({anchor:e}={},t){return void 0===e?t[0]:Vh(e,"anchor",t)}function o7(e){return OD(e,["left","right"])}function s7(e){return OD(e,["right","left"])}function a7(e){return OD(e,["bottom","top"])}function l7(e){return OD(e,["top","bottom"])}function c7(){const[e,t]=Pp(...arguments);return d7("y",o7(t),e,t)}function efe(){const[e,t]=Pp(...arguments);return d7("fy",s7(t),e,t)}function u7(){const[e,t]=Pp(...arguments);return h7("x",a7(t),e,t)}function tfe(){const[e,t]=Pp(...arguments);return h7("fx",l7(t),e,t)}function d7(e,t,i,{color:n="currentColor",opacity:r=1,stroke:s=n,strokeOpacity:u=r,strokeWidth:h=1,fill:_=n,fillOpacity:x=r,textAnchor:M,textStroke:S,textStrokeOpacity:P,textStrokeWidth:F,tickSize:$=("y"===e?6:0),tickPadding:W,tickRotate:X,x:K,margin:Q,marginTop:he=(void 0===Q?20:Q),marginRight:le=(void 0===Q?"right"===t?40:0:Q),marginBottom:ye=(void 0===Q?20:Q),marginLeft:Se=(void 0===Q?"left"===t?40:0:Q),label:Ue,labelAnchor:Xe,labelArrow:mt,labelOffset:bt,...qe}){return $=Dr($),W=Dr(W),X=Dr(X),void 0!==Xe&&(Xe=Vh(Xe,"labelAnchor",["center","top","bottom"])),mt=b7(mt),Cj($&&!ka(s)?function nfe(e,t,i,{strokeWidth:n=1,strokeLinecap:r=null,strokeLinejoin:s=null,facetAnchor:u=t+("y"===e?"-empty":""),frameAnchor:h=t,tickSize:_,inset:x=0,insetLeft:M=x,insetRight:S=x,dx:P=0,y:F=("y"===e?void 0:null),...$}){return z0(Jhe,e,`${e}-axis tick`,i,{strokeWidth:n,strokeLinecap:r,strokeLinejoin:s,facetAnchor:u,frameAnchor:h,y:F,...$,dx:"left"===t?+P-al+ +M:+P+al-S,anchor:"start",length:_,shape:"left"===t?hfe:ffe})}(e,t,i,{stroke:s,strokeOpacity:u,strokeWidth:h,tickSize:$,tickPadding:W,tickRotate:X,x:K,...qe}):null,ka(_)?null:function rfe(e,t,i,{facetAnchor:n=t+("y"===e?"-empty":""),frameAnchor:r=t,tickSize:s,tickRotate:u=0,tickPadding:h=Math.max(3,9-s)+(Math.abs(u)>60?4*Math.cos(u*Ij):0),tickFormat:_,text:x=("function"==typeof _?_:void 0),textAnchor:M=(Math.abs(u)>60?"middle":"left"===t?"end":"start"),lineAnchor:S=(u>60?"top":u<-60?"bottom":"middle"),fontVariant:P,inset:F=0,insetLeft:$=F,insetRight:W=F,dx:X=0,y:K=("y"===e?void 0:null),...Q}){return z0(Nhe,e,`${e}-axis tick label`,i,{facetAnchor:n,frameAnchor:r,text:void 0===x?null:x,textAnchor:M,lineAnchor:S,fontVariant:P,rotate:u,y:K,...Q,dx:"left"===t?+X-s-h+ +$:+X+ +s+ +h-W},function(he,le,ye,Se){void 0===P&&(this.fontVariant=y7(he)),void 0===x&&(Se.text=_7(he,le,ye,_,t))})}(e,t,i,{fill:_,fillOpacity:x,stroke:S,strokeOpacity:P,strokeWidth:F,textAnchor:M,tickSize:$,tickPadding:W,tickRotate:X,x:K,marginTop:he,marginRight:le,marginBottom:ye,marginLeft:Se,...qe}),ka(_)||null===Ue?null:I1([],g7({fill:_,fillOpacity:x,...qe},function(St,Nt,Ee,Ie,Ce){const je=Ie[e],{marginTop:rt,marginRight:Ke,marginBottom:wt,marginLeft:It}="y"===e&&Ce.inset||Ce,At=Xe??(je.bandwidth?"center":"top"),rn=bt??("right"===t?Ke:It)-3;return"center"===At?(this.textAnchor=void 0,this.lineAnchor="right"===t?"bottom":"top",this.frameAnchor=t,this.rotate=-90):(this.textAnchor="right"===t?"end":"start",this.lineAnchor=At,this.frameAnchor=`${At}-${t}`,this.rotate=0),this.dy="top"===At?3-rt:"bottom"===At?wt-3:0,this.dx="right"===t?rn:-rn,this.ariaLabel=`${e}-axis label`,{facets:[[0]],channels:{text:{value:[v7(e,je,{anchor:t,label:Ue,labelAnchor:At,labelArrow:mt})]}}}})))}function h7(e,t,i,{color:n="currentColor",opacity:r=1,stroke:s=n,strokeOpacity:u=r,strokeWidth:h=1,fill:_=n,fillOpacity:x=r,textAnchor:M,textStroke:S,textStrokeOpacity:P,textStrokeWidth:F,tickSize:$=("x"===e?6:0),tickPadding:W,tickRotate:X,y:K,margin:Q,marginTop:he=(void 0===Q?"top"===t?30:0:Q),marginRight:le=(void 0===Q?20:Q),marginBottom:ye=(void 0===Q?"bottom"===t?30:0:Q),marginLeft:Se=(void 0===Q?20:Q),label:Ue,labelAnchor:Xe,labelArrow:mt,labelOffset:bt,...qe}){return $=Dr($),W=Dr(W),X=Dr(X),void 0!==Xe&&(Xe=Vh(Xe,"labelAnchor",["center","left","right"])),mt=b7(mt),Cj($&&!ka(s)?function ife(e,t,i,{strokeWidth:n=1,strokeLinecap:r=null,strokeLinejoin:s=null,facetAnchor:u=t+("x"===e?"-empty":""),frameAnchor:h=t,tickSize:_,inset:x=0,insetTop:M=x,insetBottom:S=x,dy:P=0,x:F=("x"===e?void 0:null),...$}){return z0(Qhe,e,`${e}-axis tick`,i,{strokeWidth:n,strokeLinejoin:s,strokeLinecap:r,facetAnchor:u,frameAnchor:h,x:F,...$,dy:"bottom"===t?+P-al-S:+P+al+ +M,anchor:"start",length:_,shape:"bottom"===t?ufe:dfe})}(e,t,i,{stroke:s,strokeOpacity:u,strokeWidth:h,tickSize:$,tickPadding:W,tickRotate:X,y:K,...qe}):null,ka(_)?null:function ofe(e,t,i,{facetAnchor:n=t+("x"===e?"-empty":""),frameAnchor:r=t,tickSize:s,tickRotate:u=0,tickPadding:h=Math.max(3,9-s)+(Math.abs(u)>=10?4*Math.cos(u*Ij):0),tickFormat:_,text:x=("function"==typeof _?_:void 0),textAnchor:M=(Math.abs(u)>=10?u<0^"bottom"===t?"start":"end":"middle"),lineAnchor:S=(Math.abs(u)>=10?"middle":"bottom"===t?"top":"bottom"),fontVariant:P,inset:F=0,insetTop:$=F,insetBottom:W=F,dy:X=0,x:K=("x"===e?void 0:null),...Q}){return z0(Fhe,e,`${e}-axis tick label`,i,{facetAnchor:n,frameAnchor:r,text:void 0===x?null:x,textAnchor:M,lineAnchor:S,fontVariant:P,rotate:u,x:K,...Q,dy:"bottom"===t?+X+ +s+ +h-W:+X-s-h+ +$},function(he,le,ye,Se){void 0===P&&(this.fontVariant=y7(he)),void 0===x&&(Se.text=_7(he,le,ye,_,t))})}(e,t,i,{fill:_,fillOpacity:x,stroke:S,strokeOpacity:P,strokeWidth:F,textAnchor:M,tickSize:$,tickPadding:W,tickRotate:X,y:K,marginTop:he,marginRight:le,marginBottom:ye,marginLeft:Se,...qe}),ka(_)||null===Ue?null:I1([],g7({fill:_,fillOpacity:x,...qe},function(St,Nt,Ee,Ie,Ce){const je=Ie[e],{marginTop:rt,marginRight:Ke,marginBottom:wt,marginLeft:It}="x"===e&&Ce.inset||Ce,At=Xe??(je.bandwidth?"center":"right"),rn=bt??("top"===t?rt:wt)-3;return"center"===At?(this.frameAnchor=t,this.textAnchor=void 0):(this.frameAnchor=`${t}-${At}`,this.textAnchor="right"===At?"end":"start"),this.lineAnchor=t,this.dy="top"===t?-rn:rn,this.dx="right"===At?Ke-3:"left"===At?3-It:0,this.ariaLabel=`${e}-axis label`,{facets:[[0]],channels:{text:{value:[v7(e,je,{anchor:t,label:Ue,labelAnchor:At,labelArrow:mt})]}}}})))}function sfe(){const[e,t]=Pp(...arguments);return f7("y",o7(t),e,t)}function afe(){const[e,t]=Pp(...arguments);return f7("fy",s7(t),e,t)}function lfe(){const[e,t]=Pp(...arguments);return p7("x",a7(t),e,t)}function cfe(){const[e,t]=Pp(...arguments);return p7("fx",l7(t),e,t)}function f7(e,t,i,{y:n=("y"===e?void 0:null),x:r=null,x1:s=("left"===t?r:null),x2:u=("right"===t?r:null),...h}){return z0(CO,e,`${e}-grid`,i,{y:n,x1:s,x2:u,...m7(h)})}function p7(e,t,i,{x:n=("x"===e?void 0:null),y:r=null,y1:s=("top"===t?r:null),y2:u=("bottom"===t?r:null),...h}){return z0(PD,e,`${e}-grid`,i,{x:n,y1:s,y2:u,...m7(h)})}function m7({color:e="currentColor",opacity:t=.1,stroke:i=e,strokeOpacity:n=t,strokeWidth:r=1,...s}){return{stroke:i,strokeOpacity:n,strokeWidth:r,...s}}function g7({fill:e,fillOpacity:t,fontFamily:i,fontSize:n,fontStyle:r,fontWeight:s,monospace:u,pointerEvents:h,shapeRendering:_},x){return[,e]=Bh(e),[,t]=ol(t),{facet:"super",x:null,y:null,fill:e,fillOpacity:t,fontFamily:i,fontSize:n,fontStyle:r,fontWeight:s,monospace:u,pointerEvents:h,shapeRendering:_,initializer:x}}function z0(e,t,i,n,r,s){let u;const _=R0(r).initializer,x=e(n,R0({...r,initializer:function h(M,S,P,F,$,W){const X=null==M&&("fx"===t||"fy"===t),{[t]:K}=F;if(!K)throw new Error(`missing scale: ${t}`);let{ticks:Q,tickSpacing:he,interval:le}=r;if(oO(K)&&"string"==typeof Q&&(le=Q,Q=void 0),null==M){if(gd(Q))M=sl(Q);else if(K.ticks)if(void 0!==Q)M=K.ticks(Q);else if(le=I0(void 0===le?K.interval:le,K.type),void 0!==le){const[Se,Ue]=qc(K.domain());M=le.range(Se,le.offset(le.floor(Ue)))}else{const[Se,Ue]=qc(K.range());Q=(Ue-Se)/(void 0===he?"x"===t?80:35:he),M=K.ticks(Q)}else M=K.domain();"y"===t||"x"===t?S=[md(M)]:u[t]={scale:t,value:ss}}s?.call(this,K,M,Q,u);const ye=Object.fromEntries(Object.entries(u).map(([Se,Ue])=>[Se,{...Ue,value:Go(M,Ue.value)}]));return X&&(S=W.filterFacets(M,ye)),{data:M,facets:S,channels:ye}}},_));return null==n?(u=x.channels,x.channels={}):u={},x.ariaLabel=i,x}function _7(e,t,i,n,r){return{value:kD(e,t,i,n,r)}}function kD(e,t,i,n,r){return void 0===n&&oO(e)?function oue(e,t,i,n){const r="time"===e.type?GM:f1,s="left"===n||"right"===n?(u,h)=>`\n${u}\n${h}`:"top"===n?(u,h)=>`${h}\n${u}`:(u,h)=>`${u}\n${h}`;switch(function sue(e,t,i){const n=zE(function Jne(e,t=eie){const i=[];let n,r=!1;for(const s of e)r&&i.push(t(n,s)),n=s,r=!0;return i}(t,(_,x)=>Math.abs(x-_)||NaN));if(n>0)return _1[Ox(([,_])=>_).right(_1,n,1,_1.length)-1][0];const[r,s]=qc(e.domain()),u="number"==typeof i?i:10,h=Math.abs(s-r)/u;return _1[Ox(([,_])=>Math.log(_)).center(_1,Math.log(h))][0]}(e,t,i)){case"millisecond":return Tg(r(".%L"),r(":%M:%S"),s);case"second":return Tg(r(":%S"),r("%-I:%M"),s);case"minute":return Tg(r("%-I:%M"),r("%p"),s);case"hour":return Tg(r("%-I %p"),r("%b %-d"),s);case"day":case"week":return Tg(r("%-d"),r("%b"),s);case"month":return Tg(r("%b"),r("%Y"),s);case"year":return r("%Y")}throw new Error("unable to format time ticks")}(e,t,i,r):e.tickFormat?e.tickFormat(gd(i)?null:i,n):void 0===n?function iue(e){if(!e)return!1;const t=e.floor(new Date(Date.UTC(2e3,11,31)));return Jc(t)>=t}(e.interval)?f1("%Y"):function rue(e){if(!e)return!1;const t=e.floor(new Date(2e3,11,31));return Qc(t)>=t}(e.interval)?GM("%Y"):Tp:"string"==typeof n?(tu(e.domain())?f1:qx)(n):v1(n)}const ufe={draw(e,t){e.moveTo(0,0),e.lineTo(0,t)}},dfe={draw(e,t){e.moveTo(0,0),e.lineTo(0,-t)}},hfe={draw(e,t){e.moveTo(0,0),e.lineTo(-t,0)}},ffe={draw(e,t){e.moveTo(0,0),e.lineTo(t,0)}};function y7(e){return e.bandwidth&&!e.interval?void 0:"tabular-nums"}function v7(e,t,{anchor:i,label:n=t.label,labelAnchor:r,labelArrow:s}={}){if(!(null==n||n.inferred&&function mfe(e){return oO(e)||null!=e.interval}(t)&&/^(date|time|year)$/i.test(n))){if(n=String(n),"auto"===s&&(s=(!t.bandwidth||t.interval)&&!/[\u2191\u2193\u2192\u2190]/.test(n)),!s)return n;if(!0===s){const u=function pfe(e){return Math.sign(A0(e.domain()))*Math.sign(A0(e.range()))}(t);u&&(s=/x$/.test(e)||"center"===r?/x$/.test(e)===u<0?"left":"right":u<0?"up":"down")}switch(s){case"left":return`\u2190 ${n}`;case"right":return`${n} \u2192`;case"up":return"right"===i?`${n} \u2191`:`\u2191 ${n}`;case"down":return"right"===i?`${n} \u2193`:`\u2193 ${n}`}return n}}function b7(e="auto"){return!ka(e)&&("boolean"==typeof e?e:Vh(e,"labelArrow",["auto","up","right","down","left"]))}function x7(e,t){if(null==t)return t;const i=e(t);if(!i)throw new Error(`scale not found: ${t}`);return i}function w7(e,t={},i){let{columns:n,tickFormat:r,fontVariant:s=Sj(e),swatchSize:u=15,swatchWidth:h=u,swatchHeight:_=u,marginLeft:x=0,className:M,style:S,width:P}=t;const F=YP(t);M=aO(M),"function"!=typeof r&&(r=kD(e.scale,e.domain,void 0,r));const $=ra("div",F).attr("class",`${M}-swatches ${M}-swatches-${null!=n?"columns":"wrap"}`);let W;return null!=n?(W=`.${M}-swatches-columns .${M}-swatch {\n  display: flex;\n  align-items: center;\n  break-inside: avoid;\n  padding-bottom: 1px;\n}\n.${M}-swatches-columns .${M}-swatch::before {\n  flex-shrink: 0;\n}\n.${M}-swatches-columns .${M}-swatch-label {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}`,$.style("columns",n).selectAll().data(e.domain).enter().append("div").attr("class",`${M}-swatch`).call(i,e,h,_).call(X=>X.append("div").attr("class",`${M}-swatch-label`).attr("title",r).text(r))):(W=`.${M}-swatches-wrap {\n  display: flex;\n  align-items: center;\n  min-height: 33px;\n  flex-wrap: wrap;\n}\n.${M}-swatches-wrap .${M}-swatch {\n  display: inline-flex;\n  align-items: center;\n  margin-right: 1em;\n}`,$.selectAll().data(e.domain).enter().append("span").attr("class",`${M}-swatch`).call(i,e,h,_).append(function(){return this.ownerDocument.createTextNode(r.apply(this,arguments))})),$.call(X=>X.insert("style","*").text(`.${M}-swatches {\n  font-family: system-ui, sans-serif;\n  font-size: 10px;\n  margin-bottom: 0.5em;\n}\n.${M}-swatch > svg {\n  margin-right: 0.5em;\n  overflow: visible;\n}\n${W}`)).style("margin-left",x?+x+"px":null).style("width",void 0===P?null:+P+"px").style("font-variant",ko(s,"normal")).call(lO,S).node()}const RD=new Map([["symbol",function _fe(e,{fill:t=(void 0!==e.hint?.fill?e.hint.fill:"none"),fillOpacity:i=1,stroke:n=(void 0!==e.hint?.stroke?e.hint.stroke:ka(t)?"currentColor":"none"),strokeOpacity:r=1,strokeWidth:s=1.5,r:u=4.5,...h}={},_){const[x,M]=Bh(t),[S,P]=Bh(n),F=x7(_,x),$=x7(_,S),W=u*u*Math.PI;return i=ol(i)[1],r=ol(r)[1],s=ol(s)[1],w7(e,h,(X,K,Q,he)=>X.append("svg").attr("viewBox","-8 -8 16 16").attr("width",Q).attr("height",he).attr("fill","color"===x?le=>F.scale(le):M).attr("fill-opacity",i).attr("stroke","color"===S?le=>$.scale(le):P).attr("stroke-opacity",r).attr("stroke-width",s).append("path").attr("d",le=>{const ye=rP();return e.scale(le).draw(ye,W),ye}))}],["color",C7],["opacity",function vfe({type:e,interpolate:t,...i},{legend:n=!0,color:r=Cp(0,0,0),...s}){if(!t)throw new Error(`${e} opacity scales are not supported`);if(!0===n&&(n="ramp"),"ramp"!==`${n}`.toLowerCase())throw new Error(`${n} opacity legends are not supported`);return C7({type:e,...i,interpolate:bfe(r)},{legend:n,...s})}]]);function IO({className:e,...t},{label:i,ticks:n,tickFormat:r}={},s){return function Cue(e={},...t){let i=e;for(const n of t)for(const r in n)if(void 0===i[r]){const s=n[r];i===e?i={...i,[r]:s}:i[r]=s}return i}(s,{className:e,...t},{label:i,ticks:n,tickFormat:r})}function C7(e,{legend:t=!0,...i}){if(!0===t&&(t="ordinal"===e.type?"swatches":"ramp"),void 0!==e.domain)switch(`${t}`.toLowerCase()){case"swatches":return function gfe(e,{opacity:t,...i}={}){if(!Ag(e)&&!gj(e))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${e.type})`);return w7(e,i,(n,r,s,u)=>n.append("svg").attr("width",s).attr("height",u).attr("fill",r.scale).attr("fill-opacity",ol(t)[1]).append("rect").attr("width","100%").attr("height","100%"))}(e,i);case"ramp":return function Mhe(e,t){let{label:i=e.label,tickSize:n=6,width:r=240,height:s=44+n,marginTop:u=18,marginRight:h=0,marginBottom:_=16+n,marginLeft:x=0,style:M,ticks:S=(r-x-h)/64,tickFormat:P,fontVariant:F=Sj(e),round:$=!0,opacity:W,className:X}=t;const K=YP(t);X=aO(X),W=ol(W)[1],null===P&&(P=()=>null);const Q=ra("svg",K).attr("class",`${X}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",r).attr("height",s).attr("viewBox",`0 0 ${r} ${s}`).call(St=>St.append("style").text(`.${X}-ramp {\n  display: block;\n  background: white;\n  height: auto;\n  height: intrinsic;\n  max-width: 100%;\n  overflow: visible;\n}\n.${X}-ramp text {\n  white-space: pre;\n}`)).call(lO,M);let le,he=St=>St.selectAll(".tick line").attr("y1",u+_-s);const ye=$?(St,Nt)=>St.rangeRound(Nt):(St,Nt)=>St.range(Nt),{type:Se,domain:Ue,range:Xe,interpolate:mt,scale:bt,pivot:qe}=e;if(mt){const St=void 0===Xe?mt:kM(1===mt.length?tO(mt):mt,Xe);le=ye(bt.copy(),Kc(As(x,r-h),Math.min(Ue.length+(void 0!==qe),void 0===Xe?1/0:Xe.length)));const Nt=256,Ee=K.document.createElement("canvas");Ee.width=Nt,Ee.height=1;const Ie=Ee.getContext("2d");for(let Ce=0,je=Nt-1;Ce<Nt;++Ce)Ie.fillStyle=St(Ce/je),Ie.fillRect(Ce,0,1,1);Q.append("image").attr("opacity",W).attr("x",x).attr("y",u).attr("width",r-x-h).attr("height",s-u-_).attr("preserveAspectRatio","none").attr("xlink:href",Ee.toDataURL())}else if("threshold"===Se){const St=Ue,Nt=void 0===P?Ee=>Ee:"string"==typeof P?qx(P):P;le=ye(cP().domain([-1,Xe.length-1]),[x,r-h]),Q.append("g").attr("fill-opacity",W).selectAll().data(Xe).enter().append("rect").attr("x",(Ee,Ie)=>le(Ie-1)).attr("y",u).attr("width",(Ee,Ie)=>le(Ie)-le(Ie-1)).attr("height",s-u-_).attr("fill",Ee=>Ee),S=Oo(St,(Ee,Ie)=>Ie),P=Ee=>Nt(St[Ee],Ee)}else le=ye(LM().domain(Ue),[x,r-h]),Q.append("g").attr("fill-opacity",W).selectAll().data(Ue).enter().append("rect").attr("x",le).attr("y",u).attr("width",Math.max(0,le.bandwidth()-1)).attr("height",s-u-_).attr("fill",bt),he=()=>{};return Q.append("g").attr("transform",`translate(0,${s-_})`).call(function uie(e){return HE(tA,e)}(le).ticks(Array.isArray(S)?null:S,"string"==typeof P?P:void 0).tickFormat("function"==typeof P?P:void 0).tickSize(n).tickValues(Array.isArray(S)?S:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",ko(F,"normal")).call(he).call(St=>St.select(".domain").remove()),void 0!==i&&Q.append("text").attr("x",x).attr("y",u-6).attr("fill","currentColor").attr("font-weight","bold").text(i),Q.node()}(e,i);default:throw new Error(`unknown legend type: ${t}`)}}function bfe(e){const{r:t,g:i,b:n}=Cp(e)||Cp(0,0,0);return r=>`rgba(${t},${i},${n},${r})`}const wfe={ariaLabel:"frame",fill:"none",stroke:"currentColor"},Cfe={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square"};class Efe extends iu{constructor(t={}){const{anchor:i=null,inset:n=0,insetTop:r=n,insetRight:s=n,insetBottom:u=n,insetLeft:h=n,rx:_,ry:x}=t;super(rD,void 0,t,null==i?wfe:Cfe),this.anchor=aD(i,"anchor",["top","right","bottom","left"]),this.insetTop=Dr(r),this.insetRight=Dr(s),this.insetBottom=Dr(u),this.insetLeft=Dr(h),this.rx=Dr(_),this.ry=Dr(x)}render(t,i,n,r,s){const{marginTop:u,marginRight:h,marginBottom:_,marginLeft:x,width:M,height:S}=r,{anchor:P,insetTop:F,insetRight:$,insetBottom:W,insetLeft:X,rx:K,ry:Q}=this,he=x+X,le=M-h-$,ye=u+F,Se=S-_-W;return ra(P?"svg:line":"svg:rect",s).datum(0).call(Sp,this,r,s).call(Ip,this).call(Pg,this,n).call(Zh,this,{}).call("left"===P?Ue=>Ue.attr("x1",he).attr("x2",he).attr("y1",ye).attr("y2",Se):"right"===P?Ue=>Ue.attr("x1",le).attr("x2",le).attr("y1",ye).attr("y2",Se):"top"===P?Ue=>Ue.attr("x1",he).attr("x2",le).attr("y1",ye).attr("y2",ye):"bottom"===P?Ue=>Ue.attr("x1",he).attr("x2",le).attr("y1",Se).attr("y2",Se):Ue=>Ue.attr("x",he).attr("y",ye).attr("width",le-he).attr("height",Se-ye).attr("rx",K).attr("ry",Q)).node()}}const AO={ariaLabel:"tip",fill:"white",stroke:"currentColor"},Dfe=new Set(["geometry","href","src","ariaLabel"]);class Tfe extends iu{constructor(t,i={}){i.tip&&(i={...i,tip:!1}),void 0===i.title&&gd(t)&&DU(t)&&(i={...i,title:ss});const{x:n,y:r,x1:s,x2:u,y1:h,y2:_,anchor:x,monospace:M,fontFamily:S=(M?"ui-monospace, monospace":void 0),fontSize:P,fontStyle:F,fontVariant:$,fontWeight:W,lineHeight:X=1,lineWidth:K=20,frameAnchor:Q,textAnchor:he="start",textOverflow:le,textPadding:ye=8,title:Se,pointerSize:Ue=12,pathFilter:Xe="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=i;super(t,{x:{value:null!=s&&null!=u?null:n,scale:"x",optional:!0},y:{value:null!=h&&null!=_?null:r,scale:"y",optional:!0},x1:{value:s,scale:"x",optional:null==u},y1:{value:h,scale:"y",optional:null==_},x2:{value:u,scale:"x",optional:null==s},y2:{value:_,scale:"y",optional:null==h},title:{value:Se,optional:!0}},i,AO),this.anchor=SU(x,"anchor"),this.previousAnchor=this.anchor??"top-left",this.frameAnchor=jP(Q),this.textAnchor=ko(he,"middle"),this.textPadding=+ye,this.pointerSize=+Ue,this.pathFilter=ia(Xe),this.lineHeight=+X,this.lineWidth=+K,this.textOverflow=Gj(le),this.monospace=!!M,this.fontFamily=ia(S),this.fontSize=Dr(P),this.fontStyle=ia(F),this.fontVariant=ia($),this.fontWeight=ia(W);for(const mt in AO)mt in this.channels&&(this[mt]=AO[mt]);this.splitLines=Zj(this),this.clipLine=Xj(this)}render(t,i,n,r,s){const u=this,{x:h,y:_,fx:x,fy:M}=i,{ownerSVGElement:S,document:P}=s,{anchor:F,monospace:$,lineHeight:W,lineWidth:X}=this,{textPadding:K,pointerSize:Q,pathFilter:he}=this,{marginTop:le,marginLeft:ye}=r,Se=function Ofe({channels:e}){const t={};for(const i in e){if(Dfe.has(i))continue;const n=$ue(e,i);n&&(t[i]=n)}return t}(n),{x1:Ue,y1:Xe,x2:mt,y2:bt,x:qe=Ue??mt,y:St=Xe??bt}=n,Nt=x?x(t.fx)-ye:0,Ee=M?M(t.fy)-le:0,[Ie,Ce]=CD(this,r),je=Dj(n,Ie),rt=Tj(n,Ce),Ke=$?DO:MO,wt=Ke(L0),It=x&&kD(x),At=M&&kD(M),vn=ra("svg:g",s).call(Sp,this,r,s).call(qj,this).call(Zh,this,{x:qe&&h,y:St&&_}).call(Wt=>Wt.selectAll().data(t).enter().append("g").attr("transform",Kt=>`translate(${Math.round(je(Kt))},${Math.round(rt(Kt))})`).call(Ip,this).call(Kt=>Kt.append("path").attr("filter",he)).call(Kt=>Kt.append("text").each(function(ot){const Qt=m1(this);this.setAttribute("fill","currentColor"),this.setAttribute("fill-opacity",1),this.setAttribute("stroke","none");const tn=new Set;for(const tt of function*rn(Wt,Kt){if("title"in Wt){const ot=Wt.title.value[Kt];for(const Qt of u.splitLines(Tp(ot)))yield{name:"",value:u.clipLine(Qt)}}else{for(const ot in Wt){if("x1"===ot&&"x2"in Wt||"y1"===ot&&"y2"in Wt)continue;const Qt=Wt[ot],tn=Qt.value[Kt];if(Dg(tn)||null!=Qt.scale)if("x2"===ot&&"x1"in Wt)yield{name:PO(i,Qt,"x"),value:E7(Wt.x1,Qt,Kt)};else if("y2"===ot&&"y1"in Wt)yield{name:PO(i,Qt,"y"),value:E7(Wt.y1,Qt,Kt)};else{const tt=Qt.scale,hn={name:PO(i,Qt,ot),value:Tp(tn)};("color"===tt||"opacity"===tt)&&(hn[tt]=n[ot][Kt]),yield hn}}null!=t.fi&&x&&(yield{name:String(x.label??"fx"),value:It(t.fx)}),null!=t.fi&&M&&(yield{name:String(M.label??"fy"),value:At(t.fy)})}}(Se,ot)){const hn=tt.name;hn&&tn.has(hn)||(tn.add(hn),pi(Qt,tt))}})));function pi(Wt,{name:Kt,value:ot,color:Qt,opacity:tn}){const tt=null!=Qt||null!=tn;let hn,Bn=100*X;const[Ii]=F0(Kt,Bn,Ke,wt);if(Ii>=0)Kt=Kt.slice(0,Ii).trimEnd()+L0,hn=ot.trim(),ot="";else{(Kt||!ot&&!tt)&&(ot=" "+ot);const[nn]=F0(ot,Bn-Ke(Kt),Ke,wt);nn>=0&&(hn=(ot=ot.slice(0,nn).trimEnd()+L0).trim())}const ci=Wt.append("tspan").attr("x",0).attr("dy",`${W}em`).text("\u200b");Kt&&ci.append("tspan").attr("font-weight","bold").text(Kt),ot&&ci.append(()=>P.createTextNode(ot)),tt&&ci.append("tspan").text(" \u25a0").attr("fill",Qt).attr("fill-opacity",tn).style("user-select","none"),hn&&ci.append("title").text(hn)}function pr(){const{width:Wt,height:Kt}=r.facet??r;vn.selectChildren().each(function(ot){let{x:Qt,width:tn,height:tt}=this.getBBox();tn=Math.round(tn),tt=Math.round(tt);let hn=F;if(void 0===hn){hn=u.previousAnchor;const ci=je(ot)+Nt,nn=rt(ot)+Ee,mr=ci+tn+2*K<Wt,vd=ci-tn-2*K>0,ll=nn+tt+Q+2*K+7<Kt,KD=nn-tt-Q-2*K>0,QD=(/-left$/.test(hn)?mr||!vd:mr&&!vd)?"left":"right",ak=(/^top-/.test(hn)?ll||!KD:ll&&!KD)?"top":"bottom";hn=u.previousAnchor=`${ak}-${QD}`}const Ii=this.lastChild;if(this.firstChild.setAttribute("d",function Pfe(e,t,i,n,r){const s=n+2*i,u=r+2*i;switch(e){case"middle":return`M${-s/2},${-u/2}h${s}v${u}h${-s}z`;case"top-left":return`M0,0l${t},${t}h${s-t}v${u}h${-s}z`;case"top":return`M0,0l${t/2},${t/2}h${(s-t)/2}v${u}h${-s}v${-u}h${(s-t)/2}z`;case"top-right":return`M0,0l${-t},${t}h${t-s}v${u}h${s}z`;case"right":return`M0,0l${-t/2},${-t/2}v${t/2-u/2}h${-s}v${u}h${s}v${t/2-u/2}z`;case"bottom-left":return`M0,0l${t},${-t}h${s-t}v${-u}h${-s}z`;case"bottom":return`M0,0l${t/2},${-t/2}h${(s-t)/2}v${-u}h${-s}v${u}h${(s-t)/2}z`;case"bottom-right":return`M0,0l${-t},${-t}h${t-s}v${-u}h${s}z`;case"left":return`M0,0l${t/2},${-t/2}v${t/2-u/2}h${s}v${u}h${-s}v${t/2-u/2}z`}}(hn,Q,K,tn,tt)),Qt)for(const ci of Ii.childNodes)ci.setAttribute("x",-Qt);Ii.setAttribute("y",+function Ife(e,t,i){return/^top(?:-|$)/.test(e)?.94-i:-.29-t*i}(hn,Ii.childNodes.length,W).toFixed(6)+"em"),Ii.setAttribute("transform",`translate(${function Afe(e,t,i,n,r){switch(e){case"middle":return[-n/2,r/2];case"top-left":return[i,t+i];case"top":return[-n/2,t/2+i];case"top-right":return[-n-i,t+i];case"right":return[-t/2-n-i,r/2];case"bottom-left":return[i,-t-i];case"bottom":return[-n/2,-t/2-i];case"bottom-right":return[-n-i,-t-i];case"left":return[i+t/2,r/2]}}(hn,Q,K,tn,tt)})`)})}return S.isConnected?Promise.resolve().then(pr):typeof requestAnimationFrame<"u"&&requestAnimationFrame(pr),vn.node()}}function Sfe(e,{x:t,y:i,...n}={}){return void 0===n.frameAnchor&&([t,i]=CU(t,i)),new Tfe(e,{...n,x:t,y:i})}function E7(e,t,i){return t.hint?.length?`${Tp(t.value[i]-e.value[i])}`:`${Tp(e.value[i])}\u2013${Tp(t.value[i])}`}function PO(e,t,i){return String(e[t.scale]?.label??t?.label??i)}function B0(e={}){const{facet:t,style:i,caption:n,ariaLabel:r,ariaDescription:s}=e,u=aO(e.className),h=void 0===e.marks?[]:M7(e.marks);h.push(...function Bfe(e){const t=[];for(const i of e){const n=i.tip;if(n){const s=("x"===n?Che:"y"===n?Ehe:whe)(zfe(i));s.title=null,t.push(Sfe(i.data,s))}}return t}(h));const _=function Nfe(e,t){if(null==e)return;const{x:i,y:n}=e;if(null==i&&null==n)return;const r=sl(e.data);if(null==r)throw new Error("missing facet data");const s={};null!=i&&(s.fx=E1(r,{value:i,scale:"fx"})),null!=n&&(s.fy=E1(r,{value:n,scale:"fy"})),OO(s,t);return{channels:s,groups:cO(r,s),data:e.data}}(t,e),x=new Map;for(const Ce of h){const je=T7(Ce,_,e);je&&x.set(Ce,je)}const M=new Map;_&&A1(M,[_],e),A1(M,x,e);const S=M7(function Vfe(e,t,i){let{projection:n,x:r={},y:s={},fx:u={},fy:h={},axis:_,grid:x,facet:M={},facet:{axis:S=_,grid:P}=M,x:{axis:F=_,grid:$=(null===F?null:x)}=r,y:{axis:W=_,grid:X=(null===W?null:x)}=s,fx:{axis:K=S,grid:Q=(null===K?null:P)}=u,fy:{axis:he=S,grid:le=(null===he?null:P)}=h}=i;(n||!NP(r)&&!S7("x",e))&&(F=$=null),(n||!NP(s)&&!S7("y",e))&&(W=X=null),t.has("fx")||(K=Q=null),t.has("fy")||(he=le=null),void 0===F&&(F=!ND(e,"x")),void 0===W&&(W=!ND(e,"y")),void 0===K&&(K=!ND(e,"fx")),void 0===he&&(he=!ND(e,"fy")),!0===F&&(F="bottom"),!0===W&&(W="left"),!0===K&&(K="top"===F||null===F?"bottom":"top"),!0===he&&(he="right"===W||null===W?"left":"right");const ye=[];return FD(ye,le,afe,h),LD(ye,he,efe,"right","left",M,h),FD(ye,Q,cfe,u),LD(ye,K,tfe,"top","bottom",M,u),FD(ye,X,sfe,s),LD(ye,W,c7,"left","right",i,s),FD(ye,$,lfe,r),LD(ye,F,u7,"bottom","top",i,r),ye}(h,M,e));for(const Ce of S){const je=T7(Ce,_,e);je&&x.set(Ce,je)}h.unshift(...S);let P=function ahe(e,t){const{fx:i,fy:n}=nO(e,t),r=i?.scale.domain(),s=n?.scale.domain();return r&&s?function jne(...e){const t="function"==typeof e[e.length-1]&&function Une(e){return t=>e(...t)}(e.pop()),i=(e=e.map(Vne)).map(zne),n=e.length-1,r=new Array(n+1).fill(0),s=[];if(n<0||i.some(Bne))return s;for(;;){s.push(r.map((h,_)=>e[_][h]));let u=n;for(;++r[u]===i[u];){if(0===u)return t?s.map(t):s;r[u--]=0}}}(r,s).map(([u,h],_)=>({x:u,y:h,i:_})):r?r.map((u,h)=>({x:u,i:h})):s?s.map((u,h)=>({y:u,i:h})):void 0}(M,e);if(void 0!==P){const Ce=_?mO(P,_):void 0;for(const rt of h){if(null===rt.facet||"super"===rt.facet)continue;const Ke=x.get(rt);void 0!==Ke&&(Ke.facetsIndex=null!=rt.fx||null!=rt.fy?mO(P,Ke):Ce)}const je=new Set;for(const{facetsIndex:rt}of x.values())rt?.forEach((Ke,wt)=>{Ke?.length>0&&je.add(wt)});P.forEach(0<je.size&&je.size<P.length?(rt,Ke)=>rt.empty=!je.has(Ke):rt=>rt.empty=!1);for(const rt of h)if("exclude"===rt.facet){const Ke=x.get(rt);void 0!==Ke&&(Ke.facetsIndex=uhe(Ke.facetsIndex))}}for(const Ce of to.keys())NP(e[Ce])&&"fx"!==Ce&&"fy"!==Ce&&M.set(Ce,[]);const F=new Map;for(const Ce of h){if(F.has(Ce))throw new Error("duplicate mark; each mark must be unique");const{facetsIndex:je,channels:rt}=x.get(Ce)??{},{data:Ke,facets:wt,channels:It}=Ce.initialize(je,rt,e);OO(It,e),F.set(Ce,{data:Ke,facets:wt,channels:It})}const $=nO(A1(M,F,e),e),W=lj($),X=function ohe(e,t,i={}){let n=.5-al,r=.5+al,s=.5+al,u=.5-al;for(const{marginTop:W,marginRight:X,marginBottom:K,marginLeft:Q}of t)W>n&&(n=W),X>r&&(r=X),K>s&&(s=K),Q>u&&(u=Q);let{margin:h,marginTop:_=(void 0!==h?h:n),marginRight:x=(void 0!==h?h:r),marginBottom:M=(void 0!==h?h:s),marginLeft:S=(void 0!==h?h:u)}=i;_=+_,x=+x,M=+M,S=+S;let{width:P=640,height:F=she(e,i,{width:P,marginTopDefault:n,marginRightDefault:r,marginBottomDefault:s,marginLeftDefault:u})+Math.max(0,_-n+M-s)}=i;P=+P,F=+F;const $={width:P,height:F,marginTop:_,marginRight:x,marginBottom:M,marginLeft:S};if(e.fx||e.fy){let{margin:W,marginTop:X=(void 0!==W?W:_),marginRight:K=(void 0!==W?W:x),marginBottom:Q=(void 0!==W?W:M),marginLeft:he=(void 0!==W?W:S)}=i.facet??{};X=+X,K=+K,Q=+Q,he=+he,$.facet={marginTop:X,marginRight:K,marginBottom:Q,marginLeft:he}}return $}($,h,e);!function Pde(e,t){const{x:i,y:n,fx:r,fy:s}=e,u=r||s?iO(t):t;r&&uj(r,u),s&&dj(s,u);const h=r||s?cj(e,t):t;i&&uj(i,h),n&&dj(n,h)}($,X);const{fx:K,fy:Q}=W,he=K||Q?cj($,X):X,le=K||Q?function Wfe({fx:e,fy:t},i){const{marginTop:n,marginRight:r,marginBottom:s,marginLeft:u,width:h,height:_}=iO(i),x=e&&I7(e),M=t&&I7(t);return{marginTop:t?M[0]:n,marginRight:e?h-x[1]:r,marginBottom:t?_-M[1]:s,marginLeft:e?x[0]:u,inset:{marginTop:i.marginTop,marginRight:i.marginRight,marginBottom:i.marginBottom,marginLeft:i.marginLeft},width:h,height:_}}(W,X):X,ye=YP(e),Se=ye.document,Ue=WE("svg").call(Se.documentElement);let Xe=Ue;ye.ownerSVGElement=Ue,ye.className=u,ye.projection=function Gue({projection:e,inset:t=0,insetTop:i=t,insetRight:n=t,insetBottom:r=t,insetLeft:s=t}={},u){if(null==e)return;if("function"==typeof e.stream)return e;let h,_,x="frame";if(Sg(e)){let ye;if(({type:e,domain:_,inset:ye,insetTop:i=(void 0!==ye?ye:i),insetRight:n=(void 0!==ye?ye:n),insetBottom:r=(void 0!==ye?ye:r),insetLeft:s=(void 0!==ye?ye:s),clip:x=x,...h}=e),null==e)return}"function"!=typeof e&&({type:e}=jU(e));const{width:M,height:S,marginLeft:P,marginRight:F,marginTop:$,marginBottom:W}=u,X=M-P-F-s-n,K=S-$-W-i-r;if(e=e?.({width:X,height:K,clip:x,...h}),null==e)return;x=function que(e,t,i,n,r){if(!1===e||null==e||"number"==typeof e)return s=>s;if("frame"===(!0===e&&(e="frame"),`${e}`.toLowerCase()))return PB(t,i,n,r);throw new Error(`unknown projection clip type: ${e}`)}(x,P,$,M-F,S-W);let le,Q=P+s,he=$+i;if(null!=_){const[[ye,Se],[Ue,Xe]]=t6(e).bounds(_),mt=Math.min(X/(Ue-ye),K/(Xe-Se));mt>0?(Q-=(mt*(ye+Ue)-X)/2,he-=(mt*(Se+Xe)-K)/2,le=$A({point(bt,qe){this.stream.point(bt*mt+Q,qe*mt+he)}})):O0("Warning: the projection could not be fit to the specified domain; using the default scale.")}return le??=0===Q&&0===he?$U():$A({point(ye,Se){this.stream.point(ye+Q,Se+he)}}),{stream:ye=>e.stream(le.stream(x(ye)))}}(e,he),ye.filterFacets=(Ce,je)=>mO(P,{channels:je,groups:cO(Ce,je)}),ye.getMarkState=Ce=>{const je=F.get(Ce),rt=x.get(Ce);return{...je,channels:{...je.channels,...rt?.channels}}},ye.dispatchValue=Ce=>{Xe.value!==Ce&&(Xe.value=Ce,Xe.dispatchEvent(new Event("input",{bubbles:!0})))};const mt=new Set;for(const[Ce,je]of F)if(null!=Ce.initializer){const Ke=Ce.initializer(je.data,je.facets,je.channels,W,"super"===Ce.facet?le:he,ye);if(void 0!==Ke.data&&(je.data=Ke.data),void 0!==Ke.facets&&(je.facets=Ke.facets),void 0!==Ke.channels){const{fx:wt,fy:It,...At}=Ke.channels;Ffe(At),Object.assign(je.channels,At);for(const rn of Object.values(At)){const{scale:vn}=rn;null!=vn&&to.get(vn)!==_d&&(D7(rn,e),mt.add(vn))}(null!=wt||null!=It)&&x.set(Ce,!0)}}if(mt.size){const Ce=new Map;A1(Ce,F,e,Ke=>mt.has(Ke)),A1(M,F,e,Ke=>mt.has(Ke));const je=function qfe(e,t){for(const i in e){const n=e[i],r=t[i];void 0===n.label&&r&&(n.label=r.label)}return e}(nO(Ce,e),$),rt=lj(je);Object.assign($,je),Object.assign(W,rt)}let bt,qe;void 0!==P&&(bt={x:K?.domain(),y:Q?.domain()},P=function lhe(e,{x:t,y:i}){return t&&=uO(t),i&&=uO(i),e.filter(t&&i?n=>t.has(n.x)&&i.has(n.y):t?n=>t.has(n.x):n=>i.has(n.y)).sort(t&&i?(n,r)=>t.get(n.x)-t.get(r.x)||i.get(n.y)-i.get(r.y):t?(n,r)=>t.get(n.x)-t.get(r.x):(n,r)=>i.get(n.y)-i.get(r.y))}(P,bt),qe=function che(e,t,{marginTop:i,marginLeft:n}){return e&&t?({x:r,y:s})=>`translate(${e(r)-n},${t(s)-i})`:e?({x:r})=>`translate(${e(r)-n},0)`:({y:r})=>`translate(0,${t(r)-i})`}(K,Q,X));for(const[Ce,je]of F)je.values=Ce.scale(je.channels,W,ye);const{width:St,height:Nt}=X;m1(Ue).attr("class",u).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",St).attr("height",Nt).attr("viewBox",`0 0 ${St} ${Nt}`).attr("aria-label",r).attr("aria-description",s).call(Ce=>Ce.append("style").text(`.${u} {\n  display: block;\n  background: white;\n  height: auto;\n  height: intrinsic;\n  max-width: 100%;\n}\n.${u} text,\n.${u} tspan {\n  white-space: pre;\n}`)).call(lO,i);for(const Ce of h){const{channels:je,values:rt,facets:Ke}=F.get(Ce);if(void 0===P||"super"===Ce.facet){let wt=null;if(Ke&&(wt=Ke[0],wt=Ce.filter(wt,je,rt),0===wt.length))continue;const It=Ce.render(wt,W,rt,le,ye);if(null==It)continue;Ue.appendChild(It)}else{let wt;for(const It of P){if(!(Ce.facetAnchor?.(P,bt,It)??!It.empty))continue;let At=null;if(Ke){const vn=x.has(Ce);if(At=Ke[vn?It.i:0],At=Ce.filter(At,je,rt),0===At.length)continue;!vn&&At===Ke[0]&&(At=pue(At)),At.fx=It.x,At.fy=It.y,At.fi=It.i}const rn=Ce.render(At,W,rt,he,ye);if(null!=rn){(wt??=m1(Ue).append("g")).append(()=>rn).datum(It);for(const vn of["aria-label","aria-description","aria-hidden","transform"])rn.hasAttribute(vn)&&(wt.attr(vn,rn.getAttribute(vn)),rn.removeAttribute(vn))}}wt?.selectChildren().attr("transform",qe)}}const Ee=function xfe(e,t,i){const n=[];for(const[r,s]of RD){const u=i[r];if(u?.legend&&r in e){const h=s(e[r],IO(t,e[r],u),_=>e[_]);null!=h&&n.push(h)}}return n}($,ye,e);if(null!=n||Ee.length>0){Xe=Se.createElement("figure"),Xe.style.maxWidth="initial";for(const Ce of Ee)Xe.appendChild(Ce);if(Xe.appendChild(Ue),null!=n){const Ce=Se.createElement("figcaption");Ce.appendChild(n?.ownerDocument?n:Se.createTextNode(n)),Xe.appendChild(Ce)}}Xe.scale=function zde(e){return t=>{if(!to.has(t=`${t}`))throw new Error(`unknown scale: ${t}`);return t in e?function _j({scale:e,type:t,domain:i,range:n,interpolate:r,interval:s,transform:u,percent:h,pivot:_}){if("identity"===t)return{type:"identity",apply:M=>M,invert:M=>M};const x=e.unknown?e.unknown():void 0;return{type:t,domain:LP(i),...void 0!==n&&{range:LP(n)},...void 0!==u&&{transform:u},...h&&{percent:h},...void 0!==x&&{unknown:x},...void 0!==s&&{interval:s},...void 0!==r&&{interpolate:r},...e.clamp&&{clamp:e.clamp()},...void 0!==_&&{pivot:_,symmetric:!1},...e.base&&{base:e.base()},...e.exponent&&{exponent:e.exponent()},...e.constant&&{constant:e.constant()},...e.align&&{align:e.align(),round:e.round()},...e.padding&&(e.paddingInner?{paddingInner:e.paddingInner(),paddingOuter:e.paddingOuter()}:{padding:e.padding()}),...e.bandwidth&&{bandwidth:e.bandwidth(),step:e.step()},apply:M=>e(M),...e.invert&&{invert:M=>e.invert(M)}}}(e[t]):void 0}}($),Xe.legend=function yfe(e,t,i={}){return(n,r)=>{if(!RD.has(n))throw new Error(`unknown legend type: ${n}`);if(n in e)return RD.get(n)(e[n],IO(t,i[n],r),s=>e[s])}}($,ye,e);const Ie=function Hue(){const e=KP;return KP=0,e}();return Ie>0&&m1(Ue).append("text").attr("x",St).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("\u26a0\ufe0f").append("title").text(`${Ie.toLocaleString("en-US")} warning${1===Ie?"":"s"}. Please check the console.`),Xe}function M7(e){return e.flat(1/0).filter(t=>null!=t).map(Rfe)}function Rfe(e){return"function"==typeof e.render?e:new Lfe(e)}iu.prototype.plot=function kfe({marks:e=[],...t}={}){return B0({...t,marks:[...e,this]})};class Lfe extends iu{constructor(t){if("function"!=typeof t)throw new TypeError("invalid mark; missing render function");super(),this.render=t}render(){}}function OO(e,t){for(const i in e)D7(e[i],t);return e}function D7(e,t){const{scale:i,transform:n=!0}=e;if(null==i||!n)return;const{type:r,percent:s,interval:u,transform:h=(s?_=>100*_:MU(u,r))}=t[i]??{};null!=h&&(e.value=Oo(e.value,h),e.transform=!1)}function Ffe(e){for(const t in e)FU(t,e[t])}function A1(e,t,i,n=uue){for(const{channels:r}of t.values())for(const s in r){const u=r[s],{scale:h}=u;if(null!=h&&n(h))if("projection"===h){if(!Zue(i)){const _=void 0===i.x?.domain,x=void 0===i.y?.domain;if(_||x){const[M,S]=Yue(u);_&&kO(e,"x",M),x&&kO(e,"y",S)}}}else kO(e,h,u)}return e}function kO(e,t,i){const n=e.get(t);void 0!==n?n.push(i):e.set(t,[i])}function T7(e,t,i){if(null===e.facet||"super"===e.facet)return;const{fx:n,fy:r}=e;if(null!=n||null!=r){const _=sl(e.data??n??r);if(void 0===_)throw new Error(`missing facet data in ${e.ariaLabel}`);if(null===_)return;const x={};return null!=n&&(x.fx=E1(_,{value:n,scale:"fx"})),null!=r&&(x.fy=E1(_,{value:r,scale:"fy"})),OO(x,i),{channels:x,groups:cO(_,x)}}if(void 0===t)return;const{channels:s,groups:u,data:h}=t;if("auto"!==e.facet||e.data===h)return{channels:s,groups:u};h.length>0&&(u.size>1||1===u.size&&s.fx&&s.fy&&[...u][0][1].size>1)&&sl(e.data)?.length===h.length&&O0(`Warning: the ${e.ariaLabel} mark appears to use faceted data, but isn\u2019t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function zfe(e,t={}){return R0({...t,x:null,y:null},(i,n,r,s,u,h)=>h.getMarkState(e))}function LD(e,t,i,n,r,s,u){if(!t)return;const h=function Ufe(e){return/^\s*both\s*$/i.test(e)}(t);u=function jfe(e,t,{line:i=t.line,ticks:n,tickSize:r,tickSpacing:s,tickPadding:u,tickFormat:h,tickRotate:_,fontVariant:x,ariaLabel:M,ariaDescription:S,label:P=t.label,labelAnchor:F,labelArrow:$=t.labelArrow,labelOffset:W}){return{anchor:e,line:i,ticks:n,tickSize:r,tickSpacing:s,tickPadding:u,tickFormat:h,tickRotate:_,fontVariant:x,ariaLabel:M,ariaDescription:S,label:P,labelAnchor:F,labelArrow:$,labelOffset:W}}(h?n:t,s,u);const{line:_}=u;(i===c7||i===u7)&&_&&!w1(_)&&e.push(function Mfe(e){return new Efe(e)}(function $fe(e){const{anchor:t,line:i}=e;return{anchor:t,facetAnchor:t+"-empty",stroke:!0===i?void 0:i}}(u))),e.push(i(u)),h&&e.push(i({...u,anchor:r,label:null}))}function FD(e,t,i,n){!t||w1(t)||e.push(i(function Hfe(e,{stroke:t=(dD(e)?e:void 0),ticks:i=(Gfe(e)?e:void 0),tickSpacing:n,ariaLabel:r,ariaDescription:s}){return{stroke:t,ticks:i,tickSpacing:n,ariaLabel:r,ariaDescription:s}}(t,n)))}function Gfe(e){switch(typeof e){case"number":return!0;case"string":return!dD(e)}return gd(e)||"function"==typeof e?.range}function ND(e,t){const i=`${t}-axis `;return e.some(n=>n.ariaLabel?.startsWith(i))}function S7(e,t){for(const i of t)for(const n in i.channels){const{scale:r}=i.channels[n];if(r===e||"projection"===r)return!0}return!1}function I7(e){const t=e.domain();let i=e(t[0]),n=e(t[t.length-1]);return n<i&&([i,n]=[n,i]),[i,n+e.bandwidth()]}function A7(e={}){return xU(e)?e:{...e,y:ss}}function P7({y:e,y1:t,y2:i,...n}={}){return n=SD(n,"x"),void 0===t&&void 0===i?function Yfe(e={},t={}){1===arguments.length&&([e,t]=V0(e));const{x1:i,x:n=i,y:r,...s}=t,[u,h,_,x]=U0(n,r,"x","y",e,s);return{...u,x1:i,x:h,y1:_,y2:x,y:uD(_,x)}}({y:e,...n}):([t,i]=wU(e,t,i),{...n,y1:t,y2:i})}function V0(e){const{offset:t,order:i,reverse:n,...r}=e;return[{offset:t,order:i,reverse:n},r]}const Qfe={length:!0};function U0(e,t=cue,i,n,{offset:r,order:s,reverse:u},h){const _=function fue({z:e,fill:t,stroke:i}={}){return void 0===e&&([e]=Bh(t)),void 0===e&&([e]=Bh(i)),e}(h),[x,M]=Uh(e),[S,P]=cD(t),[F,$]=cD(t);return S.hint=F.hint=Qfe,r=function Jfe(e){if(null!=e){if("function"==typeof e)return e;switch(`${e}`.toLowerCase()){case"expand":case"normalize":return epe;case"center":case"silhouette":return tpe;case"wiggle":return k7}throw new Error(`unknown offset: ${e}`)}}(r),s=function npe(e,t,i){if(void 0===e&&t===k7)return F7(eu);if(null!=e){if("string"==typeof e){const n=e.startsWith("-"),r=n?nD:eu;switch((n?e.slice(1):e).toLowerCase()){case"value":case i:return function ipe(e){return(t,i,n)=>(r,s)=>e(n[r],n[s])}(r);case"z":return function rpe(e){return(t,i,n,r)=>(s,u)=>e(r[s],r[u])}(r);case"sum":return function ope(e){return zD(e,(t,i,n,r)=>KI(md(t),s=>bp(s,u=>n[u]),s=>r[s]))}(r);case"appearance":return function spe(e){return zD(e,(t,i,n,r)=>KI(md(t),s=>i[wz(s,u=>n[u])],s=>r[s]))}(r);case"inside-out":return F7(r)}return N7(yU(e))}if("function"==typeof e)return(1===e.length?N7:ape)(e);if(Array.isArray(e))return function lpe(e){return zD(eu,()=>e)}(e);throw new Error(`invalid order: ${e}`)}}(s,r,n),[DD(h,(W,X,K)=>{const Q=null==e?void 0:M(EU(Go(W,e),K?.[i])),he=Go(W,t,Float64Array),le=Go(W,_),ye=s&&s(W,Q,he,le),Se=W.length,Ue=P(new Float64Array(Se)),Xe=$(new Float64Array(Se)),mt=[];for(const bt of X){const qe=Q?Array.from(YI(bt,St=>Q[St]).values()):[bt];if(ye)for(const St of qe)St.sort(ye);for(const St of qe){let Nt=0,Ee=0;u&&St.reverse();for(const Ie of St){const Ce=he[Ie];Ce<0?Nt=Xe[Ie]=(Ue[Ie]=Nt)+Ce:Ce>0?Ee=Xe[Ie]=(Ue[Ie]=Ee)+Ce:Xe[Ie]=Ue[Ie]=Ee}}mt.push(qe)}return r&&r(mt,Ue,Xe,le),{data:W,facets:X}}),x,S,F]}function O7(e,t){let i=0,n=0;for(const r of e){const s=t[r];s<i&&(i=s),s>n&&(n=s)}return[i,n]}function epe(e,t,i){for(const n of e)for(const r of n){const[s,u]=O7(r,i);for(const h of r){const _=1/(u-s||1);t[h]=_*(t[h]-s),i[h]=_*(i[h]-s)}}}function tpe(e,t,i){for(const n of e){for(const r of n){const[s,u]=O7(r,i);for(const h of r){const _=(u+s)/2;t[h]-=_,i[h]-=_}}R7(n,t,i)}L7(e,t,i)}function k7(e,t,i,n){for(const r of e){const s=new hg;let u=0;for(const h of r){let _=-1;const x=h.map(F=>Math.abs(i[F]-t[F])),M=h.map(F=>{_=n?n[F]:++_;const $=i[F]-t[F],W=s.has(_)?$-s.get(_):0;return s.set(_,$),W}),S=[0,...$ne(M)];for(const F of h)t[F]+=u,i[F]+=u;const P=bp(x);P&&(u-=bp(x,(F,$)=>(M[$]/2+S[$])*F)/P)}R7(r,t,i)}L7(e,t,i)}function R7(e,t,i){const n=Ih(e,r=>Ih(r,s=>t[s]));for(const r of e)for(const s of r)t[s]-=n,i[s]-=n}function L7(e,t,i){const n=e.length;if(1===n)return;const r=e.map(h=>h.flat()),s=r.map(h=>(Ih(h,_=>t[_])+ad(h,_=>i[_]))/2),u=Ih(s);for(let h=0;h<n;h++){const _=u-s[h];for(const x of r[h])t[x]+=_,i[x]+=_}}function F7(e){return zD(e,(t,i,n,r)=>{const s=md(t),u=KI(s,S=>i[wz(S,P=>n[P])],S=>r[S]),h=s0(s,S=>bp(S,P=>n[P]),S=>r[S]),_=[],x=[];let M=0;for(const S of u)M<0?(M+=h.get(S),_.push(S)):(M-=h.get(S),x.push(S));return x.reverse().concat(_)})}function N7(e){return t=>{const i=Go(t,e);return(n,r)=>eu(i[n],i[r])}}function ape(e){return t=>(i,n)=>e(t[i],t[n])}function zD(e,t){return(i,n,r,s)=>{if(!s)throw new Error("missing channel: z");const u=new hg(t(i,n,r,s).map((h,_)=>[h,_]));return(h,_)=>e(u.get(s[h]),u.get(s[_]))}}class z7 extends iu{constructor(t,i,n={},r){super(t,i,n,r);const{inset:s=0,insetTop:u=s,insetRight:h=s,insetBottom:_=s,insetLeft:x=s,rx:M,ry:S}=n;this.insetTop=Dr(u),this.insetRight=Dr(h),this.insetBottom=Dr(_),this.insetLeft=Dr(x),this.rx=ko(M,"auto"),this.ry=ko(S,"auto")}render(t,i,n,r,s){const{rx:u,ry:h}=this;return ra("svg:g",s).call(Sp,this,r,s).call(this._transform,this,i).call(_=>_.selectAll().data(t).enter().append("rect").call(Ip,this).attr("x",this._x(i,n,r)).attr("width",this._width(i,n,r)).attr("y",this._y(i,n,r)).attr("height",this._height(i,n,r)).call($n,"rx",u).call($n,"ry",h).call(Pg,this,n)).node()}_x(t,{x:i},{marginLeft:n}){const{insetLeft:r}=this;return i?s=>i[s]+r:n+r}_y(t,{y:i},{marginTop:n}){const{insetTop:r}=this;return i?s=>i[s]+r:n+r}_width({x:t},{x:i},{marginRight:n,marginLeft:r,width:s}){const{insetLeft:u,insetRight:h}=this,_=i&&t?t.bandwidth():s-n-r;return Math.max(0,_-u-h)}_height({y:t},{y:i},{marginTop:n,marginBottom:r,height:s}){const{insetTop:u,insetBottom:h}=this,_=i&&t?t.bandwidth():s-n-r;return Math.max(0,_-u-h)}}const B7={ariaLabel:"bar"};class cpe extends z7{constructor(t,i={}){const{x1:n,x2:r,y:s}=i;super(t,{x1:{value:n,scale:"x"},x2:{value:r,scale:"x"},y:{value:s,scale:"y",type:"band",optional:!0}},i,B7)}_transform(t,i,{x:n}){t.call(Zh,i,{x:n},0,0)}_x({x:t},{x1:i,x2:n},{marginLeft:r}){const{insetLeft:s}=this;return Ql(t)?r+s:u=>Math.min(i[u],n[u])+s}_width({x:t},{x1:i,x2:n},{marginRight:r,marginLeft:s,width:u}){const{insetLeft:h,insetRight:_}=this;return Ql(t)?u-r-s-h-_:x=>Math.max(0,Math.abs(n[x]-i[x])-h-_)}}class upe extends z7{constructor(t,i={}){const{x:n,y1:r,y2:s}=i;super(t,{y1:{value:r,scale:"y"},y2:{value:s,scale:"y"},x:{value:n,scale:"x",type:"band",optional:!0}},i,B7)}_transform(t,i,{y:n}){t.call(Zh,i,{y:n},0,0)}_y({y:t},{y1:i,y2:n},{marginTop:r}){const{insetTop:s}=this;return Ql(t)?r+s:u=>Math.min(i[u],n[u])+s}_height({y:t},{y1:i,y2:n},{marginTop:r,marginBottom:s,height:u}){const{insetTop:h,insetBottom:_}=this;return Ql(t)?u-r-s-h-_:x=>Math.max(0,Math.abs(n[x]-i[x])-h-_)}}function RO(e,t={}){return FP(t)||(t={...t,y:oD,x2:ss}),new cpe(e,function Kfe({x:e,x1:t,x2:i,...n}={}){return n=SD(n,"y"),void 0===t&&void 0===i?function Xfe(e={},t={}){1===arguments.length&&([e,t]=V0(e));const{y1:i,y:n=i,x:r,...s}=t,[u,h,_,x]=U0(n,r,"y","x",e,s);return{...u,y1:i,y:h,x1:_,x2:x,x:uD(_,x)}}({x:e,...n}):([t,i]=wU(e,t,i),{...n,x1:t,x2:i})}(Bj(function Zfe(e={}){return bU(e)?e:{...e,x:ss}}(t))))}function dpe(e,t={}){return FP(t)||(t={...t,x:oD,y2:ss}),new upe(e,P7(Vj(A7(t))))}const hpe={ariaLabel:"rect"};class LO extends iu{constructor(t,i={}){const{x1:n,y1:r,x2:s,y2:u,inset:h=0,insetTop:_=h,insetRight:x=h,insetBottom:M=h,insetLeft:S=h,rx:P,ry:F}=i;super(t,{x1:{value:n,scale:"x",optional:!0},y1:{value:r,scale:"y",optional:!0},x2:{value:s,scale:"x",optional:!0},y2:{value:u,scale:"y",optional:!0}},i,hpe),this.insetTop=Dr(_),this.insetRight=Dr(x),this.insetBottom=Dr(M),this.insetLeft=Dr(S),this.rx=ko(P,"auto"),this.ry=ko(F,"auto")}render(t,i,n,r,s){const{x:u,y:h}=i,{x1:_,y1:x,x2:M,y2:S}=n,{marginTop:P,marginRight:F,marginBottom:$,marginLeft:W,width:X,height:K}=r,{projection:Q}=s,{insetTop:he,insetRight:le,insetBottom:ye,insetLeft:Se,rx:Ue,ry:Xe}=this;return ra("svg:g",s).call(Sp,this,r,s).call(Zh,this,{x:_&&M&&u,y:x&&S&&h},0,0).call(mt=>mt.selectAll().data(t).enter().append("rect").call(Ip,this).attr("x",_&&M&&(Q||!Ql(u))?bt=>Math.min(_[bt],M[bt])+Se:W+Se).attr("y",x&&S&&(Q||!Ql(h))?bt=>Math.min(x[bt],S[bt])+he:P+he).attr("width",_&&M&&(Q||!Ql(u))?bt=>Math.max(0,Math.abs(M[bt]-_[bt])-Se-le):X-F-W-le-Se).attr("height",x&&S&&(Q||!Ql(h))?bt=>Math.max(0,Math.abs(x[bt]-S[bt])-he-ye):K-P-$-he-ye).call($n,"rx",Ue).call($n,"ry",Xe).call(Pg,this,n)).node()}}function fpe(e,t={}){return FP(t)||(t={...t,x:oD,y2:ss,interval:1}),new LO(e,P7(function Ihe(e={}){return AD("x",ID,e,!0)}(A7(t))))}function V7(e={y:"count"},t={}){[e,t]=function NO({cumulative:e,domain:t,thresholds:i,interval:n,...r},s){return[r,{cumulative:e,domain:t,thresholds:i,interval:n,...s}]}(e,t);const{x:i,y:n}=t;return function FO(e,t,i,n,{data:r=ZP,filter:s=yD,sort:u,reverse:h,..._}={},x={}){e=j7(e),t=j7(t),_=function _pe(e,t){return function AU(e,t,i=qP){const n=Object.entries(e);return null!=t.title&&void 0===e.title&&n.push(["title",kue]),null!=t.href&&void 0===e.href&&n.push(["href",RU]),n.filter(([,r])=>void 0!==r).map(([r,s])=>null===s?function Iue(e){return{name:e,initialize(){},scope(){},reduce(){}}}(r):i(r,s,t))}(e,t,$7)}(_,x),r=G7(r,ss),u=null==u?void 0:$7("sort",u,x),s=null==s?void 0:H7("filter",s,x),null!=i&&P0(_,"x","x1","x2")&&(i=null),null!=n&&P0(_,"y","y1","y2")&&(n=null);const[M,S]=Uh(e),[P,F]=Uh(e),[$,W]=Uh(t),[X,K]=Uh(t),[Q,he]=null!=i?[i,"x"]:null!=n?[n,"y"]:[],[le,ye]=Uh(Q),{x:Se,y:Ue,z:Xe,fill:mt,stroke:bt,x1:qe,x2:St,y1:Nt,y2:Ee,domain:Ie,cumulative:Ce,thresholds:je,interval:rt,...Ke}=x,[wt,It]=Uh(Xe),[At]=Bh(mt),[rn]=Bh(bt),[vn,pi]=Uh(At),[pr,Wt]=Uh(rn);return{..."z"in x&&{z:wt||Xe},..."fill"in x&&{fill:vn||mt},..."stroke"in x&&{stroke:pr||bt},...DD(Ke,(Kt,ot,Qt)=>{const tn=EU(Go(Kt,Q),Qt?.[he]),tt=Go(Kt,Xe),hn=Go(Kt,At),Bn=Go(Kt,rn),Ii=function PU(e,t){for(const i in t){const n=t[i];if(void 0!==n&&!e.some(r=>r.name===i))return n}}(_,{z:tt,fill:hn,stroke:Bn}),ci=[],nn=[],mr=tn&&ye([]),vd=tt&&It([]),ll=hn&&pi([]),KD=Bn&&Wt([]),QD=e&&S([]),ak=e&&F([]),b9=t&&W([]),Vge=t&&K([]),Uge=function xpe(e,t){return e&&t?function*(i){const n=e.bin(i);for(const[r,[s,u]]of e.entries()){const h=t.bin(n[r]);for(const[_,[x,M]]of t.entries())yield[h[_],{x1:s,y1:x,x2:u,y2:M}]}}:e?function*(i){const n=e.bin(i);for(const[r,[s,u]]of e.entries())yield[n[r],{x1:s,x2:u}]}:function*(i){const n=t.bin(i);for(const[r,[s,u]]of t.entries())yield[n[r],{y1:s,y2:u}]}}(e?.(Kt),t?.(Kt));let jge=0;for(const Y0 of _)Y0.initialize(Kt);u&&u.initialize(Kt),s&&s.initialize(Kt);for(const Y0 of ot){const x9=[];for(const F1 of _)F1.scope("facet",Y0);u&&u.scope("facet",Y0),s&&s.scope("facet",Y0);for(const[F1,$ge]of C1(Y0,Ii))for(const[Hge,Gge]of C1($ge,tn))for(const[Lg,Fg]of Uge(Gge))if(!s||s.reduce(Lg,Fg)){x9.push(jge++),nn.push(r.reduceIndex(Lg,Kt,Fg)),tn&&mr.push(Hge),tt&&vd.push(Ii===tt?F1:tt[Lg[0]]),hn&&ll.push(Ii===hn?F1:hn[Lg[0]]),Bn&&KD.push(Ii===Bn?F1:Bn[Lg[0]]),QD&&(QD.push(Fg.x1),ak.push(Fg.x2)),b9&&(b9.push(Fg.y1),Vge.push(Fg.y2));for(const qge of _)qge.reduce(Lg,Fg);u&&u.reduce(Lg)}ci.push(x9)}return function OU(e,t,i){if(t){const n=t.output.transform(),r=(s,u)=>eu(n[s],n[u]);e.forEach(s=>s.sort(r))}i&&e.forEach(n=>n.reverse())}(ci,u,h),{data:nn,facets:ci}}),...!P0(_,"x")&&(M?{x1:M,x2:P,x:uD(M,P)}:{x:Se,x1:qe,x2:St}),...!P0(_,"y")&&($?{y1:$,y2:X,y:uD($,X)}:{y:Ue,y1:Nt,y2:Ee}),...le&&{[he]:le},...Object.fromEntries(_.map(({name:Kt,output:ot})=>[Kt,ot]))}}(function BD(e,{cumulative:t,domain:i,thresholds:n,interval:r},s){return void 0===(e={...x1(e)}).domain&&(e.domain=i),void 0===e.cumulative&&(e.cumulative=t),void 0===e.thresholds&&(e.thresholds=n),void 0===e.interval&&(e.interval=r),void 0===e.value&&(e.value=s),e.thresholds=function gpe(e,t,i=q7){if(void 0===e)return void 0===t?i:I0(t);if("string"==typeof e){switch(e.toLowerCase()){case"freedman-diaconis":return Wne;case"scott":return xz;case"sturges":return Zne;case"auto":return q7}return mU(e)}return e}(e.thresholds,e.interval),e}(i,t,ss),null,null,n,e,ID(t))}function j7(e){if(null==e)return;const{value:t,cumulative:i,domain:n=qc,thresholds:r}=e,s=u=>{let _,h=Go(u,t);if(tu(h)||function vpe(e){return function bpe(e){return P1(e)&&"function"==typeof e&&e()instanceof Date}(e)||gd(e)&&tu(e)}(r)){h=Oo(h,vU,Float64Array);let[M,S]="function"==typeof n?n(h):n,P="function"!=typeof r||P1(r)?r:r(h,M,S);"number"==typeof P&&(P=m8(M,S,P)),P1(P)&&(n===qc&&(M=P.floor(M),S=P.offset(P.floor(S))),P=P.range(M,P.offset(S))),_=P}else{h=sD(h);let[M,S]="function"==typeof n?n(h):n,P="function"!=typeof r||P1(r)?r:r(h,M,S);if("number"==typeof P)if(n===qc){let F=VE(M,S,P);if(isFinite(F))if(F>0){let $=Math.round(M/F),W=Math.round(S/F);$*F<=M||--$,W*F>S||++W;let X=W-$+1;P=new Float64Array(X);for(let K=0;K<X;++K)P[K]=($+K)*F}else if(F<0){F=-F;let $=Math.round(M*F),W=Math.round(S*F);$/F<=M||--$,W/F>S||++W;let X=W-$+1;P=new Float64Array(X);for(let K=0;K<X;++K)P[K]=($+K)/F}else P=[M];else P=[M]}else P=Lx(M,S,P);else P1(P)&&(n===qc&&(M=P.floor(M),S=P.offset(P.floor(S))),P=P.range(M,P.offset(S)));_=P}const x=[];if(1===_.length)x.push([_[0],_[0]]);else for(let M=1;M<_.length;++M)x.push([_[M-1],_[M]]);return x.bin=(i<0?Cpe:i>0?wpe:zO)(x,_,h),x};return s.label=Ig(t),s}function $7(e,t,i){return qP(e,t,i,H7)}function H7(e,t,i){return WP(e,t,i,G7)}function G7(e,t){return _D(e,t,ype)}function ype(e){switch(`${e}`.toLowerCase()){case"x":return Epe;case"x1":return Dpe;case"x2":return Tpe;case"y":return Mpe;case"y1":return Spe;case"y2":return Ipe}throw new Error(`invalid bin reduce: ${e}`)}function q7(e,t,i){return Math.min(200,xz(e,t,i))}function P1(e){return"function"==typeof e?.range}function zO(e,t,i){return t=sD(t),n=>{const r=e.map(()=>[]);for(const s of n)r[FE(t,i[s])-1]?.push(s);return r}}function wpe(e,t,i){const n=zO(e,t,i);return r=>{const s=n(r);for(let u=1,h=s.length;u<h;++u){const _=s[u-1],x=s[u];for(const M of _)x.push(M)}return s}}function Cpe(e,t,i){const n=zO(e,t,i);return r=>{const s=n(r);for(let u=s.length-2;u>=0;--u){const h=s[u+1],_=s[u];for(const x of h)_.push(x)}return s}}function W7(e,t){const i=(+e+ +t)/2;return e instanceof Date?new Date(i):i}const Epe={reduceIndex:(e,t,{x1:i,x2:n})=>W7(i,n)},Mpe={reduceIndex:(e,t,{y1:i,y2:n})=>W7(i,n)},Dpe={reduceIndex:(e,t,{x1:i})=>i},Tpe={reduceIndex:(e,t,{x2:i})=>i},Spe={reduceIndex:(e,t,{y1:i})=>i},Ipe={reduceIndex:(e,t,{y2:i})=>i};class Ape extends cg{constructor(t){console.log("MunisState constructor, filters=",t),t.rc||(t.rc="temperature");let i=-1;t.opacity&&(i=Number(t.opacity),i>0&&i<=1||(i=-1)),super("munis",void 0,t);let n=[],r="TRUE";"high"===this.filters.sei?(r="(socioeconomic_index >= 8 and socioeconomic_index <= 10)",n.push([">=",["get","socioeconomic_index"],8])):"mid"===this.filters.sei?(r="(socioeconomic_index >= 4 and socioeconomic_index <= 7)",n.push(["all",[">=",["get","socioeconomic_index"],4],["<=",["get","socioeconomic_index"],7]])):"low"===this.filters.sei&&(r="(socioeconomic_index >= 1 and socioeconomic_index <= 3)",n.push(["<=",["get","socioeconomic_index"],3]));let s="TRUE";"high"===this.filters.pd?(s="(population_density >= 5000)",n.push([">=",["get","population_density"],5e3])):"mid"===this.filters.pd?(s="(population_density >= 1000 and population_density < 5000)",n.push(["all",[">=",["get","population_density"],1e3],["<",["get","socioeconomic_index"],5e3]])):"low"===this.filters.pd&&(s="(population_density < 1000)",n.push(["<",["get","population_density"],1e3])),this.sql=[`SELECT muni_name, canopy_area_ratio*100 as ratio, canopy_per_capita::numeric as cpc FROM munis WHERE ${r} AND ${s} ORDER BY canopy_area_ratio DESC nulls last`];for(const _ of["munis-label","munis-border","munis-fill"])this.layerConfig[_]=new os(["all",[">",["get","canopy_area_ratio"],0],...n],null,null);const u=this.filters[ug]||o0;this.legend=vp[u],this.layerConfig["munis-fill"].paint={"fill-color":dg[u],"fill-opacity":.8},this.layerConfig["munis-border"].paint={"line-color":"#155b2e","line-opacity":.4},this.filterItems=Pne,this.popupLayers={"munis-fill":[{label:"\u05e9\u05dd \u05d4\u05e8\u05e9\u05d5\u05ea",content:_=>_.muni_name},{label:"\u05d0\u05d5\u05db\u05dc\u05d5\u05e1\u05d9\u05d4",content:_=>_.population.toLocaleString()},{label:"\u05db\u05d9\u05e1\u05d5\u05d9 \u05e6\u05d5\u05de\u05d7 \u05dc\u05e0\u05e4\u05e9",content:_=>_.canopy_per_capita.toFixed(1)+' \u05de"\u05e8'}]};const h=this.calculate_paint_definition(u,i);this.layerConfig["prcc-settlements-data"]=new os(null,h,null),this.layerConfig["prcc-settlements-data-borders"]=new os(null,null,null),this.layerConfig["prcc-settlements-data-borders"].paint={"line-width":["step",["zoom"],0,10,1],"line-opacity":1},this.handle_background_layers("bglayers")}handle_background_layers(t){const i=[];if(this.filters[t]=(this.filters[t]||"").split(";").filter(n=>n.length>0),console.log("list of layers in multi select:",this.filters[t]),this.filters[t].length>0){const n=this.filters[t];console.log("selected layers:",n),n.includes("gush")&&(console.log("displaying Gush-Chelka layer"),i.push("parcels"),i.push("parcels-labels")),n.includes("yaad")&&(console.log("displaying Yaad Trees layer"),i.push("trees")),n.includes("hupot")&&(console.log("displaying Yaad Canopies layer"),i.push("canopies"))}console.log("bg layers:",i);for(const n of i)this.layerConfig[n]=new os(null,null,null),"trees"===n&&(this.layerConfig.trees.paint={"circle-color":["case",["get","certainty"],["to-color","#204E37"],["to-color","#64B883"]],"circle-radius":["interpolate",["linear"],["zoom"],15,2,18,5],"circle-stroke-width":["interpolate",["linear"],["zoom"],15,0,18,3],"circle-stroke-color":"#ffffff"}),("parcels"===n||"parcels-labels"===n)&&(this.layerConfig[n].layout={visibility:"visible"}),"canopies"===n&&(this.layerConfig[n].layout={visibility:"visible"})}calculate_paint_definition(t,i){let _=.6;-1!==i&&(console.log("overriding opacity with",i),_=i),console.log("using opacity ",_);let $=null;return"vegetation"===t?$={"fill-color":["step",["get","VegFrac"],["to-color","#D9D9D9"],.001,["to-color","#BBDFC3"],.4,["to-color","#90B192"],.5,["to-color","#6D8F6E"],.6,["to-color","#4D734E"],.8,["to-color","#2B5B34"]],"fill-opacity":_}:"temperature"===t?$={"fill-color":["step",["get","Temperatur"],["to-color","#D9D9D9"],30,["to-color","#F7DEDF"],33,["to-color","#EDB1B2"],34,["to-color","#E58586"],35,["to-color","#DE5959"],37,["to-color","#EC1E26"]],"fill-opacity":_}:"cluster"===t?$={"fill-color":["match",["coalesce",["get","cluster17"],0],0,["to-color","#9BD7F5"],1,["to-color","#9BD7F5"],2,["to-color","#89C8EE"],3,["to-color","#78BBE7"],4,["to-color","#66AFE1"],5,["to-color","#54A4DB"],6,["to-color","#497DB0"],7,["to-color","#3C5E91"],8,["to-color","#314177"],9,["to-color","#272361"],["to-color","#1E1E4D"]],"fill-opacity":_}:"all"===t&&($={"fill-color":["rgb",["-",255,["*",21.25,["-",42,["coalesce",["get","Temperatur"],32]]]],["*",255,["coalesce",["get","VegFrac"],.001]],["*",25,["coalesce",["get","cluster17"],0]]],"fill-opacity":.6}),$}handleData(t){if(this.charts=[],t[0].length){console.log("MUNI DATA",t[0]),this.charts.push(new Ax("\u05d4\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05e2\u05dd \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd \u05d4\u05d2\u05d1\u05d5\u05d4 \u05d1\u05d9\u05d5\u05ea\u05e8:",B0({height:250,width:340,y:{axis:null},x:{grid:!0,tickFormat:n=>n+"%",label:"\u05d0\u05d7\u05d5\u05d6 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd",labelAnchor:"center"},marks:[RO(t[0].slice(0,10),{y:"muni_name",x:"ratio",fill:"#204E37",sort:{y:"-x"}}),I1(t[0].slice(0,10),{x:"ratio",y:"muni_name",text:"muni_name",textAnchor:"start",dx:-3,fill:"#fff"}),PD([0])]}))),this.charts.push(new Ax("\u05d4\u05ea\u05e4\u05dc\u05d2\u05d5\u05ea \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd \u05d1\u05d9\u05df \u05d4\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea:",B0({height:250,width:340,marginLeft:30,y:{grid:!0,label:"\u05de\u05e1\u05e4\u05e8 \u05e8\u05e9\u05d5\u05d9\u05d5\u05ea",tickPadding:15,labelAnchor:"center",labelOffset:30},x:{label:"\u05d0\u05d7\u05d5\u05d6 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd",tickFormat:n=>n+"%",labelAnchor:"center"},marks:[fpe(t[0],{...V7({y:"count"},{x:"ratio",interval:2.5}),fill:"#204E37"}),CO([0])]})));const i=t[0].filter(n=>n.cpc>0).sort((n,r)=>r.cpc-n.cpc).slice(0,10);this.charts.push(new Ax("\u05d4\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05e2\u05dd \u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd \u05dc\u05e0\u05e4\u05e9 \u05d4\u05d2\u05d1\u05d5\u05d4 \u05d1\u05d9\u05d5\u05ea\u05e8:",B0({height:250,width:340,y:{axis:null},x:{grid:!0,label:"\u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd \u05dc\u05e0\u05e4\u05e9 \u05d1\u05de\u05f4\u05e8",labelAnchor:"center"},marks:[RO(i,{y:"muni_name",x:"cpc",fill:"#204E37",sort:{y:"-x"}}),I1(i,{x:"cpc",y:"muni_name",text:"muni_name",textAnchor:"start",dx:-3,fill:"#fff"}),PD([0])]})))}}}class Ppe extends cg{constructor(t,i){super("stat-area",t,i),console.log("StatAreaState constructor STARTED"),this.sql=[`SELECT * FROM stat_areas WHERE code = '${this.id}'`,`SELECT "meta-source" as name, count(1) as count FROM trees_processed WHERE "stat_area_code" = '${this.id}' GROUP BY 1 order by 2 desc`,`SELECT count(1) as total_count FROM trees_compact WHERE "stat_area_code" = '${this.id}'`];for(const u of["stat-areas-label","stat-areas-border","stat-areas-fill"])this.layerConfig[u]=new os(["==",["get","code"],["literal",this.id]],null,null);let n=this.filters[ug]||o0;"cpc"===n&&(n=o0),this.legend=vp[n],this.layerConfig["stat-areas-fill"].paint={"fill-color":dg[n],"fill-opacity":.8},this.layerConfig["stat-areas-border"].paint={"line-color":"#ff871f","line-opacity":.4},this.filterItems=lz;const r=this.calculate_paint_definition(n),s=this.calc_filter();this.layerConfig["prcc-statistical-areas"]=new os(s,r,null),this.handle_background_layers("sbglayers")}handle_background_layers(t){const i=[];if(this.filters[t]=(this.filters[t]||"").split(";").filter(n=>n.length>0),console.log("list of layers in multi select:",this.filters[t]),this.filters[t].length>0){const n=this.filters[t];console.log("selected layers:",n),n.includes("gush")&&(console.log("displaying Gush-Chelka layer"),i.push("parcels"),i.push("parcels-labels")),n.includes("yaad")&&(console.log("displaying Yaad Trees layer"),i.push("trees")),n.includes("hupot")&&(console.log("displaying Yaad Canopies layer"),i.push("canopies"))}for(const n of i)this.layerConfig[n]=new os(null,null,null),"trees"===n&&(this.layerConfig.trees.filter=["==",["get","stat_area"],["literal",this.id]],this.layerConfig.trees.paint={"circle-color":["case",["get","certainty"],["to-color","#204E37"],["to-color","#64B883"]],"circle-radius":["interpolate",["linear"],["zoom"],15,2,18,5],"circle-stroke-width":["interpolate",["linear"],["zoom"],15,0,18,3],"circle-stroke-color":"#ffffff"}),("parcels"===n||"parcels-labels"===n||"canopies"===n)&&(this.layerConfig[n].layout={visibility:"visible"})}calc_filter(){return["==",["get","semel_new"],Number(this.id)]}calculate_paint_definition(t){let M=null;return"vegetation"===t?M={"fill-color":["interpolate",["exponential",.01],["get","VegFrac"],0,["to-color","#ccc"],.5,["to-color","#acecc2"],.6,["to-color","#155b2e"]],"fill-opacity":.3}:"temperature"===t?M={"fill-color":["interpolate",["exponential",.01],["get","median_tem"],30,["to-color","#FFFF00"],35,["to-color","#FFA500"],40,["to-color","#FF0000"]],"fill-opacity":.3}:"cluster"===t?M={"fill-color":["match",["coalesce",["get","cluster"],0],0,["to-color","#9BD7F5"],1,["to-color","#9BD7F5"],2,["to-color","#89C8EE"],3,["to-color","#78BBE7"],4,["to-color","#66AFE1"],5,["to-color","#54A4DB"],6,["to-color","#497DB0"],7,["to-color","#3C5E91"],8,["to-color","#314177"],9,["to-color","#272361"],["to-color","#1E1E4D"]],"fill-opacity":.3}:"all"===t&&(M={"fill-color":["rgb",["-",255,["*",21.25,["-",42,["coalesce",["get","median_tem"],32]]]],["*",255,["coalesce",["get","VegFrac"],.001]],["*",25,["coalesce",["get","cluster"],0]]],"fill-opacity":.6}),M}handleData(t){console.log("STAT AREA DATA",this.sql,t),t[0].length&&t[0][0]&&(this.geo={zoom:14,center:t[0][0].center})}}class Ope extends cg{constructor(t){t.rc||(t.rc="temperature"),super("stat-areas",void 0,t),this.sql=["SELECT round(canopy_area_ratio*20) * 5 as ratio, count(1) as count FROM stat_areas WHERE canopy_area_ratio > 0 GROUP BY 1 ORDER BY 1 "];for(const r of["stat-areas-label","stat-areas-border","stat-areas-fill"])this.layerConfig[r]=new os([">",["get","canopy_area_ratio"],0],null,null);this.layerConfig["munis-label"]=new os(null,null,null);let i=this.filters[ug]||o0;this.legend=vp[i],this.layerConfig["stat-areas-fill"].paint={"fill-color":dg[i],"fill-opacity":.8},this.filterItems=lz,this.popupLayers={"stat-areas-fill":[{label:"\u05de\u05d6\u05d4\u05d4 \u05d4\u05d0\u05d6\u05d5\u05e8",content:r=>r.code},{label:"\u05d9\u05d9\u05e9\u05d5\u05d1",content:r=>r.city_name||"\u05dc\u05d0 \u05d9\u05d3\u05d5\u05e2"},{label:"\u05d0\u05d7\u05d5\u05d6 \u05db\u05d9\u05e1\u05d5\u05d9 \u05e6\u05d5\u05de\u05d7",content:r=>(100*r.canopy_area_ratio).toFixed(1)+"%"}]};const n=this.calculate_paint_definition(i);this.layerConfig["prcc-statistical-areas"]=new os(null,n,null),this.layerConfig["prcc-statistical-areas-borders"]=new os(null,null,null),this.layerConfig["prcc-statistical-areas-borders"].paint={"line-width":["step",["zoom"],0,11,1,14,2],"line-opacity":1},this.handle_background_layers("sbglayers")}handle_background_layers(t){const i=[];if(this.filters[t]=(this.filters[t]||"").split(";").filter(n=>n.length>0),console.log("list of layers in multi select:",this.filters[t]),this.filters[t].length>0){const n=this.filters[t];console.log("selected layers:",n),n.includes("gush")&&(console.log("displaying Gush-Chelka layer"),i.push("parcels"),i.push("parcels-labels")),n.includes("yaad")&&(console.log("displaying Yaad Trees layer"),i.push("trees")),n.includes("hupot")&&(console.log("displaying Yaad Canopies layer"),i.push("canopies"))}for(const n of i)this.layerConfig[n]=new os(null,null,null),"trees"===n&&(this.layerConfig.trees.paint={"circle-color":["case",["get","certainty"],["to-color","#204E37"],["to-color","#64B883"]],"circle-radius":["interpolate",["linear"],["zoom"],15,2,18,5],"circle-stroke-width":["interpolate",["linear"],["zoom"],15,0,18,3],"circle-stroke-color":"#ffffff"}),("parcels"===n||"parcels-labels"===n||"canopies"===n)&&(this.layerConfig[n].layout={visibility:"visible"})}calculate_paint_definition(t){let P=null;return"vegetation"===t?P={"fill-color":["step",["get","VegFrac"],["to-color","#D9D9D9"],.001,["to-color","#BBDFC3"],.2,["to-color","#90B192"],.4,["to-color","#6D8F6E"],.6,["to-color","#4D734E"],.8,["to-color","#2B5B34"]],"fill-opacity":.6}:"temperature"===t?P={"fill-color":["step",["get","median_tem"],["to-color","#D9D9D9"],30,["to-color","#F7DEDF"],33,["to-color","#EDB1B2"],34,["to-color","#E58586"],35,["to-color","#DE5959"],37,["to-color","#EC1E26"]],"fill-opacity":.6}:"cluster"===t?P={"fill-color":["match",["coalesce",["get","cluster"],0],0,["to-color","#9BD7F5"],1,["to-color","#9BD7F5"],2,["to-color","#89C8EE"],3,["to-color","#78BBE7"],4,["to-color","#66AFE1"],5,["to-color","#54A4DB"],6,["to-color","#497DB0"],7,["to-color","#3C5E91"],8,["to-color","#314177"],9,["to-color","#272361"],["to-color","#1E1E4D"]],"fill-opacity":.6}:"all"===t&&(P={"fill-color":["rgb",["-",255,["*",21.25,["-",42,["coalesce",["get","median_tem"],32]]]],["*",255,["coalesce",["get","VegFrac"],.001]],["*",25,["coalesce",["get","cluster"],0]]],"fill-opacity":.6}),P}handleData(t){this.charts=[],t[0].length&&(console.log("STAT-AREA DATA",t[0]),this.charts.push(new Ax("\u05d4\u05ea\u05e4\u05dc\u05d2\u05d5\u05ea \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd \u05d1\u05d9\u05df \u05d4\u05d0\u05d6\u05d5\u05e8\u05d9\u05dd \u05d4\u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9\u05d9\u05dd:",B0({height:250,width:340,marginLeft:50,y:{grid:!0,label:"\u05de\u05e1\u05e4\u05e8 \u05d4\u05d0\u05d6\u05d5\u05e8\u05d9\u05dd",tickPadding:20,labelAnchor:"center",labelOffset:40},x:{label:"\u05d0\u05d7\u05d5\u05d6 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05e2\u05e6\u05d9\u05dd",tickFormat:i=>i+"%",labelAnchor:"center"},marks:[dpe(t[0],{y:"count",x:"ratio",fill:"#204E37"}),CO([0])]}))))}}const X7="certain",Y7="suspected",K7="unreported",UD={};UD[X7]=["==",["get","certainty"],!0],UD[Y7]=["==",["get","certainty"],!1],UD[K7]=["==",["get","unreported"],!0];const BO="0-10",VO="10-20",UO="20-30",jO="30-45",$O="45-60",XO="5-12",YO="12-18",Vpe=["case",["get","certainty"],["to-color","#204E37"],["to-color","#64B883"]],Upe=new LE('\u05e2\u05e6\u05d9 \u05d9\u05e2"\u05d3 - \u05d5\u05d5\u05d3\u05d0\u05d5\u05ea \u05d6\u05d9\u05d4\u05d5\u05d9',[new Vr("#204E37","\u05e2\u05e5 \u05de\u05d6\u05d5\u05d4\u05d4"),new Vr("#64B883","\u05d7\u05e9\u05d3 \u05dc\u05e2\u05e5")]),jpe=[new yp("ts","\u05d4\u05e6\u05d2\u05ea \u05e2\u05e6\u05d9\u05dd:",[new Hn("all","\u05db\u05dc \u05d4\u05e2\u05e6\u05d9\u05dd"),new Hn(X7,"\u05e8\u05e7 \u05e2\u05e6\u05d9\u05dd \u05de\u05d6\u05d5\u05d4\u05d9\u05dd"),new Hn(Y7,"\u05e8\u05e7 \u05e2\u05e6\u05d9\u05dd \u05d7\u05e9\u05d5\u05d3\u05d9\u05dd"),new Hn(K7,"\u05e8\u05e7 \u05e2\u05e6\u05d9\u05dd \u05e9\u05dc\u05d0 \u05d3\u05d5\u05d5\u05d7\u05d5 \u05dc\u05e8\u05e9\u05d5\u05ea \u05d4\u05de\u05d9\u05dd")]),new yp("canopies","\u05d4\u05e6\u05d2\u05ea \u05d7\u05d5\u05e4\u05d5\u05ea:",[new Hn("1","\u05d4\u05e6\u05d2\u05ea \u05db\u05dc \u05d4\u05d7\u05d5\u05e4\u05d5\u05ea"),new Hn("matched","\u05d4\u05e6\u05d2\u05ea \u05e8\u05e7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05e9\u05d4\u05d5\u05ea\u05d0\u05de\u05d5 \u05dc\u05e2\u05e5 \u05de\u05d6\u05d5\u05d4\u05d4"),new Hn("likely","\u05d4\u05e6\u05d2\u05ea \u05e8\u05e7 \u05d4\u05d7\u05d5\u05e4\u05d5\u05ea \u05d4\u05d7\u05e9\u05d5\u05d3\u05d5\u05ea \u05db\u05e2\u05e5"),new Hn("matched+likely","\u05d4\u05e6\u05d2\u05ea \u05e8\u05e7 \u05d7\u05d5\u05e4\u05d5\u05ea \u05e9\u05d4\u05d5\u05ea\u05d0\u05de\u05d5 \u05dc\u05e2\u05e5 \u05db\u05dc\u05e9\u05d4\u05d5"),new Hn("0","\u05d4\u05e1\u05ea\u05e8\u05ea \u05db\u05dc \u05d4\u05d7\u05d5\u05e4\u05d5\u05ea")]),new yp("bd","\u05e7\u05d5\u05d8\u05e8 \u05d2\u05d6\u05e2:",[new Hn("all","\u05d4\u05db\u05dc"),new Hn(BO,'0-10 \u05e1"\u05de'),new Hn(VO,'10-20 \u05e1"\u05de'),new Hn(UO,'20-30 \u05e1"\u05de'),new Hn(jO,'30-45 \u05e1"\u05de'),new Hn($O,'45-60 \u05e1"\u05de'),new Hn("60",'\u05de\u05e2\u05dc 60 \u05e1"\u05de')]),new yp("ca","\u05e9\u05d8\u05d7 \u05d7\u05d5\u05e4\u05ea \u05d4\u05e2\u05e5:",[new Hn("all","\u05d4\u05db\u05dc"),new Hn("0-4",'\u05e2\u05d3 4 \u05de"\u05e8'),new Hn("4-8",'4-8 \u05de"\u05e8'),new Hn("8",'\u05de\u05e2\u05dc 8 \u05de"\u05e8')]),new yp("th","\u05d2\u05d5\u05d1\u05d4 \u05d4\u05e2\u05e5:",[new Hn("all","\u05d4\u05db\u05dc"),new Hn("0-5",'\u05e2\u05d3 5 \u05de"\u05e8'),new Hn(XO,'5-12 \u05de"\u05e8'),new Hn(YO,'12-18 \u05de"\u05e8'),new Hn("18",'\u05de\u05e2\u05dc 18 \u05de"\u05e8')]),new class yne extends BI{constructor(t,i){super(t,"check"),this.label=i}}("cadaster","\u05d4\u05e6\u05d2\u05ea \u05d2\u05d5\u05e9/\u05d7\u05dc\u05e7\u05d4")],j0={};j0[BO]=["all",[">",["to-number",["get","bark_diameter"]],0],["<=",["to-number",["get","bark_diameter"]],10]],j0[VO]=["all",[">",["to-number",["get","bark_diameter"]],10],["<=",["to-number",["get","bark_diameter"]],20]],j0[UO]=["all",[">",["to-number",["get","bark_diameter"]],20],["<=",["to-number",["get","bark_diameter"]],30]],j0[jO]=["all",[">",["to-number",["get","bark_diameter"]],30],["<=",["to-number",["get","bark_diameter"]],45]],j0[$O]=["all",[">",["to-number",["get","bark_diameter"]],45],["<=",["to-number",["get","bark_diameter"]],60]],j0[60]=[">",["to-number",["get","bark_diameter"]],60];const Og={};Og[BO]='"attributes-bark-diameter" > 0 AND "attributes-bark-diameter" <= 10',Og[VO]='"attributes-bark-diameter" > 10 AND "attributes-bark-diameter" <= 20',Og[UO]='"attributes-bark-diameter" > 20 AND "attributes-bark-diameter" <= 30',Og[jO]='"attributes-bark-diameter" > 30 AND "attributes-bark-diameter" <= 45',Og[$O]='"attributes-bark-diameter" > 45 AND "attributes-bark-diameter" <= 60',Og[60]='"attributes-bark-diameter" > 60';const GD={"0-4":'"attributes-canopy-area" > 0 AND "attributes-canopy-area" <= 4',"4-8":'"attributes-canopy-area" > 4 AND "attributes-canopy-area" <= 8',8:'"attributes-canopy-area" > 8'},qD={"0-5":["all",[">",["to-number",["get","height"]],0],["<=",["to-number",["get","height"]],5]]};qD[XO]=["all",[">",["to-number",["get","height"]],5],["<=",["to-number",["get","height"]],12]],qD[YO]=["all",[">",["to-number",["get","height"]],12],["<=",["to-number",["get","height"]],18]],qD[18]=[">",["to-number",["get","height"]],18];const O1={"0-5":'"attributes-height" > 0 AND "attributes-height" <= 5'};O1[XO]='"attributes-height" > 5 AND "attributes-height" <= 12',O1[YO]='"attributes-height" > 12 AND "attributes-height" <= 18',O1[18]='"attributes-height" > 18';class $pe extends cg{constructor(t,i){super("tree",t,i),this.sql=[`SELECT * FROM trees_processed WHERE "meta-tree-id" = '${this.id}'`];for(const n of["trees","canopies"])this.layerConfig[n]=new os(null,null,null);this.layerConfig.trees.paint={"circle-color":Vpe,"circle-stroke-color":"#ff871f","circle-stroke-width":["case",["==",["get","tree-id"],["literal",this.id]],3,0]},this.filters.ts&&"all"!==this.filters.ts&&(this.layerConfig.trees.filter=["any",UD[this.filters.ts],["==",["get","tree-id"],["literal",this.id]]]),this.filterItems=jpe}handleData(t){this.geo={zoom:20,center:[t[0][0]["location-x"],t[0][0]["location-y"]]}}}class Hpe extends cg{constructor(t){console.log("TreesState constructor, filters=",t),t.rc||(t.rc="temperature"),super("trees",void 0,t);const i=[];"temperature"===this.filters.rc?i.push("evyatark-lst-tiles-8-16"):"vegetation"===this.filters.rc?i.push("evyatark-ndvi-tiles-8-16"):"satellite"===this.filters.rc&&i.push("satellite"),"0"!==this.filters.cadaster&&i.push("cadaster-label","cadaster-border"),"road"===this.focus?.kind&&i.push("roads-border");for(const _ of i)console.log("trees state, add layer",_),this.layerConfig[_]=new os(null,null,null);this.layerConfig["evyatark-lst-tiles-8-16"]&&(console.log("trees state, lst-tiles-8-16 layer, set raster-opacity"),this.layerConfig["evyatark-lst-tiles-8-16"].paint={"raster-opacity":.7}),this.layerConfig["evyatark-ndvi-tiles-8-16"]&&(console.log("trees state, ndvi-tiles-8-16 layer, set raster-opacity"),this.layerConfig["evyatark-ndvi-tiles-8-16"].paint={"raster-opacity":.7});let n="TRUE";this.filters.species=(this.filters.species||"").split(";").filter(_=>_.length>0),this.filters.species.length>0&&(n=this.filters.species.map(_=>`'${_}'`).join(","),n=`"attributes-species-clean-en" IN (${n})`);let r="TRUE";this.filters.bd&&"all"!==this.filters.bd&&(r=Og[this.filters.bd]);let s="TRUE";this.filters.ca&&"all"!==this.filters.ca&&(s=GD[this.filters.ca]);let u="TRUE";this.filters.th&&"all"!==this.filters.th&&(u=O1[this.filters.th]),[r,s,u].join(" AND "),this.filterItems=kne}handleData(t){this.charts=[];const i={"\u05d7\u05d9\u05e9\u05d4 \u05de\u05e8\u05d7\u05d5\u05e7/\u05de\u05de\u05e9\u05dc\u05ea\u05d9":'\u05e2\u05d9\u05d1\u05d5\u05d3 \u05d7\u05d5\u05e4\u05d5\u05ea \u05e2\u05e6\u05d9\u05dd/(\u05d7\u05d9\u05e9\u05d4 \u05de\u05e8\u05d7\u05d5\u05e7, \u05de\u05e4"\u05d9)',"\u05e1\u05e7\u05e8 \u05e8\u05d2\u05dc\u05d9/\u05de\u05de\u05e9\u05dc\u05ea\u05d9":"\u05e8\u05e9\u05d5\u05ea \u05d4\u05de\u05d9\u05dd/(\u05e0\u05ea\u05d5\u05e0\u05d9 \u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05de\u05e2\u05d5\u05d1\u05d3\u05d9\u05dd)"};if(t[1].length){const n=t[0][0].count,r=t[1];this.charts.push(new Ax("\u05de\u05e1\u05e4\u05e8 \u05e2\u05e6\u05d9\u05dd \u05dc\u05e4\u05d9 \u05e1\u05d5\u05d2 \u05de\u05e7\u05d5\u05e8 \u05de\u05d9\u05d3\u05e2:",B0({height:250,width:340,marginRight:100,y:{axis:null},x:{grid:!0},marks:[RO(r,{y:"name",x:"count",fill:"#204E37",sort:{y:"-x"}}),I1(r,{x:"count",y:"name",tip:"x",title:s=>`${s.count.toLocaleString()} \u05e2\u05e6\u05d9\u05dd (${(s.count/n*100).toFixed(1)}%)`,text:s=>(i[s.name]||s.name).replace(/\//,"\n"),textAnchor:"end",dx:3,fill:"#204E37"}),PD([0])]})))}t[2].length&&(this.filterItems=[...this.filterItems.slice(0,2),new VI("species","\u05e1\u05d9\u05e0\u05d5\u05df \u05dc\u05e4\u05d9 \u05de\u05d9\u05df \u05d4\u05e2\u05e5:","\u05d1\u05d7\u05d9\u05e8\u05ea \u05de\u05d9\u05e0\u05d9 \u05e2\u05e6\u05d9\u05dd...",t[2].map(n=>new Hn(n.species_en,n.species_he))),...this.filterItems.slice(2)])}}class WD{}class ZD{}class yd{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?"string"==typeof t?this.lazyInit=()=>{this.headers=new Map,t.split("\n").forEach(i=>{const n=i.indexOf(":");if(n>0){const r=i.slice(0,n),s=r.toLowerCase(),u=i.slice(n+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(u):this.headers.set(s,[u])}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((i,n)=>{this.setHeaderEntries(n,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([i,n])=>{this.setHeaderEntries(i,n)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const i=this.headers.get(t.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,i){return this.clone({name:t,value:i,op:"a"})}set(t,i){return this.clone({name:t,value:i,op:"s"})}delete(t,i){return this.clone({name:t,value:i,op:"d"})}maybeSetNormalizedName(t,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,t)}init(){this.lazyInit&&(this.lazyInit instanceof yd?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(i=>{this.headers.set(i,t.headers.get(i)),this.normalizedNames.set(i,t.normalizedNames.get(i))})}clone(t){const i=new yd;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof yd?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([t]),i}applyUpdate(t){const i=t.name.toLowerCase();switch(t.op){case"a":case"s":let n=t.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(t.name,i);const r=("a"===t.op?this.headers.get(i):void 0)||[];r.push(...n),this.headers.set(i,r);break;case"d":const s=t.value;if(s){let u=this.headers.get(i);if(!u)return;u=u.filter(h=>-1===s.indexOf(h)),0===u.length?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,u)}else this.headers.delete(i),this.normalizedNames.delete(i)}}setHeaderEntries(t,i){const n=(Array.isArray(i)?i:[i]).map(s=>s.toString()),r=t.toLowerCase();this.headers.set(r,n),this.maybeSetNormalizedName(t,r)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>t(this.normalizedNames.get(i),this.headers.get(i)))}}class Gpe{encodeKey(t){return t9(t)}encodeValue(t){return t9(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const Wpe=/%(\d[a-f0-9])/gi,Zpe={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function t9(e){return encodeURIComponent(e).replace(Wpe,(t,i)=>Zpe[i]??t)}function XD(e){return`${e}`}class Op{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new Gpe,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function qpe(e,t){const i=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[u,h]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],_=i.get(u)||[];_.push(h),i.set(u,_)}),i}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(i=>{const n=t.fromObject[i],r=Array.isArray(n)?n.map(XD):[XD(n)];this.map.set(i,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const i=this.map.get(t);return i?i[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,i){return this.clone({param:t,value:i,op:"a"})}appendAll(t){const i=[];return Object.keys(t).forEach(n=>{const r=t[n];Array.isArray(r)?r.forEach(s=>{i.push({param:n,value:s,op:"a"})}):i.push({param:n,value:r,op:"a"})}),this.clone(i)}set(t,i){return this.clone({param:t,value:i,op:"s"})}delete(t,i){return this.clone({param:t,value:i,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const i=this.encoder.encodeKey(t);return this.map.get(t).map(n=>i+"="+this.encoder.encodeValue(n)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const i=new Op({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(t),i}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const i=("a"===t.op?this.map.get(t.param):void 0)||[];i.push(XD(t.value)),this.map.set(t.param,i);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let n=this.map.get(t.param)||[];const r=n.indexOf(XD(t.value));-1!==r&&n.splice(r,1),n.length>0?this.map.set(t.param,n):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class Xpe{constructor(){this.map=new Map}set(t,i){return this.map.set(t,i),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function n9(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function i9(e){return typeof Blob<"u"&&e instanceof Blob}function r9(e){return typeof FormData<"u"&&e instanceof FormData}class k1{constructor(t,i,n,r){let s;if(this.url=i,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function Ype(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,s=r):s=n,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new yd),this.context||(this.context=new Xpe),this.params){const u=this.params.toString();if(0===u.length)this.urlWithParams=i;else{const h=i.indexOf("?");this.urlWithParams=i+(-1===h?"?":h<i.length-1?"&":"")+u}}else this.params=new Op,this.urlWithParams=i}serializeBody(){return null===this.body?null:n9(this.body)||i9(this.body)||r9(this.body)||function Kpe(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Op?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||r9(this.body)?null:i9(this.body)?this.body.type||null:n9(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Op?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const i=t.method||this.method,n=t.url||this.url,r=t.responseType||this.responseType,s=void 0!==t.body?t.body:this.body,u=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,h=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let _=t.headers||this.headers,x=t.params||this.params;const M=t.context??this.context;return void 0!==t.setHeaders&&(_=Object.keys(t.setHeaders).reduce((S,P)=>S.set(P,t.setHeaders[P]),_)),t.setParams&&(x=Object.keys(t.setParams).reduce((S,P)=>S.set(P,t.setParams[P]),x)),new k1(i,n,s,{params:x,headers:_,context:M,reportProgress:h,responseType:r,withCredentials:u})}}var $0=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}($0||{});class JO{constructor(t,i=200,n="OK"){this.headers=t.headers||new yd,this.status=void 0!==t.status?t.status:i,this.statusText=t.statusText||n,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class ek extends JO{constructor(t={}){super(t),this.type=$0.ResponseHeader}clone(t={}){return new ek({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class H0 extends JO{constructor(t={}){super(t),this.type=$0.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new H0({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class o9 extends JO{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function tk(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let s9=(()=>{var e;class t{constructor(n){this.handler=n}request(n,r,s={}){let u;if(n instanceof k1)u=n;else{let x,M;x=s.headers instanceof yd?s.headers:new yd(s.headers),s.params&&(M=s.params instanceof Op?s.params:new Op({fromObject:s.params})),u=new k1(n,r,void 0!==s.body?s.body:null,{headers:x,context:s.context,params:M,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials})}const h=Dt(u).pipe(Zy(x=>this.handler.handle(x)));if(n instanceof k1||"events"===s.observe)return h;const _=h.pipe(Aa(x=>x instanceof H0));switch(s.observe||"body"){case"body":switch(u.responseType){case"arraybuffer":return _.pipe(Un(x=>{if(null!==x.body&&!(x.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return x.body}));case"blob":return _.pipe(Un(x=>{if(null!==x.body&&!(x.body instanceof Blob))throw new Error("Response is not a Blob.");return x.body}));case"text":return _.pipe(Un(x=>{if(null!==x.body&&"string"!=typeof x.body)throw new Error("Response is not a string.");return x.body}));default:return _.pipe(Un(x=>x.body))}case"response":return _;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(n,r={}){return this.request("DELETE",n,r)}get(n,r={}){return this.request("GET",n,r)}head(n,r={}){return this.request("HEAD",n,r)}jsonp(n,r){return this.request("JSONP",n,{params:(new Op).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,r={}){return this.request("OPTIONS",n,r)}patch(n,r,s={}){return this.request("PATCH",n,tk(s,r))}post(n,r,s={}){return this.request("POST",n,tk(s,r))}put(n,r,s={}){return this.request("PUT",n,tk(s,r))}}return(e=t).\u0275fac=function(n){return new(n||e)(st(WD))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();function c9(e,t){return t(e)}function Jpe(e,t){return(i,n)=>t.intercept(i,{handle:r=>e(r,n)})}const tme=new kt(""),R1=new kt(""),u9=new kt("");function nme(){let e=null;return(t,i)=>{null===e&&(e=(Vt(tme,{optional:!0})??[]).reduceRight(Jpe,c9));const n=Vt(TC),r=n.add();return e(t,i).pipe(fx(()=>n.remove(r)))}}let d9=(()=>{var e;class t extends WD{constructor(n,r){super(),this.backend=n,this.injector=r,this.chain=null,this.pendingTasks=Vt(TC)}handle(n){if(null===this.chain){const s=Array.from(new Set([...this.injector.get(R1),...this.injector.get(u9,[])]));this.chain=s.reduceRight((u,h)=>function eme(e,t,i){return(n,r)=>i.runInContext(()=>t(n,s=>e(s,r)))}(u,h,this.injector),c9)}const r=this.pendingTasks.add();return this.chain(n,s=>this.backend.handle(s)).pipe(fx(()=>this.pendingTasks.remove(r)))}}return(e=t).\u0275fac=function(n){return new(n||e)(st(ZD),st(Xs))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();const sme=/^\)\]\}',?\n/;let f9=(()=>{var e;class t{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new gt(-2800,!1);const r=this.xhrFactory;return(r.\u0275loadImpl?Pi(r.\u0275loadImpl()):Dt(null)).pipe(Ar(()=>new On(u=>{const h=r.build();if(h.open(n.method,n.urlWithParams),n.withCredentials&&(h.withCredentials=!0),n.headers.forEach((X,K)=>h.setRequestHeader(X,K.join(","))),n.headers.has("Accept")||h.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const X=n.detectContentTypeHeader();null!==X&&h.setRequestHeader("Content-Type",X)}if(n.responseType){const X=n.responseType.toLowerCase();h.responseType="json"!==X?X:"text"}const _=n.serializeBody();let x=null;const M=()=>{if(null!==x)return x;const X=h.statusText||"OK",K=new yd(h.getAllResponseHeaders()),Q=function ame(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(h)||n.url;return x=new ek({headers:K,status:h.status,statusText:X,url:Q}),x},S=()=>{let{headers:X,status:K,statusText:Q,url:he}=M(),le=null;204!==K&&(le=typeof h.response>"u"?h.responseText:h.response),0===K&&(K=le?200:0);let ye=K>=200&&K<300;if("json"===n.responseType&&"string"==typeof le){const Se=le;le=le.replace(sme,"");try{le=""!==le?JSON.parse(le):null}catch(Ue){le=Se,ye&&(ye=!1,le={error:Ue,text:le})}}ye?(u.next(new H0({body:le,headers:X,status:K,statusText:Q,url:he||void 0})),u.complete()):u.error(new o9({error:le,headers:X,status:K,statusText:Q,url:he||void 0}))},P=X=>{const{url:K}=M(),Q=new o9({error:X,status:h.status||0,statusText:h.statusText||"Unknown Error",url:K||void 0});u.error(Q)};let F=!1;const $=X=>{F||(u.next(M()),F=!0);let K={type:$0.DownloadProgress,loaded:X.loaded};X.lengthComputable&&(K.total=X.total),"text"===n.responseType&&h.responseText&&(K.partialText=h.responseText),u.next(K)},W=X=>{let K={type:$0.UploadProgress,loaded:X.loaded};X.lengthComputable&&(K.total=X.total),u.next(K)};return h.addEventListener("load",S),h.addEventListener("error",P),h.addEventListener("timeout",P),h.addEventListener("abort",P),n.reportProgress&&(h.addEventListener("progress",$),null!==_&&h.upload&&h.upload.addEventListener("progress",W)),h.send(_),u.next({type:$0.Sent}),()=>{h.removeEventListener("error",P),h.removeEventListener("abort",P),h.removeEventListener("load",S),h.removeEventListener("timeout",P),n.reportProgress&&(h.removeEventListener("progress",$),null!==_&&h.upload&&h.upload.removeEventListener("progress",W)),h.readyState!==h.DONE&&h.abort()}})))}}return(e=t).\u0275fac=function(n){return new(n||e)(st(c5))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();const nk=new kt("XSRF_ENABLED"),p9=new kt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),m9=new kt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class g9{}let ume=(()=>{var e;class t{constructor(n,r,s){this.doc=n,this.platform=r,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=QF(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return(e=t).\u0275fac=function(n){return new(n||e)(st(Qi),st(Ea),st(p9))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac}),t})();function dme(e,t){const i=e.url.toLowerCase();if(!Vt(nk)||"GET"===e.method||"HEAD"===e.method||i.startsWith("http://")||i.startsWith("https://"))return t(e);const n=Vt(g9).getToken(),r=Vt(m9);return null!=n&&!e.headers.has(r)&&(e=e.clone({headers:e.headers.set(r,n)})),t(e)}var kp=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(kp||{});function kg(e,t){return{\u0275kind:e,\u0275providers:t}}function hme(...e){const t=[s9,f9,d9,{provide:WD,useExisting:d9},{provide:ZD,useExisting:f9},{provide:R1,useValue:dme,multi:!0},{provide:nk,useValue:!0},{provide:g9,useClass:ume}];for(const i of e)t.push(...i.\u0275providers);return function Hu(e){return{\u0275providers:e}}(t)}const _9=new kt("LEGACY_INTERCEPTOR_FN");let pme=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({providers:[hme(kg(kp.LegacyInterceptors,[{provide:_9,useFactory:nme},{provide:R1,useExisting:_9,multi:!0}]))]}),t})(),y9=(()=>{var e;class t{constructor(n){this.http=n,this.cache={}}b64EncodeUnicode(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(r,s)=>String.fromCharCode(parseInt(s,16))))}query(n,r=null){if(r||(r=n),this.cache[r])return Pi([this.cache[r]]);const u=`https://api.digital-forest.org.il/api/query?query=${encodeURIComponent(this.b64EncodeUnicode(n))}&num_rows=1000`;return this.http.get(u).pipe(mp(h=>(alert("\u05e9\u05d2\u05d9\u05d0\u05d4 \u05d1\u05e9\u05dc\u05d9\u05e4\u05ea \u05d4\u05de\u05d9\u05d3\u05e2"),Pi([{}]))),Un(h=>h.rows||[]),Ss(h=>{this.cache[r||n]=h}))}downloadUrl(n){return"https://api.digital-forest.org.il/api/download?format=xlsx&filename="+encodeURIComponent(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(st(s9))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),L1=(()=>{var e;class t{constructor(n){this.api=n,this.state=new zI,this.loading=new zI,this.sidebarOpened=!0,this.lastFeature=null,this.treeLegend=Upe}saveLastFeature(n){this.lastFeature=n}getLastFeature(){return this.lastFeature}initFromUrl(n,r){console.log("initFromUrl STARTED, segments=",n,"queryParams=",r);let s=n[0];const u=n[1]?decodeURIComponent(n[1]):void 0;let h=null;s||(s="about"),console.log("initFromUrl STARTED, mode=",s),"trees"===s&&(h=u?new $pe(u,r):new Hpe(r)),"stat-areas"===s&&(h=u?new Ppe(u,r):new Ope(r)),"munis"===s&&(h=u?new Rne(u,r):new Ape(r)),h=h||new cg(s,u,r),this.init(h)}init(n){this.loading.next(),console.log("LOADING STATE"),n.process(this.api).subscribe(()=>{console.log("PROCESSED STATE",n),this.state.next(n)})}}return(e=t).\u0275fac=function(n){return new(n||e)(st(y9))},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function bme(e,t){if(1&e&&(vt(0,"div",6),zn(1,"div",9),vt(2,"div",10),sn(3),Tt()()),2&e){const i=dn().$implicit;Nl("flex-direction",i.direction),j(1),Nl("background-color",i.color),j(1),Io("scaled",i.scaled),j(1),Yi(i.label)}}function xme(e,t){if(1&e&&(vt(0,"div",11),sn(1),Tt()),2&e){const i=dn().$implicit;Nl("background-color",i.color),j(1),Wm(" ",i.label," ")}}function wme(e,t){if(1&e&&(vt(0,"div",6),yn(1,bme,4,7,"div",7),yn(2,xme,2,3,"div",8),Tt()),2&e){const i=t.$implicit;Io("separated",i.separated),j(1),Ft("ngIf",!i.separated&&!i.label_on_color),j(1),Ft("ngIf",!i.separated&&i.label_on_color)}}function Cme(e,t){if(1&e&&(vt(0,"div"),sn(1),Tt()),2&e){const i=dn(2);j(1),Yi(i.legend.title)}}function Eme(e,t){if(1&e&&(vt(0,"div",6),zn(1,"div",9),vt(2,"div",10),sn(3),Tt()()),2&e){const i=dn().$implicit;j(1),Nl("background-color",i.color),j(1),Io("scaled",i.scaled),j(1),Yi(i.label)}}function Mme(e,t){if(1&e&&(vt(0,"div",12),yn(1,Eme,4,5,"div",13),Tt()),2&e){const i=t.$implicit;j(1),Ft("ngIf",i.separated)}}function Dme(e,t){if(1&e&&(vt(0,"div",1)(1,"div",2),yn(2,wme,3,4,"div",3),yn(3,Cme,2,1,"div",4),Tt(),vt(4,"div",2),yn(5,Mme,2,1,"div",5),Tt()()),2&e){const i=dn();Ft("matTooltip",i.legend.tooltip),j(2),Ft("ngForOf",i.legend.items),j(1),Ft("ngIf",i.legend.displayTitle),j(2),Ft("ngForOf",i.legend.items)}}let Tme=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-legend"]],inputs:{legend:"legend"},decls:1,vars:1,consts:[["class","tooltip",3,"matTooltip",4,"ngIf"],[1,"tooltip",3,"matTooltip"],[1,"items"],["class","item",3,"separated",4,"ngFor","ngForOf"],[4,"ngIf"],["class","item1",4,"ngFor","ngForOf"],[1,"item"],["class","item",3,"flex-direction",4,"ngIf"],["class","item color label","style","color: white; font-size: 12px; padding-right: 40%",3,"backgroundColor",4,"ngIf"],[1,"color"],[1,"label"],[1,"item","color","label",2,"color","white","font-size","12px","padding-right","40%"],[1,"item1"],["class","item",4,"ngIf"]],template:function(n,r){1&n&&yn(0,Dme,6,4,"div",0),2&n&&Ft("ngIf",r.legend.tooltip)},dependencies:[Jm,Sa,GS],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]{background:#fff;box-shadow:0 4px 8px #0000004d;padding:12px;display:flex;flex-flow:column;align-items:flex-start;gap:20px;margin:20px;border-radius:5px}[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:13px;color:#383838;margin:0}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]{display:flex;flex-flow:row;gap:2px;width:100%;justify-content:space-between}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;gap:0px}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]{width:43px;height:13px;background:#204E37;padding:3px;gap:10px}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;color:#4f4f4f;font-size:16px;line-height:24px}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .label.scaled[_ngcontent-%COMP%]{transform:scale(6);transform-origin:8px 16px;color:#838383}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item.separated[_ngcontent-%COMP%]{border-top:1px dotted #838383;padding-top:7px}']}),t})();function Sme(e,t){if(1&e&&(vt(0,"h2",4),sn(1),Tt()),2&e){const i=dn();Ft("matTooltip",i.legend.tooltip),j(1),Yi(i.legend.title)}}function Ime(e,t){if(1&e&&(vt(0,"h2"),sn(1),Tt()),2&e){const i=dn();j(1),Yi(i.legend.title)}}function Ame(e,t){if(1&e&&(vt(0,"div",5),zn(1,"div",6),vt(2,"div",7),sn(3),Tt()()),2&e){const i=t.$implicit;Io("separated",i.separated),j(1),Nl("background-color",i.color),j(1),Io("scaled",i.scaled),j(1),Yi(i.label)}}let Pme=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-tree-legend"]],inputs:{legend:"legend"},decls:4,vars:3,consts:[["class","tooltip",3,"matTooltip",4,"ngIf"],[4,"ngIf"],[1,"items"],["class","item",3,"separated",4,"ngFor","ngForOf"],[1,"tooltip",3,"matTooltip"],[1,"item"],[1,"color"],[1,"label"]],template:function(n,r){1&n&&(yn(0,Sme,2,2,"h2",0),yn(1,Ime,2,1,"h2",1),vt(2,"div",2),yn(3,Ame,4,7,"div",3),Tt()),2&n&&(Ft("ngIf",r.legend.tooltip),j(1),Ft("ngIf",!r.legend.tooltip),j(2),Ft("ngForOf",r.legend.items))},dependencies:[Jm,Sa,GS],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]{background:#fff;box-shadow:0 4px 8px #0000004d;padding:12px;display:flex;flex-flow:column;align-items:flex-start;gap:20px;margin:20px;border-radius:5px}[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:13px;color:#383838;margin:0}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px;width:100%}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;gap:10px}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:14px;background:#204E37}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;color:#4f4f4f;font-size:16px;line-height:24px}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .label.scaled[_ngcontent-%COMP%]{transform:scale(6);transform-origin:8px 16px;color:#838383}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]   .item.separated[_ngcontent-%COMP%]{border-top:1px dotted #838383;padding-top:7px}']}),t})();var G0;function Ome(e,t){if(1&e&&(vt(0,"div",8),zn(1,"a",9),Tt()),2&e){const i=dn();j(1),Ft("routerLink",i.back)}}function kme(e,t){1&e&&Fb(0,0,["*ngIf","init"])}function Rme(e,t){1&e&&(bh(0),zn(1,"div",10)(2,"div",11)(3,"div",11),xh())}function Lme(e,t){if(1&e){const i=Fy();vt(0,"div",12),Cr("click",function(){Ef(i);const r=dn();return ku(r.stateSvc.sidebarOpened=!r.stateSvc.sidebarOpened)}),Tt()}2&e&&Io("opened",dn().stateSvc.sidebarOpened)}function Fme(e,t){if(1&e&&(bh(0),zn(1,"div")(2,"app-legend",13),xh()),2&e){const i=dn();j(2),Ft("legend",i.state_.legend)}}function Nme(e,t){if(1&e&&(bh(0),zn(1,"div")(2,"app-tree-legend",13),xh()),2&e){const i=dn();j(2),Ft("legend",i.stateSvc.treeLegend)}}let Rg=((G0=class{constructor(t,i){this.stateSvc=t,this.router=i,this.init=!1,this.mode="empty",this.back=null,this.state=new rr,this.stateSvc.state.pipe(Ix(this),Aa(n=>n.mode===this.mode),function hne(e,t=JC){const i=US(e,t);return Y4(()=>i)}(0)).subscribe(n=>{this.state_=n,this.state.emit(n)}),this.stateSvc.loading.pipe(Ix(this)).subscribe(()=>{this.state.emit(null)})}goBack(){this.back&&this.router.navigate(this.back,{queryParamsHandling:"merge"})}}).\u0275fac=function(t){return new(t||G0)(q(L1),q(Is))},G0.\u0275cmp=ui({type:G0,selectors:[["app-content"]],hostVars:2,hostBindings:function(t,i){2&t&&Io("opened",i.stateSvc.sidebarOpened||!!i.back)},inputs:{init:"init",mode:"mode",back:"back"},outputs:{state:"state"},ngContentSelectors:["*"],decls:12,vars:8,consts:[[1,"sidebar"],["class","close",4,"ngIf"],[4,"ngIf"],[1,"window",3,"click"],["class","handle",3,"opened","click",4,"ngIf"],[1,"widgets"],[1,"column"],[1,"row"],[1,"close"],["queryParamsHandling","merge",3,"routerLink"],[1,"loading","small"],[1,"loading","large"],[1,"handle",3,"click"],[3,"legend"]],template:function(t,i){1&t&&(Lb(),vt(0,"div",0),yn(1,Ome,2,1,"div",1),yn(2,kme,1,0,"ng-content",2),yn(3,Rme,4,0,"ng-container",2),Tt(),vt(4,"div",3),Cr("click",function(){return i.goBack()}),yn(5,Lme,1,2,"div",4),vt(6,"div",5)(7,"div",6),zn(8,"div"),yn(9,Fme,3,1,"ng-container",2),Tt(),vt(10,"div",7),yn(11,Nme,3,1,"ng-container",2),Tt()()()),2&t&&(j(1),Ft("ngIf",!!i.back),j(1),Ft("ngIf",i.init),j(1),Ft("ngIf",!i.init),j(1),Io("interactive",!!i.back),j(1),Ft("ngIf",!i.back),j(4),Ft("ngIf",i.state_&&i.state_.legend),j(2),Ft("ngIf",i.stateSvc.treeLegend&&i.state_.isLayerVisible("trees")))},dependencies:[Sa,n0,Tme,Pme],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]{display:flex;flex-flow:row;align-items:stretch;height:100%}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]{flex:0 1 400px;box-shadow:-4px 4px 8px #0000004d;background-color:#fff;padding:30px;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll;height:100%;pointer-events:all;position:relative;margin-right:-400px;transition:margin-right .2s ease-in-out}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:5px;border:1px solid transparent;position:absolute;top:20px;left:20px}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:hover{border:1px solid #64B883}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:inline-block;width:100%;height:100%;background-repeat:no-repeat;background-size:contain;background-size:24px;background-position:center;background-image:url(icon-close.e4568d58d18fcde9.svg)}[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited, [_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:none}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]{height:100%;flex:1 1 auto;display:flex;flex-flow:row;align-items:stretch;position:relative}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:20px;background-repeat:no-repeat;background-position:center;background-size:contain;background-size:40px;background-image:url(circle-chevron.24be55ab865c21aa.svg);cursor:pointer;pointer-events:all;position:absolute;top:calc(50% - 20px);right:-16px;box-shadow:-4px 0 8px #0000004d;transition:transform .2s ease-in-out}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]   .handle.opened[_ngcontent-%COMP%]{transform:rotate(180deg);box-shadow:4px 0 8px #0000004d}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:space-between;flex:1 1 100%;position:relative}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;flex-flow:row-reverse;align-items:flex-start;justify-content:space-between;height:50%;position:absolute;bottom:0}[_nghost-%COMP%]   .window[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .column[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:flex-start;justify-content:space-between;height:100%;position:absolute;bottom:0}[_nghost-%COMP%]   .window.interactive[_ngcontent-%COMP%]{pointer-events:all}.opened[_nghost-%COMP%]   .sidebar[_ngcontent-%COMP%]{margin-right:0}']}),G0);Rg=dl([RE()],Rg);const Bme=["chart"];function Vme(e,t){1&e&&(vt(0,"div",5)(1,"h1",6),sn(2,"\u05ea\u05db\u05e0\u05d5\u05df \u05d3\u05d9\u05d2\u05d9\u05d8\u05dc\u05d9 \u05dc\u05e7\u05d9\u05d3\u05d5\u05dd \u05d7\u05d5\u05e1\u05df \u05e2\u05d9\u05e8\u05d5\u05e0\u05d9 \u05d5\u05d4\u05e2\u05e8\u05db\u05d5\u05ea \u05dc\u05e9\u05d9\u05e0\u05d5\u05d9\u05d9 \u05d0\u05e7\u05dc\u05d9\u05dd"),Tt(),vt(3,"div",7),zn(4,"span")(5,"br"),vt(6,"div",8),sn(7,"\u05db\u05d3\u05d9 \u05dc\u05ea\u05e2\u05d3\u05e3 \u05d4\u05e9\u05e7\u05e2\u05d4 \u05d1\u05ea\u05e9\u05ea\u05d9\u05d5\u05ea \u05d9\u05e8\u05d5\u05e7\u05d5\u05ea,"),Tt(),zn(8,"br"),vt(9,"span"),sn(10,"\u05dc\u05e8\u05e9\u05d5\u05ea\u05db\u05dd \u05d4\u05de\u05d9\u05d3\u05e2: \u05d8\u05de\u05e4\u05e8\u05d8\u05d5\u05e8\u05ea \u05e4\u05e0\u05d9 \u05d4\u05e9\u05d8\u05d7,"),Tt(),zn(11,"br"),vt(12,"span"),sn(13,"\u05db\u05d9\u05e1\u05d5\u05d9 \u05e6\u05d5\u05de\u05d7, \u05d0\u05e9\u05db\u05d5\u05dc \u05d7\u05d1\u05e8\u05ea\u05d9 \u05db\u05dc\u05db\u05dc\u05d9, \u05de\u05e6\u05d1"),Tt(),zn(14,"br"),vt(15,"span"),sn(16,"\u05d4\u05d4\u05e6\u05dc\u05dc\u05d4 \u05d4\u05e7\u05d9\u05d9\u05dd \u05e1\u05d1\u05d9\u05d1 \u05e9\u05d9\u05e8\u05d5\u05ea\u05d9 \u05d1\u05e8\u05d9\u05d0\u05d5\u05ea, \u05d7\u05d9\u05e0\u05d5\u05da"),Tt(),zn(17,"br"),vt(18,"span"),sn(19,"\u05d5\u05ea\u05d7\u05e0\u05d5\u05ea \u05d0\u05d5\u05d8\u05d5\u05d1\u05d5\u05e1 (\u05e6\u05d9\u05d5\u05df \u05de\u05e9\u05d5\u05db\u05dc\u05dc), \u05d5\u05e4\u05e9\u05d8\u05d9 \u05d4\u05e6\u05e4\u05d4."),Tt(),zn(20,"br")(21,"span")(22,"br"),vt(23,"div",9),sn(24,"\u05d1\u05d5\u05d0\u05d5 \u05dc\u05e9\u05e0\u05d5\u05ea \u05d0\u05ea \u05e4\u05e0\u05d9 \u05d4\u05e2\u05d9\u05e8 \u05dc\u05e2\u05ea\u05d9\u05d3 \u05d9\u05e8\u05d5\u05e7 \u05d9\u05d5\u05ea\u05e8"),Tt(),zn(25,"br"),vt(26,"span"),sn(27,"\u05d4\u05d6\u05d9\u05d6\u05d5 \u05d0\u05ea \u05d4\u05e1\u05dc\u05d9\u05d9\u05d3\u05e8 \u05d5\u05e8\u05d0\u05d5 \u05db\u05d9\u05e6\u05d3 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d4\u05e2\u05d9\u05e8 \u05d1\u05e2\u05e6\u05d9\u05dd"),Tt(),zn(28,"br"),vt(29,"span"),sn(30,"\u05d5\u05e6\u05dc \u05de\u05e9\u05e0\u05d4 \u05d0\u05ea \u05d4\u05e2\u05ea\u05d9\u05d3"),Tt(),zn(31,"br")(32,"span")(33,"br"),Tt()())}function Ume(e,t){if(1&e&&(vt(0,"div",10)(1,"h2"),sn(2),Tt(),zn(3,"div",11,12),Tt()),2&e){const i=t.$implicit;j(2),Yi(i.title)}}function jme(e,t){if(1&e&&(vt(0,"div",1),yn(1,Vme,34,0,"div",2),Fb(2),vt(3,"div",3),yn(4,Ume,5,1,"div",4),Tt()()),2&e){const i=dn();j(1),Ft("ngIf","munis"==i.state.mode||"stat-areas"==i.state.mode),j(3),Ft("ngForOf",i.state.charts)}}const $me=["*"];let ik=(()=>{var e;class t{constructor(){this.state=null,this.name=""}ngOnChanges(){US(0).subscribe(()=>{this.charts.forEach((n,r)=>{console.log("CHART",n,n.nativeElement,this.state?.charts[r].chart),this.state?.charts[r].chart&&n.nativeElement.appendChild(this.state?.charts[r].chart)})})}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-summary"]],viewQuery:function(n,r){if(1&n&&Ch(Bme,5),2&n){let s;Bl(s=Vl())&&(r.charts=s)}},inputs:{state:"state",name:"name"},features:[Te],ngContentSelectors:$me,decls:1,vars:1,consts:[["class","content",4,"ngIf"],[1,"content"],["class","c1",4,"ngIf"],[1,"charts"],["class","chart",4,"ngFor","ngForOf"],[1,"c1"],[1,"c2"],[1,"c3_regular"],[1,"c3_bold"],[1,"c3_bold","c3_green"],[1,"chart"],[1,"chart-container"],["chart",""]],template:function(n,r){1&n&&(Lb(),yn(0,jme,5,2,"div",0)),2&n&&Ft("ngIf",r.state)},dependencies:[Jm,Sa],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:10px}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:10px;align-items:right;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:14px;line-height:14px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}.c1[_ngcontent-%COMP%]{width:Fixed 303px;height:Hug 416.5px;gap:30px}.c1[_ngcontent-%COMP%]   .c2[_ngcontent-%COMP%]{font-family:Noto Sans Hebrew;font-size:24px;font-weight:400;line-height:30px;letter-spacing:0em;text-align:right;width:303px;height:60px}.c1[_ngcontent-%COMP%]   .c3_bold[_ngcontent-%COMP%]{font-family:Noto Sans Hebrew;font-size:16px;font-weight:700;line-height:24px;letter-spacing:0em;text-align:right}.c1[_ngcontent-%COMP%]   .c3_green[_ngcontent-%COMP%]{color:#43855e}.c1[_ngcontent-%COMP%]   .c3_regular[_ngcontent-%COMP%]{font-family:Noto Sans Hebrew;font-size:16px;font-weight:400;line-height:24px;letter-spacing:0em;text-align:right}.charts[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}.charts[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:16px}.charts[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:18px;line-height:22px;color:#383838}']}),t})();function Hme(e,t){1&e&&(vt(0,"app-summary",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2"),sn(5,"\u05ea\u05de\u05d5\u05e0\u05d5\u05ea \u05dc\u05d5\u05d5\u05d9\u05d9\u05df"),Tt()()()()()),2&e&&Ft("state",dn().state)}let Gme=(()=>{var e;class t{constructor(){this.state=null}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-trees"]],decls:2,vars:2,consts:[["mode","trees",3,"init","state"],[3,"state",4,"ngIf"],[3,"state"],[1,"icon-infos"],[1,"icon-info","big"],[1,"text"]],template:function(n,r){1&n&&(vt(0,"app-content",0),Cr("state",function(u){return r.state=u}),yn(1,Hme,6,1,"app-summary",1),Tt()),2&n&&(Ft("init",!!r.state),j(1),Ft("ngIf",r.state))},dependencies:[Sa,Rg,ik],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:10px}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:10px;align-items:right;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:14px;line-height:14px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}']}),t})();function qme(e,t){if(1&e&&(vt(0,"h2",5),sn(1),Tt()),2&e){const i=dn().$implicit;Ft("matTooltip",i.tooltip),j(1),Yi(i.text)}}function Wme(e,t){if(1&e&&(vt(0,"h2"),sn(1),Tt()),2&e){const i=dn().$implicit;j(1),Yi(i.text)}}function Zme(e,t){if(1&e&&(vt(0,"div",10),zn(1,"div",11),vt(2,"div",12),yn(3,qme,2,2,"h2",13),yn(4,Wme,2,1,"h2",14),vt(5,"div",15)(6,"span",16),sn(7),Tt(),vt(8,"span",17),sn(9),Tt()()()()),2&e){const i=t.$implicit;j(1),Nl("background-image","url(assets/img/icon-"+i.icon+".svg)"),j(2),Ft("ngIf",i.tooltip),j(1),Ft("ngIf",!i.tooltip),j(3),Yi(i.value),j(2),Yi(i.units)}}function Xme(e,t){if(1&e&&(vt(0,"h2",5),sn(1),Tt()),2&e){const i=dn().$implicit;Ft("matTooltip",i.tooltip),j(1),Yi(i.text)}}function Yme(e,t){if(1&e&&(vt(0,"h2"),sn(1),Tt()),2&e){const i=dn().$implicit;j(1),Yi(i.text)}}function Kme(e,t){if(1&e&&(vt(0,"div",10),zn(1,"div",11),vt(2,"div",12),yn(3,Xme,2,2,"h2",13),yn(4,Yme,2,1,"h2",14),vt(5,"div",15)(6,"span",16),sn(7),Tt(),vt(8,"span",17),sn(9),Tt()()()()),2&e){const i=t.$implicit;j(1),Nl("background-image","url(assets/img/icon-"+i.icon+".svg)"),j(2),Ft("ngIf",i.tooltip),j(1),Ft("ngIf",!i.tooltip),j(3),Yi(i.value),j(2),Yi(i.units)}}function Qme(e,t){if(1&e&&(vt(0,"h2",5),sn(1),Tt()),2&e){const i=dn().$implicit;Ft("matTooltip",i.tooltip),j(1),Yi(i.text)}}function Jme(e,t){if(1&e&&(vt(0,"h2"),sn(1),Tt()),2&e){const i=dn().$implicit;j(1),Yi(i.text)}}function ege(e,t){if(1&e&&(vt(0,"div",10),zn(1,"div",11),vt(2,"div",12),yn(3,Qme,2,2,"h2",13),yn(4,Jme,2,1,"h2",14),vt(5,"div",15)(6,"span",16),sn(7),Tt(),vt(8,"span",17),sn(9),Tt()()()()),2&e){const i=t.$implicit;j(1),Nl("background-image","url(assets/img/icon-"+i.icon+".svg)"),j(2),Ft("ngIf",i.tooltip),j(1),Ft("ngIf",!i.tooltip),j(3),Yi(i.value),j(2),Yi(i.units)}}function tge(e,t){if(1&e){const i=Fy();vt(0,"div",1)(1,"h1"),sn(2),Tt(),vt(3,"div",2),yn(4,Zme,10,6,"div",3),Tt(),vt(5,"div",4)(6,"h2",5),sn(7,"\u05d4\u05ea\u05e2\u05e8\u05d1\u05d5\u05ea: \u05e9\u05d9\u05e0\u05d5\u05d9 \u05e9\u05d9\u05e2\u05d5\u05e8 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d4\u05e6\u05d5\u05de\u05d7"),Tt()(),vt(8,"div",6),yn(9,Kme,10,6,"div",3),Tt(),vt(10,"div",7)(11,"mat-slider",8)(12,"input",9),Cr("dragEnd",function(r){return Ef(i),ku(dn().onDragEnd(r))}),Tt()()(),zn(13,"hr"),vt(14,"div",2),yn(15,ege,10,6,"div",3),Tt()()}if(2&e){const i=dn();j(2),Yi(i.nameOfRegion),j(2),Ft("ngForOf",i.iconInfos),j(2),Ft("matTooltip","\u05d4\u05ea\u05e2\u05e8\u05d1\u05d5\u05ea: \u05e9\u05d9\u05e0\u05d5\u05d9 \u05e9\u05d9\u05e2\u05d5\u05e8 \u05db\u05d9\u05e1\u05d5\u05d9 \u05d4\u05e6\u05d5\u05de\u05d7"),j(3),Ft("ngForOf",i.iconInfos2),j(2),l2("min",100*i.record.VegFrac),Ft("displayWith",i.formatLabel),j(4),Ft("ngForOf",i.iconInfos3)}}const nge=[{text:"\u05d8\u05de\u05e4\u05e8\u05d8\u05d5\u05e8\u05ea \u05e4\u05e0\u05d9 \u05d4\u05e9\u05d8\u05d7",icon:"temperature",tooltip:"\u05dc\u05e4\u05d9 \u05e0\u05ea\u05d5\u05e0\u05d9 \u05dc\u05de\u05f4\u05e1 2020",units:"\u05de\u05e2\u05dc\u05d5\u05ea",field:"Temperatur"},{text:"\u05de\u05d3\u05d3 \u05e1\u05d5\u05e6\u05d9\u05d5\u05d0\u05e7\u05d5\u05e0\u05d5\u05de\u05d9",icon:"madad",tooltip:"\u05dc\u05e4\u05d9 \u05e0\u05ea\u05d5\u05e0\u05d9 \u05dc\u05de\u05f4\u05e1 2020",units:"",field:"cluster17"},{text:"\u05d8\u05de\u05e4\u05e8\u05d8\u05d5\u05e8\u05ea \u05e4\u05e0\u05d9 \u05d4\u05e9\u05d8\u05d7",icon:"temperature",tooltip:"\u05dc\u05e4\u05d9 \u05e0\u05ea\u05d5\u05e0\u05d9 \u05dc\u05de\u05f4\u05e1 2020",units:"\u05de\u05e2\u05dc\u05d5\u05ea",field:"median_tem"},{text:"\u05de\u05d3\u05d3 \u05e1\u05d5\u05e6\u05d9\u05d5\u05d0\u05e7\u05d5\u05e0\u05d5\u05de\u05d9",icon:"madad",tooltip:"\u05dc\u05e4\u05d9 \u05e0\u05ea\u05d5\u05e0\u05d9 \u05dc\u05de\u05f4\u05e1 2020",units:"",field:"cluster"},{text:"\u05e6\u05d9\u05d5\u05df \u05d4\u05e6\u05dc\u05dc\u05d4 \u05de\u05e9\u05d5\u05e7\u05dc\u05dc",icon:"shadowing-score",tooltip:"\u05d1\u05e7\u05e8\u05d5\u05d1...",units:"",value:e=>"--"}],ige=[{text:"\u05db\u05d9\u05e1\u05d5\u05d9 \u05e0\u05d5\u05db\u05d7\u05d9",icon:"current-cover",tooltip:"\u05dc\u05e4\u05d9 \u05e0\u05ea\u05d5\u05e0\u05d9 \u05dc\u05de\u05f4\u05e1 2020",units:"",value:e=>(100*e.VegFrac).toFixed(0)+"%"},{text:"\u05db\u05d9\u05e1\u05d5\u05d9 \u05dc\u05d0\u05d7\u05e8 \u05d4\u05ea\u05e2\u05e8\u05d1\u05d5\u05ea",icon:"expected-cover",tooltip:"\u05d4\u05d6\u05d6 \u05d0\u05ea \u05d4\u05e1\u05e7\u05e8\u05d5\u05dc \u05dc\u05ea\u05d5\u05e6\u05d0\u05d5\u05ea",units:"",value:e=>"?"}],rge=[{text:"\u05e9\u05d9\u05e0\u05d5\u05d9 \u05d1\u05d8\u05de\u05e4\u05e8\u05d8\u05d5\u05e8\u05d4",icon:"temperature-change",tooltip:"\u05d4\u05d6\u05d6 \u05d0\u05ea \u05d4\u05e1\u05e7\u05e8\u05d5\u05dc \u05dc\u05ea\u05d5\u05e6\u05d0\u05d5\u05ea",units:"\u05de\u05e2\u05dc\u05d5\u05ea",value:"0"},{text:"\u05d7\u05d9\u05e1\u05db\u05d5\u05df",icon:"savings",tooltip:"\u05d1\u05e7\u05e8\u05d5\u05d1...",units:"",value:"--"},{text:"\u05de\u05e0\u05d9\u05e2\u05ea \u05ea\u05d7\u05dc\u05d5\u05d0\u05d4",icon:"prevent-sickness",tooltip:"\u05d1\u05e7\u05e8\u05d5\u05d1...",units:"",value:"--"},{text:"\u05de\u05e0\u05d9\u05e2\u05ea \u05ea\u05de\u05d5\u05ea\u05d4 \u05de\u05d5\u05e7\u05d3\u05de\u05ea",icon:"prevent-death",tooltip:"\u05d4\u05d6\u05d6 \u05d0\u05ea \u05d4\u05e1\u05e7\u05e8\u05d5\u05dc \u05dc\u05ea\u05d5\u05e6\u05d0\u05d5\u05ea",units:"\u05d1\u05e9\u05e0\u05d4",value:"0"}];let v9=(()=>{var e;class t{constructor(n){this.state=n,this.record=null,this.sources=[],this.name="",this.focus="",this.focusLink="",this.iconInfos=[],this.iconInfos2=[],this.iconInfos3=rge,this.focusParams={},this.nameOfRegion="unknown"}ngOnChanges(){if(console.log("ngOnChange started"),this.record){console.log("REGION RECORD",this.record);const n=this.state.getLastFeature();console.log("LAST FEATURE",n),n&&("prcc-settlements-data"===n.layer.id?this.nameOfRegion=n.properties.Muni_Heb:"prcc-statistical-areas"===n.layer.id&&(this.nameOfRegion=n.properties.SHEM_YISHU+" \u05d0\u05d9\u05d6\u05d5\u05e8 "+n.properties.stat_area),this.record=n.properties),this.iconInfos=[],nge.forEach(r=>{this.populateIconInfo(r,this.iconInfos)}),ige.forEach(r=>{this.populateIconInfo(r,this.iconInfos2)}),console.log("REGION ICON_INFOS",this.iconInfos),console.log("REGION ICON_INFOS2",this.iconInfos2),this.iconInfos3[0].value="--",this.iconInfos3[1].value="--",this.iconInfos3[2].value="--",this.iconInfos3[3].value="--",this.focusParams={focus:this.focus}}}populateIconInfo(n,r){let s=null;n.field?s=this.record[n.field]:"function"==typeof n.value&&(s=n.value(this.record));let u=n.units;"function"==typeof u&&(u=u(this.record)),null!=s&&null!=u&&("number"==typeof s&&(s=s.toLocaleString()),r.push({text:n.text,icon:n.icon,tooltip:n.tooltip,value:s,units:u}))}formatLabel(n){return n>=-1?Math.round(n)+"%":`${n}`}onDragEnd(n){console.log("event dragEnd",n),console.log("slider value is now",n.value);const r=this.calculate_aoc(n.value),u=this.calculate_Temperature_change(n.value);this.iconInfos2[1].value=n.value.toFixed(0)+"%",this.iconInfos3[0].value=String(u),this.iconInfos3[1].value="--",this.iconInfos3[2].value="--",this.iconInfos3[3].value=String(r)}calculate_Temperature_change(n){const _=(-1*this.record.SlopeT*(.01*n-this.record.VegFrac)).toFixed(2);return console.log("temperature_change=",_),_}calculate_aoc(n){const r=this.record.VegFrac,s=.01*n,u=s-r,h=Math.exp(-.4082*u),_=(h-1)/h,x=this.record.EM,M=(-1*_*x).toFixed(2);return console.log("calculate_aoc, slider_val_percents=",n),console.log("current_ndvi=",r),console.log("slider_val=",s),console.log("delta=",u),console.log("rri=",h),console.log("pafi=",_),console.log("em=",x),console.log("aoc=",M),M}}return(e=t).\u0275fac=function(n){return new(n||e)(q(L1))},e.\u0275cmp=ui({type:e,selectors:[["app-region"]],inputs:{record:"record",sources:"sources",name:"name",focus:"focus",focusLink:"focusLink"},features:[Te],decls:1,vars:1,consts:[["class","content",4,"ngIf"],[1,"content"],[1,"icon-infos"],["class","icon-info",4,"ngFor","ngForOf"],[1,"sources","section"],[1,"tooltip",3,"matTooltip"],[1,"icon-infos",2,"flex-flow","row wrap"],["dir","ltr",1,"slider"],["max","100","step","1","showTickMarks","","discrete","",3,"min","displayWith"],["matSliderThumb","",3,"dragEnd"],[1,"icon-info"],[1,"icon"],[1,"text"],["class","tooltip",3,"matTooltip",4,"ngIf"],[4,"ngIf"],[1,"value"],[1,"number"],[1,"units"]],template:function(n,r){1&n&&yn(0,tge,16,7,"div",0),2&n&&Ft("ngIf",r.record)},dependencies:[Jm,Sa,GS,tK,TJ,fI],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:10px}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:10px;align-items:right;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:14px;line-height:14px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}.content[_ngcontent-%COMP%]   .go-to-trees[_ngcontent-%COMP%]{align-self:flex-end;color:#204e37}mat-slider[_ngcontent-%COMP%]{width:300px}']}),t})();function oge(e,t){if(1&e&&zn(0,"app-region",2),2&e){const i=dn();Ft("record",i.muni)("sources",i.sources)("name",i.muni.muni_name)("focus","muni:"+i.muni.muni_code+":"+i.muni.muni_name)("focusLink",i.muni.muni_name)}}const sge=function(){return["/","munis"]};let age=(()=>{var e;class t{constructor(){this.muni=null,this.sources=[]}set state(n){if(null===n)return this.muni=null,void(this.sources=[]);this.muni=Object.assign({},{},{}),this.sources=[]}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-muni"]],decls:2,vars:4,consts:[["mode","muni",3,"init","back","state"],[3,"record","sources","name","focus","focusLink",4,"ngIf"],[3,"record","sources","name","focus","focusLink"]],template:function(n,r){1&n&&(vt(0,"app-content",0),Cr("state",function(u){return r.state=u}),yn(1,oge,1,5,"app-region",1),Tt()),2&n&&(Ft("init",!!r.muni)("back",sp(3,sge)),j(1),Ft("ngIf",r.muni))},dependencies:[Sa,Rg,v9],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:10px}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:10px;align-items:right;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:14px;line-height:14px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}']}),t})();function lge(e,t){1&e&&zn(0,"app-summary",2),2&e&&Ft("state",dn().state)}let cge=(()=>{var e;class t{constructor(){this.state=null}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-munis"]],decls:2,vars:2,consts:[["mode","munis",3,"init","state"],["name","\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05de\u05e7\u05d5\u05de\u05d9\u05d5\u05ea",3,"state",4,"ngIf"],["name","\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea \u05de\u05e7\u05d5\u05de\u05d9\u05d5\u05ea",3,"state"]],template:function(n,r){1&n&&(vt(0,"app-content",0),Cr("state",function(u){return r.state=u}),yn(1,lge,1,1,"app-summary",1),Tt()),2&n&&(Ft("init",!!r.state),j(1),Ft("ngIf",r.state))},dependencies:[Sa,Rg,ik]}),t})();function uge(e,t){if(1&e&&zn(0,"app-region",2),2&e){const i=dn();Ft("record",i.stat_area)("sources",i.sources)("name",i.name)("focus","stat-area:"+i.stat_area.code)("focusLink","\u05d0\u05d9\u05d6\u05d5\u05e8 \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9 "+i.stat_area.code)}}const dge=function(){return["/","stat-areas"]};let hge=(()=>{var e;class t{constructor(){this.stat_area=null,this.sources=[],this.name=""}set state(n){if(console.log("GOET STATE",n),null===n)return this.stat_area=null,this.sources=[],void(this.name="");this.stat_area=Object.assign({},{},{}),this.sources=[],this.name=`\u05d0\u05d6\u05d5\u05e8 \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9 ${this.stat_area.city_code}/${this.stat_area.area_code||"0"}`}calculate_paint_definition(n){let M=null;return"vegetation"===n?M={"fill-color":["interpolate",["exponential",.01],["get","VegFrac"],0,["to-color","#ccc"],.5,["to-color","#acecc2"],.6,["to-color","#155b2e"]],"fill-opacity":.3}:"temperature"===n?M={"fill-color":["interpolate",["exponential",.01],["get","median_tem"],30,["to-color","#FFFF00"],35,["to-color","#FFA500"],40,["to-color","#FF0000"]],"fill-opacity":.3}:"cluster"===n&&(M={"fill-color":["match",["coalesce",["get","cluster"],0],0,["to-color","#9BD7F5"],1,["to-color","#9BD7F5"],2,["to-color","#89C8EE"],3,["to-color","#78BBE7"],4,["to-color","#66AFE1"],5,["to-color","#54A4DB"],6,["to-color","#497DB0"],7,["to-color","#3C5E91"],8,["to-color","#314177"],9,["to-color","#272361"],["to-color","#1E1E4D"]],"fill-opacity":.3}),M}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-stat-area"]],decls:2,vars:4,consts:[["mode","stat-area",3,"init","back","state"],[3,"record","sources","name","focus","focusLink",4,"ngIf"],[3,"record","sources","name","focus","focusLink"]],template:function(n,r){1&n&&(vt(0,"app-content",0),Cr("state",function(u){return r.state=u}),yn(1,uge,1,5,"app-region",1),Tt()),2&n&&(Ft("init",!!r.stat_area)("back",sp(3,dge)),j(1),Ft("ngIf",r.stat_area))},dependencies:[Sa,Rg,v9],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:40px}h1[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;line-height:24px;font-size:24px;color:#204e37}h2[_ngcontent-%COMP%]{color:#204e37;font-style:Normal;font-weight:600;font-size:13px;line-height:12px;margin:0}.section[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:10px}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:baseline;justify-content:space-between}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-style:Normal;font-weight:400;font-size:13px;line-height:17px;color:#838383}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-style:Normal;font-weight:600;font-size:13px;line-height:17px;color:#383838}.sources1[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{font-size:16px;line-height:24px}.icon-infos[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:10px;align-items:right;justify-content:flex-start}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;justify-content:flex-start;gap:8px;flex:0 1 calc(50% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:contain;background-size:40px;background-position:center;width:40px;height:40px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:8px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-style:Normal;font-weight:400;margin:0;font-size:12px;line-height:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:last baseline;max-height:18px;gap:3px}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:14px;line-height:14px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;color:#383838}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]{flex:0 1 calc(100% - 20px)}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:64px;height:64px;background-size:64px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{max-height:unset}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:40px;line-height:24px}.icon-infos[_ngcontent-%COMP%]   .icon-info.big[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]   .units[_ngcontent-%COMP%]{font-size:24px}']}),t})();function fge(e,t){1&e&&zn(0,"app-summary",2),2&e&&Ft("state",dn().state)}const pge=[{path:"trees",component:Gme},{path:"munis",component:cge},{path:"munis/:id",component:age},{path:"stat-areas",component:(()=>{var e;class t{constructor(){this.state=null}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-stat-areas"]],decls:2,vars:2,consts:[["mode","stat-areas",3,"init","state"],["name","\u05d0\u05d6\u05d5\u05e8\u05d9\u05dd \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9\u05d9\u05dd",3,"state",4,"ngIf"],["name","\u05d0\u05d6\u05d5\u05e8\u05d9\u05dd \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9\u05d9\u05dd",3,"state"]],template:function(n,r){1&n&&(vt(0,"app-content",0),Cr("state",function(u){return r.state=u}),yn(1,fge,1,1,"app-summary",1),Tt()),2&n&&(Ft("init",!!r.state),j(1),Ft("ngIf",r.state))},dependencies:[Sa,Rg,ik]}),t})()},{path:"stat-areas/:id",component:hge},{path:"",component:Qte}];let mge=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e}),e.\u0275inj=qi({imports:[B4.forRoot(pge),B4]}),t})(),gge=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-header"]],decls:15,vars:0,consts:[["href","#","aria-label","\u05de\u05e2\u05d1\u05e8 \u05dc\u05e2\u05de\u05d5\u05d3 \u05d4\u05d1\u05d9\u05ea",1,"logo-container"],[1,"logo1"],[1,"separator"],[1,"links"],["href","#"],["href","https://www.biu.ac.il/","aria-label","\u05d0\u05ea\u05e8 \u05d0\u05d5\u05e0\u05d9\u05d1\u05e8\u05e1\u05d9\u05d8\u05ea \u05d1\u05e8 \u05d0\u05d9\u05dc\u05df - \u05de\u05e2\u05d1\u05e8 \u05dc\u05d0\u05ea\u05e8 \u05d7\u05d9\u05e6\u05d5\u05e0\u05d9",1,"barilan-logo"],["href","https://www.hasadna.org.il","aria-label","\u05d0\u05ea\u05e8 \u05d4\u05e1\u05d3\u05e0\u05d0 \u05dc\u05d9\u05d3\u05e2 \u05e6\u05d9\u05d1\u05d5\u05e8\u05d9 - \u05de\u05e2\u05d1\u05e8 \u05dc\u05d0\u05ea\u05e8 \u05d7\u05d9\u05e6\u05d5\u05e0\u05d9",1,"pkw-logo"]],template:function(n,r){1&n&&(vt(0,"a",0)(1,"div",1),sn(2,"TEST1"),Tt(),zn(3,"div",2),vt(4,"h1"),sn(5,"\u05ea\u05db\u05e0\u05d5\u05df \u05d3\u05d9\u05d2\u05d9\u05d8\u05dc\u05d9 \u05dc\u05e7\u05d9\u05d3\u05d5\u05dd \u05d7\u05d5\u05e1\u05df \u05e2\u05d9\u05e8\u05d5\u05e0\u05d9 \u05d5\u05d4\u05e2\u05e8\u05db\u05d5\u05ea \u05dc\u05e9\u05d9\u05e0\u05d5\u05d9 \u05d0\u05e7\u05dc\u05d9\u05dd"),Tt()(),vt(6,"div",3)(7,"a",4),sn(8,"\u05de\u05ea\u05d5\u05d3\u05d5\u05dc\u05d5\u05d2\u05d9\u05d4"),Tt(),vt(9,"a",4),sn(10,"\u05e6\u05d5\u05e8 \u05e7\u05e9\u05e8"),Tt(),vt(11,"a",4),sn(12,"\u05d0\u05d5\u05d3\u05d5\u05ea"),Tt()(),zn(13,"a",5)(14,"a",6))},styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}[_nghost-%COMP%]{height:74px;width:100%;display:flex;flex-flow:row;align-items:center;padding:0 25px;background-color:#383838}[_nghost-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   a[_ngcontent-%COMP%]:visited, [_nghost-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:none}[_nghost-%COMP%]   .logo-container[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;gap:20px;height:60px}[_nghost-%COMP%]   .logo-container[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:119px;height:50px;background-repeat:no-repeat;background-position:center;background-size:contain;background-image:url(logo.1103d2d3af22ba98.svg);padding-left:20px}[_nghost-%COMP%]   .logo-container[_ngcontent-%COMP%]   .logo1[_ngcontent-%COMP%]{width:48px;height:20px;color:#fff;font-family:Rubik;font-size:18px;font-weight:400;line-height:20px;letter-spacing:0em;text-align:left}[_nghost-%COMP%]   .logo-container[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{width:1px;height:100%;background-color:#fff}[_nghost-%COMP%]   .logo-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;padding-right:20px;font-family:Rubik;color:#fff;font-size:18px;font-weight:400;line-height:20px;letter-spacing:0em;text-align:left;height:20px}[_nghost-%COMP%]   .links[_ngcontent-%COMP%]{margin-right:auto;display:flex;flex-flow:row;align-items:center;gap:30px}[_nghost-%COMP%]   .links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;font-family:Rubik,sans-serif;font-style:normal;font-weight:500;font-size:18px;line-height:20px;text-decoration:none}[_nghost-%COMP%]   .links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]   .pkw-logo[_ngcontent-%COMP%]{margin-right:50px;background-repeat:no-repeat;background-position:center;background-size:contain;width:61px;height:59.863px;background-image:url(pkw-logo.99898b87c8dc389e.svg)}[_nghost-%COMP%]   .barilan-logo[_ngcontent-%COMP%]{margin-right:50px;background-repeat:no-repeat;background-position:center;background-size:contain;width:145px;height:54px;background-image:url(barilan-logo.e2fa59fabd043ee7.svg)}']}),t})();var q0=Yh(574);let _ge=(()=>{var e;class t{constructor(){this.ACCESS_TOKEN="pk.eyJ1IjoiZXZ5YXRhcmszMTA4IiwiYSI6ImNsbmxqZmk2NzB2ZDMyanMzc2p3YTlpajMifQ.dmZ__h8Jz5hVfXxUquNULw",this.init=new zI(1),console.log("MAPBOX SERVICE ACCESS TOKEN",this.ACCESS_TOKEN),q0.accessToken=this.ACCESS_TOKEN,q0.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",n=>{console.log("FAILED TO LOAD PLUGIN",n)},!0),this.init.next(),this.init.complete()}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Bt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();var W0;const yge=["map"];let rk=((W0=class{constructor(t,i,n,r){this.mapboxService=t,this.state=i,this.router=n,this.api=r,this.STYLE="mapbox://styles/evyatark3108/clnljjtd7003i01plcccdek9h/draft",this.OWN_LAYERS=["prcc-settlements-data","prcc-statistical-areas","prcc-settlements-data-borders","prcc-statistical-areas-borders","parcels","parcels-labels","trees","canopies","lst-tiles-8-11","evyatark-lst-tiles-8-16","evyatark-ndvi-tiles-8-16","satellite"],this.CLICKS=[["prcc-statistical-areas","stat-areas","semel_new"],["prcc-settlements-data","munis","CODE"]],this.focus_=null,this.popup=null}ngAfterViewInit(){this.mapboxService.init.subscribe(()=>{this.initialize()})}initialize(){this.map=new q0.Map({container:this.mapEl.nativeElement,style:this.STYLE,minZoom:6.4,attributionControl:!1,bounds:[[34.578046,33.2],[35.356111,30.8]],maxBounds:[[30,27],[40,38]],preserveDrawingBuffer:!0}),this.map.addControl(new q0.AttributionControl,"top-right"),this.map.addControl(new q0.NavigationControl({showCompass:!1}),"top-left"),this.map.dragRotate.disable(),this.map.touchZoomRotate.disableRotation(),this.map.touchPitch.disable(),this.map.on("load",()=>{console.log("on load STARTED"),this.CLICKS.forEach(([i,n,r])=>{this.map.on("click",i,s=>{const u=s.features;if(u&&u.length>0){const h=u[0];h.properties?.[r]&&this.router.navigate([n,h.properties[r]],{queryParamsHandling:"merge"})}})}),console.log("LAYERS:"),this.OWN_LAYERS.forEach(i=>{console.log(i),this.map.on("mousemove",i,n=>{n.defaultPrevented||(n.preventDefault(),n.features&&n.features.length>0&&(this.map.getCanvas().style.cursor="pointer",this.addPopup(n.features[0],n.lngLat,i),this.saveLastFeature(n.features[0])))})}),this.map.on("mousemove",i=>{i.defaultPrevented||(i.preventDefault(),this.map.getCanvas().style.cursor="",this.removePreviousPopup())}),this.state.state.pipe(Ix(this)).subscribe(i=>{if(i.geo&&this.map.flyTo({center:i.geo.center,zoom:i.geo.zoom}),console.log("STATE",i,this.map.getStyle().layers),i.filters?.focus!==this.focus_&&(this.focus_=i.filters?.focus,i.focus)){const r=i.focus.boundsQuery();r&&this.api.query(r).subscribe(s=>{this.map.fitBounds(s[0].bounds)})}const n=i.focus?.mapFilters()||{};this.map.getStyle().layers.forEach(r=>{if((r.id.startsWith("prcc")||r.id.startsWith("evyatark"))&&console.log(r),this.ownLayer(r)){if(!i.isLayerVisible(r.id))return console.log("set visibility of layer",r.id,"to none"),void this.map.setLayoutProperty(r.id,"visibility","none");console.log("set visibility of layer",r.id,"to visible"),this.map.setLayoutProperty(r.id,"visibility","visible");const s=i.getLayerConfig(r.id);console.log("OWN LAYER",r.id,s);const u=[];s?.filter&&u.push(s.filter),n[r.id]&&u.push(n[r.id]),console.log("FILTERS",n,s.filter,u.length,["all",...u]),this.map.setFilter(r.id,u.length>1?["all",...u]:1===u.length?u[0]:null),s?.paint&&Object.keys(s.paint).forEach(h=>{this.map.setPaintProperty(r.id,h,s.paint[h])}),s?.layout&&Object.keys(s.layout).forEach(h=>{this.map.setLayoutProperty(r.id,h,s.layout[h])})}})}),this.mapboxService.map=this.map,console.log("on load FINISHED")})}ownLayer(t){return this.OWN_LAYERS.includes(t.id)}addPopup(t,i,n){this.removePreviousPopup();let r="";"prcc-settlements-data"===n?r=this.createPopupHtmlContentSettlements(t):"prcc-statistical-areas"===n&&(r=this.createPopupHtmlContentStatistical(t)),this.popup=new q0.Popup({closeButton:!1}).setLngLat(i).setHTML(r).addTo(this.map)}removePreviousPopup(){null!==this.popup&&(this.popup.remove(),this.popup=null)}createPopupHtmlContentStatistical(t){return'<div dir="rtl"><strong>'+t.properties.SHEM_YISHU+"</strong><br/><strong>\u05d0\u05d9\u05d6\u05d5\u05e8 \u05e1\u05d8\u05d8\u05d9\u05e1\u05d8\u05d9: </strong>"+t.properties.STAT11+"<br/><strong>\u05d0\u05d5\u05db\u05dc\u05d5\u05e1\u05d9\u05d4: </strong>"+t.properties.Pop_Total+"<br/><strong>\u05d3\u05d9\u05e8\u05d5\u05d2 \u05db\u05dc\u05db\u05dc\u05d9 \u05d7\u05d1\u05e8\u05ea\u05d9: </strong>"+t.properties.cluster+"<br/><strong>\u05d8\u05de\u05e4\u05e8\u05d8\u05d5\u05e8\u05d4: </strong>"+this.round(t.properties.median_tem)+"<br/><strong>\u05db\u05d9\u05e1\u05d5\u05d9 \u05e6\u05d5\u05de\u05d7: </strong>"+this.round(t.properties.VegFrac,4)+"<br/></div>"}createPopupHtmlContentSettlements(t){return'<div dir="rtl"><strong>'+t.properties.Muni_Heb+"</strong><hr/><strong>\u05d0\u05d5\u05db\u05dc\u05d5\u05e1\u05d9\u05d4: </strong>"+this.round(t.properties.pop17,0)+"<br/><strong>\u05d3\u05d9\u05e8\u05d5\u05d2 \u05db\u05dc\u05db\u05dc\u05d9 \u05d7\u05d1\u05e8\u05ea\u05d9: </strong>"+t.properties.cluster17+"<br/><strong>\u05d8\u05de\u05e4\u05e8\u05d8\u05d5\u05e8\u05d4: </strong>"+this.round(t.properties.Temperatur)+"<br/><strong>\u05db\u05d9\u05e1\u05d5\u05d9 \u05e6\u05d5\u05de\u05d7: </strong>"+this.round(t.properties.VegFrac,4)+"</div>"}round(t,i=2){return Math.round(10**i*t)/10**i}saveLastFeature(t){this.state.saveLastFeature(t)}}).\u0275fac=function(t){return new(t||W0)(q(_ge),q(L1),q(Is),q(y9))},W0.\u0275cmp=ui({type:W0,selectors:[["app-map"]],viewQuery:function(t,i){if(1&t&&Ch(yge,5),2&t){let n;Bl(n=Vl())&&(i.mapEl=n.first)}},decls:4,vars:0,consts:[[1,"map-container"],["aria-hidden","true","role","presentation",1,"map"],["map",""],[1,"map-popup-container",2,"display","none"]],template:function(t,i){1&t&&(vt(0,"div",0),zn(1,"div",1,2),Tt(),zn(3,"div",3))},styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%]   .map-container[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .map-container[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]{width:100%;height:100%}"]}),W0);var Z0;function vge(e,t){if(1&e){const i=Fy();vt(0,"div",12)(1,"input",13),Cr("change",function(r){Ef(i);const s=dn().$implicit;return ku(dn().updateCheck(s.id,r.target))}),Tt(),vt(2,"label",14),sn(3),Tt()()}if(2&e){const i=dn().$implicit,n=dn();j(1),Ft("id",i.id)("checked",n._checked[i.id]),j(1),Ft("for",i.id),j(1),Yi(i.label)}}function bge(e,t){if(1&e&&(vt(0,"option",18),sn(1),Tt()),2&e){const i=t.$implicit,n=dn(2).$implicit,r=dn();Ft("value",i.value)("selected",i.value===r._selected[n.id]),j(1),Yi(i.label)}}function xge(e,t){if(1&e){const i=Fy();vt(0,"div",15)(1,"label",14),sn(2),Tt(),vt(3,"select",16),Cr("change",function(r){Ef(i);const s=dn().$implicit;return ku(dn().selectValue(s.id,r))}),yn(4,bge,2,3,"option",17),Tt()()}if(2&e){const i=dn().$implicit;j(1),Ft("for",i.id),j(1),Yi(i.label),j(1),Ft("id",i.id),j(1),Ft("ngForOf",i.options)}}function wge(e,t){if(1&e&&(vt(0,"option",22),sn(1),Tt()),2&e){const i=dn(2).$implicit;j(1),Yi(i.placeholder)}}function Cge(e,t){if(1&e&&(vt(0,"option",22),sn(1),Tt()),2&e){const i=dn(2).$implicit,n=dn();j(1),Wm("",n._selected[i.id].length," \u05e0\u05d1\u05d7\u05e8(\u05d5)")}}function Ege(e,t){if(1&e&&(vt(0,"option",24)(1,"strong"),sn(2),Tt()()),2&e){const i=dn().$implicit;Ft("value",i.value),j(2),Wm("- ",i.label,"")}}function Mge(e,t){if(1&e&&(bh(0),yn(1,Ege,3,2,"option",23),xh()),2&e){const i=t.$implicit,n=dn(2).$implicit,r=dn();j(1),Ft("ngIf",r._selected[n.id]&&r._selected[n.id].includes(i.value))}}function Dge(e,t){1&e&&(vt(0,"option",25),sn(1,"---"),Tt())}function Tge(e,t){if(1&e&&(vt(0,"option",24),sn(1),Tt()),2&e){const i=dn().$implicit;Ft("value",i.value),j(1),Wm("+ ",i.label,"")}}function Sge(e,t){if(1&e&&(bh(0),yn(1,Tge,2,2,"option",23),xh()),2&e){const i=t.$implicit,n=dn(2).$implicit,r=dn();j(1),Ft("ngIf",!r._selected[n.id]||!r._selected[n.id].includes(i.value))}}function Ige(e,t){if(1&e){const i=Fy();vt(0,"div",15)(1,"label",14),sn(2),Tt(),vt(3,"select",16),Cr("change",function(r){Ef(i);const s=dn().$implicit;return ku(dn().toggleValue(s.id,r))}),yn(4,wge,2,1,"option",19),yn(5,Cge,2,1,"option",19),yn(6,Mge,2,1,"ng-container",20),yn(7,Dge,2,0,"option",21),yn(8,Sge,2,1,"ng-container",20),Tt()()}if(2&e){const i=dn().$implicit,n=dn();j(1),Ft("for",i.id),j(1),Yi(i.label),j(1),Ft("id",i.id),j(1),Ft("ngIf",0===n._selected[i.id].length),j(1),Ft("ngIf",n._selected[i.id].length>0),j(1),Ft("ngForOf",i.options),j(1),Ft("ngIf",n._selected[i.id]),j(1),Ft("ngForOf",i.options)}}function Age(e,t){if(1&e&&(vt(0,"div",9),yn(1,vge,4,4,"div",10),yn(2,xge,5,4,"div",11),yn(3,Ige,9,8,"div",11),Tt()),2&e){const i=t.$implicit;j(1),Ft("ngIf","check"===i.kind),j(1),Ft("ngIf","select"===i.kind),j(1),Ft("ngIf","multi-select"===i.kind)}}rk=dl([RE()],rk);const Pge=function(){return[]},Oge=function(){return{}};function kge(e,t){1&e&&(vt(0,"div",26)(1,"a",27),sn(2,"\u05e0\u05d9\u05e7\u05d5\u05d9 \u05d4\u05de\u05e1\u05e0\u05e0\u05d9\u05dd"),Tt()()),2&e&&(j(1),Ft("routerLink",sp(2,Pge))("queryParams",sp(3,Oge)))}const Rge=function(){return["/","munis"]},Lge=function(){return["/","stat-areas"]},Fge=function(){return["/","trees"]};let ok=((Z0=class{constructor(t,i){this.stateSvc=t,this.router=i,this.controls=[],this.filters={},this._selected={},this._checked={},this._clear=!1,this.downloadQuery=null,this.stateSvc.state.pipe(Ix(this)).subscribe(n=>{this.state=n})}set state(t){this.mode=0===t.mode.indexOf("tree")?"trees":0===t.mode.indexOf("muni")?"munis":0===t.mode.indexOf("stat-area")?"stat-areas":"none",this.controls=t.filterItems||[],this.filters=t.filters||{},this.controls.filter(i=>"select"===i.kind).forEach(i=>{this._selected[i.id]=this.filters[i.id]||i.options[0].value}),this.controls.filter(i=>"multi-select"===i.kind).forEach(i=>{this._selected[i.id]=this.filters[i.id]||[]}),this.controls.filter(i=>"check"===i.kind).forEach(i=>{this._checked[i.id]="0"!==this.filters[i.id]}),this.downloadQuery=t.downloadQuery,this._clear=t.clearFilters}updateCheck(t,i){if(!i)return;const r={};r[t]=i.checked?"1":"0",this.router.navigate([],{queryParams:r,replaceUrl:!0,queryParamsHandling:"merge"})}selectValue(t,i){const n=i.target.value;this._selected[t]=n;const r={};r[t]=n,this.router.navigate([],{queryParams:r,replaceUrl:!0,queryParamsHandling:"merge"})}toggleValue(t,i){const n=i.target.value;this._selected[t]=this._selected[t]||[],this._selected[t].indexOf(n)>=0?this._selected[t]=this._selected[t].filter(s=>s!==n):this._selected[t].push(n);const r={};r[t]=this._selected[t].join(";"),this.router.navigate([],{queryParams:r,replaceUrl:!0,queryParamsHandling:"merge"})}}).\u0275fac=function(t){return new(t||Z0)(q(L1),q(Is))},Z0.\u0275cmp=ui({type:Z0,selectors:[["app-filter"]],decls:13,vars:16,consts:[[1,"filter"],[1,"selector"],["queryParamsHandling","merge",1,"munis",3,"routerLink"],["queryParamsHandling","merge",1,"stat-areas",3,"routerLink"],["queryParamsHandling","merge",1,"trees",3,"routerLink"],[1,"controls"],["class","control",4,"ngFor","ngForOf"],[1,"last"],["class","clear",4,"ngIf"],[1,"control"],["class","check",4,"ngIf"],["class","select",4,"ngIf"],[1,"check"],["type","checkbox",3,"id","checked","change"],[3,"for"],[1,"select"],[3,"id","change"],[3,"value","selected",4,"ngFor","ngForOf"],[3,"value","selected"],["disabled","","selected","","value","",4,"ngIf"],[4,"ngFor","ngForOf"],["disabled","","value","",4,"ngIf"],["disabled","","selected","","value",""],[3,"value",4,"ngIf"],[3,"value"],["disabled","","value",""],[1,"clear"],[3,"routerLink","queryParams"]],template:function(t,i){1&t&&(vt(0,"div",0)(1,"div",1),zn(2,"span"),vt(3,"a",2),sn(4,"\u05e8\u05e9\u05d5\u05d9\u05d5\u05ea"),Tt(),vt(5,"a",3),sn(6,"\u05d0\u05d6\u05d5\u05e8\u05d9\u05dd"),Tt(),vt(7,"a",4),sn(8,"\u05dc\u05d5\u05d5\u05d9\u05df"),Tt()(),vt(9,"div",5),yn(10,Age,4,3,"div",6),Tt(),vt(11,"div",7),yn(12,kge,3,4,"div",8),Tt()()),2&t&&(j(2),f2("selected "+i.mode),j(1),Io("active","munis"===i.mode),Ft("routerLink",sp(13,Rge)),j(2),Io("active","stat-areas"===i.mode),Ft("routerLink",sp(14,Lge)),j(2),Io("active","trees"===i.mode),Ft("routerLink",sp(15,Fge)),j(3),Ft("ngForOf",i.controls),j(2),Ft("ngIf",i._clear))},dependencies:[Jm,Sa,n0],styles:['.font-regular[_ngcontent-%COMP%]{font-style:Normal;font-weight:400}.font-semibold[_ngcontent-%COMP%]{font-style:Normal;font-weight:600}.font-bold[_ngcontent-%COMP%]{font-style:Normal;font-weight:700}.font-rubik-medium[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:500}.font-rubik-semibold[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-style:normal;font-weight:600}.font-secular-regular[_ngcontent-%COMP%]{font-family:Secular One,sans-serif;font-style:normal;font-weight:400}.background-image[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center;background-size:contain}.button-image[_ngcontent-%COMP%]{border:none;background:none;margin:0;padding:0;cursor:pointer}.overflow-scroll[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;overflow:scroll}.overflow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ellipsis-2-line[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical;white-space:normal}@media only screen and (max-width: 767px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 768px){  .layout-mobile{display:none!important}}.loading[_ngcontent-%COMP%]{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;display:inline-block;will-change:transform;transform:translateZ(0)}.loading[_ngcontent-%COMP%]:after, .loading[_ngcontent-%COMP%]:before{box-sizing:border-box}.loading[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:""}.loading[_ngcontent-%COMP%]:before{background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.6),rgba(255,255,255,0))}.loading.small[_ngcontent-%COMP%]{width:100%;height:40px;margin-bottom:40px}.loading.large[_ngcontent-%COMP%]{width:100%;height:250px;margin-bottom:40px}@keyframes _ngcontent-%COMP%_progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}.ltr[_ngcontent-%COMP%]{direction:ltr}.tooltip[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted 1px #204E37;text-decoration:underline dotted 1px #204E37;cursor:help;pointer-events:all}.filter[_ngcontent-%COMP%]{width:100%;min-height:71px;padding:20px;display:flex;align-items:center;justify-content:flex-start;gap:20px;background:#F2F2F2;box-shadow:0 4px 8px #0000004d;z-index:2}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]{flex:0 0 auto;height:40px;border-radius:20px;border:1px solid #204E37;background:#fff;display:flex;flex-flow:row;align-items:center;position:relative;overflow:hidden}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{position:absolute;width:88px;height:32px;right:4px;border-radius:16px;background:#204E37;z-index:0;transition:right .2s ease-in-out;transition-property:right,opacity;opacity:0}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   .selected.munis[_ngcontent-%COMP%]{right:4px;opacity:1}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   .selected.stat-areas[_ngcontent-%COMP%]{right:100px;opacity:1}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   .selected.trees[_ngcontent-%COMP%]{right:196px;opacity:1}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;justify-content:center;width:96px;font-style:Normal;font-weight:400;font-size:20px;color:#383838;z-index:1;text-decoration:none}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus{text-decoration:underline}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;color:#fff}.filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%], .filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]:hover, .filter[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]:focus{text-decoration:none}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]{flex:1 1 auto;display:flex;flex-flow:row wrap;align-items:center;justify-content:flex-start;gap:18px 30px}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]{flex:0 0 auto}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:5px}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{-webkit-appearance:none;appearance:none;position:relative;width:18px;height:18px;border:2px solid #838383;border-radius:2px;vertical-align:-2px}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:before{content:"\\2714";position:absolute;font-size:13px;right:1px;top:-2px;visibility:hidden;color:#204e37;font-style:Normal;font-weight:400}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked{border-color:#204e37}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked:before{visibility:visible}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:0;color:#383838;font-style:Normal;font-weight:400;font-size:16px;line-height:24px;white-space:nowrap}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]{display:flex;flex-flow:column}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-style:Normal;font-weight:600;font-size:12px;line-height:16px;margin:-16px 0 0;color:#838383;white-space:nowrap}.filter[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border-radius:5px;border:1px solid #204E37;background:#fff;padding:4px 12px;color:#383838;font-style:Normal;font-weight:400;font-size:16px;line-height:24px}.filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]{flex:0 0 auto;margin-right:auto;display:flex;align-items:center;justify-content:flex-start;gap:12px}.filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{color:#838383;text-decoration:none}.filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited:hover, .filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus, .filter[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%]   .clear[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited:focus{color:#383838}']}),Z0);ok=dl([RE()],ok);const Nge=["*"];let zge=(()=>{var e;class t{constructor(){console.log("LayoutComponent constructor STARTED")}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=ui({type:e,selectors:[["app-layout"]],ngContentSelectors:Nge,decls:5,vars:0,consts:[[1,"content"]],template:function(n,r){1&n&&(Lb(),zn(0,"app-header")(1,"app-filter"),vt(2,"div",0),zn(3,"app-map"),Fb(4),Tt())},dependencies:[gge,rk,ok],styles:["[_nghost-%COMP%]{display:flex;flex-flow:column;height:100%;width:100%;align-items:stretch}[_nghost-%COMP%]   app-header[_ngcontent-%COMP%], [_nghost-%COMP%]   app-filter[_ngcontent-%COMP%]{flex:0 0 auto}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{flex:1 1 auto;position:relative;overflow:hidden;width:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%] >   *{position:absolute;width:100%;height:100%;top:0;left:0;z-index:1;pointer-events:none}[_nghost-%COMP%]   .content[_ngcontent-%COMP%] > app-map[_ngcontent-%COMP%]{z-index:0;pointer-events:all}"]}),t})();var X0;let sk=((X0=class{constructor(t,i,n){this.route=t,this.router=i,this.state=n,this.title="Evyatar",console.log("AppComponent constructor STARTED"),this.router.events.pipe(Ix(this),Aa(r=>r instanceof _p),Un(r=>{const s=r,u=s.url.split("?")[0].split("/").filter(M=>M.length>0),h="?"+s.url.split("?")[1]||0,_=new URLSearchParams(h);return{segments:u,params:Object.fromEntries(_.entries())}})).subscribe(({segments:r,params:s})=>{this.state.initFromUrl(r,s)})}}).\u0275fac=function(t){return new(t||X0)(q(lg),q(Is),q(L1))},X0.\u0275cmp=ui({type:X0,selectors:[["app-root"]],decls:2,vars:0,template:function(t,i){1&t&&(vt(0,"app-layout"),zn(1,"router-outlet"),Tt())},dependencies:[SI,zge],styles:[".nav-link[_ngcontent-%COMP%]{font-size:large}"]}),X0);sk=dl([RE()],sk);let Bge=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Wi({type:e,bootstrap:[sk]}),e.\u0275inj=qi({imports:[eY,mge,gQ,OJ,pme]}),t})();QX().bootstrapModule(Bge).catch(e=>console.error(e))},574:function(K0){K0.exports=function(){"use strict";var Xh,Yh,ni;function Rp(m,Je){if(Xh)if(Yh){var oa="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Xh+")(sharedChunk); ("+Yh+")(sharedChunk); self.onerror = null;",as={};Xh(as),ni=Je(as),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(ni.workerUrl=window.URL.createObjectURL(new Blob([oa],{type:"text/javascript"})))}else Yh=Je;else Xh=Je}return Rp(0,function(m){var Je=typeof self<"u"?self:{},oa="2.15.0";let as;const En={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==as){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{as=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch{as=a}}return as},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!En.API_URL)return null;try{const a=new URL(En.API_URL);return"api.mapbox.cn"===a.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===a.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},wn={supported:!1,testSupport:function(a){!ls&&vo&&(Ra?bd(a):Ur=a)}};let Ur,vo,ls=!1,Ra=!1;function bd(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,vo),a.isContextLost())return;wn.supported=!0}catch{}a.deleteTexture(o),ls=!0}Je.document&&(vo=Je.document.createElement("img"),vo.onload=function(){Ur&&bd(Ur),Ur=null,Ra=!0},vo.onerror=function(){ls=!0,Ur=null},vo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ru="01";function Wo(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var cs=Ro;function Ro(a,o,l,d){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(d-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=d}Ro.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,d=0;d<8;d++){var p=this.sampleCurveX(l)-a;if(Math.abs(p)<o)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=p/y}var b=0,C=1;for(l=a,d=0;d<20&&(p=this.sampleCurveX(l),!(Math.abs(p-a)<o));d++)a>p?b=l:C=l,l=.5*(C-b)+b;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var Jl=Wo(cs),La=ks;function ks(a,o){this.x=a,this.y=o}ks.prototype={clone:function(){return new ks(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),d=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=d,this},_rotateAround:function(a,o){var l=Math.cos(a),d=Math.sin(a),p=o.y+d*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-d*(this.y-o.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ks.convert=function(a){return a instanceof ks?a:Array.isArray(a)?new ks(a[0],a[1]):a};var Ct=Wo(La);const Lp=Math.PI/180,ec=180/Math.PI;function Pn(a){return a*Lp}function qr(a){return a*ec}const xd=[[0,0],[1,0],[1,1],[0,1]];function Kh(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function tc(a,o,l,d){const p=new Jl(a,o,l,d);return function(y){return p.solve(y)}}const Rs=tc(.25,.1,.25,1);function Ln(a,o,l){return Math.min(l,Math.max(o,a))}function nc(a,o,l){return(l=Ln((l-a)/(o-a),0,1))*l*(3-2*l)}function On(a,o,l){const d=l-o,p=((a-o)%d+d)%d+o;return p===o?l:p}function jr(a,o,l){if(!a.length)return l(null,[]);let d=a.length;const p=new Array(a.length);let y=null;a.forEach((b,C)=>{o(b,(D,T)=>{D&&(y=D),p[C]=T,0==--d&&l(y,p)})})}function cl(a){const o=[];for(const l in a)o.push(a[l]);return o}function Tr(a,...o){for(const l of o)for(const d in l)a[d]=l[d];return a}let ul=1;function hi(){return ul++}function Fa(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Sr(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function wd(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Ai(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function Mi(a,o){return-1!==a.indexOf(o,a.length-o.length)}function Vn(a,o,l){const d={};for(const p in a)d[p]=o.call(l||this,a[p],p,a);return d}function Un(a,o,l){const d={};for(const p in a)o.call(l||this,a[p],p,a)&&(d[p]=a[p]);return d}function bo(a){return Array.isArray(a)?a.map(bo):"object"==typeof a&&a?Vn(a,bo):a}const Cd={};function Fi(a){Cd[a]||(typeof console<"u"&&console.warn(a),Cd[a]=!0)}function us(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function dl(a){let o=0;for(let l,d,p=0,y=a.length,b=y-1;p<y;b=p++)l=a[p],d=a[b],o+=(d.x-l.x)*(l.y+d.y);return o}function Na(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ds(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,p,y)=>{const b=p||y;return o[d]=!b||b.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let Qh=null;function Ed(a){if(null==Qh){const o=a.navigator?a.navigator.userAgent:null;Qh=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Qh}function Jh(a){try{const o=Je[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}}function hl(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const ic="mapbox-tiles";let hs,sa,ef=500,ou=50;function su(){try{return Je.caches}catch{}}function rc(){su()&&!hs&&(hs=Je.caches.open(ic))}function au(a){const o=a.indexOf("?");if(o<0)return a;const d=function(p){const y=p.indexOf("?");return y>0?p.slice(y+1).split("&"):[]}(a).filter(p=>{const y=p.split("=");return"language"===y[0]||"worldview"===y[0]});return d.length?`${a.slice(0,o)}?${d.join("&")}`:a.slice(0,o)}let Md=1/0;const Lo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Lo);class za extends Error{constructor(o,l,d){401===l&&Oe(d)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const oc=Na()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Je.location.protocol?Je.parent:Je).location.href,fl=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(oc())&&!/^\w+:/.test(l))){if(Je.fetch&&Je.Request&&Je.AbortController&&Je.Request.prototype.hasOwnProperty("signal"))return function(d,p){const y=new Je.AbortController,b=new Je.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:oc(),referrerPolicy:d.referrerPolicy,signal:y.signal});let C=!1,D=!1;const T=(k=b.url).indexOf("sku=")>0&&Oe(k);var k;"json"===d.type&&b.headers.set("Accept","application/json");const L=(V,U,j)=>{if(D)return;if(V&&"SecurityError"!==V.message&&Fi(V.toString()),U&&j)return N(U);const te=Date.now();Je.fetch(b).then(q=>{if(q.ok){const pe=T?q.clone():null;return N(q,pe,te)}return p(new za(q.statusText,q.status,d.url))}).catch(q=>{"AbortError"!==q.name&&p(new Error(`${q.message} ${d.url}`))})},N=(V,U,j)=>{("arrayBuffer"===d.type?V.arrayBuffer():"json"===d.type?V.json():V.text()).then(te=>{D||(U&&j&&function(q,pe,ae){if(rc(),!hs)return;const fe={status:pe.status,statusText:pe.statusText,headers:new Je.Headers};pe.headers.forEach((Fe,ke)=>fe.headers.set(ke,Fe));const ge=ds(pe.headers.get("Cache-Control")||"");if(ge["no-store"])return;ge["max-age"]&&fe.headers.set("Expires",new Date(ae+1e3*ge["max-age"]).toUTCString());const _e=fe.headers.get("Expires");_e&&(new Date(_e).getTime()-ae<42e4||function(Fe,ke){if(void 0===sa)try{new Response(new ReadableStream),sa=!0}catch{sa=!1}sa?ke(Fe.body):Fe.blob().then(ke)}(pe,Fe=>{const ke=new Je.Response(Fe,fe);rc(),hs&&hs.then(Ge=>Ge.put(au(q.url),ke)).catch(Ge=>Fi(Ge.message))}))}(b,U,j),C=!0,p(null,te,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(te=>{D||p(new Error(te.message))})};return T?function(V,U){if(rc(),!hs)return U(null);const j=au(V.url);hs.then(te=>{te.match(j).then(q=>{const pe=function(ae){if(!ae)return!1;const fe=new Date(ae.headers.get("Expires")||0),ge=ds(ae.headers.get("Cache-Control")||"");return fe>Date.now()&&!ge["no-cache"]}(q);te.delete(j),pe&&te.put(j,q.clone()),U(null,q,pe)}).catch(U)}).catch(U)}(b,L):L(null,null),{cancel:()=>{D=!0,C||y.abort()}}}(a,o);if(Na()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(d,p){const y=new Je.XMLHttpRequest;y.open(d.method||"GET",d.url,!0),"arrayBuffer"===d.type&&(y.responseType="arraybuffer");for(const b in d.headers)y.setRequestHeader(b,d.headers[b]);return"json"===d.type&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials="include"===d.credentials,y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||0===y.status)&&null!==y.response){let b=y.response;if("json"===d.type)try{b=JSON.parse(y.response)}catch(C){return p(C)}p(null,b,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else p(new za(y.statusText,y.status,d.url))},y.send(d.body),{cancel:()=>y.abort()}}(a,o)},lu=function(a,o){return fl(Tr(a,{type:"arrayBuffer"}),o)};function tf(a){const o=Je.document.createElement("a");return o.href=a,o.protocol===Je.document.location.protocol&&o.host===Je.document.location.host}const me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Y,J;Y=[],J=0;const de=function(a,o){if(wn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),J>=En.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return Y.push(y),y}J++;let l=!1;const d=()=>{if(!l)for(l=!0,J--;Y.length&&J<En.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Y.shift(),{requestParameters:b,callback:C,cancelled:D}=y;D||(y.cancel=de(b,C).cancel)}},p=lu(a,(y,b,C,D)=>{d(),y?o(y):b&&(Je.createImageBitmap?function(T,k){const L=new Je.Blob([new Uint8Array(T)],{type:"image/png"});Je.createImageBitmap(L).then(N=>{k(null,N)}).catch(N=>{k(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(T,k)=>o(T,k,C,D)):function(T,k){const L=new Je.Image,N=Je.URL;L.onload=()=>{k(null,L),N.revokeObjectURL(L.src),L.onload=null,Je.requestAnimationFrame(()=>{L.src=me})},L.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Je.Blob([new Uint8Array(T)],{type:"image/png"});L.src=T.byteLength?N.createObjectURL(V):me}(b,(T,k)=>o(T,k,C,D)))});return{cancel:()=>{p.cancel(),d()}}},ve="NO_ACCESS_TOKEN";function Me(a){return 0===a.indexOf("mapbox:")}function Oe(a){return En.API_URL_REGEX.test(a)}function Pe(a){return En.API_CDN_URL_REGEX.test(a)}function De(a){return En.API_STYLE_REGEX.test(a)&&!Be(a)}function Be(a){return En.API_SPRITE_REGEX.test(a)}const yt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xt(a){const o=a.match(yt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function ht(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}const fn="mapbox.eventData";function Sn(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(Je.atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class pn{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const l=Sn(En.ACCESS_TOKEN);let d="";return d=l&&l.u?Je.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(p,y)=>String.fromCharCode(+("0x"+y)))):En.ACCESS_TOKEN||"",o?`${fn}.${o}:${d}`:`${fn}:${d}`}fetchEventData(){const o=Jh("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(o)try{const p=Je.localStorage.getItem(l);p&&(this.eventData=JSON.parse(p));const y=Je.localStorage.getItem(d);y&&(this.anonId=y)}catch{Fi("Unable to read from LocalStorage")}}saveEventData(){const o=Jh("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(o)try{Je.localStorage.setItem(d,this.anonId),Object.keys(this.eventData).length>=1&&Je.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{Fi("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,d,p){if(!En.EVENTS_URL)return;const y=xt(En.EVENTS_URL);y.params.push(`access_token=${p||En.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(o).toISOString()},C=l?Tr(b,l):b,D={url:ht(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};var k;this.pendingRequest=(k=T=>{this.pendingRequest=null,d(T),this.saveEventData(),this.processRequests(p)},fl(Tr(D,{method:"POST"}),k))}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}const Mn=new class extends pn{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){En.EVENTS_URL&&En.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>Me(l)||Oe(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Sn(En.ACCESS_TOKEN),l=o?o.u:En.ACCESS_TOKEN;let d=l!==this.eventData.tokenU;wd(this.anonId)||(this.anonId=Fa(),d=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),b=new Date(p),C=(p-this.eventData.lastSuccess)/864e5;d=d||C>=1||C<-1||y.getDate()!==b.getDate()}else d=!0;d?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:oa,skuId:ru,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=p,this.eventData.tokenU=l)},a):this.processRequests()}},Fn=Mn.postTurnstileEvent.bind(Mn),Ui=new class extends pn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,d){this.skuToken=o,this.errorCb=d,En.EVENTS_URL&&(l||En.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(ve)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),wd(this.anonId)||(this.anonId=Fa()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:oa,skuId:ru,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):o&&(this.success[o]=!0)},a))}},Xn=Ui.postMapLoadEvent.bind(Ui),so=new class extends pn{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){En.EVENTS_URL&&(a||En.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:l}=this.queue.shift(),d=function(p){const y=Je.performance.getEntriesByType("resource"),b=Je.performance.getEntriesByType("mark"),C=function(N){const V={};if(N)for(const U in N)if("other"!==U)for(const j of N[U]){const te=`${U}ResolveRangeMin`,q=`${U}ResolveRangeMax`,pe=`${U}RequestCount`,ae=`${U}RequestCachedCount`;V[te]=Math.min(V[te]||1/0,j.startTime),V[q]=Math.max(V[q]||-1/0,j.responseEnd);const fe=ge=>{void 0===V[ge]&&(V[ge]=0),++V[ge]};void 0!==j.transferSize&&0===j.transferSize&&fe(ae),fe(pe)}return V}(function(N,V){const U={};if(N)for(const j of N){const te=V(j);void 0===U[te]&&(U[te]=[]),U[te].push(j)}return U}(y,la)),D=Je.devicePixelRatio,T=Je.navigator.connection||Je.navigator.mozConnection||Je.navigator.webkitConnection,k={counters:[],metadata:[],attributes:[]},L=(N,V,U)=>{null!=U&&N.push({name:V,value:U.toString()})};for(const N in C)L(k.counters,N,C[N]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(L(k.counters,"interactionRangeMin",p.interactionRange[0]),L(k.counters,"interactionRangeMax",p.interactionRange[1])),b)for(const N of Object.keys(cu)){const V=cu[N],U=b.find(j=>j.name===V);U&&L(k.counters,V,U.startTime)}return L(k.counters,"visibilityHidden",p.visibilityHidden),L(k.attributes,"style",function(N){if(N)for(const V of N){const U=V.name.split("?")[0];if(De(U)){const j=U.split("/").slice(-2);if(2===j.length)return`mapbox://styles/${j[0]}/${j[1]}`}}}(y)),L(k.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),L(k.attributes,"fogEnabled",p.fogEnabled?"true":"false"),L(k.attributes,"projection",p.projection),L(k.attributes,"zoom",p.zoom),L(k.metadata,"devicePixelRatio",D),L(k.metadata,"connectionEffectiveType",T?T.effectiveType:void 0),L(k.metadata,"navigatorUserAgent",Je.navigator.userAgent),L(k.metadata,"screenWidth",Je.screen.width),L(k.metadata,"screenHeight",Je.screen.height),L(k.metadata,"windowWidth",Je.innerWidth),L(k.metadata,"windowHeight",Je.innerHeight),L(k.metadata,"mapWidth",p.width/D),L(k.metadata,"mapHeight",p.height/D),L(k.metadata,"webglRenderer",p.renderer),L(k.metadata,"webglVendor",p.vendor),L(k.metadata,"sdkVersion",oa),L(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(l);for(const p of d.metadata);for(const p of d.counters);for(const p of d.attributes);this.postEvent(o,d,()=>{},a)}},Fr=so.postPerformanceEvent.bind(so),aa=new class extends pn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,d){if(!En.API_URL||!En.SESSION_PATH)return;const p=xt(En.API_URL+En.SESSION_PATH);p.params.push(`sku=${o||""}`),p.params.push(`access_token=${d||En.ACCESS_TOKEN||""}`);const y={url:ht(p),headers:{"Content-Type":"text/plain"}};var C;this.pendingRequest=(C=b=>{this.pendingRequest=null,l(b),this.saveEventData(),this.processRequests(d)},fl(Tr(y,{method:"GET"}),C))}getSessionAPI(a,o,l,d){this.skuToken=o,this.errorCb=d,En.SESSION_PATH&&En.API_URL&&(l||En.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(ve)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,d=>{d?this.errorCb(d):o&&(this.success[o]=!0)},a)}},Wr=aa.getSessionAPI.bind(aa),ao=new Set,cu={create:"create",load:"load",fullLoad:"fullLoad"},J0={mark(a){Je.performance.mark(a)},measure(a,o,l){Je.performance.measure(a,o,l)}};function la(a){const o=a.name.split("?")[0];return Pe(o)&&o.includes("mapbox-gl.js")?"javascript":Pe(o)&&o.includes("mapbox-gl.css")?"css":En.API_FONTS_REGEX.test(o)?"fontRange":Be(o)?"sprite":De(o)?"style":En.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const ii=Je.performance;function or(a){const o=a?a.url.toString():void 0;return ii.getEntriesByName(o)}let ca,Zo,Fp,ua;const da={now:()=>void 0!==Fp?Fp:Je.performance.now(),setNow(a){Fp=a},restoreNow(){Fp=void 0},frame(a){const o=Je.requestAnimationFrame(a);return{cancel:()=>Je.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:l,height:d}=a;ua||(ua=Je.document.createElement("canvas"));const p=ua.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>ua.width||d>ua.height)&&(ua.width=l,ua.height=d),p.clearRect(-o,-o,l+2*o,d+2*o),p.drawImage(a,0,0,l,d),p.getImageData(-o,-o,l+2*o,d+2*o)},resolveURL:a=>(ca||(ca=Je.document.createElement("a")),ca.href=a,ca.href),get devicePixelRatio(){return Je.devicePixelRatio},get prefersReducedMotion(){return!!Je.matchMedia&&(null==Zo&&(Zo=Je.matchMedia("(prefers-reduced-motion: reduce)")),Zo.matches)}};function Dd(a,o,l){l[a]&&-1!==l[a].indexOf(o)||(l[a]=l[a]||[],l[a].push(o))}function nf(a,o,l){if(l&&l[a]){const d=l[a].indexOf(o);-1!==d&&l[a].splice(d,1)}}class Ls{constructor(o,l={}){Tr(this,l),this.type=o}}class Ba extends Ls{constructor(o,l={}){super("error",Tr({error:o},l))}}class uu{on(o,l){return this._listeners=this._listeners||{},Dd(o,l,this._listeners),this}off(o,l){return nf(o,l,this._listeners),nf(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Dd(o,l,this._oneTimeListeners),this):new Promise(d=>this.once(o,d))}fire(o,l){"string"==typeof o&&(o=new Ls(o,l||{}));const d=o.type;if(this.listens(d)){o.target=this;const p=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const C of p)C.call(this,o);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const C of y)nf(d,C,this._oneTimeListeners),C.call(this,o);const b=this._eventedParent;b&&(Tr(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(o))}else o instanceof Ba&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var He=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Va(a,...o){for(const l of o)for(const d in l)a[d]=l[d];return a}function Ir(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Zr(a){if(Array.isArray(a))return a.map(Zr);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const l in a)o[l]=Zr(a[l]);return o}return Ir(a)}class Ng extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}var Fs=Ng;class Np{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[d,p]of l)this.bindings[d]=p}concat(o){return new Np(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var zg=Np;const Pi={kind:"null"},Lt={kind:"number"},Dt={kind:"string"},In={kind:"boolean"},xo={kind:"color"},Ar={kind:"object"},An={kind:"value"},Xo={kind:"collator"},ai={kind:"formatted"},ha={kind:"resolvedImage"};function mi(a,o){return{kind:"array",itemType:a,N:o}}function Oi(a){if("array"===a.kind){const o=Oi(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const Bg=[Pi,Lt,Dt,In,xo,ai,Ar,mi(An),ha];function Yn(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Yn(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const l of Bg)if(!Yn(l,o))return null}return`Expected ${Oi(a)} but found ${Oi(o)} instead.`}function an(a,o){return o.some(l=>l.kind===a.kind)}function sc(a,o){return o.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var Td,ev={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function du(a){return(a=Math.round(a))<0?0:a>255?255:a}function gt(a){return du("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function ac(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function ln(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{Td={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in ev)return ev[l].slice();if("#"===l[0])return 4===l.length?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===l.length&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var d=l.indexOf("("),p=l.indexOf(")");if(-1!==d&&p+1===l.length){var y=l.substr(0,d),b=l.substr(d+1,p-(d+1)).split(","),C=1;switch(y){case"rgba":if(4!==b.length)return null;C=ac(b.pop());case"rgb":return 3!==b.length?null:[gt(b[0]),gt(b[1]),gt(b[2]),C];case"hsla":if(4!==b.length)return null;C=ac(b.pop());case"hsl":if(3!==b.length)return null;var D=(parseFloat(b[0])%360+360)%360/360,T=ac(b[1]),k=ac(b[2]),L=k<=.5?k*(T+1):k+T-k*T,N=2*k-L;return[du(255*ln(N,L,D+1/3)),du(255*ln(N,L,D)),du(255*ln(N,L,D-1/3)),C];default:return null}}return null}}catch{}class kn{constructor(o,l,d,p=1){this.r=o,this.g=l,this.b=d,this.a=p}static parse(o){if(!o)return;if(o instanceof kn)return o;if("string"!=typeof o)return;const l=Td(o);return l?new kn(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,d,p]=this.toArray();return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(d)},${p})`}toArray(){const{r:o,g:l,b:d,a:p}=this;return 0===p?[0,0,0,0]:[255*o/p,255*l/p,255*d/p,p]}toArray01(){const{r:o,g:l,b:d,a:p}=this;return 0===p?[0,0,0,0]:[o/p,l/p,d/p,p]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:d,a:p}=this;return[o,l,d,p]}}kn.black=new kn(0,0,0,1),kn.white=new kn(1,1,1,1),kn.transparent=new kn(0,0,0,0),kn.red=new kn(1,0,0,1),kn.blue=new kn(0,0,1,1);var gr=kn;class Vg{constructor(o,l,d){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zp{constructor(o,l,d,p,y){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=d,this.fontStack=p,this.textColor=y}}class lo{constructor(o){this.sections=o}static fromString(o){return new lo([new zp(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof lo?o:lo.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.name]);continue}o.push(l.text);const d={};l.fontStack&&(d["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(d["font-scale"]=l.scale),l.textColor&&(d["text-color"]=["rgba"].concat(l.textColor.toArray())),o.push(d)}return o}}class tr{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new tr({name:o,available:!1}):null}serialize(){return["image",this.name]}}function tv(a,o,l,d){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===d||"number"==typeof d&&d>=0&&d<=1?null:`Invalid rgba value [${[a,o,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof d?[a,o,l,d]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Sd(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof gr||a instanceof Vg||a instanceof lo||a instanceof tr)return!0;if(Array.isArray(a)){for(const o of a)if(!Sd(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!Sd(a[o]))return!1;return!0}return!1}function _r(a){if(null===a)return Pi;if("string"==typeof a)return Dt;if("boolean"==typeof a)return In;if("number"==typeof a)return Lt;if(a instanceof gr)return xo;if(a instanceof Vg)return Xo;if(a instanceof lo)return ai;if(a instanceof tr)return ha;if(Array.isArray(a)){const o=a.length;let l;for(const d of a){const p=_r(d);if(l){if(l===p)continue;l=An;break}l=p}return mi(l||An,o)}return Ar}function Ns(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof gr||a instanceof lo||a instanceof tr?a.toString():JSON.stringify(a)}class Ug{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Sd(o[1]))return l.error("invalid value");const d=o[1];let p=_r(d);const y=l.expectedType;return"array"!==p.kind||0!==p.N||!y||"array"!==y.kind||"number"==typeof y.N&&0!==y.N||(p=y),new Ug(p,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof gr?["rgba"].concat(this.value.toArray()):this.value instanceof lo?this.value.serialize():this.value}}var hu=Ug,co=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const jg={string:Dt,number:Lt,boolean:In,object:Ar};class Bp{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let d,p=1;const y=o[0];if("array"===y){let C,D;if(o.length>2){const T=o[1];if("string"!=typeof T||!(T in jg)||"object"===T)return l.error('The item type argument of "array" must be one of string, number, boolean',1);C=jg[T],p++}else C=An;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);D=o[2],p++}d=mi(C,D)}else d=jg[y];const b=[];for(;p<o.length;p++){const C=l.parse(o[p],p,An);if(!C)return null;b.push(C)}return new Bp(d,b)}evaluate(o){for(let l=0;l<this.args.length;l++){const d=this.args[l].evaluate(o);if(!Yn(this.type,_r(d)))return d;if(l===this.args.length-1)throw new co(`Expected value to be of type ${Oi(this.type)}, but found ${Oi(_r(d))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const d=o.itemType;if("string"===d.kind||"number"===d.kind||"boolean"===d.kind){l.push(d.kind);const p=o.N;("number"==typeof p||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(d=>d.serialize()))}}var pl=Bp;class ml{constructor(o){this.type=ai,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const d=o[1];if(!Array.isArray(d)&&"object"==typeof d)return l.error("First argument must be an image or text section.");const p=[];let y=!1;for(let b=1;b<=o.length-1;++b){const C=o[b];if(y&&"object"==typeof C&&!Array.isArray(C)){y=!1;let D=null;if(C["font-scale"]&&(D=l.parse(C["font-scale"],1,Lt),!D))return null;let T=null;if(C["text-font"]&&(T=l.parse(C["text-font"],1,mi(Dt)),!T))return null;let k=null;if(C["text-color"]&&(k=l.parse(C["text-color"],1,xo),!k))return null;const L=p[p.length-1];L.scale=D,L.font=T,L.textColor=k}else{const D=l.parse(o[b],1,An);if(!D)return null;const T=D.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:D,scale:null,font:null,textColor:null})}}return new ml(p)}evaluate(o){return new lo(this.sections.map(l=>{const d=l.content.evaluate(o);return _r(d)===ha?new zp("",d,null,null,null):new zp(Ns(d),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const d={};l.scale&&(d["font-scale"]=l.scale.serialize()),l.font&&(d["text-font"]=l.font.serialize()),l.textColor&&(d["text-color"]=l.textColor.serialize()),o.push(d)}return o}}class Vp{constructor(o){this.type=ha,this.input=o}static parse(o,l){if(2!==o.length)return l.error("Expected two arguments.");const d=l.parse(o[1],1,Dt);return d?new Vp(d):l.error("No image name provided.")}evaluate(o){const l=this.input.evaluate(o),d=tr.fromString(l);return d&&o.availableImages&&(d.available=o.availableImages.indexOf(l)>-1),d}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const fs={"to-boolean":In,"to-color":xo,"to-number":Lt,"to-string":Dt};class cn{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const d=o[0];if(("to-boolean"===d||"to-string"===d)&&2!==o.length)return l.error("Expected one argument.");const p=fs[d],y=[];for(let b=1;b<o.length;b++){const C=l.parse(o[b],b,An);if(!C)return null;y.push(C)}return new cn(p,y)}evaluate(o){if("boolean"===this.type.kind)return!!this.args[0].evaluate(o);if("color"===this.type.kind){let l,d;for(const p of this.args){if(l=p.evaluate(o),d=null,l instanceof gr)return l;if("string"==typeof l){const y=o.parseColor(l);if(y)return y}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:tv(l[0],l[1],l[2],l[3]),!d))return new gr(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new co(d||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const d of this.args){if(l=d.evaluate(o),null===l)return 0;const p=Number(l);if(!isNaN(p))return p}throw new co(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?lo.fromString(Ns(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?tr.fromString(Ns(this.args[0].evaluate(o))):Ns(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ml([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Vp(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Id=cn;const Ua=["Unknown","Point","LineString","Polygon"];var $g=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ua[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:l,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*o-a[0])+this.featureDistanceData.bearing[1]*(d*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=gr.parse(a)),o}};class Bt{constructor(o,l,d,p){this.name=o,this.type=l,this._evaluate=d,this.args=p}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const d=o[0],p=Bt.definitions[d];if(!p)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,C=b.filter(([T])=>!Array.isArray(T)||T.length===o.length-1);let D=null;for(const[T,k]of C){D=new Gg(l.registry,l.path,null,l.scope);const L=[];let N=!1;for(let V=1;V<o.length;V++){const U=o[V],j=Array.isArray(T)?T[V-1]:T.type,te=D.parse(U,1+L.length,j);if(!te){N=!0;break}L.push(te)}if(!N)if(Array.isArray(T)&&T.length!==L.length)D.error(`Expected ${T.length} arguments, but found ${L.length} instead.`);else{for(let V=0;V<L.length;V++){const U=Array.isArray(T)?T[V]:T.type,j=L[V];D.concat(V+1).checkSubtype(U,j.type)}if(0===D.errors.length)return new Bt(d,y,k,L)}}if(1===C.length)l.errors.push(...D.errors);else{const T=(C.length?C:b).map(([L])=>{return N=L,Array.isArray(N)?`(${N.map(Oi).join(", ")})`:`(${Oi(N.type)}...)`;var N}).join(" | "),k=[];for(let L=1;L<o.length;L++){const N=l.parse(o[L],1+k.length);if(!N)return null;k.push(Oi(N.type))}l.error(`Expected arguments of type ${T}, but found (${k.join(", ")}) instead.`)}return null}static register(o,l){Bt.definitions=l;for(const d in l)o[d]=Bt}}var gl=Bt;class qi{constructor(o,l,d){this.type=Xo,this.locale=d,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const d=o[1];if("object"!=typeof d||Array.isArray(d))return l.error("Collator options argument must be an object.");const p=l.parse(void 0!==d["case-sensitive"]&&d["case-sensitive"],1,In);if(!p)return null;const y=l.parse(void 0!==d["diacritic-sensitive"]&&d["diacritic-sensitive"],1,In);if(!y)return null;let b=null;return d.locale&&(b=l.parse(d.locale,1,Dt),!b)?null:new qi(p,y,b)}evaluate(o){return new Vg(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const ps=8192;function rf(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function lc(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function Ad(a,o){const l=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,o.z);return[Math.round(l*p*ps),Math.round(d*p*ps)]}function Pd(a,o,l){const d=a[0]-o[0],p=a[1]-o[1],y=a[0]-l[0],b=a[1]-l[1];return d*b-y*p==0&&d*y<=0&&p*b<=0}function cc(a,o){let l=!1;for(let b=0,C=o.length;b<C;b++){const D=o[b];for(let T=0,k=D.length;T<k-1;T++){if(Pd(a,D[T],D[T+1]))return!1;(p=D[T])[1]>(d=a)[1]!=(y=D[T+1])[1]>d[1]&&d[0]<(y[0]-p[0])*(d[1]-p[1])/(y[1]-p[1])+p[0]&&(l=!l)}}var d,p,y;return l}function Od(a,o){for(let l=0;l<o.length;l++)if(cc(a,o[l]))return!0;return!1}function sf(a,o,l,d){const p=d[0]-l[0],y=d[1]-l[1],b=(a[0]-l[0])*y-p*(a[1]-l[1]),C=(o[0]-l[0])*y-p*(o[1]-l[1]);return b>0&&C<0||b<0&&C>0}function fu(a,o,l){for(const T of l)for(let k=0;k<T.length-1;++k)if((C=[(b=T[k+1])[0]-(y=T[k])[0],b[1]-y[1]])[0]*(D=[(p=o)[0]-(d=a)[0],p[1]-d[1]])[1]-C[1]*D[0]!=0&&sf(d,p,y,b)&&sf(y,b,d,p))return!0;var d,p,y,b,C,D;return!1}function Zt(a,o){for(let l=0;l<a.length;++l)if(!cc(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(fu(a[l],a[l+1],o))return!1;return!0}function Up(a,o){for(let l=0;l<o.length;l++)if(Zt(a,o[l]))return!0;return!1}function af(a,o,l){const d=[];for(let p=0;p<a.length;p++){const y=[];for(let b=0;b<a[p].length;b++){const C=Ad(a[p][b],l);rf(o,C),y.push(C)}d.push(y)}return d}function wo(a,o,l){const d=[];for(let p=0;p<a.length;p++){const y=af(a[p],o,l);d.push(y)}return d}function lf(a,o,l,d){if(a[0]<l[0]||a[0]>l[2]){const p=.5*d;let y=a[0]-l[0]>p?-d:l[0]-a[0]>p?d:0;0===y&&(y=a[0]-l[2]>p?-d:l[2]-a[0]>p?d:0),a[0]+=y}rf(o,a)}function nv(a,o,l,d){const p=Math.pow(2,d.z)*ps,y=[d.x*ps,d.y*ps],b=[];if(!a)return b;for(const C of a)for(const D of C){const T=[D.x+y[0],D.y+y[1]];lf(T,o,l,p),b.push(T)}return b}function gi(a,o,l,d){const p=Math.pow(2,d.z)*ps,y=[d.x*ps,d.y*ps],b=[];if(!a)return b;for(const D of a){const T=[];for(const k of D){const L=[k.x+y[0],k.y+y[1]];rf(o,L),T.push(L)}b.push(T)}if(o[2]-o[0]<=p/2){(C=o)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const D of b)for(const T of D)lf(T,o,l,p)}var C;return b}class kd{constructor(o,l){this.type=In,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Sd(o[1])){const d=o[1];if("FeatureCollection"===d.type)for(let p=0;p<d.features.length;++p){const y=d.features[p].geometry.type;if("Polygon"===y||"MultiPolygon"===y)return new kd(d,d.features[p].geometry)}else if("Feature"===d.type){const p=d.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new kd(d,d.geometry)}else if("Polygon"===d.type||"MultiPolygon"===d.type)return new kd(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,d){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===d.type){const C=af(d.coordinates,y,b),D=nv(l.geometry(),p,y,b);if(!lc(p,y))return!1;for(const T of D)if(!cc(T,C))return!1}if("MultiPolygon"===d.type){const C=wo(d.coordinates,y,b),D=nv(l.geometry(),p,y,b);if(!lc(p,y))return!1;for(const T of D)if(!Od(T,C))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,d){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===d.type){const C=af(d.coordinates,y,b),D=gi(l.geometry(),p,y,b);if(!lc(p,y))return!1;for(const T of D)if(!Zt(T,C))return!1}if("MultiPolygon"===d.type){const C=wo(d.coordinates,y,b),D=gi(l.geometry(),p,y,b);if(!lc(p,y))return!1;for(const T of D)if(!Up(T,C))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var jp=kd;function _l(a){if(a instanceof gl&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof jp)return!1;let o=!0;return a.eachChild(l=>{o&&!_l(l)&&(o=!1)}),o}function zs(a){if(a instanceof gl&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(l=>{o&&!zs(l)&&(o=!1)}),o}function yl(a,o){if(a instanceof gl&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(d=>{l&&!yl(d,o)&&(l=!1)}),l}class pu{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const d=o[1];return l.scope.has(d)?new pu(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Hg=pu;class uc{constructor(o,l=[],d,p=new zg,y=[]){this.registry=o,this.path=l,this.key=l.map(b=>`[${b}]`).join(""),this.scope=p,this.errors=y,this.expectedType=d}parse(o,l,d,p,y={}){return l?this.concat(l,d,p)._parse(o,y):this._parse(o,y)}_parse(o,l){function d(p,y,b){return"assert"===b?new pl(y,[p]):"coerce"===b?new Id(y,[p]):p}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=o[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let b=y.parse(o,this);if(!b)return null;if(this.expectedType){const C=this.expectedType,D=b.type;if("string"!==C.kind&&"number"!==C.kind&&"boolean"!==C.kind&&"object"!==C.kind&&"array"!==C.kind||"value"!==D.kind)if("color"!==C.kind&&"formatted"!==C.kind&&"resolvedImage"!==C.kind||"value"!==D.kind&&"string"!==D.kind){if(this.checkSubtype(C,D))return null}else b=d(b,C,l.typeAnnotation||"coerce");else b=d(b,C,l.typeAnnotation||"assert")}if(!(b instanceof hu)&&"resolvedImage"!==b.type.kind&&qg(b)){const C=new $g;try{b=new hu(b.type,b.evaluate(C))}catch(D){return this.error(D.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,d){const p="number"==typeof o?this.path.concat(o):this.path,y=d?this.scope.concat(d):this.scope;return new uc(this.registry,p,l||null,y,this.errors)}error(o,...l){const d=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new Fs(d,o))}checkSubtype(o,l){const d=Yn(o,l);return d&&this.error(d),d}}var Gg=uc;function qg(a){if(a instanceof Hg)return qg(a.boundExpression);if(a instanceof gl&&"error"===a.name||a instanceof qi||a instanceof jp)return!1;const o=a instanceof Id||a instanceof pl;let l=!0;return a.eachChild(d=>{l=o?l&&qg(d):l&&d instanceof hu}),!!l&&_l(a)&&yl(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function $p(a,o){const l=a.length-1;let d,p,y=0,b=l,C=0;for(;y<=b;)if(C=Math.floor((y+b)/2),d=a[C],p=a[C+1],d<=o){if(C===l||o<p)return C;y=C+1}else{if(!(d>o))throw new co("Input is not a number.");b=C-1}return 0}class Hp{constructor(o,l,d){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[p,y]of d)this.labels.push(p),this.outputs.push(y)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const d=l.parse(o[1],1,Lt);if(!d)return null;const p=[];let y=null;l.expectedType&&"value"!==l.expectedType.kind&&(y=l.expectedType);for(let b=1;b<o.length;b+=2){const C=1===b?-1/0:o[b],D=o[b+1],T=b,k=b+1;if("number"!=typeof C)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(p.length&&p[p.length-1][0]>=C)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const L=l.parse(D,k,y);if(!L)return null;y=y||L.type,p.push([C,L])}return new Hp(y,d,p)}evaluate(o){const l=this.labels,d=this.outputs;if(1===l.length)return d[0].evaluate(o);const p=this.input.evaluate(o);if(p<=l[0])return d[0].evaluate(o);const y=l.length;return p>=l[y-1]?d[y-1].evaluate(o):d[$p(l,p)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}var Wg=Hp;function Nn(a,o,l){return a*(1-l)+o*l}var dc=Object.freeze({__proto__:null,array:function(a,o,l){return a.map((d,p)=>Nn(d,o[p],l))},color:function(a,o,l){return new gr(Nn(a.r,o.r,l),Nn(a.g,o.g,l),Nn(a.b,o.b,l),Nn(a.a,o.a,l))},number:Nn});const Zg=4/29,hc=6/29,cf=3*hc*hc,mu=hc*hc*hc,iv=Math.PI/180,vl=180/Math.PI;function qp(a){return a>mu?Math.pow(a,1/3):a/cf+Zg}function st(a){return a>hc?a*a*a:cf*(a-Zg)}function uf(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Vt(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Ld(a){const o=Vt(a.r),l=Vt(a.g),d=Vt(a.b),p=qp((.4124564*o+.3575761*l+.1804375*d)/.95047),y=qp((.2126729*o+.7151522*l+.072175*d)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-qp((.0193339*o+.119192*l+.9503041*d)/1.08883)),alpha:a.a}}function df(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,d=isNaN(a.b)?o:o-a.b/200;return o=1*st(o),l=.95047*st(l),d=1.08883*st(d),new gr(uf(3.2404542*l-1.5371385*o-.4985314*d),uf(-.969266*l+1.8760108*o+.041556*d),uf(.0556434*l-.2040259*o+1.0572252*d),a.alpha)}function Fd(a,o,l){const d=o-a;return a+l*(d>180||d<-180?d-360*Math.round(d/360):d)}const Nd={forward:Ld,reverse:df,interpolate:function(a,o,l){return{l:Nn(a.l,o.l,l),a:Nn(a.a,o.a,l),b:Nn(a.b,o.b,l),alpha:Nn(a.alpha,o.alpha,l)}}},gu={forward:function(a){const{l:o,a:l,b:d}=Ld(a),p=Math.atan2(d,l)*vl;return{h:p<0?p+360:p,c:Math.sqrt(l*l+d*d),l:o,alpha:a.a}},reverse:function(a){const o=a.h*iv,l=a.c;return df({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:Fd(a.h,o.h,l),c:Nn(a.c,o.c,l),l:Nn(a.l,o.l,l),alpha:Nn(a.alpha,o.alpha,l)}}};var Wp=Object.freeze({__proto__:null,hcl:gu,lab:Nd});class Yo{constructor(o,l,d,p,y){this.type=o,this.operator=l,this.interpolation=d,this.input=p,this.labels=[],this.outputs=[];for(const[b,C]of y)this.labels.push(b),this.outputs.push(C)}static interpolationFactor(o,l,d,p){let y=0;if("exponential"===o.name)y=_u(l,o.base,d,p);else if("linear"===o.name)y=_u(l,1,d,p);else if("cubic-bezier"===o.name){const b=o.controlPoints;y=new Jl(b[0],b[1],b[2],b[3]).solve(_u(l,1,d,p))}return y}static parse(o,l){let[d,p,y,...b]=o;if(!Array.isArray(p)||0===p.length)return l.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const T=p[1];if("number"!=typeof T)return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:T}}else{if("cubic-bezier"!==p[0])return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const T=p.slice(1);if(4!==T.length||T.some(k=>"number"!=typeof k||k<0||k>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:T}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(y=l.parse(y,2,Lt),!y)return null;const C=[];let D=null;"interpolate-hcl"===d||"interpolate-lab"===d?D=xo:l.expectedType&&"value"!==l.expectedType.kind&&(D=l.expectedType);for(let T=0;T<b.length;T+=2){const k=b[T],L=b[T+1],N=T+3,V=T+4;if("number"!=typeof k)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(C.length&&C[C.length-1][0]>=k)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const U=l.parse(L,V,D);if(!U)return null;D=D||U.type,C.push([k,U])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new Yo(D,d,p,y,C):l.error(`Type ${Oi(D)} is not interpolatable.`)}evaluate(o){const l=this.labels,d=this.outputs;if(1===l.length)return d[0].evaluate(o);const p=this.input.evaluate(o);if(p<=l[0])return d[0].evaluate(o);const y=l.length;if(p>=l[y-1])return d[y-1].evaluate(o);const b=$p(l,p),C=Yo.interpolationFactor(this.interpolation,p,l[b],l[b+1]),D=d[b].evaluate(o),T=d[b+1].evaluate(o);return"interpolate"===this.operator?dc[this.type.kind.toLowerCase()](D,T,C):"interpolate-hcl"===this.operator?gu.reverse(gu.interpolate(gu.forward(D),gu.forward(T),C)):Nd.reverse(Nd.interpolate(Nd.forward(D),Nd.forward(T),C))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let d=0;d<this.labels.length;d++)l.push(this.labels[d],this.outputs[d].serialize());return l}}function _u(a,o,l,d){const p=d-l,y=a-l;return 0===p?0:1===o?y/p:(Math.pow(o,y)-1)/(Math.pow(o,p)-1)}var Nr=Yo;class Ko{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let d=null;const p=l.expectedType;p&&"value"!==p.kind&&(d=p);const y=[];for(const C of o.slice(1)){const D=l.parse(C,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!D)return null;d=d||D.type,y.push(D)}const b=p&&y.some(C=>Yn(p,C.type));return new Ko(b?An:d,y)}evaluate(o){let l,d=null,p=0;for(const y of this.args){if(p++,d=y.evaluate(o),d&&d instanceof tr&&!d.available&&(l||(l=d),d=null,p===this.args.length))return l;if(null!==d)break}return d}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var ri=Ko;class fc{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const d=[];for(let y=1;y<o.length-1;y+=2){const b=o[y];if("string"!=typeof b)return l.error(`Expected string, but found ${typeof b} instead.`,y);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",y);const C=l.parse(o[y+1],y+1);if(!C)return null;d.push([b,C])}const p=l.parse(o[o.length-1],o.length-1,l.expectedType,d);return p?new fc(d,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,d]of this.bindings)o.push(l,d.serialize());return o.push(this.result.serialize()),o}}var hf=fc;class yu{constructor(o,l,d){this.type=o,this.index=l,this.input=d}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,Lt),p=l.parse(o[2],2,mi(l.expectedType||An));return d&&p?new yu(p.type.itemType,d,p):null}evaluate(o){const l=this.index.evaluate(o),d=this.input.evaluate(o);if(l<0)throw new co(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new co(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new co(`Array index must be an integer, but found ${l} instead.`);return d[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Xg=yu;class Bs{constructor(o,l){this.type=In,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,An),p=l.parse(o[2],2,An);return d&&p?an(d.type,[In,Dt,Lt,Pi,An])?new Bs(d,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(d.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(null==d)return!1;if(!sc(l,["boolean","string","number","null"]))throw new co(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(_r(l))} instead.`);if(!sc(d,["string","array"]))throw new co(`Expected second argument to be of type array or string, but found ${Oi(_r(d))} instead.`);return d.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var bl=Bs;class vu{constructor(o,l,d){this.type=Lt,this.needle=o,this.haystack=l,this.fromIndex=d}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,An),p=l.parse(o[2],2,An);if(!d||!p)return null;if(!an(d.type,[In,Dt,Lt,Pi,An]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(d.type)} instead`);if(4===o.length){const y=l.parse(o[3],3,Lt);return y?new vu(d,p,y):null}return new vu(d,p)}evaluate(o){const l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!sc(l,["boolean","string","number","null"]))throw new co(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(_r(l))} instead.`);if(!sc(d,["string","array"]))throw new co(`Expected second argument to be of type array or string, but found ${Oi(_r(d))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(o);return d.indexOf(l,p)}return d.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Zp=vu;class zd{constructor(o,l,d,p,y,b){this.inputType=o,this.type=l,this.input=d,this.cases=p,this.outputs=y,this.otherwise=b}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let d,p;l.expectedType&&"value"!==l.expectedType.kind&&(p=l.expectedType);const y={},b=[];for(let T=2;T<o.length-1;T+=2){let k=o[T];const L=o[T+1];Array.isArray(k)||(k=[k]);const N=l.concat(T);if(0===k.length)return N.error("Expected at least one branch label.");for(const U of k){if("number"!=typeof U&&"string"!=typeof U)return N.error("Branch labels must be numbers or strings.");if("number"==typeof U&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof U&&Math.floor(U)!==U)return N.error("Numeric branch labels must be integer values.");if(d){if(N.checkSubtype(d,_r(U)))return null}else d=_r(U);if(void 0!==y[String(U)])return N.error("Branch labels must be unique.");y[String(U)]=b.length}const V=l.parse(L,T,p);if(!V)return null;p=p||V.type,b.push(V)}const C=l.parse(o[1],1,An);if(!C)return null;const D=l.parse(o[o.length-1],o.length-1,p);return D?"value"!==C.type.kind&&l.concat(1).checkSubtype(d,C.type)?null:new zd(d,p,C,y,b,D):null}evaluate(o){const l=this.input.evaluate(o);return(_r(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),d=[],p={};for(const b of l){const C=p[this.cases[b]];void 0===C?(p[this.cases[b]]=d.length,d.push([this.cases[b],[b]])):d[C][1].push(b)}const y=b=>"number"===this.inputType.kind?Number(b):b;for(const[b,C]of d)o.push(1===C.length?y(C[0]):C.map(y)),o.push(this.outputs[b].serialize());return o.push(this.otherwise.serialize()),o}}var Yg=zd;class ff{constructor(o,l,d){this.type=o,this.branches=l,this.otherwise=d}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&"value"!==l.expectedType.kind&&(d=l.expectedType);const p=[];for(let b=1;b<o.length-1;b+=2){const C=l.parse(o[b],b,In);if(!C)return null;const D=l.parse(o[b+1],b+1,d);if(!D)return null;p.push([C,D]),d=d||D.type}const y=l.parse(o[o.length-1],o.length-1,d);return y?new ff(d,p,y):null}evaluate(o){for(const[l,d]of this.branches)if(l.evaluate(o))return d.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,d]of this.branches)o(l),o(d);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var bu=ff;class xu{constructor(o,l,d,p){this.type=o,this.input=l,this.beginIndex=d,this.endIndex=p}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,An),p=l.parse(o[2],2,Lt);if(!d||!p)return null;if(!an(d.type,[mi(An),Dt,An]))return l.error(`Expected first argument to be of type array or string, but found ${Oi(d.type)} instead`);if(4===o.length){const y=l.parse(o[3],3,Lt);return y?new xu(d.type,d,p,y):null}return new xu(d.type,d,p)}evaluate(o){const l=this.input.evaluate(o),d=this.beginIndex.evaluate(o);if(!sc(l,["string","array"]))throw new co(`Expected first argument to be of type array or string, but found ${Oi(_r(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(o);return l.slice(d,p)}return l.slice(d)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Xp=xu;function pf(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Yp(a,o,l,d){return 0===d.compare(o,l)}function wu(a,o,l){const d="=="!==a&&"!="!==a;return class w9{constructor(y,b,C){this.type=In,this.lhs=y,this.rhs=b,this.collator=C,this.hasUntypedArgument="value"===y.type.kind||"value"===b.type.kind}static parse(y,b){if(3!==y.length&&4!==y.length)return b.error("Expected two or three arguments.");const C=y[0];let D=b.parse(y[1],1,An);if(!D)return null;if(!pf(C,D.type))return b.concat(1).error(`"${C}" comparisons are not supported for type '${Oi(D.type)}'.`);let T=b.parse(y[2],2,An);if(!T)return null;if(!pf(C,T.type))return b.concat(2).error(`"${C}" comparisons are not supported for type '${Oi(T.type)}'.`);if(D.type.kind!==T.type.kind&&"value"!==D.type.kind&&"value"!==T.type.kind)return b.error(`Cannot compare types '${Oi(D.type)}' and '${Oi(T.type)}'.`);d&&("value"===D.type.kind&&"value"!==T.type.kind?D=new pl(T.type,[D]):"value"!==D.type.kind&&"value"===T.type.kind&&(T=new pl(D.type,[T])));let k=null;if(4===y.length){if("string"!==D.type.kind&&"string"!==T.type.kind&&"value"!==D.type.kind&&"value"!==T.type.kind)return b.error("Cannot use collator to compare non-string types.");if(k=b.parse(y[3],3,Xo),!k)return null}return new w9(D,T,k)}evaluate(y){const b=this.lhs.evaluate(y),C=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const D=_r(b),T=_r(C);if(D.kind!==T.kind||"string"!==D.kind&&"number"!==D.kind)throw new co(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${D.kind}, ${T.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const D=_r(b),T=_r(C);if("string"!==D.kind||"string"!==T.kind)return o(y,b,C)}return this.collator?l(y,b,C,this.collator.evaluate(y)):o(y,b,C)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[a];return this.eachChild(b=>{y.push(b.serialize())}),y}}}const rv=wu("==",function(a,o,l){return o===l},Yp),Vs=wu("!=",function(a,o,l){return o!==l},function(a,o,l,d){return!Yp(0,o,l,d)}),ov=wu("<",function(a,o,l){return o<l},function(a,o,l,d){return d.compare(o,l)<0}),Kg=wu(">",function(a,o,l){return o>l},function(a,o,l,d){return d.compare(o,l)>0}),sv=wu("<=",function(a,o,l){return o<=l},function(a,o,l,d){return d.compare(o,l)<=0}),Qg=wu(">=",function(a,o,l){return o>=l},function(a,o,l,d){return d.compare(o,l)>=0});class mf{constructor(o,l,d,p,y,b){this.type=Dt,this.number=o,this.locale=l,this.currency=d,this.unit=p,this.minFractionDigits=y,this.maxFractionDigits=b}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const d=l.parse(o[1],1,Lt);if(!d)return null;const p=o[2];if("object"!=typeof p||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=l.parse(p.locale,1,Dt),!y))return null;let b=null;if(p.currency&&(b=l.parse(p.currency,1,Dt),!b))return null;let C=null;if(p.unit&&(C=l.parse(p.unit,1,Dt),!C))return null;let D=null;if(p["min-fraction-digits"]&&(D=l.parse(p["min-fraction-digits"],1,Lt),!D))return null;let T=null;return p["max-fraction-digits"]&&(T=l.parse(p["max-fraction-digits"],1,Lt),!T)?null:new mf(d,y,b,C,D,T)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Cu{constructor(o){this.type=Lt,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const d=l.parse(o[1],1);return d?"array"!==d.type.kind&&"string"!==d.type.kind&&"value"!==d.type.kind?l.error(`Expected argument of type string or array, but found ${Oi(d.type)} instead.`):new Cu(d):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new co(`Expected value to be of type string or array, but found ${Oi(_r(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}const Kp={"==":rv,"!=":Vs,">":Kg,"<":ov,">=":Qg,"<=":sv,array:pl,at:Xg,boolean:pl,case:bu,coalesce:ri,collator:qi,format:ml,image:Vp,in:bl,"index-of":Zp,interpolate:Nr,"interpolate-hcl":Nr,"interpolate-lab":Nr,length:Cu,let:hf,literal:hu,match:Yg,number:pl,"number-format":mf,object:pl,slice:Xp,step:Wg,string:pl,"to-boolean":Id,"to-color":Id,"to-number":Id,"to-string":Id,var:Hg,within:jp};function Jg(a,[o,l,d,p]){o=o.evaluate(a),l=l.evaluate(a),d=d.evaluate(a);const y=p?p.evaluate(a):1,b=tv(o,l,d,y);if(b)throw new co(b);return new gr(o/255*y,l/255*y,d/255*y,y)}function ja(a,o){return a in o}function gf(a,o){const l=o[a];return void 0===l?null:l}function ui(a){return{type:a}}gl.register(Kp,{error:[{kind:"error"},[Dt],(a,[o])=>{throw new co(o.evaluate(a))}],typeof:[Dt,[An],(a,[o])=>Oi(_r(o.evaluate(a)))],"to-rgba":[mi(Lt,4),[xo],(a,[o])=>o.evaluate(a).toArray()],rgb:[xo,[Lt,Lt,Lt],Jg],rgba:[xo,[Lt,Lt,Lt,Lt],Jg],has:{type:In,overloads:[[[Dt],(a,[o])=>ja(o.evaluate(a),a.properties())],[[Dt,Ar],(a,[o,l])=>ja(o.evaluate(a),l.evaluate(a))]]},get:{type:An,overloads:[[[Dt],(a,[o])=>gf(o.evaluate(a),a.properties())],[[Dt,Ar],(a,[o,l])=>gf(o.evaluate(a),l.evaluate(a))]]},"feature-state":[An,[Dt],(a,[o])=>gf(o.evaluate(a),a.featureState||{})],properties:[Ar,[],a=>a.properties()],"geometry-type":[Dt,[],a=>a.geometryType()],id:[An,[],a=>a.id()],zoom:[Lt,[],a=>a.globals.zoom],pitch:[Lt,[],a=>a.globals.pitch||0],"distance-from-center":[Lt,[],a=>a.distanceFromCenter()],"heatmap-density":[Lt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Lt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[Lt,[],a=>a.globals.skyRadialProgress||0],accumulated:[An,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[Lt,ui(Lt),(a,o)=>{let l=0;for(const d of o)l+=d.evaluate(a);return l}],"*":[Lt,ui(Lt),(a,o)=>{let l=1;for(const d of o)l*=d.evaluate(a);return l}],"-":{type:Lt,overloads:[[[Lt,Lt],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[Lt],(a,[o])=>-o.evaluate(a)]]},"/":[Lt,[Lt,Lt],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[Lt,[Lt,Lt],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[Lt,[],()=>Math.LN2],pi:[Lt,[],()=>Math.PI],e:[Lt,[],()=>Math.E],"^":[Lt,[Lt,Lt],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[Lt,[Lt],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[Lt,[Lt],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[Lt,[Lt],(a,[o])=>Math.log(o.evaluate(a))],log2:[Lt,[Lt],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[Lt,[Lt],(a,[o])=>Math.sin(o.evaluate(a))],cos:[Lt,[Lt],(a,[o])=>Math.cos(o.evaluate(a))],tan:[Lt,[Lt],(a,[o])=>Math.tan(o.evaluate(a))],asin:[Lt,[Lt],(a,[o])=>Math.asin(o.evaluate(a))],acos:[Lt,[Lt],(a,[o])=>Math.acos(o.evaluate(a))],atan:[Lt,[Lt],(a,[o])=>Math.atan(o.evaluate(a))],min:[Lt,ui(Lt),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[Lt,ui(Lt),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[Lt,[Lt],(a,[o])=>Math.abs(o.evaluate(a))],round:[Lt,[Lt],(a,[o])=>{const l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[Lt,[Lt],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[Lt,[Lt],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[In,[Dt,An],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[In,[An],(a,[o])=>a.id()===o.value],"filter-type-==":[In,[Dt],(a,[o])=>a.geometryType()===o.value],"filter-<":[In,[Dt,An],(a,[o,l])=>{const d=a.properties()[o.value],p=l.value;return typeof d==typeof p&&d<p}],"filter-id-<":[In,[An],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l<d}],"filter->":[In,[Dt,An],(a,[o,l])=>{const d=a.properties()[o.value],p=l.value;return typeof d==typeof p&&d>p}],"filter-id->":[In,[An],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l>d}],"filter-<=":[In,[Dt,An],(a,[o,l])=>{const d=a.properties()[o.value],p=l.value;return typeof d==typeof p&&d<=p}],"filter-id-<=":[In,[An],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l<=d}],"filter->=":[In,[Dt,An],(a,[o,l])=>{const d=a.properties()[o.value],p=l.value;return typeof d==typeof p&&d>=p}],"filter-id->=":[In,[An],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l>=d}],"filter-has":[In,[An],(a,[o])=>o.value in a.properties()],"filter-has-id":[In,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[In,[mi(Dt)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[In,[mi(An)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[In,[Dt,mi(An)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[In,[Dt,mi(An)],(a,[o,l])=>function(d,p,y,b){for(;y<=b;){const C=y+b>>1;if(p[C]===d)return!0;p[C]>d?b=C-1:y=C+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:In,overloads:[[[In,In],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[ui(In),(a,o)=>{for(const l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:In,overloads:[[[In,In],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[ui(In),(a,o)=>{for(const l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[In,[In],(a,[o])=>!o.evaluate(a)],"is-supported-script":[In,[Dt],(a,[o])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[Dt,[Dt],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[Dt,[Dt],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[Dt,ui(An),(a,o)=>o.map(l=>Ns(l.evaluate(a))).join("")],"resolved-locale":[Dt,[Xo],(a,[o])=>o.evaluate(a).resolvedLocale()]});var Bd=Kp;function e_(a){return{result:"success",value:a}}function pc(a){return{result:"error",value:a}}function Wi(a){return"data-driven"===a["property-type"]}function _f(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Vd(a){return!!a.expression&&a.expression.interpolated}function Pt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Xr(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function Qn(a){return a}function zr(a,o){const l="color"===o.type,d=a.stops&&"object"==typeof a.stops[0][0],p=d||!(d||void 0!==a.property),y=a.type||(Vd(o)?"exponential":"interval");if(l&&((a=Va({},a)).stops&&(a.stops=a.stops.map(T=>[T[0],gr.parse(T[1])])),a.default=gr.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!Wp[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,C,D;if("exponential"===y)b=fa;else if("interval"===y)b=uo;else if("categorical"===y){b=mc,C=Object.create(null);for(const T of a.stops)C[T[0]]=T[1];D=typeof a.stops[0][0]}else{if("identity"!==y)throw new Error(`Unknown function type "${y}"`);b=Qp}if(d){const T={},k=[];for(let V=0;V<a.stops.length;V++){const U=a.stops[V],j=U[0].zoom;void 0===T[j]&&(T[j]={zoom:j,type:a.type,property:a.property,default:a.default,stops:[]},k.push(j)),T[j].stops.push([U[0].value,U[1]])}const L=[];for(const V of k)L.push([T[V].zoom,zr(T[V],o)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:Nr.interpolationFactor.bind(void 0,N),zoomStops:L.map(V=>V[0]),evaluate:({zoom:V},U)=>fa({stops:L,base:a.base},o,V).evaluate(V,U)}}if(p){const T="exponential"===y?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Nr.interpolationFactor.bind(void 0,T),zoomStops:a.stops.map(k=>k[0]),evaluate:({zoom:k})=>b(a,o,k,C,D)}}return{kind:"source",evaluate(T,k){const L=k&&k.properties?k.properties[a.property]:void 0;return void 0===L?Br(a.default,o.default):b(a,o,L,C,D)}}}function Br(a,o,l){return void 0!==a?a:void 0!==o?o:void 0!==l?l:void 0}function mc(a,o,l,d,p){return Br(typeof l===p?d[l]:void 0,a.default,o.default)}function uo(a,o,l){if("number"!==Pt(l))return Br(a.default,o.default);const d=a.stops.length;if(1===d||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[d-1][0])return a.stops[d-1][1];const p=$p(a.stops.map(y=>y[0]),l);return a.stops[p][1]}function fa(a,o,l){const d=void 0!==a.base?a.base:1;if("number"!==Pt(l))return Br(a.default,o.default);const p=a.stops.length;if(1===p||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[p-1][0])return a.stops[p-1][1];const y=$p(a.stops.map(k=>k[0]),l),b=function(k,L,N,V){const U=V-N,j=k-N;return 0===U?0:1===L?j/U:(Math.pow(L,j)-1)/(Math.pow(L,U)-1)}(l,d,a.stops[y][0],a.stops[y+1][0]),C=a.stops[y][1],D=a.stops[y+1][1];let T=dc[o.type]||Qn;if(a.colorSpace&&"rgb"!==a.colorSpace){const k=Wp[a.colorSpace];T=(L,N)=>k.reverse(k.interpolate(k.forward(L),k.forward(N),b))}return"function"==typeof C.evaluate?{evaluate(...k){const L=C.evaluate.apply(void 0,k),N=D.evaluate.apply(void 0,k);if(void 0!==L&&void 0!==N)return T(L,N,b)}}:T(C,D,b)}function Qp(a,o,l){return"color"===o.type?l=gr.parse(l):"formatted"===o.type?l=lo.fromString(l.toString()):"resolvedImage"===o.type?l=tr.fromString(l.toString()):Pt(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),Br(l,a.default,o.default)}class gc{constructor(o,l){var d;this.expression=o,this._warningHistory={},this._evaluator=new $g,this._defaultValue=l?"color"===(d=l).type&&(Xr(d.default)||Array.isArray(d.default))?new gr(0,0,0,0):"color"===d.type?gr.parse(d.default)||null:void 0===d.default?null:d.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(o,l,d,p,y,b,C,D){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,d,p,y,b,C,D){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=D||null;try{const T=this.expression.evaluate(this._evaluator);if(null==T||"number"==typeof T&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new co(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Eu(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Bd}function Mu(a,o){const l=new Gg(Bd,[],o?function(p){const y={color:xo,string:Dt,number:Lt,enum:Dt,boolean:In,formatted:ai,resolvedImage:ha};return"array"===p.type?mi(y[p.value]||An,p.length):y[p.type]}(o):void 0),d=l.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return d?e_(new gc(d,o)):pc(l.errors)}class sr{constructor(o,l){this.kind=o,this._styleExpression=l,this.isStateDependent="constant"!==o&&!zs(l.expression)}evaluateWithoutErrorHandling(o,l,d,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,p,y,b)}evaluate(o,l,d,p,y,b){return this._styleExpression.evaluate(o,l,d,p,y,b)}}class $t{constructor(o,l,d,p){this.kind=o,this.zoomStops=d,this._styleExpression=l,this.isStateDependent="camera"!==o&&!zs(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(o,l,d,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,p,y,b)}evaluate(o,l,d,p,y,b){return this._styleExpression.evaluate(o,l,d,p,y,b)}interpolationFactor(o,l,d){return this.interpolationType?Nr.interpolationFactor(this.interpolationType,o,l,d):0}}function bn(a,o){if("error"===(a=Mu(a,o)).result)return a;const l=a.value.expression,d=_l(l);if(!d&&!Wi(o))return pc([new Fs("","data expressions not supported")]);const p=yl(l,["zoom","pitch","distance-from-center"]);if(!p&&!_f(o))return pc([new Fs("","zoom expressions not supported")]);const y=Fo(l);return y||p?y instanceof Fs?pc([y]):y instanceof Nr&&!Vd(o)?pc([new Fs("",'"interpolate" expressions cannot be used with this property')]):e_(y?new $t(d?"camera":"composite",a.value,y.labels,y instanceof Nr?y.interpolation:void 0):new sr(d?"constant":"source",a.value)):pc([new Fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ni{constructor(o,l){this._parameters=o,this._specification=l,Va(this,zr(this._parameters,this._specification))}static deserialize(o){return new Ni(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Fo(a){let o=null;if(a instanceof hf)o=Fo(a.result);else if(a instanceof ri){for(const l of a.args)if(o=Fo(l),o)break}else(a instanceof Wg||a instanceof Nr)&&a.input instanceof gl&&"zoom"===a.input.name&&(o=a);return o instanceof Fs||a.eachChild(l=>{const d=Fo(l);d instanceof Fs?o=d:!o&&d?o=new Fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&d&&o!==d&&(o=new Fs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class Ot{constructor(o,l,d,p){this.message=(o?`${o}: `:"")+d,p&&(this.identifier=p),null!=l&&l.__line__&&(this.line=l.__line__)}}function ji(a){const o=a.key,l=a.value,d=a.valueSpec||{},p=a.objectElementValidators||{},y=a.style,b=a.styleSpec;let C=[];const D=Pt(l);if("object"!==D)return[new Ot(o,l,`object expected, ${D} found`)];for(const T in l){const k=T.split(".")[0];let L;p[k]?L=p[k]:d[k]?L=$i:p["*"]?L=p["*"]:d["*"]&&(L=$i),L?C=C.concat(L({key:(o&&`${o}.`)+T,value:l[T],valueSpec:d[k]||d["*"],style:y,styleSpec:b,object:l,objectKey:T},l)):C.push(new Ot(o,l[T],`unknown property "${T}"`))}for(const T in d)p[T]||d[T].required&&void 0===d[T].default&&void 0===l[T]&&C.push(new Ot(o,l,`missing required property "${T}"`));return C}function _c(a){const o=a.value,l=a.valueSpec,d=a.style,p=a.styleSpec,y=a.key,b=a.arrayElementValidator||$i;if("array"!==Pt(o))return[new Ot(y,o,`array expected, ${Pt(o)} found`)];if(l.length&&o.length!==l.length)return[new Ot(y,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new Ot(y,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let C={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};p.$version<7&&(C.function=l.function),"object"===Pt(l.value)&&(C=l.value);let D=[];for(let T=0;T<o.length;T++)D=D.concat(b({array:o,arrayIndex:T,value:o[T],valueSpec:C,style:d,styleSpec:p,key:`${y}[${T}]`}));return D}function Zi(a){const o=a.key,l=a.value,d=a.valueSpec;let p=Pt(l);if("number"===p&&l!=l&&(p="NaN"),"number"!==p)return[new Ot(o,l,`number expected, ${p} found`)];if("minimum"in d){let y=d.minimum;if("array"===Pt(d.minimum)&&(y=d.minimum[a.arrayIndex]),l<y)return[new Ot(o,l,`${l} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if("array"===Pt(d.maximum)&&(y=d.maximum[a.arrayIndex]),l>y)return[new Ot(o,l,`${l} is greater than the maximum value ${y}`)]}return[]}function ms(a){const o=a.valueSpec,l=Ir(a.value.type);let d,p,y,b={};const C="categorical"!==l&&void 0===a.value.property,D=!C,T="array"===Pt(a.value.stops)&&"array"===Pt(a.value.stops[0])&&"object"===Pt(a.value.stops[0][0]),k=ji({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(V){if("identity"===l)return[new Ot(V.key,V.value,'identity function may not have a "stops" property')];let U=[];const j=V.value;return U=U.concat(_c({key:V.key,value:j,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:L})),"array"===Pt(j)&&0===j.length&&U.push(new Ot(V.key,j,"array must have at least one stop")),U},default:function(V){return $i({key:V.key,value:V.value,valueSpec:o,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===l&&C&&k.push(new Ot(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||k.push(new Ot(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!Vd(a.valueSpec)&&k.push(new Ot(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(D&&!Wi(a.valueSpec)?k.push(new Ot(a.key,a.value,"property functions not supported")):C&&!_f(a.valueSpec)&&k.push(new Ot(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!T||void 0!==a.value.property||k.push(new Ot(a.key,a.value,'"property" property is required')),k;function L(V){let U=[];const j=V.value,te=V.key;if("array"!==Pt(j))return[new Ot(te,j,`array expected, ${Pt(j)} found`)];if(2!==j.length)return[new Ot(te,j,`array length 2 expected, length ${j.length} found`)];if(T){if("object"!==Pt(j[0]))return[new Ot(te,j,`object expected, ${Pt(j[0])} found`)];if(void 0===j[0].zoom)return[new Ot(te,j,"object stop key must have zoom")];if(void 0===j[0].value)return[new Ot(te,j,"object stop key must have value")];const q=Ir(j[0].zoom);if("number"!=typeof q)return[new Ot(te,j[0].zoom,"stop zoom values must be numbers")];if(y&&y>q)return[new Ot(te,j[0].zoom,"stop zoom values must appear in ascending order")];q!==y&&(y=q,p=void 0,b={}),U=U.concat(ji({key:`${te}[0]`,value:j[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Zi,value:N}}))}else U=U.concat(N({key:`${te}[0]`,value:j[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},j));return Eu(Zr(j[1]))?U.concat([new Ot(`${te}[1]`,j[1],"expressions are not allowed in function stops.")]):U.concat($i({key:`${te}[1]`,value:j[1],valueSpec:o,style:V.style,styleSpec:V.styleSpec}))}function N(V,U){const j=Pt(V.value),te=Ir(V.value),q=null!==V.value?V.value:U;if(d){if(j!==d)return[new Ot(V.key,q,`${j} stop domain type must match previous stop domain type ${d}`)]}else d=j;if("number"!==j&&"string"!==j&&"boolean"!==j&&"number"!=typeof te&&"string"!=typeof te&&"boolean"!=typeof te)return[new Ot(V.key,q,"stop domain value must be a number, string, or boolean")];if("number"!==j&&"categorical"!==l){let pe=`number expected, ${j} found`;return Wi(o)&&void 0===l&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ot(V.key,q,pe)]}return"categorical"!==l||"number"!==j||"number"==typeof te&&isFinite(te)&&Math.floor(te)===te?"categorical"!==l&&"number"===j&&"number"==typeof te&&"number"==typeof p&&void 0!==p&&te<p?[new Ot(V.key,q,"stop domain values must appear in ascending order")]:(p=te,"categorical"===l&&te in b?[new Ot(V.key,q,"stop domain values must be unique")]:(b[te]=!0,[])):[new Ot(V.key,q,`integer expected, found ${String(te)}`)]}}function ar(a){const o=("property"===a.expressionContext?bn:Mu)(Zr(a.value),a.valueSpec);if("error"===o.result)return o.value.map(d=>new Ot(`${a.key}${d.key}`,a.value,d.message));const l=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Ot(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!zs(l))return[new Ot(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return mn(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!yl(l,["zoom","feature-state"]))return[new Ot(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!_l(l))return[new Ot(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function mn(a,o){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const p of o.valueSpec.expression.parameters)l.delete(p);if(0===l.size)return[];const d=[];return a instanceof gl&&l.has(a.name)?[new Ot(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(p=>{d.push(...mn(p,o))}),d)}function xl(a){const o=a.key,l=a.value,d=a.valueSpec,p=[];return Array.isArray(d.values)?-1===d.values.indexOf(Ir(l))&&p.push(new Ot(o,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(d.values).indexOf(Ir(l))&&p.push(new Ot(o,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function yf(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!yf(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function $a(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yf(a)||(a=Qo(a));const l=a;let d=!0;try{d=function(T){if(!Us(T))return T;let k=Zr(T);return wl(k),k=yr(k),k}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const p=He[`filter_${o}`],y=Mu(d,p);let b=null;if("error"===y.result)throw new Error(y.value.map(T=>`${T.key}: ${T.message}`).join(", "));b=(T,k,L)=>y.value.evaluate(T,k,{},L);let C=null,D=null;if(d!==l){const T=Mu(l,p);if("error"===T.result)throw new Error(T.value.map(k=>`${k.key}: ${k.message}`).join(", "));C=(k,L,N,V,U)=>T.value.evaluate(k,L,{},N,void 0,void 0,V,U),D=!_l(T.value.expression)}return{filter:b,dynamicFilter:C||void 0,needGeometry:Jp(d),needFeature:!!D}}function yr(a){if(!Array.isArray(a))return a;const o=function(l){if(gs.has(l[0]))for(let d=1;d<l.length;d++)if(Us(l[d]))return!0;return l}(a);return!0===o?o:o.map(l=>yr(l))}function wl(a){let o=!1;const l=[];if("case"===a[0]){for(let d=1;d<a.length-1;d+=2)o=o||Us(a[d]),l.push(a[d+1]);l.push(a[a.length-1])}else if("match"===a[0]){o=o||Us(a[1]);for(let d=2;d<a.length-1;d+=2)l.push(a[d+1]);l.push(a[a.length-1])}else if("step"===a[0]){o=o||Us(a[1]);for(let d=1;d<a.length-1;d+=2)l.push(a[d+1])}o&&(a.length=0,a.push("any",...l));for(let d=1;d<a.length;d++)wl(a[d])}function Us(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<a.length;l++)if(Us(a[l]))return!0;return!1}const gs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ud(a,o){return a<o?-1:a>o?1:0}function Jp(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(Jp(a[o]))return!0;return!1}function Qo(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?js(a[1],a[2],"=="):"!="===o?jn(js(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?js(a[1],a[2],o):"any"===o?(l=a.slice(1),["any"].concat(l.map(Qo))):"all"===o?["all"].concat(a.slice(1).map(Qo)):"none"===o?["all"].concat(a.slice(1).map(Qo).map(jn)):"in"===o?Du(a[1],a.slice(2)):"!in"===o?jn(Du(a[1],a.slice(2))):"has"===o?Tu(a[1]):"!has"===o?jn(Tu(a[1])):"within"!==o||a;var l}function js(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function Du(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort(Ud)]]:["filter-in-small",a,["literal",o]]}}function Tu(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function jn(a){return["!",a]}function vf(a){return yf(Zr(a.value))?ar(Va({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):yc(a)}function yc(a){const o=a.value,l=a.key;if("array"!==Pt(o))return[new Ot(l,o,`array expected, ${Pt(o)} found`)];const d=a.styleSpec;let p,y=[];if(o.length<1)return[new Ot(l,o,"filter array must have at least 1 element")];switch(y=y.concat(xl({key:`${l}[0]`,value:o[0],valueSpec:d.filter_operator,style:a.style,styleSpec:a.styleSpec})),Ir(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===Ir(o[1])&&y.push(new Ot(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&y.push(new Ot(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(p=Pt(o[1]),"string"!==p&&y.push(new Ot(`${l}[1]`,o[1],`string expected, ${p} found`)));for(let b=2;b<o.length;b++)p=Pt(o[b]),"$type"===Ir(o[1])?y=y.concat(xl({key:`${l}[${b}]`,value:o[b],valueSpec:d.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&y.push(new Ot(`${l}[${b}]`,o[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<o.length;b++)y=y.concat(yc({key:`${l}[${b}]`,value:o[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":p=Pt(o[1]),2!==o.length?y.push(new Ot(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==p&&y.push(new Ot(`${l}[1]`,o[1],`string expected, ${p} found`));break;case"within":p=Pt(o[1]),2!==o.length?y.push(new Ot(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==p&&y.push(new Ot(`${l}[1]`,o[1],`object expected, ${p} found`))}return y}function bf(a,o){const l=a.key,d=a.style,p=a.styleSpec,y=a.value,b=a.objectKey,C=p[`${o}_${a.layerType}`];if(!C)return[];const D=b.match(/^(.*)-transition$/);if("paint"===o&&D&&C[D[1]]&&C[D[1]].transition)return $i({key:l,value:y,valueSpec:p.transition,style:d,styleSpec:p});const T=a.valueSpec||C[b];if(!T)return[new Ot(l,y,`unknown property "${b}"`)];let k;if("string"===Pt(y)&&Wi(T)&&!T.tokens&&(k=/^{([^}]+)}$/.exec(y))){const N=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new Ot(l,y,`"${b}" does not support interpolation syntax\nUse an identity property function instead: ${N}.`)]}const L=[];return"symbol"===a.layerType&&("text-field"===b&&d&&!d.glyphs&&L.push(new Ot(l,y,'use of "text-field" requires a style "glyphs" property')),"text-font"===b&&Xr(Zr(y))&&"identity"===Ir(y.type)&&L.push(new Ot(l,y,'"text-font" does not support identity functions'))),L.concat($i({key:a.key,value:y,valueSpec:T,style:d,styleSpec:p,expressionContext:"property",propertyType:o,propertyKey:b}))}function $s(a){return bf(a,"paint")}function Su(a){return bf(a,"layout")}function vc(a){let o=[];const l=a.value,d=a.key,p=a.style,y=a.styleSpec;l.type||l.ref||o.push(new Ot(d,l,'either "type" or "ref" is required'));let b=Ir(l.type);const C=Ir(l.ref);if(l.id){const D=Ir(l.id);for(let T=0;T<a.arrayIndex;T++){const k=p.layers[T];Ir(k.id)===D&&o.push(new Ot(d,l.id,`duplicate layer id "${l.id}", previously used at line ${k.id.__line__}`))}}if("ref"in l){let D;["type","source","source-layer","filter","layout"].forEach(T=>{T in l&&o.push(new Ot(d,l[T],`"${T}" is prohibited for ref layers`))}),p.layers.forEach(T=>{Ir(T.id)===C&&(D=T)}),D?D.ref?o.push(new Ot(d,l.ref,"ref cannot reference another ref layer")):b=Ir(D.type):"string"==typeof C&&o.push(new Ot(d,l.ref,`ref layer "${C}" not found`))}else if("background"!==b&&"sky"!==b)if(l.source){const D=p.sources&&p.sources[l.source],T=D&&Ir(D.type);D?"vector"===T&&"raster"===b?o.push(new Ot(d,l.source,`layer "${l.id}" requires a raster source`)):"raster"===T&&"raster"!==b?o.push(new Ot(d,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==T||l["source-layer"]?"raster-dem"===T&&"hillshade"!==b?o.push(new Ot(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==b||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===T&&D.lineMetrics||o.push(new Ot(d,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new Ot(d,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new Ot(d,l.source,`source "${l.source}" not found`))}else o.push(new Ot(d,l,'missing required property "source"'));return o=o.concat(ji({key:d,value:l,valueSpec:y.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$i({key:`${d}.type`,value:l.type,valueSpec:y.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:D=>vf(Va({layerType:b},D)),layout:D=>ji({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":T=>Su(Va({layerType:b},T))}}),paint:D=>ji({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":T=>$s(Va({layerType:b},T))}})}})),o}function _s(a){const o=a.value,l=a.key,d=Pt(o);return"string"!==d?[new Ot(l,o,`string expected, ${d} found`)]:[]}const Yr={promoteId:function({key:a,value:o}){if("string"===Pt(o))return _s({key:a,value:o});{const l=[];for(const d in o)l.push(..._s({key:`${a}.${d}`,value:o[d]}));return l}}};function av(a){const o=a.value,l=a.key,d=a.styleSpec,p=a.style;if(!o.type)return[new Ot(l,o,'"type" is required')];const y=Ir(o.type);let b;switch(y){case"vector":case"raster":case"raster-dem":return b=ji({key:l,value:o,valueSpec:d[`source_${y.replace("-","_")}`],style:a.style,styleSpec:d,objectElementValidators:Yr}),b;case"geojson":if(b=ji({key:l,value:o,valueSpec:d.source_geojson,style:p,styleSpec:d,objectElementValidators:Yr}),o.cluster)for(const C in o.clusterProperties){const[D,T]=o.clusterProperties[C],k="string"==typeof D?[D,["accumulated"],["get",C]]:D;b.push(...ar({key:`${l}.${C}.map`,value:T,expressionContext:"cluster-map"})),b.push(...ar({key:`${l}.${C}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return b;case"video":return ji({key:l,value:o,valueSpec:d.source_video,style:p,styleSpec:d});case"image":return ji({key:l,value:o,valueSpec:d.source_image,style:p,styleSpec:d});case"canvas":return[new Ot(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xl({key:`${l}.type`,value:o.type,valueSpec:{values:No(d)},style:p,styleSpec:d})}}function No(a){return a.source.reduce((o,l)=>{const d=a[l];return"enum"===d.type.type&&(o=o.concat(Object.keys(d.type.values))),o},[])}function Co(a){const o=a.value,l=a.styleSpec,d=l.light,p=a.style;let y=[];const b=Pt(o);if(void 0===o)return y;if("object"!==b)return y=y.concat([new Ot("light",o,`object expected, ${b} found`)]),y;for(const C in o){const D=C.match(/^(.*)-transition$/);y=y.concat(D&&d[D[1]]&&d[D[1]].transition?$i({key:C,value:o[C],valueSpec:l.transition,style:p,styleSpec:l}):d[C]?$i({key:C,value:o[C],valueSpec:d[C],style:p,styleSpec:l}):[new Ot(C,o[C],`unknown property "${C}"`)])}return y}function jd(a){const o=a.value,l=a.key,d=a.style,p=a.styleSpec,y=p.terrain;let b=[];const C=Pt(o);if(void 0===o)return b;if("object"!==C)return b=b.concat([new Ot("terrain",o,`object expected, ${C} found`)]),b;for(const D in o){const T=D.match(/^(.*)-transition$/);b=b.concat(T&&y[T[1]]&&y[T[1]].transition?$i({key:D,value:o[D],valueSpec:p.transition,style:d,styleSpec:p}):y[D]?$i({key:D,value:o[D],valueSpec:y[D],style:d,styleSpec:p}):[new Ot(D,o[D],`unknown property "${D}"`)])}if(o.source){const D=d.sources&&d.sources[o.source],T=D&&Ir(D.type);D?"raster-dem"!==T&&b.push(new Ot(l,o.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):b.push(new Ot(l,o.source,`source "${o.source}" not found`))}else b.push(new Ot(l,o,'terrain is missing required property "source"'));return b}function Cl(a){const o=a.value,l=a.style,d=a.styleSpec,p=d.fog;let y=[];const b=Pt(o);if(void 0===o)return y;if("object"!==b)return y=y.concat([new Ot("fog",o,`object expected, ${b} found`)]),y;for(const C in o){const D=C.match(/^(.*)-transition$/);y=y.concat(D&&p[D[1]]&&p[D[1]].transition?$i({key:C,value:o[C],valueSpec:d.transition,style:l,styleSpec:d}):p[C]?$i({key:C,value:o[C],valueSpec:p[C],style:l,styleSpec:d}):[new Ot(C,o[C],`unknown property "${C}"`)])}return y}const $d={"*":()=>[],array:_c,boolean:function(a){const o=a.value,l=a.key,d=Pt(o);return"boolean"!==d?[new Ot(l,o,`boolean expected, ${d} found`)]:[]},number:Zi,color:function(a){const o=a.key,l=a.value,d=Pt(l);return"string"!==d?[new Ot(o,l,`color expected, ${d} found`)]:null===Td(l)?[new Ot(o,l,`color expected, "${l}" found`)]:[]},enum:xl,filter:vf,function:ms,layer:vc,object:ji,source:av,light:Co,terrain:jd,fog:Cl,string:_s,formatted:function(a){return 0===_s(a).length?[]:ar(a)},resolvedImage:function(a){return 0===_s(a).length?[]:ar(a)},projection:function(a){const o=a.value,l=a.styleSpec,d=l.projection,p=a.style;let y=[];const b=Pt(o);if("object"===b)for(const C in o)y=y.concat($i({key:C,value:o[C],valueSpec:d[C],style:p,styleSpec:l}));else"string"!==b&&(y=y.concat([new Ot("projection",o,`object or string expected, ${b} found`)]));return y}};function $i(a){const o=a.value,l=a.valueSpec,d=a.styleSpec;return l.expression&&Xr(Ir(o))?ms(a):l.expression&&Eu(Zr(o))?ar(a):l.type&&$d[l.type]?$d[l.type](a):ji(Va({},a,{valueSpec:l.type?d[l.type]:l}))}function em(a){const o=a.value,l=a.key,d=_s(a);return d.length||(-1===o.indexOf("{fontstack}")&&d.push(new Ot(l,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&d.push(new Ot(l,o,'"glyphs" url must include a "{range}" token'))),d}function t_(a,o=He){return ys($i({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:em,"*":()=>[]}}))}const lv=a=>ys($s(a)),N1=a=>ys(Su(a));function ys(a){return a.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function n_(a,o){let l=!1;if(o&&o.length)for(const d of o)a.fire(new Ba(new Error(d.message))),l=!0;return l}var z1=Ha,pa=3;function Ha(a,o,l){var d=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var p=new Int32Array(this.arrayBuffer);a=p[0],this.d=(o=p[1])+2*(l=p[2]);for(var y=0;y<this.d*this.d;y++){var b=p[pa+y],C=p[pa+y+1];d.push(b===C?null:p.subarray(b,C))}var D=p[pa+d.length+1];this.keys=p.subarray(p[pa+d.length],D),this.bboxes=p.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var T=0;T<this.d*this.d;T++)d.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var k=l/o*a;this.min=-k,this.max=a+k}Ha.prototype.insert=function(a,o,l,d,p){this._forEachCell(o,l,d,p,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(p)},Ha.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ha.prototype._insertCell=function(a,o,l,d,p,y){this.cells[p].push(y)},Ha.prototype.query=function(a,o,l,d,p){var y=this.min,b=this.max;if(a<=y&&o<=y&&b<=l&&b<=d&&!p)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(a,o,l,d,this._queryCell,C,{},p),C},Ha.prototype._queryCell=function(a,o,l,d,p,y,b,C){var D=this.cells[p];if(null!==D)for(var T=this.keys,k=this.bboxes,L=0;L<D.length;L++){var N=D[L];if(void 0===b[N]){var V=4*N;(C?C(k[V+0],k[V+1],k[V+2],k[V+3]):a<=k[V+2]&&o<=k[V+3]&&l>=k[V+0]&&d>=k[V+1])?(b[N]=!0,y.push(T[N])):b[N]=!1}}},Ha.prototype._forEachCell=function(a,o,l,d,p,y,b,C){for(var D=this._convertToCellCoord(a),T=this._convertToCellCoord(o),k=this._convertToCellCoord(l),L=this._convertToCellCoord(d),N=D;N<=k;N++)for(var V=T;V<=L;V++){var U=this.d*V+N;if((!C||C(this._convertFromCellCoord(N),this._convertFromCellCoord(V),this._convertFromCellCoord(N+1),this._convertFromCellCoord(V+1)))&&p.call(this,a,o,l,d,U,y,b,C))return}},Ha.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ha.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ha.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=pa+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var p=new Int32Array(o+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var y=o,b=0;b<a.length;b++){var C=a[b];p[pa+b]=y,p.set(C,y),y+=C.length}return p[pa+a.length]=y,p.set(this.keys,y),p[pa+a.length+1]=y+=this.keys.length,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer};var Iu=Wo(z1);const tm={};function jt(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),tm[o]={klass:a,omit:l.omit||[]}}jt(Object,"Object"),Iu.serialize=function(a,o){const l=a.toArrayBuffer();return o&&o.push(l),{buffer:l}},Iu.deserialize=function(a){return new Iu(a.buffer)},Object.defineProperty(Iu,"name",{value:"Grid"}),jt(Iu,"Grid"),jt(gr,"Color"),jt(Error,"Error"),jt(za,"AJAXError"),jt(tr,"ResolvedImage"),jt(Ni,"StylePropertyFunction"),jt(gc,"StyleExpression",{omit:["_evaluator"]}),jt($t,"ZoomDependentExpression"),jt(sr,"ZoomConstantExpression"),jt(gl,"CompoundExpression",{omit:["_evaluate"]});for(const a in Bd)tm[Bd[a]._classRegistryKey]||jt(Bd[a],`Expression${a}`);function i_(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function r_(a){return Je.ImageBitmap&&a instanceof Je.ImageBitmap}function Hd(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(i_(a)||r_(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return o&&o.push(l.buffer),l}if(a instanceof Je.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const d of a)l.push(Hd(d,o));return l}if("object"==typeof a){const l=a.constructor,d=l._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);const p=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(const y in a)a.hasOwnProperty(y)&&(tm[d].omit.indexOf(y)>=0||(p[y]=Hd(a[y],o)));a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==d&&(p.$name=d),p}throw new Error("can't serialize object of type "+typeof a)}function Au(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||i_(a)||r_(a)||ArrayBuffer.isView(a)||a instanceof Je.ImageData)return a;if(Array.isArray(a))return a.map(Au);if("object"==typeof a){const o=a.$name||"Object",{klass:l}=tm[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);const d=Object.create(l.prototype);for(const p of Object.keys(a))"$name"!==p&&(d[p]=Au(a[p]));return d}throw new Error("can't deserialize object of type "+typeof a)}const zt={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function o_(a){for(const o of a)if(a_(o.charCodeAt(0)))return!0;return!1}function s_(a){for(const o of a)if(!nm(o.charCodeAt(0)))return!1;return!0}function nm(a){return!(zt.Arabic(a)||zt["Arabic Supplement"](a)||zt["Arabic Extended-A"](a)||zt["Arabic Presentation Forms-A"](a)||zt["Arabic Presentation Forms-B"](a))}function a_(a){return!(746!==a&&747!==a&&(a<4352||!(zt["Bopomofo Extended"](a)||zt.Bopomofo(a)||zt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||zt["CJK Compatibility Ideographs"](a)||zt["CJK Compatibility"](a)||zt["CJK Radicals Supplement"](a)||zt["CJK Strokes"](a)||!(!zt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||zt["CJK Unified Ideographs Extension A"](a)||zt["CJK Unified Ideographs"](a)||zt["Enclosed CJK Letters and Months"](a)||zt["Hangul Compatibility Jamo"](a)||zt["Hangul Jamo Extended-A"](a)||zt["Hangul Jamo Extended-B"](a)||zt["Hangul Jamo"](a)||zt["Hangul Syllables"](a)||zt.Hiragana(a)||zt["Ideographic Description Characters"](a)||zt.Kanbun(a)||zt["Kangxi Radicals"](a)||zt["Katakana Phonetic Extensions"](a)||zt.Katakana(a)&&12540!==a||!(!zt["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!zt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||zt["Unified Canadian Aboriginal Syllabics"](a)||zt["Unified Canadian Aboriginal Syllabics Extended"](a)||zt["Vertical Forms"](a)||zt["Yijing Hexagram Symbols"](a)||zt["Yi Syllables"](a)||zt["Yi Radicals"](a))))}function cv(a){return!(a_(a)||(o=a,zt["Latin-1 Supplement"](o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||zt["General Punctuation"](o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||zt["Letterlike Symbols"](o)||zt["Number Forms"](o)||zt["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||zt["Control Pictures"](o)&&9251!==o||zt["Optical Character Recognition"](o)||zt["Enclosed Alphanumerics"](o)||zt["Geometric Shapes"](o)||zt["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||zt["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||zt["CJK Symbols and Punctuation"](o)||zt.Katakana(o)||zt["Private Use Area"](o)||zt["CJK Compatibility Forms"](o)||zt["Small Form Variants"](o)||zt["Halfwidth and Fullwidth Forms"](o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function uv(a){return a>=1424&&a<=2303||zt["Arabic Presentation Forms-A"](a)||zt["Arabic Presentation Forms-B"](a)}function bc(a,o){return!(!o&&uv(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||zt.Khmer(a))}function l_(a){for(const o of a)if(uv(o.charCodeAt(0)))return!0;return!1}const c_="deferred",Gd="loading",xf="loaded";let Pu=null,g="unavailable",c=null;const f=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(g="error"),Pu&&Pu(a)};function v(){w.fire(new Ls("pluginStateChange",{pluginStatus:g,pluginURL:c}))}const w=new uu,E=function(){return g},I=function(){if(g!==c_||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");g=Gd,v(),c&&lu({url:c},a=>{a?f(a):(g=xf,v())})},O={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>g===xf||null!=O.applyArabicShaping,isLoading:()=>g===Gd,setState(a){g=a.pluginStatus,c=a.pluginURL},isParsed:()=>null!=O.applyArabicShaping&&null!=O.processBidirectionalText&&null!=O.processStyledBidirectionalText,getPluginURL:()=>c};class R{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(l,d){for(const p of l)if(!bc(p.charCodeAt(0),d))return!1;return!0}(o,O.isLoaded())}}class B{constructor(o,l){this.property=o,this.value=l,this.expression=function(d,p){if(Xr(d))return new Ni(d,p);if(Eu(d)){const y=bn(d,p);if("error"===y.result)throw new Error(y.value.map(b=>`${b.key}: ${b.message}`).join(", "));return y.value}{let y=d;return"string"==typeof d&&"color"===p.type&&(y=gr.parse(d)),{kind:"constant",evaluate:()=>y}}}(void 0===l?o.specification.default:l,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,d){return this.property.possiblyEvaluate(this,o,l,d)}}class z{constructor(o){this.property=o,this.value=new B(o,void 0)}transitioned(o,l){return new ee(this.property,this.value,l,Tr({},o.transition,this.transition),o.now)}untransitioned(){return new ee(this.property,this.value,null,{},0)}}class H{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return bo(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new z(this._values[o].property)),this._values[o].value=new B(this._values[o].property,null===l?void 0:bo(l))}getTransition(o){return bo(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new z(this._values[o].property)),this._values[o].transition=bo(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const d=this.getValue(l);void 0!==d&&(o[l]=d);const p=this.getTransition(l);void 0!==p&&(o[`${l}-transition`]=p)}return o}transitioned(o,l){const d=new ie(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].transitioned(o,l._values[p]);return d}untransitioned(){const o=new ie(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class ee{constructor(o,l,d,p,y){const b=p.delay||0,C=p.duration||0;y=y||0,this.property=o,this.value=l,this.begin=y+b,this.end=this.begin+C,o.specification.transition&&(p.delay||p.duration)&&(this.prior=d)}possiblyEvaluate(o,l,d){const p=o.now||0,y=this.value.possiblyEvaluate(o,l,d),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(o,l,d);{const C=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(o,l,d),y,Kh(C))}}return y}}class ie{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,d){const p=new se(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(o,l,d);return p}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class oe{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return bo(this._values[o].value)}setValue(o,l){this._values[o]=new B(this._values[o].property,null===l?void 0:bo(l))}serialize(){const o={};for(const l of Object.keys(this._values)){const d=this.getValue(l);void 0!==d&&(o[l]=d)}return o}possiblyEvaluate(o,l,d){const p=new se(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(o,l,d);return p}}class re{constructor(o,l,d){this.property=o,this.value=l,this.parameters=d}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,d,p){return this.property.evaluate(this.value,this.parameters,o,l,d,p)}}class se{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class G{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,d){const p=dc[this.specification.type];return p?p(o,l,d):o}}class ne{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,d,p){return new re(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},d,p)}:o.expression,l)}interpolate(o,l,d){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new re(this,{kind:"constant",value:void 0},o.parameters);const p=dc[this.specification.type];return p?new re(this,{kind:"constant",value:p(o.value.value,l.value.value,d)},o.parameters):o}evaluate(o,l,d,p,y,b){return"constant"===o.kind?o.value:o.evaluate(l,d,p,y,b)}}class ce{constructor(o){this.specification=o}possiblyEvaluate(o,l,d,p){return!!o.expression.evaluate(l,null,{},d,p)}interpolate(){return!1}}class ue{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new R(0,{});for(const d in o){const p=o[d];p.specification.overridable&&this.overridableProperties.push(d);const y=this.defaultPropertyValues[d]=new B(p,void 0),b=this.defaultTransitionablePropertyValues[d]=new z(p);this.defaultTransitioningPropertyValues[d]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=y.possiblyEvaluate(l)}}}function be(a,o){return 256*(a=Ln(Math.floor(a),0,255))+Ln(Math.floor(o),0,255)}jt(ne,"DataDrivenProperty"),jt(G,"DataConstantProperty"),jt(ce,"ColorRampProperty");const we={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class xe{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ae{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Te(a,o=1){let l=0,d=0;return{members:a.map(p=>{const y=we[p.type].BYTES_PER_ELEMENT,b=l=Ne(l,Math.max(o,y)),C=p.components||1;return d=Math.max(d,y),l+=y*C,{name:p.name,type:p.type,components:C,offset:b}}),size:Ne(l,Math.max(d,o)),alignment:o}}function Ne(a,o){return Math.ceil(a/o)*o}class ut extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const p=2*o;return this.int16[p+0]=l,this.int16[p+1]=d,o}}ut.prototype.bytesPerElement=4,jt(ut,"StructArrayLayout2i4");class Re extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const y=3*o;return this.int16[y+0]=l,this.int16[y+1]=d,this.int16[y+2]=p,o}}Re.prototype.bytesPerElement=6,jt(Re,"StructArrayLayout3i6");class Ze extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p)}emplace(o,l,d,p,y){const b=4*o;return this.int16[b+0]=l,this.int16[b+1]=d,this.int16[b+2]=p,this.int16[b+3]=y,o}}Ze.prototype.bytesPerElement=8,jt(Ze,"StructArrayLayout4i8");class Ve extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,C){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,d,p,y,b,C)}emplace(o,l,d,p,y,b,C,D){const T=6*o,k=12*o,L=3*o;return this.int16[T+0]=l,this.int16[T+1]=d,this.uint8[k+4]=p,this.uint8[k+5]=y,this.uint8[k+6]=b,this.uint8[k+7]=C,this.float32[L+2]=D,o}}Ve.prototype.bytesPerElement=12,jt(Ve,"StructArrayLayout2i4ub1f12");class lt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p)}emplace(o,l,d,p,y){const b=4*o;return this.float32[b+0]=l,this.float32[b+1]=d,this.float32[b+2]=p,this.float32[b+3]=y,o}}lt.prototype.bytesPerElement=16,jt(lt,"StructArrayLayout4f16");class Le extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,p,y)}emplace(o,l,d,p,y,b){const C=6*o,D=3*o;return this.uint16[C+0]=l,this.uint16[C+1]=d,this.uint16[C+2]=p,this.uint16[C+3]=y,this.float32[D+2]=b,o}}Le.prototype.bytesPerElement=12,jt(Le,"StructArrayLayout4ui1f12");class We extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p)}emplace(o,l,d,p,y){const b=4*o;return this.uint16[b+0]=l,this.uint16[b+1]=d,this.uint16[b+2]=p,this.uint16[b+3]=y,o}}We.prototype.bytesPerElement=8,jt(We,"StructArrayLayout4ui8");class nt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b){const C=this.length;return this.resize(C+1),this.emplace(C,o,l,d,p,y,b)}emplace(o,l,d,p,y,b,C){const D=6*o;return this.int16[D+0]=l,this.int16[D+1]=d,this.int16[D+2]=p,this.int16[D+3]=y,this.int16[D+4]=b,this.int16[D+5]=C,o}}nt.prototype.bytesPerElement=12,jt(nt,"StructArrayLayout6i12");class et extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,C,D,T,k,L,N){const V=this.length;return this.resize(V+1),this.emplace(V,o,l,d,p,y,b,C,D,T,k,L,N)}emplace(o,l,d,p,y,b,C,D,T,k,L,N,V){const U=12*o;return this.int16[U+0]=l,this.int16[U+1]=d,this.int16[U+2]=p,this.int16[U+3]=y,this.uint16[U+4]=b,this.uint16[U+5]=C,this.uint16[U+6]=D,this.uint16[U+7]=T,this.int16[U+8]=k,this.int16[U+9]=L,this.int16[U+10]=N,this.int16[U+11]=V,o}}et.prototype.bytesPerElement=24,jt(et,"StructArrayLayout4i4ui4i24");class dt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b){const C=this.length;return this.resize(C+1),this.emplace(C,o,l,d,p,y,b)}emplace(o,l,d,p,y,b,C){const D=10*o,T=5*o;return this.int16[D+0]=l,this.int16[D+1]=d,this.int16[D+2]=p,this.float32[T+2]=y,this.float32[T+3]=b,this.float32[T+4]=C,o}}dt.prototype.bytesPerElement=20,jt(dt,"StructArrayLayout3i3f20");class Et extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}Et.prototype.bytesPerElement=4,jt(Et,"StructArrayLayout1ul4");class on extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,C,D,T,k,L,N,V){const U=this.length;return this.resize(U+1),this.emplace(U,o,l,d,p,y,b,C,D,T,k,L,N,V)}emplace(o,l,d,p,y,b,C,D,T,k,L,N,V,U){const j=20*o,te=10*o;return this.int16[j+0]=l,this.int16[j+1]=d,this.int16[j+2]=p,this.int16[j+3]=y,this.int16[j+4]=b,this.float32[te+3]=C,this.float32[te+4]=D,this.float32[te+5]=T,this.float32[te+6]=k,this.int16[j+14]=L,this.uint32[te+8]=N,this.uint16[j+18]=V,this.uint16[j+19]=U,o}}on.prototype.bytesPerElement=40,jt(on,"StructArrayLayout5i4f1i1ul2ui40");class Ut extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,C){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,d,p,y,b,C)}emplace(o,l,d,p,y,b,C,D){const T=8*o;return this.int16[T+0]=l,this.int16[T+1]=d,this.int16[T+2]=p,this.int16[T+4]=y,this.int16[T+5]=b,this.int16[T+6]=C,this.int16[T+7]=D,o}}Ut.prototype.bytesPerElement=16,jt(Ut,"StructArrayLayout3i2i2i16");class Gt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,p,y)}emplace(o,l,d,p,y,b){const C=4*o,D=8*o;return this.float32[C+0]=l,this.float32[C+1]=d,this.float32[C+2]=p,this.int16[D+6]=y,this.int16[D+7]=b,o}}Gt.prototype.bytesPerElement=16,jt(Gt,"StructArrayLayout2f1f2i16");class Rn extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p)}emplace(o,l,d,p,y){const b=12*o,C=3*o;return this.uint8[b+0]=l,this.uint8[b+1]=d,this.float32[C+1]=p,this.float32[C+2]=y,o}}Rn.prototype.bytesPerElement=12,jt(Rn,"StructArrayLayout2ub2f12");class Dn extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const y=3*o;return this.float32[y+0]=l,this.float32[y+1]=d,this.float32[y+2]=p,o}}Dn.prototype.bytesPerElement=12,jt(Dn,"StructArrayLayout3f12");class qt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const y=3*o;return this.uint16[y+0]=l,this.uint16[y+1]=d,this.uint16[y+2]=p,o}}qt.prototype.bytesPerElement=6,jt(qt,"StructArrayLayout3ui6");class Tn extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,C,D,T,k,L,N,V,U,j,te,q,pe,ae,fe,ge){const _e=this.length;return this.resize(_e+1),this.emplace(_e,o,l,d,p,y,b,C,D,T,k,L,N,V,U,j,te,q,pe,ae,fe,ge)}emplace(o,l,d,p,y,b,C,D,T,k,L,N,V,U,j,te,q,pe,ae,fe,ge,_e){const Fe=30*o,ke=15*o,Ge=60*o;return this.int16[Fe+0]=l,this.int16[Fe+1]=d,this.int16[Fe+2]=p,this.float32[ke+2]=y,this.float32[ke+3]=b,this.uint16[Fe+8]=C,this.uint16[Fe+9]=D,this.uint32[ke+5]=T,this.uint32[ke+6]=k,this.uint32[ke+7]=L,this.uint16[Fe+16]=N,this.uint16[Fe+17]=V,this.uint16[Fe+18]=U,this.float32[ke+10]=j,this.float32[ke+11]=te,this.uint8[Ge+48]=q,this.uint8[Ge+49]=pe,this.uint8[Ge+50]=ae,this.uint32[ke+13]=fe,this.int16[Fe+28]=ge,this.uint8[Ge+58]=_e,o}}Tn.prototype.bytesPerElement=60,jt(Tn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class _i extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y,b,C,D,T,k,L,N,V,U,j,te,q,pe,ae,fe,ge,_e,Fe,ke,Ge,ct,ze,Qe,Ye,at){const pt=this.length;return this.resize(pt+1),this.emplace(pt,o,l,d,p,y,b,C,D,T,k,L,N,V,U,j,te,q,pe,ae,fe,ge,_e,Fe,ke,Ge,ct,ze,Qe,Ye,at)}emplace(o,l,d,p,y,b,C,D,T,k,L,N,V,U,j,te,q,pe,ae,fe,ge,_e,Fe,ke,Ge,ct,ze,Qe,Ye,at,pt){const $e=38*o,Mt=19*o;return this.int16[$e+0]=l,this.int16[$e+1]=d,this.int16[$e+2]=p,this.float32[Mt+2]=y,this.float32[Mt+3]=b,this.int16[$e+8]=C,this.int16[$e+9]=D,this.int16[$e+10]=T,this.int16[$e+11]=k,this.int16[$e+12]=L,this.int16[$e+13]=N,this.uint16[$e+14]=V,this.uint16[$e+15]=U,this.uint16[$e+16]=j,this.uint16[$e+17]=te,this.uint16[$e+18]=q,this.uint16[$e+19]=pe,this.uint16[$e+20]=ae,this.uint16[$e+21]=fe,this.uint16[$e+22]=ge,this.uint16[$e+23]=_e,this.uint16[$e+24]=Fe,this.uint16[$e+25]=ke,this.uint16[$e+26]=Ge,this.uint16[$e+27]=ct,this.uint16[$e+28]=ze,this.uint32[Mt+15]=Qe,this.float32[Mt+16]=Ye,this.float32[Mt+17]=at,this.float32[Mt+18]=pt,o}}_i.prototype.bytesPerElement=76,jt(_i,"StructArrayLayout3i2f6i15ui1ul3f76");class yi extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}yi.prototype.bytesPerElement=4,jt(yi,"StructArrayLayout1f4");class vi extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,p,y)}emplace(o,l,d,p,y,b){const C=5*o;return this.float32[C+0]=l,this.float32[C+1]=d,this.float32[C+2]=p,this.float32[C+3]=y,this.float32[C+4]=b,o}}vi.prototype.bytesPerElement=20,jt(vi,"StructArrayLayout5f20");class lr extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p)}emplace(o,l,d,p,y){const b=6*o;return this.uint32[3*o+0]=l,this.uint16[b+2]=d,this.uint16[b+3]=p,this.uint16[b+4]=y,o}}lr.prototype.bytesPerElement=12,jt(lr,"StructArrayLayout1ul3ui12");class $r extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const p=2*o;return this.uint16[p+0]=l,this.uint16[p+1]=d,o}}$r.prototype.bytesPerElement=4,jt($r,"StructArrayLayout2ui4");class vs extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}vs.prototype.bytesPerElement=2,jt(vs,"StructArrayLayout1ui2");class Hs extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const p=2*o;return this.float32[p+0]=l,this.float32[p+1]=d,o}}Hs.prototype.bytesPerElement=8,jt(Hs,"StructArrayLayout2f8");class zi extends xe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}zi.prototype.size=40;class fi extends on{get(o){return new zi(this,o)}}jt(fi,"CollisionBoxArray");class Jn extends xe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}Jn.prototype.size=60;class Yt extends Tn{get(o){return new Jn(this,o)}}jt(Yt,"PlacedSymbolArray");class ho extends xe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ho.prototype.size=76;class Hi extends _i{get(o){return new ho(this,o)}}jt(Hi,"SymbolInstanceArray");class zo extends yi{getoffsetX(o){return this.float32[1*o+0]}}jt(zo,"GlyphOffsetArray");class wf extends ut{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}jt(wf,"SymbolLineVertexArray");class xc extends xe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}xc.prototype.size=12;class Ou extends lr{get(o){return new xc(this,o)}}jt(Ou,"FeatureIndexArray");class Bo extends $r{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}jt(Bo,"FillExtrusionCentroidArray");const El=Te([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),wc=Te([{name:"a_dash",components:4,type:"Uint16"}]);var Cf={exports:{}},li=function(a,o){var l,d,p,y,b,C,D,T;for(d=a.length-(l=3&a.length),p=o,b=3432918353,C=461845907,T=0;T<d;)D=255&a.charCodeAt(T)|(255&a.charCodeAt(++T))<<8|(255&a.charCodeAt(++T))<<16|(255&a.charCodeAt(++T))<<24,++T,p=27492+(65535&(y=5*(65535&(p=(p^=D=(65535&(D=(D=(65535&D)*b+(((D>>>16)*b&65535)<<16)&4294967295)<<15|D>>>17))*C+(((D>>>16)*C&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(D=0,l){case 3:D^=(255&a.charCodeAt(T+2))<<16;case 2:D^=(255&a.charCodeAt(T+1))<<8;case 1:p^=D=(65535&(D=(D=(65535&(D^=255&a.charCodeAt(T)))*b+(((D>>>16)*b&65535)<<16)&4294967295)<<15|D>>>17))*C+(((D>>>16)*C&65535)<<16)&4294967295}return p^=a.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0},Ef=function(a,o){for(var l,d=a.length,p=o^d,y=0;d>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(y)|(255&a.charCodeAt(++y))<<8|(255&a.charCodeAt(++y))<<16|(255&a.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:p^=(255&a.charCodeAt(y+2))<<16;case 2:p^=(255&a.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&a.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};Cf.exports=li,Cf.exports.murmur3=li,Cf.exports.murmur2=Ef;var ku=Wo(Cf.exports);class Kr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,l,d,p){this.ids.push(dv(o)),this.positions.push(l,d,p)}getPositions(o){const l=dv(o);let d=0,p=this.ids.length-1;for(;d<p;){const b=d+p>>1;this.ids[b]>=l?p=b:d=b+1}const y=[];for(;this.ids[d]===l;)y.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return y}static serialize(o,l){const d=new Float64Array(o.ids),p=new Uint32Array(o.positions);return Wd(d,p,0,d.length-1),l&&l.push(d.buffer,p.buffer),{ids:d,positions:p}}static deserialize(o){const l=new Kr;return l.ids=o.ids,l.positions=o.positions,l.indexed=!0,l}}function dv(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:ku(String(a))}function Wd(a,o,l,d){for(;l<d;){const p=a[l+d>>1];let y=l-1,b=d+1;for(;;){do{y++}while(a[y]<p);do{b--}while(a[b]>p);if(y>=b)break;Gs(a,y,b),Gs(o,3*y,3*b),Gs(o,3*y+1,3*b+1),Gs(o,3*y+2,3*b+2)}b-l<d-b?(Wd(a,o,l,b),l=b+1):(Wd(a,o,b+1,d),d=b)}}function Gs(a,o,l){const d=a[o];a[o]=a[l],a[l]=d}jt(Kr,"FeaturePositionMap");class Ga{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}}class Mf extends Ga{constructor(o){super(o),this.current=0}set(o,l,d){this.fetchUniformLocation(o,l)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class B1 extends Ga{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class JD extends Ga{constructor(o){super(o),this.current=gr.transparent}set(o,l,d){this.fetchUniformLocation(o,l)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const V1=new Float32Array(16),Jo=new Float32Array(9),Cc=new Float32Array(4);function u_(a){return[be(255*a.r,255*a.g),be(255*a.b,255*a.a)]}class Ml{constructor(o,l,d){this.value=o,this.uniformNames=l.map(p=>`u_${p}`),this.type=d}setUniform(o,l,d,p,y){l.set(o,y,p.constantOr(this.value))}getBinding(o,l){return"color"===this.type?new JD(o):new Mf(o)}}class bs{constructor(o,l){this.uniformNames=l.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,d,p,y){const b="u_pattern"===y||"u_dash"===y?this.pattern:"u_pixel_ratio"===y?this.pixelRatio:null;b&&l.set(o,y,b)}getBinding(o,l){return"u_pattern"===l||"u_dash"===l?new B1(o):new Mf(o)}}class Ec{constructor(o,l,d,p){this.expression=o,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===d?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(o,l,d,p,y,b){const C=this.paintVertexArray.length,D=this.expression.evaluate(new R(0),l,{},y,p,b);this.paintVertexArray.resize(o),this._setPaintValue(C,o,D)}updatePaintArray(o,l,d,p,y){const b=this.expression.evaluate({zoom:0},d,p,void 0,y);this._setPaintValue(o,l,b)}_setPaintValue(o,l,d){if("color"===this.type){const p=u_(d);for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=o;p<l;p++)this.paintVertexArray.emplace(p,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ma{constructor(o,l,d,p,y,b){this.expression=o,this.uniformNames=l.map(C=>`u_${C}_t`),this.type=d,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=l.map(C=>({name:`a_${C}`,type:"Float32",components:"color"===d?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(o,l,d,p,y,b){const C=this.expression.evaluate(new R(this.zoom),l,{},y,p,b),D=this.expression.evaluate(new R(this.zoom+1),l,{},y,p,b),T=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(T,o,C,D)}updatePaintArray(o,l,d,p,y){const b=this.expression.evaluate({zoom:this.zoom},d,p,void 0,y),C=this.expression.evaluate({zoom:this.zoom+1},d,p,void 0,y);this._setPaintValue(o,l,b,C)}_setPaintValue(o,l,d,p){if("color"===this.type){const y=u_(d),b=u_(p);for(let C=o;C<l;C++)this.paintVertexArray.emplace(C,y[0],y[1],b[0],b[1])}else{for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,d,p);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,d,p,y){const b=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,C=Ln(this.expression.interpolationFactor(b,this.zoom,this.zoom+1),0,1);l.set(o,y,C)}getBinding(o,l){return new Mf(o)}}class Ru{constructor(o,l,d,p,y){this.expression=o,this.layerId=y,this.paintVertexAttributes=("array"===d?wc:El).members;for(let b=0;b<l.length;++b);this.paintVertexArray=new p}populatePaintArray(o,l,d){const p=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(p,o,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(o,l,d,p,y,b){this._setPaintValues(o,l,d.patterns&&d.patterns[this.layerId],b)}_setPaintValues(o,l,d,p){if(!p||!d)return;const y=p[d];if(!y)return;const{tl:b,br:C,pixelRatio:D}=y;for(let T=o;T<l;T++)this.paintVertexArray.emplace(T,b[0],b[1],C[0],C[1],D)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Lu{constructor(o,l,d=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const y in o.paint._values){if(!d(y))continue;const b=o.paint.get(y);if(!(b instanceof re&&Wi(b.property.specification)))continue;const C=U1(y,o.type),D=b.value,T=b.property.specification.type,k=!!b.property.useIntegerZoom,L="line-dasharray"===y||y.endsWith("pattern"),N="line-dasharray"===y&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==D.kind||N)if("source"===D.kind||N||L){const V=pv(y,T,"source");this.binders[y]=L?new Ru(D,C,T,V,o.id):new Ec(D,C,T,V),p.push(`/a_${y}`)}else{const V=pv(y,T,"composite");this.binders[y]=new ma(D,C,T,k,l,V),p.push(`/z_${y}`)}else this.binders[y]=L?new bs(D.value,C):new Ml(D.value,C,T),p.push(`/u_${y}`)}this.cacheKey=p.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof Ec||l instanceof ma?l.maxValue:0}populatePaintArrays(o,l,d,p,y,b){for(const C in this.binders){const D=this.binders[C];(D instanceof Ec||D instanceof ma||D instanceof Ru)&&D.populatePaintArray(o,l,d,p,y,b)}}setConstantPatternPositions(o){for(const l in this.binders){const d=this.binders[l];d instanceof bs&&d.setConstantPatternPositions(o)}}updatePaintArrays(o,l,d,p,y,b){let C=!1;for(const D in o){const T=l.getPositions(D);for(const k of T){const L=d.feature(k.index);for(const N in this.binders){const V=this.binders[N];if((V instanceof Ec||V instanceof ma||V instanceof Ru)&&!0===V.expression.isStateDependent){const U=p.paint.get(N);V.expression=U.value,V.updatePaintArray(k.start,k.end,L,o[D],y,b),C=!0}}}}return C}defines(){const o=[];for(const l in this.binders){const d=this.binders[l];(d instanceof Ml||d instanceof bs)&&o.push(...d.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Ec||d instanceof ma||d instanceof Ru)for(let p=0;p<d.paintVertexAttributes.length;p++)o.push(d.paintVertexAttributes[p].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Ml||d instanceof bs||d instanceof ma)for(const p of d.uniformNames)o.push(p)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const d in this.binders){const p=this.binders[d];if(p instanceof Ml||p instanceof bs||p instanceof ma)for(const y of p.uniformNames)l.push({name:y,property:d,binding:p.getBinding(o,y)})}return l}setUniforms(o,l,d,p,y){for(const{name:b,property:C,binding:D}of d)this.binders[C].setUniform(o,D,y,p.get(C),b)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof Ec||l instanceof ma||l instanceof Ru)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const d=this.binders[l];(d instanceof Ec||d instanceof ma||d instanceof Ru)&&d.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof Ec||l instanceof ma||l instanceof Ru)&&l.destroy()}}}class Mc{constructor(o,l,d=(()=>!0)){this.programConfigurations={};for(const p of o)this.programConfigurations[p.id]=new Lu(p,l,d);this.needsUpload=!1,this._featureMap=new Kr,this._bufferOffset=0}populatePaintArrays(o,l,d,p,y,b,C){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(o,l,p,y,b,C);void 0!==l.id&&this._featureMap.add(l.id,d,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,d,p,y){for(const b of d)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(o,this._featureMap,l,b,p,y)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const hv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function U1(a,o){return hv[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const fv={"line-pattern":{source:Le,composite:Le},"fill-pattern":{source:Le,composite:Le},"fill-extrusion-pattern":{source:Le,composite:Le},"line-dasharray":{source:We,composite:We}},eT={color:{source:Hs,composite:lt},number:{source:yi,composite:Hs}};function pv(a,o,l){const d=fv[a];return d&&d[l]||eT[o][l]}jt(Ml,"ConstantBinder"),jt(bs,"PatternConstantBinder"),jt(Ec,"SourceExpressionBinder"),jt(Ru,"PatternCompositeBinder"),jt(ma,"CompositeExpressionBinder"),jt(Lu,"ProgramConfiguration",{omit:["_buffers"]}),jt(Mc,"ProgramConfigurationSet");const d_="-transition";class ga extends uu{constructor(o,l){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),l.layout&&(this._unevaluatedLayout=new oe(l.layout)),l.paint)){this._transitionablePaint=new H(l.paint);for(const d in o.paint)this.setPaintProperty(d,o.paint[d],{validate:!1});for(const d in o.layout)this.setLayoutProperty(d,o.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new se(l.paint)}}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l,d={}){null!=l&&this._validate(N1,`layers.${this.id}.layout.${o}`,o,l,d)||("visibility"!==o?this._unevaluatedLayout.setValue(o,l):this.visibility=l)}getPaintProperty(o){return Mi(o,d_)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l,d={}){if(null!=l&&this._validate(lv,`layers.${this.id}.paint.${o}`,o,l,d))return!1;if(Mi(o,d_))return this._transitionablePaint.setTransition(o.slice(0,-11),l||void 0),!1;{const p=this._transitionablePaint._values[o],y=p.value.isDataDriven(),b=p.value;this._transitionablePaint.setValue(o,l),this._handleSpecialPaintPropertyUpdate(o);const C=this._transitionablePaint._values[o].value,D=C.isDataDriven(),T=Mi(o,"pattern")||"line-dasharray"===o;return D||y||T||this._handleOverridablePaintPropertyUpdate(o,b,C)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,l,d){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Un(o,(l,d)=>!(void 0===l||"layout"===d&&!Object.keys(l).length||"paint"===d&&!Object.keys(l).length))}_validate(o,l,d,p,y={}){return(!y||!1!==y.validate)&&n_(this,o.call(t_,{key:l,layerType:this.type,objectKey:d,value:p,styleSpec:He,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof re&&Wi(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=$a(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const j1=Te([{name:"a_pos",components:2,type:"Int16"}],4),$1=Te([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class vr{constructor(o=[]){this.segments=o}prepareSegment(o,l,d,p){let y=this.segments[this.segments.length-1];return o>vr.MAX_VERTEX_ARRAY_LENGTH&&Fi(`Max vertices per segment is ${vr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!y||y.vertexLength+o>vr.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:l.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},void 0!==p&&(y.sortKey=p),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,d,p){return new vr([{vertexOffset:o,primitiveOffset:l,vertexLength:d,primitiveLength:p,vaos:{},sortKey:0}])}}vr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jt(vr,"SegmentVector");var en=8192;class Fu{constructor(o,l){o&&(l?this.setSouthWest(o).setNorthEast(l):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof bi?new bi(o.lng,o.lat):bi.convert(o),this}setSouthWest(o){return this._sw=o instanceof bi?new bi(o.lng,o.lat):bi.convert(o),this}extend(o){const l=this._sw,d=this._ne;let p,y;if(o instanceof bi)p=o,y=o;else{if(!(o instanceof Fu))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(Fu.convert(o)):this.extend(bi.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(bi.convert(o)):this;if(p=o._sw,y=o._ne,!p||!y)return this}return l||d?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new bi(p.lng,p.lat),this._ne=new bi(y.lng,y.lat)),this}getCenter(){return new bi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new bi(this.getWest(),this.getNorth())}getSouthEast(){return new bi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:d}=bi.convert(o);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}static convert(o){return!o||o instanceof Fu?o:new Fu(o)}}var h_=1e-6,Gi=typeof Float32Array<"u"?Float32Array:Array;function Nu(){var a=new Gi(9);return Gi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function br(a,o,l){var d=o[0],p=o[1],y=o[2],b=o[3],C=o[4],D=o[5],T=o[6],k=o[7],L=o[8],N=l[0],V=l[1],U=l[2],j=l[3],te=l[4],q=l[5],pe=l[6],ae=l[7],fe=l[8];return a[0]=N*d+V*b+U*T,a[1]=N*p+V*C+U*k,a[2]=N*y+V*D+U*L,a[3]=j*d+te*b+q*T,a[4]=j*p+te*C+q*k,a[5]=j*y+te*D+q*L,a[6]=pe*d+ae*b+fe*T,a[7]=pe*p+ae*C+fe*k,a[8]=pe*y+ae*D+fe*L,a}function qa(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function mv(a,o){var l=o[0],d=o[1],p=o[2],y=o[3],b=o[4],C=o[5],D=o[6],T=o[7],k=o[8],L=o[9],N=o[10],V=o[11],U=o[12],j=o[13],te=o[14],q=o[15],pe=l*C-d*b,ae=l*D-p*b,fe=l*T-y*b,ge=d*D-p*C,_e=d*T-y*C,Fe=p*T-y*D,ke=k*j-L*U,Ge=k*te-N*U,ct=k*q-V*U,ze=L*te-N*j,Qe=L*q-V*j,Ye=N*q-V*te,at=pe*Ye-ae*Qe+fe*ze+ge*ct-_e*Ge+Fe*ke;return at?(a[0]=(C*Ye-D*Qe+T*ze)*(at=1/at),a[1]=(p*Qe-d*Ye-y*ze)*at,a[2]=(j*Fe-te*_e+q*ge)*at,a[3]=(N*_e-L*Fe-V*ge)*at,a[4]=(D*ct-b*Ye-T*Ge)*at,a[5]=(l*Ye-p*ct+y*Ge)*at,a[6]=(te*fe-U*Fe-q*ae)*at,a[7]=(k*Fe-N*fe+V*ae)*at,a[8]=(b*Qe-C*ct+T*ke)*at,a[9]=(d*ct-l*Qe-y*ke)*at,a[10]=(U*_e-j*fe+q*pe)*at,a[11]=(L*fe-k*_e-V*pe)*at,a[12]=(C*Ge-b*ze-D*ke)*at,a[13]=(l*ze-d*Ge+p*ke)*at,a[14]=(j*ae-U*ge-te*pe)*at,a[15]=(k*ge-L*ae+N*pe)*at,a):null}function Zd(a,o,l){var d=o[0],p=o[1],y=o[2],b=o[3],C=o[4],D=o[5],T=o[6],k=o[7],L=o[8],N=o[9],V=o[10],U=o[11],j=o[12],te=o[13],q=o[14],pe=o[15],ae=l[0],fe=l[1],ge=l[2],_e=l[3];return a[0]=ae*d+fe*C+ge*L+_e*j,a[1]=ae*p+fe*D+ge*N+_e*te,a[2]=ae*y+fe*T+ge*V+_e*q,a[3]=ae*b+fe*k+ge*U+_e*pe,a[4]=(ae=l[4])*d+(fe=l[5])*C+(ge=l[6])*L+(_e=l[7])*j,a[5]=ae*p+fe*D+ge*N+_e*te,a[6]=ae*y+fe*T+ge*V+_e*q,a[7]=ae*b+fe*k+ge*U+_e*pe,a[8]=(ae=l[8])*d+(fe=l[9])*C+(ge=l[10])*L+(_e=l[11])*j,a[9]=ae*p+fe*D+ge*N+_e*te,a[10]=ae*y+fe*T+ge*V+_e*q,a[11]=ae*b+fe*k+ge*U+_e*pe,a[12]=(ae=l[12])*d+(fe=l[13])*C+(ge=l[14])*L+(_e=l[15])*j,a[13]=ae*p+fe*D+ge*N+_e*te,a[14]=ae*y+fe*T+ge*V+_e*q,a[15]=ae*b+fe*k+ge*U+_e*pe,a}function rm(a,o,l){var d,p,y,b,C,D,T,k,L,N,V,U,j=l[0],te=l[1],q=l[2];return o===a?(a[12]=o[0]*j+o[4]*te+o[8]*q+o[12],a[13]=o[1]*j+o[5]*te+o[9]*q+o[13],a[14]=o[2]*j+o[6]*te+o[10]*q+o[14],a[15]=o[3]*j+o[7]*te+o[11]*q+o[15]):(p=o[1],y=o[2],b=o[3],C=o[4],D=o[5],T=o[6],k=o[7],L=o[8],N=o[9],V=o[10],U=o[11],a[0]=d=o[0],a[1]=p,a[2]=y,a[3]=b,a[4]=C,a[5]=D,a[6]=T,a[7]=k,a[8]=L,a[9]=N,a[10]=V,a[11]=U,a[12]=d*j+C*te+L*q+o[12],a[13]=p*j+D*te+N*q+o[13],a[14]=y*j+T*te+V*q+o[14],a[15]=b*j+k*te+U*q+o[15]),a}function zu(a,o,l){var d=l[0],p=l[1],y=l[2];return a[0]=o[0]*d,a[1]=o[1]*d,a[2]=o[2]*d,a[3]=o[3]*d,a[4]=o[4]*p,a[5]=o[5]*p,a[6]=o[6]*p,a[7]=o[7]*p,a[8]=o[8]*y,a[9]=o[9]*y,a[10]=o[10]*y,a[11]=o[11]*y,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function f_(a,o,l){var d=Math.sin(l),p=Math.cos(l),y=o[4],b=o[5],C=o[6],D=o[7],T=o[8],k=o[9],L=o[10],N=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=y*p+T*d,a[5]=b*p+k*d,a[6]=C*p+L*d,a[7]=D*p+N*d,a[8]=T*p-y*d,a[9]=k*p-b*d,a[10]=L*p-C*d,a[11]=N*p-D*d,a}function Xd(a,o,l){var d=Math.sin(l),p=Math.cos(l),y=o[0],b=o[1],C=o[2],D=o[3],T=o[8],k=o[9],L=o[10],N=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=y*p-T*d,a[1]=b*p-k*d,a[2]=C*p-L*d,a[3]=D*p-N*d,a[8]=y*d+T*p,a[9]=b*d+k*p,a[10]=C*d+L*p,a[11]=D*d+N*p,a}function Dc(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function H1(a,o,l){var d,p,y,b=l[0],C=l[1],D=l[2],T=Math.hypot(b,C,D);return T<h_?null:(b*=T=1/T,C*=T,D*=T,d=Math.sin(o),p=Math.cos(o),a[0]=b*b*(y=1-p)+p,a[1]=C*b*y+D*d,a[2]=D*b*y-C*d,a[3]=0,a[4]=b*C*y-D*d,a[5]=C*C*y+p,a[6]=D*C*y+b*d,a[7]=0,a[8]=b*D*y+C*d,a[9]=C*D*y-b*d,a[10]=D*D*y+p,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var p_=Zd;function Df(){var a=new Gi(3);return Gi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function om(a){var o=new Gi(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function Yd(a){return Math.hypot(a[0],a[1],a[2])}function Kd(a,o,l){var d=new Gi(3);return d[0]=a,d[1]=o,d[2]=l,d}function Dl(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a}function gv(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function Qd(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function Tc(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a}function sm(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a}function _a(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a}function Jd(a,o,l,d){return a[0]=o[0]+l[0]*d,a[1]=o[1]+l[1]*d,a[2]=o[2]+l[2]*d,a}function es(a,o){var l=o[0],d=o[1],p=o[2],y=l*l+d*d+p*p;return y>0&&(y=1/Math.sqrt(y)),a[0]=o[0]*y,a[1]=o[1]*y,a[2]=o[2]*y,a}function ya(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function _v(a,o,l){var d=o[0],p=o[1],y=o[2],b=l[0],C=l[1],D=l[2];return a[0]=p*D-y*C,a[1]=y*b-d*D,a[2]=d*C-p*b,a}function Pr(a,o,l){var d=o[0],p=o[1],y=o[2],b=l[3]*d+l[7]*p+l[11]*y+l[15];return a[0]=(l[0]*d+l[4]*p+l[8]*y+l[12])/(b=b||1),a[1]=(l[1]*d+l[5]*p+l[9]*y+l[13])/b,a[2]=(l[2]*d+l[6]*p+l[10]*y+l[14])/b,a}function tT(a,o,l){var d=l[0],p=l[1],y=l[2],b=o[0],C=o[1],D=o[2],T=p*D-y*C,k=y*b-d*D,L=d*C-p*b,N=p*L-y*k,V=y*T-d*L,U=d*k-p*T,j=2*l[3];return k*=j,L*=j,V*=2,U*=2,a[0]=b+(T*=j)+(N*=2),a[1]=C+k+V,a[2]=D+L+U,a}var eh,ts=gv,nT=Qd,am=Yd;function m_(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a}function lm(a,o){var l=o[0],d=o[1],p=o[2],y=o[3],b=l*l+d*d+p*p+y*y;return b>0&&(b=1/Math.sqrt(b)),a[0]=l*b,a[1]=d*b,a[2]=p*b,a[3]=y*b,a}function Tf(a,o,l){var d=o[0],p=o[1],y=o[2],b=o[3];return a[0]=l[0]*d+l[4]*p+l[8]*y+l[12]*b,a[1]=l[1]*d+l[5]*p+l[9]*y+l[13]*b,a[2]=l[2]*d+l[6]*p+l[10]*y+l[14]*b,a[3]=l[3]*d+l[7]*p+l[11]*y+l[15]*b,a}function yv(){var a=new Gi(4);return Gi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function vv(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function G1(a,o,l){l*=.5;var d=o[0],p=o[1],y=o[2],b=o[3],C=Math.sin(l),D=Math.cos(l);return a[0]=d*D+b*C,a[1]=p*D+y*C,a[2]=y*D-p*C,a[3]=b*D-d*C,a}function Wa(a,o,l){l*=.5;var d=o[0],p=o[1],y=o[2],b=o[3],C=Math.sin(l),D=Math.cos(l);return a[0]=d*D-y*C,a[1]=p*D+b*C,a[2]=y*D+d*C,a[3]=b*D-p*C,a}Df(),eh=new Gi(4),Gi!=Float32Array&&(eh[0]=0,eh[1]=0,eh[2]=0,eh[3]=0);var iT=lm;Df(),Kd(1,0,0),Kd(0,1,0),yv(),yv(),Nu();const g_=Te([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:__}=g_,bv=Te([{name:"a_pos_3",components:3,type:"Int16"}]);var Bu=Te([{name:"a_pos",type:"Int16",components:2}]);class cm{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,d){const p=ya(l,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/p;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,d[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(o,l,d){if(j=(V=this.pos)[0],te=V[1],q=V[2],pe=(U=o)[0],ae=U[1],fe=U[2],Math.abs(j-pe)<=h_*Math.max(1,Math.abs(j),Math.abs(pe))&&Math.abs(te-ae)<=h_*Math.max(1,Math.abs(te),Math.abs(ae))&&Math.abs(q-fe)<=h_*Math.max(1,Math.abs(q),Math.abs(fe))||0===l)return d[0]=d[1]=d[2]=0,!1;var V,U,j,te,q,pe,ae,fe;const[p,y,b]=this.dir,C=this.pos[0]-o[0],D=this.pos[1]-o[1],T=this.pos[2]-o[2],k=p*p+y*y+b*b,L=2*(C*p+D*y+T*b),N=L*L-4*k*(C*C+D*D+T*T-l*l);if(N<0){const V=Math.max(-L/2,0),U=C+p*V,j=D+y*V,te=T+b*V,q=Math.hypot(U,j,te);return d[0]=U*l/q,d[1]=j*l/q,d[2]=te*l/q,!1}{const V=(-L-Math.sqrt(N))/(2*k);if(V<0){const U=Math.hypot(C,D,T);return d[0]=C*l/U,d[1]=D*l/U,d[2]=T*l/U,!1}return d[0]=C+p*V,d[1]=D+y*V,d[2]=T+b*V,!0}}}class xv{constructor(o,l,d,p,y){this.TL=o,this.TR=l,this.BR=d,this.BL=p,this.horizon=y}static fromInvProjectionMatrix(o,l,d){const p=[-1,1,1],y=[1,1,1],b=[1,-1,1],C=[-1,-1,1],D=Pr(p,p,o),T=Pr(y,y,o),k=Pr(b,b,o),L=Pr(C,C,o);return new xv(D,T,k,L,l/d)}}class y_{constructor(o,l){this.points=o,this.planes=l}static fromInvProjectionMatrix(o,l,d,p){const y=Math.pow(2,d),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const T=Tf([],D,o),k=1/T[3]/l*y;return(L=T)[0]=(N=T)[0]*(V=[k,k,p?1/T[3]:k,k])[0],L[1]=N[1]*V[1],L[2]=N[2]*V[2],L[3]=N[3]*V[3],L;var L,N,V}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const T=es([],_v([],ts([],b[D[0]],b[D[1]]),ts([],b[D[2]],b[D[1]]))),k=-ya(T,b[D[1]]);return T.concat(k)});return new y_(b,C)}}class Eo{static fromPoints(o){const l=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const p of o)Tc(l,l,p),sm(d,d,p);return new Eo(l,d)}static applyTransform(o,l){const d=o.getCorners();for(let p=0;p<d.length;++p)Pr(d[p],d[p],l);return Eo.fromPoints(d)}constructor(o,l){this.min=o,this.max=l,this.center=_a([],Dl([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],d=om(this.min),p=om(this.max);for(let y=0;y<l.length;y++)d[y]=l[y]?this.min[y]:this.center[y],p[y]=l[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new Eo(d,p)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){const l=this.getCorners();let d=!0;for(let p=0;p<o.planes.length;p++){const y=o.planes[p];let b=0;for(let C=0;C<l.length;C++)b+=ya(y,l[C])+y[3]>=0;if(0===b)return 0;b!==l.length&&(d=!1)}if(d)return 2;for(let p=0;p<3;p++){let y=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let C=0;C<o.points.length;C++){const D=o.points[C][p]-this.min[p];y=Math.min(y,D),b=Math.max(b,D)}if(b<0||y>this.max[p]-this.min[p])return 0}return 1}}const v_=5,wv=6,Tl=en/Math.PI/2,b_=16383,um=[64,32,16],Ws=-Tl,Zs=Tl,dm=[new Eo([Ws,Ws,Ws],[Zs,Zs,Zs]),new Eo([Ws,Ws,Ws],[0,0,Zs]),new Eo([0,Ws,Ws],[Zs,0,Zs]),new Eo([Ws,0,Ws],[0,Zs,Zs]),new Eo([0,0,Ws],[Zs,Zs,Zs])];function x_(a){return a*Tl/Or}function Vo(a,o,l,d=!0){const p=_a([],a._camera.position,a.worldSize),y=[o,l,1,1];Tf(y,y,a.pixelMatrixInverse),m_(y,y,1/y[3]);const b=es([],ts([],y,p)),C=a.globeMatrix,D=[C[12],C[13],C[14]],T=ts([],D,p),k=Yd(T),L=es([],T),N=a.worldSize/(2*Math.PI),V=ya(L,b),U=Math.asin(N/k);if(U<Math.acos(V)){if(!d)return null;const ct=[],ze=[];_a(ct,b,k/V),es(ze,ts(ze,ct,T)),es(b,Dl(b,T,_a(b,ze,Math.tan(U)*k)))}const j=[];new cm(p,b).closestPointOnSphere(D,N,j);const te=es([],hl(C,0)),q=es([],hl(C,1)),pe=es([],hl(C,2)),ae=ya(te,j),fe=ya(q,j),ge=ya(pe,j),_e=qr(Math.asin(-fe/N));let Fe=qr(Math.atan2(ae,ge));Fe=a.center.lng+function(ct,ze){const Qe=(ze-ct+180)%360-180;return Qe<-180?Qe+360:Qe}(a.center.lng,Fe);const ke=ns(Fe),Ge=Ln(Za(_e),0,1);return new mo(ke,Ge)}class rT{constructor(o,l,d){this.a=ts([],o,d),this.b=ts([],l,d),this.center=d;const p=es([],this.a),y=es([],this.b);this.angle=Math.acos(ya(p,y))}}function no(a,o){if(0===a.angle)return null;let l;return l=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(d,p,y,b){const C=Math.sin(y);return d*(Math.sin((1-b)*y)/C)+p*(Math.sin(b*y)/C)}(a.a[o],a.b[o],a.angle,Ln(l,0,1))+a.center[o]}function va(a){if(a.z<=1)return dm[a.z+2*a.y+a.x];const o=Vu(Sc(a));return Eo.fromPoints(o)}function th(a,o,l){return _a(a,a,1-l),Jd(a,a,o,l)}function Cv(a,o){const l=fm(o.zoom);if(0===l)return va(a);const d=Sc(a),p=Vu(d),y=ns(d.getWest())*o.worldSize,b=ns(d.getEast())*o.worldSize,C=Za(d.getNorth())*o.worldSize,D=Za(d.getSouth())*o.worldSize,T=[y,C,0],k=[b,C,0],L=[y,D,0],N=[b,D,0],V=mv([],o.globeMatrix);return Pr(T,T,V),Pr(k,k,V),Pr(L,L,V),Pr(N,N,V),p[0]=th(p[0],L,l),p[1]=th(p[1],N,l),p[2]=th(p[2],k,l),p[3]=th(p[3],T,l),Eo.fromPoints(p)}function hm(a,o,l){for(const d of a)Pr(d,d,o),_a(d,d,l)}function Sc({x:a,y:o,z:l}){const d=1/(1<<l),p=new bi(Mo(a*d),fo((o+1)*d)),y=new bi(Mo((a+1)*d),fo(o*d));return new Fu(p,y)}function Vu(a){const o=Pn(a.getNorth()),l=Pn(a.getSouth()),d=Math.cos(o),p=Math.cos(l),y=Math.sin(o),b=Math.sin(l),C=a.getWest(),D=a.getEast();return[nh(p,b,C),nh(p,b,D),nh(d,y,D),nh(d,y,C)]}function nh(a,o,l,d=Tl){return l=Pn(l),[a*Math.sin(l)*d,-o*d,a*Math.cos(l)*d]}function Uu(a,o,l){return nh(Math.cos(Pn(a)),Math.sin(Pn(a)),o,l)}function Sl(a,o,l,d){const p=1<<l.z,y=(a/en+l.x)/p;return Uu(fo((o/en+l.y)/p),Mo(y),d)}function Ev({min:a,max:o}){return b_/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const q1=new Float64Array(16);function w_(a){const o=Ev(a),l=Dc(q1,[o,o,o]);return rm(l,l,((d=[])[0]=-(p=a.min)[0],d[1]=-p[1],d[2]=-p[2],d));var d,p}function W1(a){const o=(d=a.min,(l=q1)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=d[0],l[13]=d[1],l[14]=d[2],l[15]=1,l);var l,d;const p=1/Ev(a);return zu(o,o,[p,p,p])}function oT(a,o,l,d,p){const y=function(D){const T=en/(2*Math.PI);return D/(2*Math.PI)/T}(l),b=[a,o,-l/(2*Math.PI)],C=qa(new Float64Array(16));return rm(C,C,b),zu(C,C,[y,y,y]),f_(C,C,Pn(-p)),Xd(C,C,Pn(-d)),C}function fm(a){return nc(v_,wv,a)}function sT(a,o){const l=Uu(o.lat,o.lng);return b=(p=gv([],function(U){const j=Uu(U._center.lat,U._center.lng);let te=_v([],Kd(0,1,0),j);const q=H1([],-U.angle,j);te=Pr(te,te,q),H1(q,-U._pitch,te);const pe=es([],j);return _a(pe,pe,x_(U.cameraToCenterDistance/U.pixelsPerMeter)),Pr(pe,pe,q),Dl([],j,pe)}(a),l))[0],C=p[1],D=p[2],T=(y=l)[0],k=y[1],L=y[2],V=(N=Math.sqrt(b*b+C*C+D*D)*Math.sqrt(T*T+k*k+L*L))&&ya(p,y)/N,Math.acos(Math.min(Math.max(V,-1),1));var p,y,b,C,D,T,k,L,N,V}function Z1(a,o){return sT(a,o)>Math.PI/2*1.01}const ih=Pn(85),aT=Math.cos(ih),lT=Math.sin(ih),Or=6371008.8,X1=2*Math.PI*Or;class ba{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ba(On(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,d=this.lat*l,p=o.lat*l,y=Math.sin(d)*Math.sin(p)+Math.cos(d)*Math.cos(p)*Math.cos((o.lng-this.lng)*l);return Or*Math.acos(Math.min(y,1))}toBounds(o=0){const l=360*o/40075017,d=l/Math.cos(Math.PI/180*this.lat);return new Fu(new ba(this.lng-d,this.lat-l),new ba(this.lng+d,this.lat+l))}toEcef(o){const l=x_(o);return Uu(this.lat,this.lng,Tl+l)}static convert(o){if(o instanceof ba)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new ba(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new ba(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var bi=ba;function xs(a){return X1*Math.cos(a*Math.PI/180)}function ns(a){return(180+a)/360}function Za(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function ws(a,o){return a/xs(o)}function Mo(a){return 360*a-180}function fo(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function cT(a,o){return a*xs(fo(o))}const po=85.051129;function uT(a){return 1/Math.cos(a*Math.PI/180)}class mo{constructor(o,l,d=0){this.x=+o,this.y=+l,this.z=+d}static fromLngLat(o,l=0){const d=bi.convert(o);return new mo(ns(d.lng),Za(d.lat),ws(l,d.lat))}toLngLat(){return new bi(Mo(this.x),fo(this.y))}toAltitude(){return cT(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/X1*uT(fo(this.y))}}function pm(a,o,l,d,p,y,b,C,D){const T=(o+d)/2,k=(l+p)/2,L=new Ct(T,k);C(L),function(N,V,U,j,te,q){const pe=U-te,ae=j-q;return Math.abs((j-V)*pe-(U-N)*ae)/Math.hypot(pe,ae)}(L.x,L.y,y.x,y.y,b.x,b.y)>=D?(pm(a,o,l,T,k,y,L,C,D),pm(a,T,k,d,p,L,b,C,D)):a.push(b)}function rh(a,o,l){let d=a[0],p=d.x,y=d.y;o(d);const b=[d];for(let C=1;C<a.length;C++){const D=a[C],{x:T,y:k}=D;o(D),pm(b,p,y,T,k,d,D,o,l),p=T,y=k,d=D}return b}function Y1(a,o,l,d){if(d(o,l)){const p=o.add(l)._mult(.5);Y1(a,o,p,d),Y1(a,p,l,d)}else a.push(l)}function K1(a,o){let l=a[0];const d=[l];for(let p=1;p<a.length;p++){const y=a[p];Y1(d,l,y,o),l=y}return d}const Mv=Math.pow(2,14)-1,Q1=-Mv-1;function dT(a,o){const l=Math.round(a.x*o),d=Math.round(a.y*o);return a.x=Ln(l,Q1,Mv),a.y=Ln(d,Q1,Mv),(l<a.x||l>a.x+1||d<a.y||d>a.y+1)&&Fi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Ic(a,o,l){const d=a.loadGeometry(),p=a.extent,y=en/p;if(o&&l&&l.projection.isReprojectedInTileSpace){const b=1<<o.z,{scale:C,x:D,y:T,projection:k}=l,L=N=>{const V=Mo((o.x+N.x/p)/b),U=fo((o.y+N.y/p)/b),j=k.project(V,U);N.x=(j.x*C-D)*p,N.y=(j.y*C-T)*p};for(let N=0;N<d.length;N++)if(1!==a.type)d[N]=rh(d[N],L,1);else{const V=[];for(const U of d[N])U.x<0||U.x>=p||U.y<0||U.y>=p||(L(U),V.push(U));d[N]=V}}for(const b of d)for(const C of b)dT(C,y);return d}function oh(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?Ic(a):[]}}function C_(a,o,l,d,p){a.emplaceBack(2*o+(d+1)/2,2*l+(p+1)/2)}function If(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Af{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new ut,this.indexArray=new qt,this.segments=new vr,this.programConfigurations=new Mc(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,d,p){const y=this.layers[0],b=[];let C=null;"circle"===y.type&&(C=y.layout.get("circle-sort-key"));for(const{feature:T,id:k,index:L,sourceLayerIndex:N}of o){const V=this.layers[0]._featureFilter.needGeometry,U=oh(T,V);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),U,d))continue;const j=C?C.evaluate(U,{},d):void 0,te={id:k,properties:T.properties,type:T.type,sourceLayerIndex:N,index:L,geometry:V?U.geometry:Ic(T,d,p),patterns:{},sortKey:j};b.push(te)}C&&b.sort((T,k)=>T.sortKey-k.sortKey);let D=null;"globe"===p.projection.name&&(this.globeExtVertexArray=new nt,D=p.projection);for(const T of b){const{geometry:k,index:L,sourceLayerIndex:N}=T,V=o[L].feature;this.addFeature(T,k,L,l.availableImages,d,D),l.featureIndex.insert(V,k,L,N,this.index)}}update(o,l,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,j1.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,$1.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,d,p,y,b){for(const C of l)for(const D of C){const T=D.x,k=D.y;if(T<0||T>=en||k<0||k>=en)continue;if(b){const V=b.projectTilePoint(T,k,y),U=b.upVector(y,T,k),j=this.globeExtVertexArray;If(j,V,U),If(j,V,U),If(j,V,U),If(j,V,U)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),N=L.vertexLength;C_(this.layoutVertexArray,T,k,-1,-1),C_(this.layoutVertexArray,T,k,1,-1),C_(this.layoutVertexArray,T,k,1,1),C_(this.layoutVertexArray,T,k,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+2,N+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,{},p,y)}}function J1(a,o){for(let l=0;l<a.length;l++)if(sh(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(sh(a,o[l]))return!0;return!!Dv(a,o)}function E_(a,o,l){return!!sh(a,o)||!!mm(o,a,l)}function ew(a,o){if(1===a.length)return Tv(o,a[0]);for(let l=0;l<o.length;l++){const d=o[l];for(let p=0;p<d.length;p++)if(sh(a,d[p]))return!0}for(let l=0;l<a.length;l++)if(Tv(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(Dv(a,o[l]))return!0;return!1}function M_(a,o,l){if(a.length>1){if(Dv(a,o))return!0;for(let d=0;d<o.length;d++)if(mm(o[d],a,l))return!0}for(let d=0;d<a.length;d++)if(mm(a[d],o,l))return!0;return!1}function Dv(a,o){if(0===a.length||0===o.length)return!1;for(let l=0;l<a.length-1;l++){const d=a[l],p=a[l+1];for(let y=0;y<o.length-1;y++)if(tw(d,p,o[y],o[y+1]))return!0}return!1}function tw(a,o,l,d){return us(a,l,d)!==us(o,l,d)&&us(a,o,l)!==us(a,o,d)}function mm(a,o,l){const d=l*l;if(1===o.length)return a.distSqr(o[0])<d;for(let p=1;p<o.length;p++)if(gm(a,o[p-1],o[p])<d)return!0;return!1}function gm(a,o,l){const d=o.distSqr(l);if(0===d)return a.distSqr(o);const p=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/d;return a.distSqr(p<0?o:p>1?l:l.sub(o)._mult(p)._add(o))}function Tv(a,o){let l,d,p,y=!1;for(let b=0;b<a.length;b++){l=a[b];for(let C=0,D=l.length-1;C<l.length;D=C++)d=l[C],p=l[D],d.y>o.y!=p.y>o.y&&o.x<(p.x-d.x)*(o.y-d.y)/(p.y-d.y)+d.x&&(y=!y)}return y}function sh(a,o){let l=!1;for(let d=0,p=a.length-1;d<a.length;p=d++){const y=a[d],b=a[p];y.y>o.y!=b.y>o.y&&o.x<(b.x-y.x)*(o.y-y.y)/(b.y-y.y)+y.x&&(l=!l)}return l}function nw(a,o,l,d,p){for(const b of a)if(o<=b.x&&l<=b.y&&d>=b.x&&p>=b.y)return!0;const y=[new Ct(o,l),new Ct(o,p),new Ct(d,p),new Ct(d,l)];if(a.length>2)for(const b of y)if(sh(a,b))return!0;for(let b=0;b<a.length-1;b++)if(Pf(a[b],a[b+1],y))return!0;return!1}function Pf(a,o,l){const d=l[0],p=l[2];if(a.x<d.x&&o.x<d.x||a.x>p.x&&o.x>p.x||a.y<d.y&&o.y<d.y||a.y>p.y&&o.y>p.y)return!1;const y=us(a,o,l[0]);return y!==us(a,o,l[1])||y!==us(a,o,l[2])||y!==us(a,o,l[3])}function Il(a,o,l){const d=o.paint.get(a).value;return"constant"===d.kind?d.value:l.programConfigurations.get(o.id).getMaxValue(a)}function D_(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function hT(a,o,l,d,p){if(!o[0]&&!o[1])return a;const y=Ct.convert(o)._mult(p);"viewport"===l&&y._rotate(-d);const b=[];for(let C=0;C<a.length;C++)b.push(a[C].sub(y));return b}function Sv(a,o,l,d){const p=Ct.convert(a)._mult(d);return"viewport"===o&&p._rotate(-l),p}jt(Af,"CircleBucket",{omit:["layers"]});const fT=new ue({"circle-sort-key":new ne(He.layout_circle["circle-sort-key"])});var lk={paint:new ue({"circle-radius":new ne(He.paint_circle["circle-radius"]),"circle-color":new ne(He.paint_circle["circle-color"]),"circle-blur":new ne(He.paint_circle["circle-blur"]),"circle-opacity":new ne(He.paint_circle["circle-opacity"]),"circle-translate":new G(He.paint_circle["circle-translate"]),"circle-translate-anchor":new G(He.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new G(He.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new G(He.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ne(He.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ne(He.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ne(He.paint_circle["circle-stroke-opacity"])}),layout:fT};function iw(a,o,l,d,p,y,b,C,D){if(y&&a.queryGeometry.isAboveHorizon)return!1;y&&(D*=a.pixelToTileUnitsFactor);const T=a.tileID.canonical,k=l.projection.upVectorScale(T,l.center.lat,l.worldSize).metersToTile;for(const L of o)for(const N of L){const V=N.add(C),U=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(V.x,V.y,!0):0,j=l.projection.projectTilePoint(V.x,V.y,T);if(U>0){const ae=l.projection.upVector(T,V.x,V.y);j.x+=ae[0]*k*U,j.y+=ae[1]*k*U,j.z+=ae[2]*k*U}const te=y?V:pT(j.x,j.y,j.z,d),q=y?a.tilespaceRays.map(ae=>ow(ae,U)):a.queryGeometry.screenGeometry,pe=Tf([],[j.x,j.y,j.z,1],d);if(!b&&y?D*=pe[3]/l.cameraToCenterDistance:b&&!y&&(D*=l.cameraToCenterDistance/pe[3]),y){const ae=fo((N.y/en+T.y)/(1<<T.z));D/=l.projection.pixelsPerMeter(ae,1)/ws(1,ae)}if(E_(q,te,D))return!0}return!1}function pT(a,o,l,d){const p=Tf([],[a,o,l,1],d);return new Ct(p[0]/p[3],p[1]/p[3])}const rw=Kd(0,0,0),T_=Kd(0,0,1);function ow(a,o){const l=Df();return rw[2]=o,a.intersectsPlane(rw,T_,l),new Ct(l[0],l[1])}class sw extends Af{}function Iv(a,{width:o,height:l},d,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==o*l*d)throw new RangeError("mismatched image size")}else p=new Uint8Array(o*l*d);return a.width=o,a.height=l,a.data=p,a}function mT(a,o,l){const{width:d,height:p}=o;d===a.width&&p===a.height||(S_(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,d),height:Math.min(a.height,p)},l),a.width=d,a.height=p,a.data=o.data)}function S_(a,o,l,d,p,y){if(0===p.width||0===p.height)return o;if(p.width>a.width||p.height>a.height||l.x>a.width-p.width||l.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>o.width||p.height>o.height||d.x>o.width-p.width||d.y>o.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,C=o.data;for(let D=0;D<p.height;D++){const T=((l.y+D)*a.width+l.x)*y,k=((d.y+D)*o.width+d.x)*y;for(let L=0;L<p.width*y;L++)C[k+L]=b[T+L]}return o}jt(sw,"HeatmapBucket",{omit:["layers"]});class ju{constructor(o,l){Iv(this,o,1,l)}resize(o){mT(this,new ju(o),1)}clone(){return new ju({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,p,y){S_(o,l,d,p,y,1)}}class Cs{constructor(o,l){Iv(this,o,4,l)}resize(o){mT(this,new Cs(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Cs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,p,y){S_(o,l,d,p,y,4)}}jt(ju,"AlphaImage"),jt(Cs,"RGBAImage");var gT={paint:new ue({"heatmap-radius":new ne(He.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ne(He.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new G(He.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ce(He.paint_heatmap["heatmap-color"]),"heatmap-opacity":new G(He.paint_heatmap["heatmap-opacity"])})};function _m(a){const o={},l=a.resolution||256,d=a.clips?a.clips.length:1,p=a.image||new Cs({width:l,height:d}),y=(b,C,D)=>{o[a.evaluationKey]=D;const T=a.expression.evaluate(o);p.data[b+C+0]=Math.floor(255*T.r/T.a),p.data[b+C+1]=Math.floor(255*T.g/T.a),p.data[b+C+2]=Math.floor(255*T.b/T.a),p.data[b+C+3]=Math.floor(255*T.a)};if(a.clips)for(let b=0,C=0;b<d;++b,C+=4*l)for(let D=0,T=0;D<l;D++,T+=4){const k=D/(l-1),{start:L,end:N}=a.clips[b];y(C,T,L*(1-k)+N*k)}else for(let b=0,C=0;b<l;b++,C+=4)y(0,C,b/(l-1));return p}var ck={paint:new ue({"hillshade-illumination-direction":new G(He.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new G(He.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new G(He.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new G(He.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new G(He.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new G(He.paint_hillshade["hillshade-accent-color"])})};const uk=Te([{name:"a_pos",components:2,type:"Int16"}],4),{members:Av}=uk;var aw={exports:{}};function Pv(a,o,l){l=l||2;var d,p,y,b,C,D,T,k=o&&o.length,L=k?o[0]*l:a.length,N=_T(a,0,L,l,!0),V=[];if(!N||N.next===N.prev)return V;if(k&&(N=function(j,te,q,pe){var ae,fe,ge,_e=[];for(ae=0,fe=te.length;ae<fe;ae++)(ge=_T(j,te[ae]*pe,ae<fe-1?te[ae+1]*pe:j.length,pe,!1))===ge.next&&(ge.steiner=!0),_e.push(dw(ge));for(_e.sort(cw),ae=0;ae<_e.length;ae++)q=uw(_e[ae],q);return q}(a,o,N,l)),a.length>80*l){d=y=a[0],p=b=a[1];for(var U=l;U<L;U+=l)(C=a[U])<d&&(d=C),(D=a[U+1])<p&&(p=D),C>y&&(y=C),D>b&&(b=D);T=0!==(T=Math.max(y-d,b-p))?32767/T:0}return I_(N,V,l,d,p,T,0),V}function _T(a,o,l,d,p){var y,b;if(p===Ov(a,o,l,d)>0)for(y=o;y<l;y+=d)b=pw(y,a[y],a[y+1],b);else for(y=l-d;y>=o;y-=d)b=pw(y,a[y],a[y+1],b);return b&&R_(b,b.next)&&(vm(b),b=b.next),b}function Of(a,o){if(!a)return a;o||(o=a);var l,d=a;do{if(l=!1,d.steiner||!R_(d,d.next)&&0!==ki(d.prev,d,d.next))d=d.next;else{if(vm(d),(d=o=d.prev)===d.next)break;l=!0}}while(l||d!==o);return o}function I_(a,o,l,d,p,y,b){if(a){!b&&y&&function(k,L,N,V){var U=k;do{0===U.z&&(U.z=O_(U.x,U.y,L,N,V)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next}while(U!==k);U.prevZ.nextZ=null,U.prevZ=null,function(j){var te,q,pe,ae,fe,ge,_e,Fe,ke=1;do{for(q=j,j=null,fe=null,ge=0;q;){for(ge++,pe=q,_e=0,te=0;te<ke&&(_e++,pe=pe.nextZ);te++);for(Fe=ke;_e>0||Fe>0&&pe;)0!==_e&&(0===Fe||!pe||q.z<=pe.z)?(ae=q,q=q.nextZ,_e--):(ae=pe,pe=pe.nextZ,Fe--),fe?fe.nextZ=ae:j=ae,ae.prevZ=fe,fe=ae;q=pe}fe.nextZ=null,ke*=2}while(ge>1)}(U)}(a,d,p,y);for(var C,D,T=a;a.prev!==a.next;)if(C=a.prev,D=a.next,y?A_(a,d,p,y):yT(a))o.push(C.i/l|0),o.push(a.i/l|0),o.push(D.i/l|0),vm(a),a=D.next,T=D.next;else if((a=D)===T){b?1===b?I_(a=P_(Of(a),o,l),o,l,d,p,y,2):2===b&&lw(a,o,l,d,p,y):I_(Of(a),o,l,d,p,y,1);break}}}function yT(a){var o=a.prev,l=a,d=a.next;if(ki(o,l,d)>=0)return!1;for(var p=o.x,y=l.x,b=d.x,C=o.y,D=l.y,T=d.y,k=p<y?p<b?p:b:y<b?y:b,L=C<D?C<T?C:T:D<T?D:T,N=p>y?p>b?p:b:y>b?y:b,V=C>D?C>T?C:T:D>T?D:T,U=d.next;U!==o;){if(U.x>=k&&U.x<=N&&U.y>=L&&U.y<=V&&Ac(p,C,y,D,b,T,U.x,U.y)&&ki(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function A_(a,o,l,d){var p=a.prev,y=a,b=a.next;if(ki(p,y,b)>=0)return!1;for(var C=p.x,D=y.x,T=b.x,k=p.y,L=y.y,N=b.y,V=C<D?C<T?C:T:D<T?D:T,U=k<L?k<N?k:N:L<N?L:N,j=C>D?C>T?C:T:D>T?D:T,te=k>L?k>N?k:N:L>N?L:N,q=O_(V,U,o,l,d),pe=O_(j,te,o,l,d),ae=a.prevZ,fe=a.nextZ;ae&&ae.z>=q&&fe&&fe.z<=pe;){if(ae.x>=V&&ae.x<=j&&ae.y>=U&&ae.y<=te&&ae!==p&&ae!==b&&Ac(C,k,D,L,T,N,ae.x,ae.y)&&ki(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,fe.x>=V&&fe.x<=j&&fe.y>=U&&fe.y<=te&&fe!==p&&fe!==b&&Ac(C,k,D,L,T,N,fe.x,fe.y)&&ki(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ae&&ae.z>=q;){if(ae.x>=V&&ae.x<=j&&ae.y>=U&&ae.y<=te&&ae!==p&&ae!==b&&Ac(C,k,D,L,T,N,ae.x,ae.y)&&ki(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;fe&&fe.z<=pe;){if(fe.x>=V&&fe.x<=j&&fe.y>=U&&fe.y<=te&&fe!==p&&fe!==b&&Ac(C,k,D,L,T,N,fe.x,fe.y)&&ki(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function P_(a,o,l){var d=a;do{var p=d.prev,y=d.next.next;!R_(p,y)&&hw(p,d,d.next,y)&&ah(p,y)&&ah(y,p)&&(o.push(p.i/l|0),o.push(d.i/l|0),o.push(y.i/l|0),vm(d),vm(d.next),d=a=y),d=d.next}while(d!==a);return Of(d)}function lw(a,o,l,d,p,y){var b=a;do{for(var C=b.next.next;C!==b.prev;){if(b.i!==C.i&&k_(b,C)){var D=fw(b,C);return b=Of(b,b.next),D=Of(D,D.next),I_(b,o,l,d,p,y,0),void I_(D,o,l,d,p,y,0)}C=C.next}b=b.next}while(b!==a)}function cw(a,o){return a.x-o.x}function uw(a,o){var l=function(p,y){var b,C=y,D=p.x,T=p.y,k=-1/0;do{if(T<=C.y&&T>=C.next.y&&C.next.y!==C.y){var L=C.x+(T-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(L<=D&&L>k&&(k=L,b=C.x<C.next.x?C:C.next,L===D))return b}C=C.next}while(C!==y);if(!b)return null;var N,V=b,U=b.x,j=b.y,te=1/0;C=b;do{D>=C.x&&C.x>=U&&D!==C.x&&Ac(T<j?D:k,T,U,j,T<j?k:D,T,C.x,C.y)&&(N=Math.abs(T-C.y)/(D-C.x),ah(C,p)&&(N<te||N===te&&(C.x>b.x||C.x===b.x&&kf(b,C)))&&(b=C,te=N)),C=C.next}while(C!==V);return b}(a,o);if(!l)return o;var d=fw(l,a);return Of(d,d.next),Of(l,l.next)}function kf(a,o){return ki(a.prev,a,o.prev)<0&&ki(o.next,a,a.next)<0}function O_(a,o,l,d,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*p|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-d)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function dw(a){var o=a,l=a;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==a);return l}function Ac(a,o,l,d,p,y,b,C){return(p-b)*(o-C)>=(a-b)*(y-C)&&(a-b)*(d-C)>=(l-b)*(o-C)&&(l-b)*(y-C)>=(p-b)*(d-C)}function k_(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,d){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==d.i&&p.next.i!==d.i&&hw(p,p.next,l,d))return!0;p=p.next}while(p!==l);return!1}(a,o)&&(ah(a,o)&&ah(o,a)&&function(l,d){var p=l,y=!1,b=(l.x+d.x)/2,C=(l.y+d.y)/2;do{p.y>C!=p.next.y>C&&p.next.y!==p.y&&b<(p.next.x-p.x)*(C-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next}while(p!==l);return y}(a,o)&&(ki(a.prev,a,o.prev)||ki(a,o.prev,o))||R_(a,o)&&ki(a.prev,a,a.next)>0&&ki(o.prev,o,o.next)>0)}function ki(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function R_(a,o){return a.x===o.x&&a.y===o.y}function hw(a,o,l,d){var p=ym(ki(a,o,l)),y=ym(ki(a,o,d)),b=ym(ki(l,d,a)),C=ym(ki(l,d,o));return p!==y&&b!==C||!(0!==p||!L_(a,l,o))||!(0!==y||!L_(a,d,o))||!(0!==b||!L_(l,a,d))||!(0!==C||!L_(l,o,d))}function L_(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function ym(a){return a>0?1:a<0?-1:0}function ah(a,o){return ki(a.prev,a,a.next)<0?ki(a,o,a.next)>=0&&ki(a,a.prev,o)>=0:ki(a,o,a.prev)<0||ki(a,a.next,o)<0}function fw(a,o){var l=new F_(a.i,a.x,a.y),d=new F_(o.i,o.x,o.y),p=a.next,y=o.prev;return a.next=o,o.prev=a,l.next=p,p.prev=l,d.next=l,l.prev=d,y.next=d,d.prev=y,d}function pw(a,o,l,d){var p=new F_(a,o,l);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function vm(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function F_(a,o,l){this.i=a,this.x=o,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ov(a,o,l,d){for(var p=0,y=o,b=l-d;y<l;y+=d)p+=(a[b]-a[y])*(a[y+1]+a[b+1]),b=y;return p}aw.exports=Pv,aw.exports.default=Pv,Pv.deviation=function(a,o,l,d){var p=o&&o.length,y=Math.abs(Ov(a,0,p?o[0]*l:a.length,l));if(p)for(var b=0,C=o.length;b<C;b++)y-=Math.abs(Ov(a,o[b]*l,b<C-1?o[b+1]*l:a.length,l));var D=0;for(b=0;b<d.length;b+=3){var T=d[b]*l,k=d[b+1]*l,L=d[b+2]*l;D+=Math.abs((a[T]-a[L])*(a[k+1]-a[T+1])-(a[T]-a[k])*(a[L+1]-a[T+1]))}return 0===y&&0===D?0:Math.abs((D-y)/y)},Pv.flatten=function(a){for(var o=a[0][0].length,l={vertices:[],holes:[],dimensions:o},d=0,p=0;p<a.length;p++){for(var y=0;y<a[p].length;y++)for(var b=0;b<o;b++)l.vertices.push(a[p][y][b]);p>0&&l.holes.push(d+=a[p-1].length)}return l};var kv=Wo(aw.exports);function is(a,o,l,d,p){N_(a,o,l||0,d||a.length-1,p||Rv)}function N_(a,o,l,d,p){for(;d>l;){if(d-l>600){var y=d-l+1,b=o-l+1,C=Math.log(y),D=.5*Math.exp(2*C/3),T=.5*Math.sqrt(C*D*(y-D)/y)*(b-y/2<0?-1:1);N_(a,o,Math.max(l,Math.floor(o-b*D/y+T)),Math.min(d,Math.floor(o+(y-b)*D/y+T)),p)}var k=a[o],L=l,N=d;for(Rf(a,l,o),p(a[d],k)>0&&Rf(a,l,d);L<N;){for(Rf(a,L,N),L++,N--;p(a[L],k)<0;)L++;for(;p(a[N],k)>0;)N--}0===p(a[l],k)?Rf(a,l,N):Rf(a,++N,d),N<=o&&(l=N+1),o<=N&&(d=N-1)}}function Rf(a,o,l){var d=a[o];a[o]=a[l],a[l]=d}function Rv(a,o){return a<o?-1:a>o?1:0}function go(a,o){const l=a.length;if(l<=1)return[a];const d=[];let p,y;for(let b=0;b<l;b++){const C=dl(a[b]);0!==C&&(a[b].area=Math.abs(C),void 0===y&&(y=C<0),y===C<0?(p&&d.push(p),p=[a[b]]):p.push(a[b]))}if(p&&d.push(p),o>1)for(let b=0;b<d.length;b++)d[b].length<=o||(is(d[b],o,1,d[b].length-1,bm),d[b]=d[b].slice(0,o));return d}function bm(a,o){return o.area-a.area}function z_(a,o,l){const d=l.patternDependencies;let p=!1;for(const y of o){const b=y.paint.get(`${a}-pattern`);b.isConstant()||(p=!0);const C=b.constantOr(null);C&&(p=!0,d[C]=!0)}return p}function B_(a,o,l,d,p){const y=p.patternDependencies;for(const b of o){const C=b.paint.get(`${a}-pattern`).value;if("constant"!==C.kind){let D=C.evaluate({zoom:d},l,{},p.availableImages);D=D&&D.name?D.name:D,y[D]=!0,l.patterns[b.id]=D}}return l}class V_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ut,this.indexArray=new qt,this.indexArray2=new $r,this.programConfigurations=new Mc(o.layers,o.zoom),this.segments=new vr,this.segments2=new vr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}populate(o,l,d,p){this.hasPattern=z_("fill",this.layers,l);const y=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:C,id:D,index:T,sourceLayerIndex:k}of o){const L=this.layers[0]._featureFilter.needGeometry,N=oh(C,L);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),N,d))continue;const V=y?y.evaluate(N,{},d,l.availableImages):void 0,U={id:D,properties:C.properties,type:C.type,sourceLayerIndex:k,index:T,geometry:L?N.geometry:Ic(C,d,p),patterns:{},sortKey:V};b.push(U)}y&&b.sort((C,D)=>C.sortKey-D.sortKey);for(const C of b){const{geometry:D,index:T,sourceLayerIndex:k}=C;if(this.hasPattern){const L=B_("fill",this.layers,C,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(C,D,T,d,{},l.availableImages);l.featureIndex.insert(o[T].feature,D,T,k,this.index)}}update(o,l,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,p)}addFeatures(o,l,d,p,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,d,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Av),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,d,p,y,b=[]){for(const C of go(l,500)){let D=0;for(const U of C)D+=U.length;const T=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),k=T.vertexLength,L=[],N=[];for(const U of C){if(0===U.length)continue;U!==C[0]&&N.push(L.length/2);const j=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),te=j.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(te+U.length-1,te),L.push(U[0].x),L.push(U[0].y);for(let q=1;q<U.length;q++)this.layoutVertexArray.emplaceBack(U[q].x,U[q].y),this.indexArray2.emplaceBack(te+q-1,te+q),L.push(U[q].x),L.push(U[q].y);j.vertexLength+=U.length,j.primitiveLength+=U.length}const V=kv(L,N);for(let U=0;U<V.length;U+=3)this.indexArray.emplaceBack(k+V[U],k+V[U+1],k+V[U+2]);T.vertexLength+=D,T.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,y,b,p)}}jt(V_,"FillBucket",{omit:["layers","patternFeatures"]});const mw=new ue({"fill-sort-key":new ne(He.layout_fill["fill-sort-key"])});var vT={paint:new ue({"fill-antialias":new G(He.paint_fill["fill-antialias"]),"fill-opacity":new ne(He.paint_fill["fill-opacity"]),"fill-color":new ne(He.paint_fill["fill-color"]),"fill-outline-color":new ne(He.paint_fill["fill-outline-color"]),"fill-translate":new G(He.paint_fill["fill-translate"]),"fill-translate-anchor":new G(He.paint_fill["fill-translate-anchor"]),"fill-pattern":new ne(He.paint_fill["fill-pattern"])}),layout:mw};const gw=Te([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),bT=Te([{name:"a_centroid_pos",components:2,type:"Uint16"}]),_w=Te([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:xT}=gw;var U_={},Lv=La,j_=Lf;function Lf(a,o,l,d,p){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=p,a.readFields(xm,this,o)}function xm(a,o,l){1==a?o.id=l.readVarint():2==a?function(d,p){for(var y=d.readVarint()+d.pos;d.pos<y;){var b=p._keys[d.readVarint()],C=p._values[d.readVarint()];p.properties[b]=C}}(l,o):3==a?o.type=l.readVarint():4==a&&(o._geometry=l.pos)}function wT(a){for(var o,l,d=0,p=0,y=a.length,b=y-1;p<y;b=p++)d+=((l=a[b]).x-(o=a[p]).x)*(o.y+l.y);return d}Lf.types=["Unknown","Point","LineString","Polygon"],Lf.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,d=1,p=0,y=0,b=0,C=[];a.pos<l;){if(p<=0){var D=a.readVarint();d=7&D,p=D>>3}if(p--,1===d||2===d)y+=a.readSVarint(),b+=a.readSVarint(),1===d&&(o&&C.push(o),o=[]),o.push(new Lv(y,b));else{if(7!==d)throw new Error("unknown command "+d);o&&o.push(o[0].clone())}}return o&&C.push(o),C},Lf.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,d=0,p=0,y=0,b=1/0,C=-1/0,D=1/0,T=-1/0;a.pos<o;){if(d<=0){var k=a.readVarint();l=7&k,d=k>>3}if(d--,1===l||2===l)(p+=a.readSVarint())<b&&(b=p),p>C&&(C=p),(y+=a.readSVarint())<D&&(D=y),y>T&&(T=y);else if(7!==l)throw new Error("unknown command "+l)}return[b,D,C,T]},Lf.prototype.toGeoJSON=function(a,o,l){var d,p,y=this.extent*Math.pow(2,l),b=this.extent*a,C=this.extent*o,D=this.loadGeometry(),T=Lf.types[this.type];function k(V){for(var U=0;U<V.length;U++){var j=V[U];V[U]=[360*(j.x+b)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+C)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(d=0;d<D.length;d++)L[d]=D[d][0];k(D=L);break;case 2:for(d=0;d<D.length;d++)k(D[d]);break;case 3:for(D=function(V){var U=V.length;if(U<=1)return[V];for(var j,te,q=[],pe=0;pe<U;pe++){var ae=wT(V[pe]);0!==ae&&(void 0===te&&(te=ae<0),te===ae<0?(j&&q.push(j),j=[V[pe]]):j.push(V[pe]))}return j&&q.push(j),q}(D),d=0;d<D.length;d++)for(p=0;p<D[d].length;p++)k(D[d][p])}1===D.length?D=D[0]:T="Multi"+T;var N={type:"Feature",geometry:{type:T,coordinates:D},properties:this.properties};return"id"in this&&(N.id=this.id),N};var CT=j_,Fv=Nv;function Nv(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(yw,this,o),this.length=this._features.length}function yw(a,o,l){15===a?o.version=l.readVarint():1===a?o.name=l.readString():5===a?o.extent=l.readVarint():2===a?o._features.push(l.pos):3===a?o._keys.push(l.readString()):4===a&&o._values.push(function(d){for(var p=null,y=d.readVarint()+d.pos;d.pos<y;){var b=d.readVarint()>>3;p=1===b?d.readString():2===b?d.readFloat():3===b?d.readDouble():4===b?d.readVarint64():5===b?d.readVarint():6===b?d.readSVarint():7===b?d.readBoolean():null}return p}(l))}Nv.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new CT(this._pbf,o,this.extent,this._keys,this._values)};var Ff=Fv;function $_(a,o,l){if(3===a){var d=new Ff(l,l.readVarint()+l.pos);d.length&&(o[d.name]=d)}}var H_=U_.VectorTile=function(a,o){this.layers=a.readFields($_,{},o)},Nf=U_.VectorTileFeature=j_;function lh(a,o,l,d){const p=[],y=0===d?(b,C,D,T,k,L)=>{b.push(new Ct(L,D+(L-C)/(T-C)*(k-D)))}:(b,C,D,T,k,L)=>{b.push(new Ct(C+(L-D)/(k-D)*(T-C),L))};for(const b of a){const C=[];for(const D of b){if(D.length<=2)continue;const T=[];for(let N=0;N<D.length-1;N++){const V=D[N].x,U=D[N].y,j=D[N+1].x,te=D[N+1].y,q=0===d?V:U,pe=0===d?j:te;q<o?pe>o&&y(T,V,U,j,te,o):q>l?pe<l&&y(T,V,U,j,te,l):T.push(D[N]),pe<o&&q>=o&&y(T,V,U,j,te,o),pe>l&&q<=l&&y(T,V,U,j,te,l)}let k=D[D.length-1];const L=0===d?k.x:k.y;L>=o&&L<=l&&T.push(k),T.length&&(k=T[T.length-1],T[0].x===k.x&&T[0].y===k.y||T.push(T[0]),C.push(T))}C.length&&p.push(C)}return p}U_.VectorTileLayer=Fv;const ET=Nf.types,MT=Math.pow(2,13);function wm(a,o,l,d,p,y,b,C){a.emplaceBack((o<<1)+b,(l<<1)+y,(Math.floor(d*MT)<<1)+p,Math.round(C))}function Cm(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class vw{constructor(){this.acc=new Ct(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ct(o.x,o.y),this.max=new Ct(o.x,o.y))}append(o,l){this.currentPolyCount.edges++,this.acc._add(o);const d=this.min,p=this.max;o.x<d.x?d.x=o.x:o.x>p.x&&(p.x=o.x),o.y<d.y?d.y=o.y:o.y>p.y&&(p.y=o.y),((0===o.x||o.x===en)&&o.x===l.x)!=((0===o.y||o.y===en)&&o.y===l.y)&&this.processBorderOverlap(o,l),l.x<0!=o.x<0&&this.addBorderIntersection(0,Nn(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>en!=o.x>en&&this.addBorderIntersection(1,Nn(l.y,o.y,(en-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,Nn(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>en!=o.y>en&&this.addBorderIntersection(3,Nn(l.x,o.x,(en-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[o];l<d[0]&&(d[0]=l),l>d[1]&&(d[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const d=0===o.x?0:1;this.addBorderIntersection(d,l.y),this.addBorderIntersection(d,o.y)}else{const d=0===o.y?2:3;this.addBorderIntersection(d,l.x),this.addBorderIntersection(d,o.x)}}centroid(){const o=this.polyCount.reduce((l,d)=>l+d.edges,0);return 0!==o?this.acc.div(o)._round():new Ct(0,0)}span(){return new Ct(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0)}}class Em{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new Ze,this.centroidVertexArray=new Bo,this.indexArray=new qt,this.programConfigurations=new Mc(o.layers,o.zoom),this.segments=new vr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=o.enableTerrain}populate(o,l,d,p){this.features=[],this.hasPattern=z_("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(y){const b=Math.exp(Math.PI*(1-y.y/(1<<y.z)*2));return 80150034*b/(b*b+1)/en/(1<<y.z)}(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:y,id:b,index:C,sourceLayerIndex:D}of o){const T=this.layers[0]._featureFilter.needGeometry,k=oh(y,T);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),k,d))continue;const L={id:b,sourceLayerIndex:D,index:C,geometry:T?k.geometry:Ic(y,d,p),properties:y.properties,type:y.type,patterns:{}},N=this.layoutVertexArray.length;this.hasPattern?this.features.push(B_("fill-extrusion",this.layers,L,this.zoom,l)):this.addFeature(L,L.geometry,C,d,{},l.availableImages,p),l.featureIndex.insert(y,L.geometry,C,D,this.index,N)}this.sortBorders()}addFeatures(o,l,d,p,y){for(const b of this.features){const{geometry:C}=b;this.addFeature(b,C,b.index,l,d,p,y)}this.sortBorders()}update(o,l,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,xT),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,_w.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,bT.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,d,p,y,b,C){const D=[new Ct(0,0),new Ct(en,en)],T=C.projection,k="globe"===T.name,L=this.enableTerrain&&!k?new vw:null,N="Polygon"===ET[o.type];k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new nt);const V=go(l,500);for(let q=V.length-1;q>=0;q--){const pe=V[q];(0===pe.length||(U=pe[0]).every(ae=>ae.x<=0)||U.every(ae=>ae.x>=en)||U.every(ae=>ae.y<=0)||U.every(ae=>ae.y>=en))&&V.splice(q,1)}var U;let j;if(k)j=Bv(V,D,p);else{j=[];for(const q of V)j.push({polygon:q,bounds:D})}const te=N?this.edgeRadius:0;for(const{polygon:q,bounds:pe}of j){let ae=0,fe=0;for(const _e of q)N&&!_e[0].equals(_e[_e.length-1])&&_e.push(_e[0]),fe+=N?_e.length-1:_e.length;const ge=this.segments.prepareSegment((N?5:4)*fe,this.layoutVertexArray,this.indexArray);if(N){const _e=[],Fe=[];ae=ge.vertexLength;for(const Ge of q){let ct,ze;Ge.length&&Ge!==q[0]&&Fe.push(_e.length/2),ct=Ge[1].sub(Ge[0])._perp()._unit();for(let Qe=1;Qe<Ge.length;Qe++){const Ye=Ge[Qe],at=Ge[Qe===Ge.length-1?1:Qe+1];let{x:pt,y:$e}=Ye;if(te){ze=at.sub(Ye)._perp()._unit();const Mt=ct.add(ze)._unit(),Ht=te*Math.min(4,1/(ct.x*Mt.x+ct.y*Mt.y));pt+=Ht*Mt.x,$e+=Ht*Mt.y,ct=ze}wm(this.layoutVertexArray,pt,$e,0,0,1,1,0),ge.vertexLength++,_e.push(Ye.x,Ye.y),k&&Cm(this.layoutVertexExtArray,T.projectTilePoint(pt,$e,p),T.upVector(p,pt,$e))}}const ke=kv(_e,Fe);for(let Ge=0;Ge<ke.length;Ge+=3)this.indexArray.emplaceBack(ae+ke[Ge],ae+ke[Ge+2],ae+ke[Ge+1]),ge.primitiveLength++}for(const _e of q){L&&_e.length&&L.startRing(_e[0]);let Fe,ke,Ge,ct=_e.length>4&&bw(_e[_e.length-2],_e[0],_e[1]),ze=te?G_(_e[_e.length-2],_e[0],_e[1],te):0;ke=_e[1].sub(_e[0])._perp()._unit();let Qe=!0;for(let Ye=1,at=0;Ye<_e.length;Ye++){let pt=_e[Ye-1],$e=_e[Ye];const Mt=_e[Ye===_e.length-1?1:Ye+1];if(L&&N&&L.currentPolyCount.top++,W_($e,pt,pe)){te&&(ke=Mt.sub($e)._perp()._unit(),Qe=!Qe);continue}L&&L.append($e,pt);const Ht=$e.sub(pt)._perp(),Rt=Ht.x/(Math.abs(Ht.x)+Math.abs(Ht.y)),gn=Ht.y>0?1:0,_t=pt.dist($e);if(at+_t>32768&&(at=0),te){Ge=Mt.sub($e)._perp()._unit();let _n=q_(pt,$e,Mt,zv(ke,Ge),te);isNaN(_n)&&(_n=0);const Xt=$e.sub(pt)._unit();pt=pt.add(Xt.mult(ze))._round(),$e=$e.add(Xt.mult(-_n))._round(),ze=_n,ke=Ge}const Jt=ge.vertexLength,un=_e.length>4&&bw(pt,$e,Mt);let Kn=xw(at,ct,Qe);if(wm(this.layoutVertexArray,pt.x,pt.y,Rt,gn,0,0,Kn),wm(this.layoutVertexArray,pt.x,pt.y,Rt,gn,0,1,Kn),at+=_t,Kn=xw(at,un,!Qe),ct=un,wm(this.layoutVertexArray,$e.x,$e.y,Rt,gn,0,0,Kn),wm(this.layoutVertexArray,$e.x,$e.y,Rt,gn,0,1,Kn),ge.vertexLength+=4,this.indexArray.emplaceBack(Jt+0,Jt+1,Jt+2),this.indexArray.emplaceBack(Jt+1,Jt+3,Jt+2),ge.primitiveLength+=2,te){const _n=ae+(1===Ye?_e.length-2:Ye-2),Xt=1===Ye?ae:_n+1;if(this.indexArray.emplaceBack(Jt+1,_n,Jt+3),this.indexArray.emplaceBack(_n,Xt,Jt+3),ge.primitiveLength+=2,void 0===Fe&&(Fe=Jt),!W_(Mt,_e[Ye],pe)){const Ri=Ye===_e.length-1?Fe:ge.vertexLength;this.indexArray.emplaceBack(Jt+2,Jt+3,Ri),this.indexArray.emplaceBack(Jt+3,Ri+1,Ri),this.indexArray.emplaceBack(Jt+3,Xt,Ri+1),ge.primitiveLength+=3}Qe=!Qe}if(k){const _n=this.layoutVertexExtArray,Xt=T.projectTilePoint(pt.x,pt.y,p),Ri=T.projectTilePoint($e.x,$e.y,p),xn=T.upVector(p,pt.x,pt.y),Cn=T.upVector(p,$e.x,$e.y);Cm(_n,Xt,xn),Cm(_n,Xt,xn),Cm(_n,Ri,Cn),Cm(_n,Ri,Cn)}}N&&(ae+=_e.length-1)}}if(L&&L.polyCount.length>0){if(L.borders){L.vertexArrayOffset=this.centroidVertexArray.length;const q=L.borders,pe=this.featuresOnBorder.push(L)-1;for(let ae=0;ae<4;ae++)q[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(pe)}this.encodeCentroid(L.borders?void 0:L.centroid(),L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,y,b,p)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((l,d)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[d].borders[o][0])}encodeCentroid(o,l,d=!0){let p,y;if(o)if(0!==o.y){const C=l.span()._mult(this.tileToMeter);p=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(C.x/10)),y=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(C.y/10))}else p=Math.ceil(7*(o.x+450)),y=0;else p=0,y=+d;let b=d?this.centroidVertexArray.length:l.vertexArrayOffset;for(const C of l.polyCount){d&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*C.edges+C.top);for(let D=0;D<C.top;D++)this.centroidVertexArray.emplace(b++,p,y);for(let D=0;D<2*C.edges;D++)this.centroidVertexArray.emplace(b++,0,y),this.centroidVertexArray.emplace(b++,p,y)}}}function zv(a,o){const l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function G_(a,o,l,d){const p=o.sub(a)._perp()._unit(),y=l.sub(o)._perp()._unit();return q_(a,o,l,zv(p,y),d)}function q_(a,o,l,d,p){const y=Math.sqrt(1-d*d);return Math.min(a.dist(o)/3,o.dist(l)/3,p*y/d)}function W_(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function bw(a,o,l){if(a.x<0||a.x>=en||o.x<0||o.x>=en||l.x<0||l.x>=en)return!1;const d=l.sub(o),p=d.perp(),y=a.sub(o);return(d.x*y.x+d.y*y.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(y.x*y.x+y.y*y.y))>-.866&&p.x*y.x+p.y*y.y<0}function xw(a,o,l){const d=o?2|a:-3&a;return l?1|d:-2&d}function Z_(){const a=Math.PI/32,o=Math.tan(a),l=Or;return l*Math.sqrt(1+2*o*o)-l}function Bv(a,o,l){const d=1<<l.z,p=Mo(l.x/d),y=Mo((l.x+1)/d),b=fo(l.y/d),C=fo((l.y+1)/d);return function(D,T,k,L,N=0,V){const U=[];if(!D.length||!k||!L)return U;const j=(_e,Fe)=>{for(const ke of _e)U.push({polygon:ke,bounds:Fe})},te=Math.ceil(Math.log2(k)),q=Math.ceil(Math.log2(L)),pe=te-q,ae=[];for(let _e=0;_e<Math.abs(pe);_e++)ae.push(pe>0?0:1);for(let _e=0;_e<Math.min(te,q);_e++)ae.push(0),ae.push(1);let fe=D;if(fe=lh(fe,T[0].y-N,T[1].y+N,1),fe=lh(fe,T[0].x-N,T[1].x+N,0),!fe.length)return U;const ge=[];for(ae.length?ge.push({polygons:fe,bounds:T,depth:0}):j(fe,T);ge.length;){const _e=ge.pop(),Fe=_e.depth,ke=ae[Fe],Ge=_e.bounds[0],ct=_e.bounds[1],ze=0===ke?Ge.x:Ge.y,Qe=0===ke?ct.x:ct.y,Ye=V?V(ke,ze,Qe):.5*(ze+Qe),at=lh(_e.polygons,ze-N,Ye+N,ke),pt=lh(_e.polygons,Ye-N,Qe+N,ke);if(at.length){const $e=[Ge,new Ct(0===ke?Ye:ct.x,1===ke?Ye:ct.y)];ae.length>Fe+1?ge.push({polygons:at,bounds:$e,depth:Fe+1}):j(at,$e)}if(pt.length){const $e=[new Ct(0===ke?Ye:Ge.x,1===ke?Ye:Ge.y),ct];ae.length>Fe+1?ge.push({polygons:pt,bounds:$e,depth:Fe+1}):j(pt,$e)}}return U}(a,o,Math.ceil((y-p)/11.25),Math.ceil((b-C)/11.25),1,(D,T,k)=>{if(0===D)return.5*(T+k);{const L=fo((l.y+T/en)/d);return(Za(.5*(fo((l.y+k/en)/d)+L))*d-l.y)*en}})}jt(Em,"FillExtrusionBucket",{omit:["layers","features"]}),jt(vw,"PartMetadata");const ch=new ue({"fill-extrusion-edge-radius":new G(He["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var ww={paint:new ue({"fill-extrusion-opacity":new G(He["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ne(He["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new G(He["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new G(He["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ne(He["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ne(He["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ne(He["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new G(He["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new G(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new G(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new G(He["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:ch};function Vv(a,o,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[a*d-2*Math.PI*6378137/2,o*d-2*Math.PI*6378137/2]}class X_{constructor(o,l,d){this.z=o,this.x=l,this.y=d,this.key=Mm(0,o,o,l,d)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const d=(b=this.y,C=this.z,D=Vv(256*(y=this.x),256*(b=Math.pow(2,C)-b-1),C),T=Vv(256*(y+1),256*(b+1),C),D[0]+","+D[1]+","+T[0]+","+T[1]),p=function(y,b,C){let D,T="";for(let k=y;k>0;k--)D=1<<k-1,T+=(b&D?1:0)+(C&D?2:0);return T}(this.z,this.x,this.y);var y,b,C,D,T;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class DT{constructor(o,l){this.wrap=o,this.canonical=l,this.key=Mm(o,l.z,l.z,l.x,l.y)}}class io{constructor(o,l,d,p,y){this.overscaledZ=o,this.wrap=l,this.canonical=new X_(d,+p,+y),this.key=0===l&&o===d?this.canonical.key:Mm(l,o,d,p,y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new io(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new io(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return Mm(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-o;return Mm(this.wrap*+l,o,o,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new io(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,d=2*this.canonical.x,p=2*this.canonical.y;return[new io(l,this.wrap,l,d,p),new io(l,this.wrap,l,d+1,p),new io(l,this.wrap,l,d,p+1),new io(l,this.wrap,l,d+1,p+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new io(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new io(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new DT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Mm(a,o,l,d,p){const y=1<<Math.min(l,22);let b=y*(p%y)+d%y;return a&&l<22&&(b+=y*y*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*b+l)+(o-l)}jt(X_,"CanonicalTileID"),jt(io,"OverscaledTileID",{omit:["projMatrix"]});class uh extends Ct{constructor(o,l,d){super(o,l),this.z=d}}function zf(a,o){return a.x*o.x+a.y*o.y}function Uv(a,o){if(1===a.length){let l=0;const d=o[l++];let p;for(;!p||d.equals(p);)if(p=o[l++],!p)return 1/0;for(;l<o.length;l++){const y=o[l],b=a[0],C=p.sub(d),D=y.sub(d),T=b.sub(d),k=zf(C,C),L=zf(C,D),N=zf(D,D),V=zf(T,C),U=zf(T,D),j=k*N-L*L,te=(N*V-L*U)/j,q=(k*U-L*V)/j,pe=d.z*(1-te-q)+p.z*te+y.z*q;if(isFinite(pe))return pe}return 1/0}{let l=1/0;for(const d of o)l=Math.min(l,d.z);return l}}function Y_(a,o,l,d,p,y,b,C){const D=b*p.getElevationAt(a,o,!0,!0),T=0!==y[0],k=T?0===y[1]?b*(y[0]/7-450):b*function(L,N,V){const U=Math.floor(N[0]/8),j=Math.floor(N[1]/8),te=10*(N[0]-8*U),q=10*(N[1]-8*j),pe=L.getElevationAt(U,j,!0,!0),ae=L.getMeterToDEM(V),fe=Math.floor(.5*(te*ae-1)),ge=Math.floor(.5*(q*ae-1)),_e=L.tileCoordToPixel(U,j),Fe=2*fe+1,ke=2*ge+1,Ge=(Ht=Fe,Rt=ke,[(pt=L).getElevationAtPixel($e=_e.x-fe,Mt=_e.y-ge,!0),pt.getElevationAtPixel($e+Rt,Mt,!0),pt.getElevationAtPixel($e,Mt+Rt,!0),pt.getElevationAtPixel($e+Ht,Mt+Rt,!0)]),ct=Math.abs(Ge[0]-Ge[1]),ze=Math.abs(Ge[2]-Ge[3]),Qe=Math.abs(Ge[0]-Ge[2])+Math.abs(Ge[1]-Ge[3]),Ye=Math.min(.25,.5*ae*(ct+ze)/Fe),at=Math.min(.25,.5*ae*Qe/ke);var pt,$e,Mt,Ht,Rt;return pe+Math.max(Ye*te,at*q)}(p,y,C):D;return{base:D+(0===l)?-1:l,top:T?Math.max(k+d,D+l+2):D+d}}const Cw=Te([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:K_}=Cw,Dm=Te([{name:"a_packed",components:4,type:"Float32"}]),{members:Ew}=Dm,jv=Nf.types,Q_=Math.cos(Math.PI/180*37.5);class Tm{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Ve,this.layoutVertexArray2=new lt,this.indexArray=new qt,this.programConfigurations=new Mc(o.layers,o.zoom),this.segments=new vr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,d,p){this.hasPattern=z_("line",this.layers,l);const y=this.layers[0].layout.get("line-sort-key"),b=[];for(const{feature:k,id:L,index:N,sourceLayerIndex:V}of o){const U=this.layers[0]._featureFilter.needGeometry,j=oh(k,U);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),j,d))continue;const te=y?y.evaluate(j,{},d):void 0,q={id:L,properties:k.properties,type:k.type,sourceLayerIndex:V,index:N,geometry:U?j.geometry:Ic(k,d,p),patterns:{},sortKey:te};b.push(q)}y&&b.sort((k,L)=>k.sortKey-L.sortKey);const{lineAtlas:C,featureIndex:D}=l,T=this.addConstantDashes(C);for(const k of b){const{geometry:L,index:N,sourceLayerIndex:V}=k;if(T&&this.addFeatureDashes(k,C),this.hasPattern){const U=B_("line",this.layers,k,this.zoom,l);this.patternFeatures.push(U)}else this.addFeature(k,L,N,d,C.positions,l.availableImages);D.insert(o[N].feature,L,N,V,this.index)}}addConstantDashes(o){let l=!1;for(const d of this.layers){const p=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==y.kind)l=!0;else{const b=y.value,C=p.value;if(!C)continue;o.addDash(C,b)}}return l}addFeatureDashes(o,l){const d=this.zoom;for(const p of this.layers){const y=p.paint.get("line-dasharray").value,b=p.layout.get("line-cap").value;if("constant"===y.kind&&"constant"===b.kind)continue;let C,D;if("constant"===y.kind){if(C=y.value,!C)continue}else C=y.evaluate({zoom:d},o);D="constant"===b.kind?b.value:b.evaluate({zoom:d},o),l.addDash(C,D),o.patterns[p.id]=l.getKey(C,D)}}update(o,l,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,p)}addFeatures(o,l,d,p,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,d,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,Ew)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,K_),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,d,p,y,b){const C=this.layers[0].layout,D=C.get("line-join").evaluate(o,{}),T=C.get("line-cap").evaluate(o,{}),k=C.get("line-miter-limit"),L=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const N of l)this.addLine(N,o,D,T,k,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,y,b,p)}addLine(o,l,d,p,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<o.length-1;q++)this.totalDistance+=o[q].dist(o[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C="Polygon"===jv[l.type];let D=o.length;for(;D>=2&&o[D-1].equals(o[D-2]);)D--;let T=0;for(;T<D-1&&o[T].equals(o[T+1]);)T++;if(D<(C?3:2))return;"bevel"===d&&(y=1.05);const k=this.overscaling<=16?15*en/(512*this.overscaling):0,L=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let N,V,U,j,te;this.e1=this.e2=-1,C&&(N=o[D-2],te=o[T].sub(N)._unit()._perp());for(let q=T;q<D;q++){if(U=q===D-1?C?o[T+1]:void 0:o[q+1],U&&o[q].equals(U))continue;te&&(j=te),N&&(V=N),N=o[q],te=U?U.sub(N)._unit()._perp():j,j=j||te;let pe=j.add(te);0===pe.x&&0===pe.y||pe._unit();const ae=j.x*te.x+j.y*te.y,fe=pe.x*te.x+pe.y*te.y,ge=0!==fe?1/fe:1/0,_e=2*Math.sqrt(2-2*fe),Fe=fe<Q_&&V&&U,ke=j.x*te.y-j.y*te.x>0;if(Fe&&q>T){const ze=N.dist(V);if(ze>2*k){const Qe=N.sub(N.sub(V)._mult(k/ze)._round());this.updateDistance(V,Qe),this.addCurrentVertex(Qe,j,0,0,L),V=Qe}}const Ge=V&&U;let ct=Ge?d:C?"butt":p;if(Ge&&"round"===ct&&(ge<b?ct="miter":ge<=2&&(ct="fakeround")),"miter"===ct&&ge>y&&(ct="bevel"),"bevel"===ct&&(ge>2&&(ct="flipbevel"),ge<y&&(ct="miter")),V&&this.updateDistance(V,N),"miter"===ct)pe._mult(ge),this.addCurrentVertex(N,pe,0,0,L);else if("flipbevel"===ct){if(ge>100)pe=te.mult(-1);else{const ze=ge*j.add(te).mag()/j.sub(te).mag();pe._perp()._mult(ze*(ke?-1:1))}this.addCurrentVertex(N,pe,0,0,L),this.addCurrentVertex(N,pe.mult(-1),0,0,L)}else if("bevel"===ct||"fakeround"===ct){const ze=-Math.sqrt(ge*ge-1),Qe=ke?ze:0,Ye=ke?0:ze;if(V&&this.addCurrentVertex(N,j,Qe,Ye,L),"fakeround"===ct){const at=Math.round(180*_e/Math.PI/20);for(let pt=1;pt<at;pt++){let $e=pt/at;if(.5!==$e){const Ht=$e-.5;$e+=$e*Ht*($e-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*Ht*Ht+(.848013+ae*(.215638*ae-1.06021)))}const Mt=te.sub(j)._mult($e)._add(j)._unit()._mult(ke?-1:1);this.addHalfVertex(N,Mt.x,Mt.y,!1,ke,0,L)}}U&&this.addCurrentVertex(N,te,-Qe,-Ye,L)}else if("butt"===ct)this.addCurrentVertex(N,pe,0,0,L);else if("square"===ct){const ze=V?1:-1;V||this.addCurrentVertex(N,pe,ze,ze,L),this.addCurrentVertex(N,pe,0,0,L),V&&this.addCurrentVertex(N,pe,ze,ze,L)}else"round"===ct&&(V&&(this.addCurrentVertex(N,j,0,0,L),this.addCurrentVertex(N,j,1,1,L,!0)),U&&(this.addCurrentVertex(N,te,-1,-1,L,!0),this.addCurrentVertex(N,te,0,0,L)));if(Fe&&q<D-1){const ze=N.dist(U);if(ze>2*k){const Qe=N.add(U.sub(N)._mult(k/ze)._round());this.updateDistance(N,Qe),this.addCurrentVertex(Qe,te,0,0,L),N=Qe}}}}addCurrentVertex(o,l,d,p,y,b=!1){const C=l.y*p-l.x,D=-l.y-l.x*p;this.addHalfVertex(o,l.x+l.y*d,l.y-l.x*d,b,!1,d,y),this.addHalfVertex(o,C,D,b,!0,-p,y)}addHalfVertex({x:o,y:l},d,p,y,b,C,D){this.layoutVertexArray.emplaceBack((o<<1)+(y?1:0),(l<<1)+(b?1:0),Math.round(63*d)+128,Math.round(63*p)+128,1+(0===C?0:C<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const T=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),D.primitiveLength++),b?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}jt(Tm,"LineBucket",{omit:["layers","patternFeatures"]});const $v=new ue({"line-cap":new ne(He.layout_line["line-cap"]),"line-join":new ne(He.layout_line["line-join"]),"line-miter-limit":new G(He.layout_line["line-miter-limit"]),"line-round-limit":new G(He.layout_line["line-round-limit"]),"line-sort-key":new ne(He.layout_line["line-sort-key"])});var Bf={paint:new ue({"line-opacity":new ne(He.paint_line["line-opacity"]),"line-color":new ne(He.paint_line["line-color"]),"line-translate":new G(He.paint_line["line-translate"]),"line-translate-anchor":new G(He.paint_line["line-translate-anchor"]),"line-width":new ne(He.paint_line["line-width"]),"line-gap-width":new ne(He.paint_line["line-gap-width"]),"line-offset":new ne(He.paint_line["line-offset"]),"line-blur":new ne(He.paint_line["line-blur"]),"line-dasharray":new ne(He.paint_line["line-dasharray"]),"line-pattern":new ne(He.paint_line["line-pattern"]),"line-gradient":new ce(He.paint_line["line-gradient"]),"line-trim-offset":new G(He.paint_line["line-trim-offset"])}),layout:$v};const Mw=new class extends ne{possiblyEvaluate(a,o){return o=new R(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,l,d){return o=Tr({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,l,d)}}(Bf.paint.properties["line-width"].specification);function Hv(a,o){return o>0?o+2*a:a}Mw.useIntegerZoom=!0;const TT=Te([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ST=Te([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),IT=Te([{name:"a_projected_pos",components:4,type:"Float32"}],4);Te([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Dw=Te([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Tw=Te([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Te([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Sm=Te([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gv=Te([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Te([{name:"triangle",components:3,type:"Uint16"}]),Te([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Te([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Te([{type:"Float32",name:"offsetX"}]),Te([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var xr=24;const Xa=128;function qv(a,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new R(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:d,interpolationType:p}=l;let y=0;for(;y<d.length&&d[y]<=a;)y++;y=Math.max(0,y-1);let b=y;for(;b<d.length&&d[b]<a+1;)b++;b=Math.min(d.length-1,b);const C=d[y],D=d[b];return"composite"===l.kind?{kind:"composite",minZoom:C,maxZoom:D,interpolationType:p}:{kind:"camera",minZoom:C,maxZoom:D,minSize:l.evaluate(new R(C)),maxSize:l.evaluate(new R(D)),interpolationType:p}}}function Wv(a,{uSize:o,uSizeT:l},{lowerSize:d,upperSize:p}){return"source"===a.kind?d/Xa:"composite"===a.kind?Nn(d/Xa,p/Xa,l):o}function Vf(a,o){let l=0,d=0;if("constant"===a.kind)d=a.layoutSize;else if("source"!==a.kind){const{interpolationType:p,minZoom:y,maxZoom:b}=a,C=p?Ln(Nr.interpolationFactor(p,o,y,b),0,1):0;"camera"===a.kind?d=Nn(a.minSize,a.maxSize,C):l=C}return{uSizeT:l,uSize:d}}var Zv=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Xa,evaluateSizeForFeature:Wv,evaluateSizeForZoom:Vf,getSizeData:qv});function AT(a,o,l){return a.sections.forEach(d=>{d.text=function(p,y,b){const C=y.layout.get("text-transform").evaluate(b,{});return"uppercase"===C?p=p.toLocaleUpperCase():"lowercase"===C&&(p=p.toLocaleLowerCase()),O.applyArabicShaping&&(p=O.applyArabicShaping(p)),p}(d.text,o,l)}),a}const Al={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function J_(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function Xv(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var Yv=xi,Kv=function(a,o,l,d,p){var y,b,C=8*p-d-1,D=(1<<C)-1,T=D>>1,k=-7,L=l?p-1:0,N=l?-1:1,V=a[o+L];for(L+=N,y=V&(1<<-k)-1,V>>=-k,k+=C;k>0;y=256*y+a[o+L],L+=N,k-=8);for(b=y&(1<<-k)-1,y>>=-k,k+=d;k>0;b=256*b+a[o+L],L+=N,k-=8);if(0===y)y=1-T;else{if(y===D)return b?NaN:1/0*(V?-1:1);b+=Math.pow(2,d),y-=T}return(V?-1:1)*b*Math.pow(2,y-d)},Qv=function(a,o,l,d,p,y){var b,C,D,T=8*y-p-1,k=(1<<T)-1,L=k>>1,N=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,V=d?0:y-1,U=d?1:-1,j=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(C=isNaN(o)?1:0,b=k):(b=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-b))<1&&(b--,D*=2),(o+=b+L>=1?N/D:N*Math.pow(2,1-L))*D>=2&&(b++,D/=2),b+L>=k?(C=0,b=k):b+L>=1?(C=(o*D-1)*Math.pow(2,p),b+=L):(C=o*Math.pow(2,L-1)*Math.pow(2,p),b=0));p>=8;a[l+V]=255&C,V+=U,C/=256,p-=8);for(b=b<<p|C,T+=p;T>0;a[l+V]=255&b,V+=U,b/=256,T-=8);a[l+V-U]|=128*j};function xi(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}xi.Varint=0,xi.Fixed64=1,xi.Bytes=2,xi.Fixed32=5;var Jv=4294967296,Sw=1/Jv,Iw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Pc(a){return a.type===xi.Bytes?a.readVarint()+a.pos:a.pos+1}function Oc(a,o,l){var d=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(d);for(var p=l.pos-1;p>=a;p--)l.buf[p+d]=l.buf[p]}function Im(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function PT(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function dk(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function hk(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function fk(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function pk(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function mk(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function Aw(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function OT(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function ey(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function jf(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function Pw(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}xi.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),p=d>>3,y=this.pos;this.type=7&d,a(p,o,this),this.pos===y&&this.skip(d)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=ey(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Pw(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=ey(this.buf,this.pos)+ey(this.buf,this.pos+4)*Jv;return this.pos+=8,a},readSFixed64:function(){var a=ey(this.buf,this.pos)+Pw(this.buf,this.pos+4)*Jv;return this.pos+=8,a},readFloat:function(){var a=Kv(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Kv(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,d=this.buf;return o=127&(l=d[this.pos++]),l<128?o:(o|=(127&(l=d[this.pos++]))<<7,l<128?o:(o|=(127&(l=d[this.pos++]))<<14,l<128?o:(o|=(127&(l=d[this.pos++]))<<21,l<128?o:function(p,y,b){var C,D,T=b.buf;if(C=(112&(D=T[b.pos++]))>>4,D<128||(C|=(127&(D=T[b.pos++]))<<3,D<128)||(C|=(127&(D=T[b.pos++]))<<10,D<128)||(C|=(127&(D=T[b.pos++]))<<17,D<128)||(C|=(127&(D=T[b.pos++]))<<24,D<128)||(C|=(1&(D=T[b.pos++]))<<31,D<128))return function Uf(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(p,C,y);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=d[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&Iw?Iw.decode(this.buf.subarray(o,a)):function(l,d,p){for(var y="",b=d;b<p;){var C,D,T,k=l[b],L=null,N=k>239?4:k>223?3:k>191?2:1;if(b+N>p)break;1===N?k<128&&(L=k):2===N?128==(192&(C=l[b+1]))&&(L=(31&k)<<6|63&C)<=127&&(L=null):3===N?(D=l[b+2],128==(192&(C=l[b+1]))&&128==(192&D)&&((L=(15&k)<<12|(63&C)<<6|63&D)<=2047||L>=55296&&L<=57343)&&(L=null)):4===N&&(D=l[b+2],T=l[b+3],128==(192&(C=l[b+1]))&&128==(192&D)&&128==(192&T)&&((L=(15&k)<<18|(63&C)<<12|(63&D)<<6|63&T)<=65535||L>=1114112)&&(L=null)),null===L?(L=65533,N=1):L>65535&&(L-=65536,y+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),y+=String.fromCharCode(L),b+=N}return y}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==xi.Bytes)return a.push(this.readVarint(o));var l=Pc(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==xi.Bytes)return a.push(this.readSVarint());var o=Pc(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==xi.Bytes)return a.push(this.readBoolean());var o=Pc(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==xi.Bytes)return a.push(this.readFloat());var o=Pc(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==xi.Bytes)return a.push(this.readDouble());var o=Pc(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==xi.Bytes)return a.push(this.readFixed32());var o=Pc(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==xi.Bytes)return a.push(this.readSFixed32());var o=Pc(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==xi.Bytes)return a.push(this.readFixed64());var o=Pc(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==xi.Bytes)return a.push(this.readSFixed64());var o=Pc(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===xi.Varint)for(;this.buf[this.pos++]>127;);else if(o===xi.Bytes)this.pos=this.readVarint()+this.pos;else if(o===xi.Fixed32)this.pos+=4;else{if(o!==xi.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),jf(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),jf(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),jf(this.buf,-1&a,this.pos),jf(this.buf,Math.floor(a*Sw),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),jf(this.buf,-1&a,this.pos),jf(this.buf,Math.floor(a*Sw),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var d,p,y,C;if(o>=0?(d=o%4294967296|0,p=o/4294967296|0):(p=~(-o/4294967296),4294967295^(d=~(-o%4294967296))?d=d+1|0:(d=0,p=p+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),y=d,(C=l).buf[C.pos++]=127&y|128,y>>>=7,C.buf[C.pos++]=127&y|128,y>>>=7,C.buf[C.pos++]=127&y|128,y>>>=7,C.buf[C.pos++]=127&y|128,C.buf[C.pos]=127&(y>>>=7),function(y,b){var C=(7&y)<<4;b.buf[b.pos++]|=C|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))}(p,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(d,p,y){for(var b,C,D=0;D<p.length;D++){if((b=p.charCodeAt(D))>55295&&b<57344){if(!C){b>56319||D+1===p.length?(d[y++]=239,d[y++]=191,d[y++]=189):C=b;continue}if(b<56320){d[y++]=239,d[y++]=191,d[y++]=189,C=b;continue}b=C-55296<<10|b-56320|65536,C=null}else C&&(d[y++]=239,d[y++]=191,d[y++]=189,C=null);b<128?d[y++]=b:(b<2048?d[y++]=b>>6|192:(b<65536?d[y++]=b>>12|224:(d[y++]=b>>18|240,d[y++]=b>>12&63|128),d[y++]=b>>6&63|128),d[y++]=63&b|128)}return y}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&Oc(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),Qv(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Qv(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var d=this.pos-l;d>=128&&Oc(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,o,l){this.writeTag(a,xi.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,Im,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,PT,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,fk,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,dk,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,hk,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,pk,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,mk,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,Aw,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,OT,o)},writeBytesField:function(a,o){this.writeTag(a,xi.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,xi.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,xi.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,xi.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,xi.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,xi.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,xi.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,xi.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,xi.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,xi.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,!!o)}};var $f=Wo(Yv);const Ya=3;function Am(a,o,l){o.glyphs=[],1===a&&l.readMessage(Ow,o)}function Ow(a,o,l){if(3===a){const{id:d,bitmap:p,width:y,height:b,left:C,top:D,advance:T}=l.readMessage(kw,{});o.glyphs.push({id:d,bitmap:new ju({width:y+2*Ya,height:b+2*Ya},p),metrics:{width:y,height:b,left:C,top:D,advance:T}})}else 4===a?o.ascender=l.readSVarint():5===a&&(o.descender=l.readSVarint())}function kw(a,o,l){1===a?o.id=l.readVarint():2===a?o.bitmap=l.readBytes():3===a?o.width=l.readVarint():4===a?o.height=l.readVarint():5===a?o.left=l.readSVarint():6===a?o.top=l.readSVarint():7===a&&(o.advance=l.readVarint())}const eb=Ya;function Rw(a){let o=0,l=0;for(const b of a)o+=b.w*b.h,l=Math.max(l,b.w);a.sort((b,C)=>C.h-b.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let p=0,y=0;for(const b of a)for(let C=d.length-1;C>=0;C--){const D=d[C];if(!(b.w>D.w||b.h>D.h)){if(b.x=D.x,b.y=D.y,y=Math.max(y,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===D.w&&b.h===D.h){const T=d.pop();C<d.length&&(d[C]=T)}else b.h===D.h?(D.x+=b.w,D.w-=b.w):b.w===D.w?(D.y+=b.h,D.h-=b.h):(d.push({x:D.x+b.w,y:D.y,w:D.w-b.w,h:b.h}),D.y+=b.h,D.h-=b.h);break}}return{w:p,h:y,fill:o/(p*y)||0}}const Es=1;class Lw{constructor(o,{pixelRatio:l,version:d,stretchX:p,stretchY:y,content:b}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=p,this.stretchY=y,this.content=b,this.version=d}get tl(){return[this.paddedRect.x+Es,this.paddedRect.y+Es]}get br(){return[this.paddedRect.x+this.paddedRect.w-Es,this.paddedRect.y+this.paddedRect.h-Es]}get displaySize(){return[(this.paddedRect.w-2*Es)/this.pixelRatio,(this.paddedRect.h-2*Es)/this.pixelRatio]}}class ty{constructor(o,l){const d={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(o,d,y),this.addImages(l,p,y);const{w:b,h:C}=Rw(y),D=new Cs({width:b||1,height:C||1});for(const T in o){const k=o[T],L=d[T].paddedRect;Cs.copy(k.data,D,{x:0,y:0},{x:L.x+Es,y:L.y+Es},k.data)}for(const T in l){const k=l[T],L=p[T].paddedRect,N=L.x+Es,V=L.y+Es,U=k.data.width,j=k.data.height;Cs.copy(k.data,D,{x:0,y:0},{x:N,y:V},k.data),Cs.copy(k.data,D,{x:0,y:j-1},{x:N,y:V-1},{width:U,height:1}),Cs.copy(k.data,D,{x:0,y:0},{x:N,y:V+j},{width:U,height:1}),Cs.copy(k.data,D,{x:U-1,y:0},{x:N-1,y:V},{width:1,height:j}),Cs.copy(k.data,D,{x:0,y:0},{x:N+U,y:V},{width:1,height:j})}this.image=D,this.iconPositions=d,this.patternPositions=p}addImages(o,l,d){for(const p in o){const y=o[p],b={x:0,y:0,w:y.data.width+2*Es,h:y.data.height+2*Es};d.push(b),l[p]=new Lw(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>o.hasImage(d)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in o.updatedImages)this.patchUpdatedImage(this.iconPositions[d],o.getImage(d),l),this.patchUpdatedImage(this.patternPositions[d],o.getImage(d),l)}patchUpdatedImage(o,l,d){if(!o||!l||o.version===l.version)return;o.version=l.version;const[p,y]=o.tl;d.update(l.data,void 0,{x:p,y})}}jt(Lw,"ImagePosition"),jt(ty,"ImageAtlas");const rs={horizontal:1,vertical:2,horizontalOnly:3},kT=-17;class ny{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const d=new ny;return d.scale=o||1,d.fontStack=l,d}static forImage(o){const l=new ny;return l.imageName=o,l}}class dh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const d=new dh;for(let p=0;p<o.sections.length;p++){const y=o.sections[p];y.image?d.addImageSection(y):d.addTextSection(y,l)}return d}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(l,d){let p="";for(let y=0;y<l.length;y++){const b=l.charCodeAt(y+1)||null,C=l.charCodeAt(y-1)||null;p+=!d&&(b&&cv(b)&&!Al[l[y+1]]||C&&cv(C)&&!Al[l[y-1]])||!Al[l[y]]?l[y]:Al[l[y]]}return p}(this.text,o)}trim(){let o=0;for(let d=0;d<this.text.length&&iy[this.text.charCodeAt(d)];d++)o++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=o&&iy[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const d=new dh;return d.text=this.text.substring(o,l),d.sectionIndex=this.sectionIndex.slice(o,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(ny.forText(o.scale,o.fontStack||l));const d=this.sections.length-1;for(let p=0;p<o.text.length;++p)this.sectionIndex.push(d)}addImageSection(o){const l=o.image?o.image.name:"";if(0===l.length)return void Fi("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(ny.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Fi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function tb(a,o,l,d,p,y,b,C,D,T,k,L,N,V,U){const j=dh.fromFeature(a,p);L===rs.vertical&&j.verticalizePunctuation(N);let te=[];const q=function(_e,Fe,ke,Ge,ct,ze){if(!_e)return[];const Qe=[],Ye=function(Mt,Ht,Rt,gn,_t,Jt){let un=0;for(let Kn=0;Kn<Mt.length();Kn++){const _n=Mt.getSection(Kn);un+=Fw(Mt.getCharCode(Kn),_n,gn,_t,Ht,Jt)}return un/Math.max(1,Math.ceil(un/Rt))}(_e,Fe,ke,Ge,ct,ze),at=_e.text.indexOf("\u200b")>=0;let pt=0;for(let Mt=0;Mt<_e.length();Mt++){const Ht=_e.getSection(Mt),Rt=_e.getCharCode(Mt);if(iy[Rt]||(pt+=Fw(Rt,Ht,Ge,ct,Fe,ze)),Mt<_e.length()-1){const gn=!(($e=Rt)<11904||!(zt["Bopomofo Extended"]($e)||zt.Bopomofo($e)||zt["CJK Compatibility Forms"]($e)||zt["CJK Compatibility Ideographs"]($e)||zt["CJK Compatibility"]($e)||zt["CJK Radicals Supplement"]($e)||zt["CJK Strokes"]($e)||zt["CJK Symbols and Punctuation"]($e)||zt["CJK Unified Ideographs Extension A"]($e)||zt["CJK Unified Ideographs"]($e)||zt["Enclosed CJK Letters and Months"]($e)||zt["Halfwidth and Fullwidth Forms"]($e)||zt.Hiragana($e)||zt["Ideographic Description Characters"]($e)||zt["Kangxi Radicals"]($e)||zt["Katakana Phonetic Extensions"]($e)||zt.Katakana($e)||zt["Vertical Forms"]($e)||zt["Yi Radicals"]($e)||zt["Yi Syllables"]($e)));(RT[Rt]||gn||Ht.imageName)&&Qe.push(Nw(Mt+1,pt,Ye,Qe,ry(Rt,_e.getCharCode(Mt+1),gn&&at),!1))}}var $e;return oy(Nw(_e.length(),pt,Ye,Qe,0,!0))}(j,T,y,o,d,V),{processBidirectionalText:pe,processStyledBidirectionalText:ae}=O;if(pe&&1===j.sections.length){const _e=pe(j.toString(),q);for(const Fe of _e){const ke=new dh;ke.text=Fe,ke.sections=j.sections;for(let Ge=0;Ge<Fe.length;Ge++)ke.sectionIndex.push(0);te.push(ke)}}else if(ae){const _e=ae(j.text,j.sectionIndex,q);for(const Fe of _e){const ke=new dh;ke.text=Fe[0],ke.sectionIndex=Fe[1],ke.sections=j.sections,te.push(ke)}}else te=function(_e,Fe){const ke=[],Ge=_e.text;let ct=0;for(const ze of Fe)ke.push(_e.substring(ct,ze)),ct=ze;return ct<Ge.length&&ke.push(_e.substring(ct,Ge.length)),ke}(j,q);const fe=[],ge={positionedLines:fe,text:j.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(_e,Fe,ke,Ge,ct,ze,Qe,Ye,at,pt,$e,Mt){let Ht=0,Rt=0,gn=0;const _t="right"===Ye?1:"left"===Ye?0:.5;let Jt=!1;for(const xn of ct){const Cn=xn.getSections();for(const di of Cn){if(di.imageName)continue;const wi=Fe[di.fontStack];if(wi&&(Jt=void 0!==wi.ascender&&void 0!==wi.descender,!Jt))break}if(!Jt)break}let un=0;for(const xn of ct){xn.trim();const Cn=xn.getMaxScale(),di=(Cn-1)*xr,wi={positionedGlyphs:[],lineOffset:0};_e.positionedLines[un]=wi;const Di=wi.positionedGlyphs;let Ci=0;if(!xn.length()){Rt+=ze,++un;continue}let Xi=0,nr=0;for(let Ei=0;Ei<xn.length();Ei++){const wr=xn.getSection(Ei),Rr=xn.getSectionIndex(Ei),ir=xn.getCharCode(Ei);let ei=wr.scale,Lr=null,Ti=null,ur=null,dr=xr,ro=0;const Hr=!(at===rs.horizontal||!$e&&!a_(ir)||$e&&(iy[ir]||(Kn=ir,zt.Arabic(Kn)||zt["Arabic Supplement"](Kn)||zt["Arabic Extended-A"](Kn)||zt["Arabic Presentation Forms-A"](Kn)||zt["Arabic Presentation Forms-B"](Kn))));if(wr.imageName){const Uo=Ge[wr.imageName];if(!Uo)continue;ur=wr.imageName,_e.iconsInText=_e.iconsInText||!0,Ti=Uo.paddedRect;const Gr=Uo.displaySize;ei=ei*xr/Mt,Lr={width:Gr[0],height:Gr[1],left:Es,top:-eb,advance:Hr?Gr[1]:Gr[0],localGlyph:!1},ro=Jt?-Lr.height*ei:kT+Cn*xr-Gr[1]*ei,dr=Lr.advance;const Ma=(Hr?Gr[0]:Gr[1])*ei-xr*Cn;Ma>0&&Ma>Ci&&(Ci=Ma)}else{const Uo=ke[wr.fontStack];if(!Uo)continue;Uo[ir]&&(Ti=Uo[ir]);const Gr=Fe[wr.fontStack];if(!Gr)continue;const Ma=Gr.glyphs[ir];if(!Ma)continue;if(Lr=Ma.metrics,dr=8203!==ir?xr:0,Jt){const zc=void 0!==Gr.ascender?Math.abs(Gr.ascender):0,yh=void 0!==Gr.descender?Math.abs(Gr.descender):0,Ey=(zc+yh)*ei;Xi<Ey&&(Xi=Ey,nr=(zc-yh)/2*ei),ro=-zc*ei}else ro=kT+(Cn-ei)*xr}Hr?(_e.verticalizable=!0,Di.push({glyph:ir,imageName:ur,x:Ht,y:Rt+ro,vertical:Hr,scale:ei,localGlyph:Lr.localGlyph,fontStack:wr.fontStack,sectionIndex:Rr,metrics:Lr,rect:Ti}),Ht+=dr*ei+pt):(Di.push({glyph:ir,imageName:ur,x:Ht,y:Rt+ro,vertical:Hr,scale:ei,localGlyph:Lr.localGlyph,fontStack:wr.fontStack,sectionIndex:Rr,metrics:Lr,rect:Ti}),Ht+=Lr.advance*ei+pt)}0!==Di.length&&(gn=Math.max(Ht-pt,gn),Jt?hh(Di,_t,Ci,nr,ze*Cn/2):hh(Di,_t,Ci,0,ze/2)),Ht=0;const kr=ze*Cn+Ci;wi.lineOffset=Math.max(Ci,di),Rt+=kr,++un}var Kn;const _n=Rt,{horizontalAlign:Xt,verticalAlign:Ri}=ib(Qe);(function(xn,Cn,di,wi,Di,Ci){const Xi=(Cn-di)*Di,nr=-Ci*wi;for(const kr of xn)for(const Ei of kr.positionedGlyphs)Ei.x+=Xi,Ei.y+=nr})(_e.positionedLines,_t,Xt,Ri,gn,_n),_e.top+=-Ri*_n,_e.bottom=_e.top+_n,_e.left+=-Xt*gn,_e.right=_e.left+gn,_e.hasBaseline=Jt}(ge,o,l,d,te,b,C,D,L,T,N,U),!function(_e){for(const Fe of _e)if(0!==Fe.positionedGlyphs.length)return!1;return!0}(fe)&&ge}const iy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},RT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Fw(a,o,l,d,p,y){if(o.imageName){const b=d[o.imageName];return b?b.displaySize[0]*o.scale*xr/y+p:0}{const b=l[o.fontStack],C=b&&b.glyphs[a];return C?C.metrics.advance*o.scale+p:0}}function nb(a,o,l,d){const p=Math.pow(a-o,2);return d?a<o?p/2:2*p:p+Math.abs(l)*l}function ry(a,o,l){let d=0;return 10===a&&(d-=1e4),l&&(d+=150),40!==a&&65288!==a||(d+=50),41!==o&&65289!==o||(d+=50),d}function Nw(a,o,l,d,p,y){let b=null,C=nb(o,l,p,y);for(const D of d){const T=nb(o-D.x,l,p,y)+D.badness;T<=C&&(b=D,C=T)}return{index:a,x:o,priorBreak:b,badness:C}}function oy(a){return a?oy(a.priorBreak).concat(a.index):[]}function ib(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function hh(a,o,l,d,p){if(!(o||l||d||p))return;const y=a.length-1,b=a[y],C=(b.x+b.metrics.advance*b.scale)*o;for(let D=0;D<=y;D++)a[D].x-=C,a[D].y+=l+d+p}function LT(a,o,l){const{horizontalAlign:d,verticalAlign:p}=ib(l),y=o[0]-a.displaySize[0]*d,b=o[1]-a.displaySize[1]*p;return{image:a,top:b,bottom:b+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function zw(a,o,l,d,p,y){const b=a.image;let C;if(b.content){const te=b.content,q=b.pixelRatio||1;C=[te[0]/q,te[1]/q,b.displaySize[0]-te[2]/q,b.displaySize[1]-te[3]/q]}const D=o.left*y,T=o.right*y;let k,L,N,V;"width"===l||"both"===l?(V=p[0]+D-d[3],L=p[0]+T+d[1]):(V=p[0]+(D+T-b.displaySize[0])/2,L=V+b.displaySize[0]);const U=o.top*y,j=o.bottom*y;return"height"===l||"both"===l?(k=p[1]+U-d[0],N=p[1]+j+d[2]):(k=p[1]+(U+j-b.displaySize[1])/2,N=k+b.displaySize[1]),{image:b,top:k,right:L,bottom:N,left:V,collisionPadding:C}}class Pl extends Ct{constructor(o,l,d,p,y){super(o,l),this.angle=p,this.z=d,void 0!==y&&(this.segment=y)}clone(){return new Pl(this.x,this.y,this.z,this.angle,this.segment)}}function rb(a,o,l,d,p){if(void 0===o.segment)return!0;let y=o,b=o.segment+1,C=0;for(;C>-l/2;){if(b--,b<0)return!1;C-=a[b].dist(y),y=a[b]}C+=a[b].dist(a[b+1]),b++;const D=[];let T=0;for(;C<l/2;){const k=a[b],L=a[b+1];if(!L)return!1;let N=a[b-1].angleTo(k)-k.angleTo(L);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:C,angleDelta:N}),T+=N;C-D[0].distance>d;)T-=D.shift().angleDelta;if(T>p)return!1;b++,C+=k.dist(L)}return!0}function Bw(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function Vw(a,o,l){return a?.6*o*l:0}function Uw(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function FT(a,o,l,d,p,y){const b=Vw(l,p,y),C=Uw(l,d)*y;let D=0;const T=Bw(a)/2;for(let k=0;k<a.length-1;k++){const L=a[k],N=a[k+1],V=L.dist(N);if(D+V>T){const U=(T-D)/V,j=Nn(L.x,N.x,U),te=Nn(L.y,N.y,U),q=new Pl(j,te,0,N.angleTo(L),k);return!b||rb(a,q,C,b,o)?q:void 0}D+=V}}function jw(a,o,l,d,p,y,b,C,D){const T=Vw(d,y,b),k=Uw(d,p),L=k*b,N=0===a[0].x||a[0].x===D||0===a[0].y||a[0].y===D;return o-L<o/4&&(o=L+o/4),NT(a,N?o/2*C%o:(k/2+2*y)*b*C%o,o,T,l,L,N,!1,D)}function NT(a,o,l,d,p,y,b,C,D){const T=y/2,k=Bw(a);let L=0,N=o-l,V=[];for(let U=0;U<a.length-1;U++){const j=a[U],te=a[U+1],q=j.dist(te),pe=te.angleTo(j);for(;N+l<L+q;){N+=l;const ae=(N-L)/q,fe=Nn(j.x,te.x,ae),ge=Nn(j.y,te.y,ae);if(fe>=0&&fe<D&&ge>=0&&ge<D&&N-T>=0&&N+T<=k){const _e=new Pl(fe,ge,0,pe,U);_e._round(),d&&!rb(a,_e,y,d,p)||V.push(_e)}}L+=q}return C||V.length||b||(V=NT(a,L/2,l,d,p,y,b,!0,D)),V}function zT(a,o,l,d,p){const y=[];for(let b=0;b<a.length;b++){const C=a[b];let D;for(let T=0;T<C.length-1;T++){let k=C[T],L=C[T+1];k.x<o&&L.x<o||(k.x<o?k=new Ct(o,k.y+(o-k.x)/(L.x-k.x)*(L.y-k.y))._round():L.x<o&&(L=new Ct(o,k.y+(o-k.x)/(L.x-k.x)*(L.y-k.y))._round()),k.y<l&&L.y<l||(k.y<l?k=new Ct(k.x+(l-k.y)/(L.y-k.y)*(L.x-k.x),l)._round():L.y<l&&(L=new Ct(k.x+(l-k.y)/(L.y-k.y)*(L.x-k.x),l)._round()),k.x>=d&&L.x>=d||(k.x>=d?k=new Ct(d,k.y+(d-k.x)/(L.x-k.x)*(L.y-k.y))._round():L.x>=d&&(L=new Ct(d,k.y+(d-k.x)/(L.x-k.x)*(L.y-k.y))._round()),k.y>=p&&L.y>=p||(k.y>=p?k=new Ct(k.x+(p-k.y)/(L.y-k.y)*(L.x-k.x),p)._round():L.y>=p&&(L=new Ct(k.x+(p-k.y)/(L.y-k.y)*(L.x-k.x),p)._round()),D&&k.equals(D[D.length-1])||(D=[k],y.push(D)),D.push(L)))))}}return y}jt(Pl,"Anchor");const kc=1e20;function kt(a,o,l,d,p,y,b,C,D){for(let T=o;T<o+d;T++)Hf(a,l*y+T,y,p,b,C,D);for(let T=l;T<l+p;T++)Hf(a,T*y+o,1,d,b,C,D)}function Hf(a,o,l,d,p,y,b){y[0]=0,b[0]=-kc,b[1]=kc,p[0]=a[o];for(let C=1,D=0,T=0;C<d;C++){p[C]=a[o+C*l];const k=C*C;do{const L=y[D];T=(p[C]-p[L]+k-L*L)/(C-L)/2}while(T<=b[D]&&--D>-1);D++,y[D]=C,b[D]=T,b[D+1]=kc}for(let C=0,D=0;C<d;C++){for(;b[D+1]<C;)D++;const T=y[D],k=C-T;a[o+C*l]=p[T]+k*k}}const xa=2,sy={none:0,ideographs:1,all:2};class $u{constructor(o,l,d){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=d,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,l){const d=[];for(const p in o)for(const y of o[p])d.push({stack:p,id:y});jr(d,({stack:p,id:y},b)=>{let C=this.entries[p];C||(C=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=C.glyphs[y];if(void 0!==D)return void b(null,{stack:p,id:y,glyph:D});if(D=this._tinySDF(C,p,y),D)return C.glyphs[y]=D,void b(null,{stack:p,id:y,glyph:D});const T=Math.floor(y/256);if(256*T>65535)return void b(new Error("glyphs > 65535 not supported"));if(C.ranges[T])return void b(null,{stack:p,id:y,glyph:D});let k=C.requests[T];k||(k=C.requests[T]=[],$u.loadGlyphRange(p,T,this.url,this.requestManager,(L,N)=>{if(N){C.ascender=N.ascender,C.descender=N.descender;for(const V in N.glyphs)this._doesCharSupportLocalGlyph(+V)||(C.glyphs[+V]=N.glyphs[+V]);C.ranges[T]=!0}for(const V of k)V(L,N);delete C.requests[T]})),k.push((L,N)=>{L?b(L):N&&b(null,{stack:p,id:y,glyph:N.glyphs[y]||null})})},(p,y)=>{if(p)l(p);else if(y){const b={};for(const{stack:C,id:D,glyph:T}of y)void 0===b[C]&&(b[C]={}),void 0===b[C].glyphs&&(b[C].glyphs={}),b[C].glyphs[D]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},b[C].ascender=this.entries[C].ascender,b[C].descender=this.entries[C].descender;l(null,b)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==sy.none&&(this.localGlyphMode===sy.all?!!this.localFontFamily:!!this.localFontFamily&&(zt["CJK Unified Ideographs"](o)||zt["Hangul Syllables"](o)||zt.Hiragana(o)||zt.Katakana(o)||zt["CJK Symbols and Punctuation"](o)))}_tinySDF(o,l,d){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(d))return;let y=o.tinySDF;if(!y){let j="400";/bold/i.test(l)?j="900":/medium/i.test(l)?j="500":/light/i.test(l)&&(j="200"),y=o.tinySDF=new $u.TinySDF({fontFamily:p,fontWeight:j,fontSize:24*xa,buffer:3*xa,radius:8*xa}),y.fontWeight=j}if(this.localGlyphs[y.fontWeight][d])return this.localGlyphs[y.fontWeight][d];const b=String.fromCharCode(d),{data:C,width:D,height:T,glyphWidth:k,glyphHeight:L,glyphLeft:N,glyphTop:V,glyphAdvance:U}=y.draw(b);return this.localGlyphs[y.fontWeight][d]={id:d,bitmap:new ju({width:D,height:T},C),metrics:{width:k/xa,height:L/xa,left:N/xa,top:V/xa-27,advance:U/xa,localGlyph:!0}}}}$u.loadGlyphRange=function(a,o,l,d,p){const y=256*o,b=y+255,C=d.transformRequest(d.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${y}-${b}`),Lo.Glyphs);lu(C,(D,T)=>{if(D)p(D);else if(T){const k={},L=new $f(T).readFields(Am,{});for(const N of L.glyphs)k[N.id]=N;p(null,{glyphs:k,ascender:L.ascender,descender:L.descender})}})},$u.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:b="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=l;const C=this.size=a+4*o,D=this._createCanvas(C),T=this.ctx=D.getContext("2d",{willReadFrequently:!0});T.font=`${b} ${y} ${a}px ${p}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(a),b=Math.ceil(l),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),D=Math.min(this.size-this.buffer,b+Math.ceil(d)),T=C+2*this.buffer,k=D+2*this.buffer,L=Math.max(T*k,0),N=new Uint8ClampedArray(L),V={data:N,width:T,height:k,glyphWidth:C,glyphHeight:D,glyphTop:b,glyphLeft:0,glyphAdvance:o};if(0===C||0===D)return V;const{ctx:U,buffer:j,gridInner:te,gridOuter:q}=this;U.clearRect(j,j,C,D),U.fillText(a,j,j+b);const pe=U.getImageData(j,j,C,D);q.fill(kc,0,L),te.fill(0,0,L);for(let ae=0;ae<D;ae++)for(let fe=0;fe<C;fe++){const ge=pe.data[4*(ae*C+fe)+3]/255;if(0===ge)continue;const _e=(ae+j)*T+fe+j;if(1===ge)q[_e]=0,te[_e]=kc;else{const Fe=.5-ge;q[_e]=Fe>0?Fe*Fe:0,te[_e]=Fe<0?Fe*Fe:0}}kt(q,0,0,T,k,T,this.f,this.v,this.z),kt(te,j,j,C,D,T,this.f,this.v,this.z);for(let ae=0;ae<L;ae++){const fe=Math.sqrt(q[ae])-Math.sqrt(te[ae]);N[ae]=Math.round(255-255*(fe/this.radius+this.cutoff))}return V}};const Hu=Es;function $w(a,o,l,d){const p=[],y=a.image,b=y.pixelRatio,C=y.paddedRect.w-2*Hu,D=y.paddedRect.h-2*Hu,T=a.right-a.left,k=a.bottom-a.top,L=y.stretchX||[[0,C]],N=y.stretchY||[[0,D]],V=(ze,Qe)=>ze+Qe[1]-Qe[0],U=L.reduce(V,0),j=N.reduce(V,0),te=C-U,q=D-j;let pe=0,ae=U,fe=0,ge=j,_e=0,Fe=te,ke=0,Ge=q;if(y.content&&d){const ze=y.content;pe=Pm(L,0,ze[0]),fe=Pm(N,0,ze[1]),ae=Pm(L,ze[0],ze[2]),ge=Pm(N,ze[1],ze[3]),_e=ze[0]-pe,ke=ze[1]-fe,Fe=ze[2]-ze[0]-ae,Ge=ze[3]-ze[1]-ge}const ct=(ze,Qe,Ye,at)=>{const pt=fh(ze.stretch-pe,ae,T,a.left),$e=sb(ze.fixed-_e,Fe,ze.stretch,U),Mt=fh(Qe.stretch-fe,ge,k,a.top),Ht=sb(Qe.fixed-ke,Ge,Qe.stretch,j),Rt=fh(Ye.stretch-pe,ae,T,a.left),gn=sb(Ye.fixed-_e,Fe,Ye.stretch,U),_t=fh(at.stretch-fe,ge,k,a.top),Jt=sb(at.fixed-ke,Ge,at.stretch,j),un=new Ct(pt,Mt),Kn=new Ct(Rt,Mt),_n=new Ct(Rt,_t),Xt=new Ct(pt,_t),Ri=new Ct($e/b,Ht/b),xn=new Ct(gn/b,Jt/b),Cn=o*Math.PI/180;if(Cn){const Di=Math.sin(Cn),Ci=Math.cos(Cn),Xi=[Ci,-Di,Di,Ci];un._matMult(Xi),Kn._matMult(Xi),Xt._matMult(Xi),_n._matMult(Xi)}const di=ze.stretch+ze.fixed,wi=Qe.stretch+Qe.fixed;return{tl:un,tr:Kn,bl:Xt,br:_n,tex:{x:y.paddedRect.x+Hu+di,y:y.paddedRect.y+Hu+wi,w:Ye.stretch+Ye.fixed-di,h:at.stretch+at.fixed-wi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ri,pixelOffsetBR:xn,minFontScaleX:Fe/b/T,minFontScaleY:Ge/b/k,isSDF:l}};if(d&&(y.stretchX||y.stretchY)){const ze=ob(L,te,U),Qe=ob(N,q,j);for(let Ye=0;Ye<ze.length-1;Ye++){const at=ze[Ye],pt=ze[Ye+1];for(let $e=0;$e<Qe.length-1;$e++)p.push(ct(at,Qe[$e],pt,Qe[$e+1]))}}else p.push(ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:D+1}));return p}function Pm(a,o,l){let d=0;for(const p of a)d+=Math.max(o,Math.min(l,p[1]))-Math.max(o,Math.min(l,p[0]));return d}function ob(a,o,l){const d=[{fixed:-Hu,stretch:0}];for(const[p,y]of a){const b=d[d.length-1];d.push({fixed:p-b.stretch,stretch:b.stretch}),d.push({fixed:p-b.stretch,stretch:b.stretch+(y-p)})}return d.push({fixed:o+Hu,stretch:l}),d}function fh(a,o,l,d){return a/o*l+d}function sb(a,o,l,d){return a-o*l/d}function ab(a,o,l,d){const p=o+a.positionedLines[d].lineOffset;return 0===d?l+p/2:l+(p+(o+a.positionedLines[d-1].lineOffset))/2}class BT{constructor(o=[],l=lb){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:d}=this,p=l[o];for(;o>0;){const y=o-1>>1,b=l[y];if(d(p,b)>=0)break;l[o]=b,o=y}l[o]=p}_down(o){const{data:l,compare:d}=this,p=this.length>>1,y=l[o];for(;o<p;){let b=1+(o<<1),C=l[b];const D=b+1;if(D<this.length&&d(l[D],C)<0&&(b=D,C=l[D]),d(C,y)>=0)break;l[o]=C,o=b}l[o]=y}}function lb(a,o){return a<o?-1:a>o?1:0}function Hw(a,o=1,l=!1){let d=1/0,p=1/0,y=-1/0,b=-1/0;const C=a[0];for(let V=0;V<C.length;V++){const U=C[V];(!V||U.x<d)&&(d=U.x),(!V||U.y<p)&&(p=U.y),(!V||U.x>y)&&(y=U.x),(!V||U.y>b)&&(b=U.y)}const D=Math.min(y-d,b-p);let T=D/2;const k=new BT([],Gw);if(0===D)return new Ct(d,p);for(let V=d;V<y;V+=D)for(let U=p;U<b;U+=D)k.push(new wa(V+T,U+T,T,a));let L=function(V){let U=0,j=0,te=0;const q=V[0];for(let pe=0,ae=q.length,fe=ae-1;pe<ae;fe=pe++){const ge=q[pe],_e=q[fe],Fe=ge.x*_e.y-_e.x*ge.y;j+=(ge.x+_e.x)*Fe,te+=(ge.y+_e.y)*Fe,U+=3*Fe}return new wa(j/U,te/U,0,V)}(a),N=k.length;for(;k.length;){const V=k.pop();(V.d>L.d||!L.d)&&(L=V,l&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,N)),V.max-L.d<=o||(T=V.h/2,k.push(new wa(V.p.x-T,V.p.y-T,T,a)),k.push(new wa(V.p.x+T,V.p.y-T,T,a)),k.push(new wa(V.p.x-T,V.p.y+T,T,a)),k.push(new wa(V.p.x+T,V.p.y+T,T,a)),N+=4)}return l&&(console.log(`num probes: ${N}`),console.log(`best distance: ${L.d}`)),L.p}function Gw(a,o){return o.max-a.max}class wa{constructor(o,l,d,p){this.p=new Ct(o,l),this.h=d,this.d=function(y,b){let C=!1,D=1/0;for(let T=0;T<b.length;T++){const k=b[T];for(let L=0,N=k.length,V=N-1;L<N;V=L++){const U=k[L],j=k[V];U.y>y.y!=j.y>y.y&&y.x<(j.x-U.x)*(y.y-U.y)/(j.y-U.y)+U.x&&(C=!C),D=Math.min(D,gm(y,U,j))}}return(C?1:-1)*Math.sqrt(D)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Gf=7,Om=Number.POSITIVE_INFINITY,ay=Math.sqrt(2);function qw(a,[o,l]){let d=0,p=0;if(l===Om){o<0&&(o=0);const y=o/ay;switch(a){case"top-right":case"top-left":p=y-Gf;break;case"bottom-right":case"bottom-left":p=-y+Gf;break;case"bottom":p=-o+Gf;break;case"top":p=o-Gf}switch(a){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=o;break;case"right":d=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),a){case"top-right":case"top-left":case"top":p=l-Gf;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+Gf}switch(a){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}}return[d,p]}function cb(a,o,l,d,p,y,b,C,D,T){a.createArrays(),a.tilePixelRatio=en/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const k=a.layers[0].layout,L=a.layers[0]._unevaluatedLayout._values,N={};if("composite"===a.textSizeData.kind){const{minZoom:j,maxZoom:te}=a.textSizeData;N.compositeTextSizes=[L["text-size"].possiblyEvaluate(new R(j),C),L["text-size"].possiblyEvaluate(new R(te),C)]}if("composite"===a.iconSizeData.kind){const{minZoom:j,maxZoom:te}=a.iconSizeData;N.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new R(j),C),L["icon-size"].possiblyEvaluate(new R(te),C)]}N.layoutTextSize=L["text-size"].possiblyEvaluate(new R(D+1),C),N.layoutIconSize=L["icon-size"].possiblyEvaluate(new R(D+1),C),N.textMaxSize=L["text-size"].possiblyEvaluate(new R(18),C);const V="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),U=k.get("text-size");for(const j of a.features){const te=k.get("text-font").evaluate(j,{},C).join(","),q=U.evaluate(j,{},C),pe=N.layoutTextSize.evaluate(j,{},C),ae=(N.layoutIconSize.evaluate(j,{},C),{horizontal:{},vertical:void 0}),fe=j.text;let ge,_e=[0,0];if(fe){const Ge=fe.toString(),ct=k.get("text-letter-spacing").evaluate(j,{},C)*xr,ze=k.get("text-line-height").evaluate(j,{},C)*xr,Qe=s_(Ge)?ct:0,Ye=k.get("text-anchor").evaluate(j,{},C),at=k.get("text-variable-anchor");if(!at){const Rt=k.get("text-radial-offset").evaluate(j,{},C);_e=Rt?qw(Ye,[Rt*xr,Om]):k.get("text-offset").evaluate(j,{},C).map(gn=>gn*xr)}let pt=V?"center":k.get("text-justify").evaluate(j,{},C);const $e="point"===k.get("symbol-placement"),Mt=$e?k.get("text-max-width").evaluate(j,{},C)*xr:1/0,Ht=Rt=>{a.allowVerticalPlacement&&o_(Ge)&&(ae.vertical=tb(fe,o,l,p,te,Mt,ze,Ye,Rt,Qe,_e,rs.vertical,!0,pe,q))};if(!V&&at){const Rt="auto"===pt?at.map(_t=>qf(_t)):[pt];let gn=!1;for(let _t=0;_t<Rt.length;_t++){const Jt=Rt[_t];if(!ae.horizontal[Jt])if(gn)ae.horizontal[Jt]=ae.horizontal[0];else{const un=tb(fe,o,l,p,te,Mt,ze,"center",Jt,Qe,_e,rs.horizontal,!1,pe,q);un&&(ae.horizontal[Jt]=un,gn=1===un.positionedLines.length)}}Ht("left")}else{if("auto"===pt&&(pt=qf(Ye)),$e||k.get("text-writing-mode").indexOf("horizontal")>=0||!o_(Ge)){const Rt=tb(fe,o,l,p,te,Mt,ze,Ye,pt,Qe,_e,rs.horizontal,!1,pe,q);Rt&&(ae.horizontal[pt]=Rt)}Ht($e?"left":pt)}}let Fe=!1;if(j.icon&&j.icon.name){const Ge=d[j.icon.name];Ge&&(ge=LT(p[j.icon.name],k.get("icon-offset").evaluate(j,{},C),k.get("icon-anchor").evaluate(j,{},C)),Fe=Ge.sdf,void 0===a.sdfIcons?a.sdfIcons=Ge.sdf:a.sdfIcons!==Ge.sdf&&Fi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ge.pixelRatio!==a.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const ke=Zw(ae.horizontal)||ae.vertical;a.iconsInText||(a.iconsInText=!!ke&&ke.iconsInText),(ke||ge)&&Xs(a,j,ae,ge,d,N,pe,0,_e,Fe,b,C,T)}y&&a.generateCollisionDebugBuffers(D,a.collisionBoxArray)}function qf(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Xs(a,o,l,d,p,y,b,C,D,T,k,L,N){let V=y.textMaxSize.evaluate(o,{},L);void 0===V&&(V=b);const U=a.layers[0].layout,j=U.get("icon-offset").evaluate(o,{},L),te=Zw(l.horizontal)||l.vertical,q="globe"===N.name,pe=xr,ae=b/pe,fe=a.tilePixelRatio*V/pe,ge=(Ye=a.overscaling,a.zoom>18&&Ye>2&&(Ye>>=1),Math.max(en/(512*Ye),1)*U.get("symbol-spacing")),_e=U.get("text-padding")*a.tilePixelRatio,Fe=U.get("icon-padding")*a.tilePixelRatio,ke=Pn(U.get("text-max-angle")),Ge="map"===U.get("text-rotation-alignment")&&"point"!==U.get("symbol-placement"),ct="map"===U.get("icon-rotation-alignment")&&"point"!==U.get("symbol-placement"),ze=U.get("symbol-placement"),Qe=ge/2;var Ye;const at=U.get("icon-text-fit");let pt;d&&"none"!==at&&(a.allowVerticalPlacement&&l.vertical&&(pt=zw(d,l.vertical,at,U.get("icon-text-fit-padding"),j,ae)),te&&(d=zw(d,te,at,U.get("icon-text-fit-padding"),j,ae)));const $e=(Mt,Ht,Rt)=>{if(Ht.x<0||Ht.x>=en||Ht.y<0||Ht.y>=en)return;let gn=null;if(q){const{x:_t,y:Jt,z:un}=N.projectTilePoint(Ht.x,Ht.y,Rt);gn={anchor:new Pl(_t,Jt,un,0,void 0),up:N.upVector(Rt,Ht.x,Ht.y)}}!function(_t,Jt,un,Kn,_n,Xt,Ri,xn,Cn,di,wi,Di,Ci,Xi,nr,kr,Ei,wr,Rr,ir,ei,Lr,Ti,ur,dr){const ro=_t.addToLineVertexArray(Jt,Kn);let Hr,Uo,Gr,Ma,zc,yh,Ey,wb=0,Cb=0,Eb=0,Mb=0,jm=-1,el=-1;const Rl={};let uC=ku("");const Bc=un?un.anchor:Jt;let Db=0,My=0;if(void 0===Cn._unevaluatedLayout.getValue("text-radial-offset")?[Db,My]=Cn.layout.get("text-offset").evaluate(ei,{},dr).map(To=>To*xr):(Db=Cn.layout.get("text-radial-offset").evaluate(ei,{},dr)*xr,My=Om),_t.allowVerticalPlacement&&_n.vertical){const To=_n.vertical;if(nr)yh=qu(To),xn&&(Ey=qu(xn));else{const Ks=Cn.layout.get("text-rotate").evaluate(ei,{},dr)+90;Gr=km(di,Bc,Jt,wi,Di,Ci,To,Xi,Ks,kr),xn&&(Ma=km(di,Bc,Jt,wi,Di,Ci,xn,wr,Ks))}}if(Xt){const To=Cn.layout.get("icon-rotate").evaluate(ei,{},dr),Ks="none"!==Cn.layout.get("icon-text-fit"),Hm=$w(Xt,To,Ti,Ks),Dy=xn?$w(xn,To,Ti,Ks):void 0;Uo=km(di,Bc,Jt,wi,Di,Ci,Xt,wr,To),wb=4*Hm.length;const Tb=_t.iconSizeData;let vh=null;"source"===Tb.kind?(vh=[Xa*Cn.layout.get("icon-size").evaluate(ei,{},dr)],vh[0]>Ol&&Fi(`${_t.layerIds[0]}: Value for "icon-size" is >= ${Gu}. Reduce your "icon-size".`)):"composite"===Tb.kind&&(vh=[Xa*Lr.compositeIconSizes[0].evaluate(ei,{},dr),Xa*Lr.compositeIconSizes[1].evaluate(ei,{},dr)],(vh[0]>Ol||vh[1]>Ol)&&Fi(`${_t.layerIds[0]}: Value for "icon-size" is >= ${Gu}. Reduce your "icon-size".`)),_t.addSymbols(_t.icon,Hm,vh,ir,Rr,ei,!1,un,Jt,ro.lineStartIndex,ro.lineLength,-1,ur,dr),jm=_t.icon.placedSymbolArray.length-1,Dy&&(Cb=4*Dy.length,_t.addSymbols(_t.icon,Dy,vh,ir,Rr,ei,rs.vertical,un,Jt,ro.lineStartIndex,ro.lineLength,-1,ur,dr),el=_t.icon.placedSymbolArray.length-1)}for(const To in _n.horizontal){const Ks=_n.horizontal[To];Hr||(uC=ku(Ks.text),nr?zc=qu(Ks):Hr=km(di,Bc,Jt,wi,Di,Ci,Ks,Xi,Cn.layout.get("text-rotate").evaluate(ei,{},dr),kr));const Hm=1===Ks.positionedLines.length;if(Eb+=Ww(_t,un,Jt,Ks,Ri,Cn,nr,ei,kr,ro,_n.vertical?rs.horizontal:rs.horizontalOnly,Hm?Object.keys(_n.horizontal):[To],Rl,jm,Lr,ur,dr),Hm)break}_n.vertical&&(Mb+=Ww(_t,un,Jt,_n.vertical,Ri,Cn,nr,ei,kr,ro,rs.vertical,["vertical"],Rl,el,Lr,ur,dr));let Ju=-1;const rp=(To,Ks)=>To?Math.max(To,Ks):Ks;Ju=rp(zc,Ju),Ju=rp(yh,Ju),Ju=rp(Ey,Ju);const $m=Ju>-1?1:0;_t.glyphOffsetArray.length>=Wu.MAX_GLYPHS&&Fi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ei.sortKey&&_t.addToSortKeyRanges(_t.symbolInstances.length,ei.sortKey),_t.symbolInstances.emplaceBack(Bc.x,Bc.y,Bc.z,Jt.x,Jt.y,Rl.right>=0?Rl.right:-1,Rl.center>=0?Rl.center:-1,Rl.left>=0?Rl.left:-1,Rl.vertical>=0?Rl.vertical:-1,jm,el,uC,void 0!==Hr?Hr:_t.collisionBoxArray.length,void 0!==Hr?Hr+1:_t.collisionBoxArray.length,void 0!==Gr?Gr:_t.collisionBoxArray.length,void 0!==Gr?Gr+1:_t.collisionBoxArray.length,void 0!==Uo?Uo:_t.collisionBoxArray.length,void 0!==Uo?Uo+1:_t.collisionBoxArray.length,Ma||_t.collisionBoxArray.length,Ma?Ma+1:_t.collisionBoxArray.length,wi,Eb,Mb,wb,Cb,$m,0,Db,My,Ju)}(a,Ht,gn,Mt,l,d,p,pt,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,_e,Ge,D,0,Fe,ct,j,o,y,T,k,L)};if("line"===ze)for(const Mt of zT(o.geometry,0,0,en,en)){const Ht=jw(Mt,ge,ke,l.vertical||te,d,pe,fe,a.overscaling,en);for(const Rt of Ht)te&&VT(a,te.text,Qe,Rt)||$e(Mt,Rt,L)}else if("line-center"===ze){for(const Mt of o.geometry)if(Mt.length>1){const Ht=FT(Mt,ke,l.vertical||te,d,pe,fe);Ht&&$e(Mt,Ht,L)}}else if("Polygon"===o.type)for(const Mt of go(o.geometry,0)){const Ht=Hw(Mt,16);$e(Mt[0],new Pl(Ht.x,Ht.y,0,0,void 0),L)}else if("LineString"===o.type)for(const Mt of o.geometry)$e(Mt,new Pl(Mt[0].x,Mt[0].y,0,0,void 0),L);else if("Point"===o.type)for(const Mt of o.geometry)for(const Ht of Mt)$e([Ht],new Pl(Ht.x,Ht.y,0,0,void 0),L)}const Gu=255,Ol=Gu*Xa;function Ww(a,o,l,d,p,y,b,C,D,T,k,L,N,V,U,j,te){const q=function(fe,ge,_e,Fe,ke,Ge,ct,ze){const Qe=[];if(0===ge.positionedLines.length)return Qe;const Ye=Fe.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,at=function(Rt){const gn=Rt[0],_t=Rt[1],Jt=gn*_t;return Jt>0?[gn,-_t]:Jt<0?[-gn,_t]:0===gn?[_t,gn]:[_t,-gn]}(_e);let pt=Math.abs(ge.top-ge.bottom);for(const Rt of ge.positionedLines)pt-=Rt.lineOffset;const $e=ge.positionedLines.length,Mt=pt/$e;let Ht=ge.top-_e[1];for(let Rt=0;Rt<$e;++Rt){const gn=ge.positionedLines[Rt];Ht=ab(ge,Mt,Ht,Rt);for(const _t of gn.positionedGlyphs){if(!_t.rect)continue;const Jt=_t.rect||{};let un=eb+1,Kn=!0,_n=1,Xt=0;if(_t.imageName){const Ti=ct[_t.imageName];if(!Ti)continue;if(Ti.sdf){Fi("SDF images are not supported in formatted text and will be ignored.");continue}Kn=!1,_n=Ti.pixelRatio,un=Es/_n}const Ri=(ke||ze)&&_t.vertical,xn=_t.metrics.advance*_t.scale/2,Cn=_t.metrics,di=_t.rect;if(null===di)continue;ze&&ge.verticalizable&&(Xt=_t.imageName?xn-_t.metrics.width*_t.scale/2:0);const wi=ke?[_t.x+xn,_t.y]:[0,0];let Di=[0,0],Ci=[0,0],Xi=!1;ke||(Ri?(Ci=[_t.x+xn+at[0],_t.y+at[1]-Xt],Xi=!0):Di=[_t.x+xn+_e[0],_t.y+_e[1]-Xt]);const nr=di.w*_t.scale/(_n*(_t.localGlyph?xa:1)),kr=di.h*_t.scale/(_n*(_t.localGlyph?xa:1));let Ei,wr,Rr,ir;if(Ri){const Ti=_t.y-Ht,ur=new Ct(-xn,xn-Ti),dr=-Math.PI/2,ro=new Ct(...Ci);Ei=new Ct(-xn+Di[0],Di[1]),Ei._rotateAround(dr,ur)._add(ro),Ei.x+=-Ti+xn,Ei.y-=(Cn.left-un)*_t.scale;const Hr=_t.imageName?Cn.advance*_t.scale:xr*_t.scale,Uo=String.fromCharCode(_t.glyph);J_(Uo)?Ei.x+=(1-un)*_t.scale:Xv(Uo)?Ei.x+=Hr-Cn.height*_t.scale+(-un-1)*_t.scale:Ei.x+=_t.imageName||Cn.width+2*un===di.w&&Cn.height+2*un===di.h?(Hr-kr)/2:(Hr-(Cn.height+2*un)*_t.scale)/2,wr=new Ct(Ei.x,Ei.y-nr),Rr=new Ct(Ei.x+kr,Ei.y),ir=new Ct(Ei.x+kr,Ei.y-nr)}else{const Ti=(Cn.left-un)*_t.scale-xn+Di[0],ur=(-Cn.top-un)*_t.scale+Di[1],dr=Ti+nr,ro=ur+kr;Ei=new Ct(Ti,ur),wr=new Ct(dr,ur),Rr=new Ct(Ti,ro),ir=new Ct(dr,ro)}if(Ye){let Ti;Ti=ke?new Ct(0,0):Xi?new Ct(at[0],at[1]):new Ct(_e[0],_e[1]),Ei._rotateAround(Ye,Ti),wr._rotateAround(Ye,Ti),Rr._rotateAround(Ye,Ti),ir._rotateAround(Ye,Ti)}const ei=new Ct(0,0),Lr=new Ct(0,0);Qe.push({tl:Ei,tr:wr,bl:Rr,br:ir,tex:Jt,writingMode:ge.writingMode,glyphOffset:wi,sectionIndex:_t.sectionIndex,isSDF:Kn,pixelOffsetTL:ei,pixelOffsetBR:Lr,minFontScaleX:0,minFontScaleY:0})}}return Qe}(0,d,D,y,b,C,p,a.allowVerticalPlacement),pe=a.textSizeData;let ae=null;"source"===pe.kind?(ae=[Xa*y.layout.get("text-size").evaluate(C,{},te)],ae[0]>Ol&&Fi(`${a.layerIds[0]}: Value for "text-size" is >= ${Gu}. Reduce your "text-size".`)):"composite"===pe.kind&&(ae=[Xa*U.compositeTextSizes[0].evaluate(C,{},te),Xa*U.compositeTextSizes[1].evaluate(C,{},te)],(ae[0]>Ol||ae[1]>Ol)&&Fi(`${a.layerIds[0]}: Value for "text-size" is >= ${Gu}. Reduce your "text-size".`)),a.addSymbols(a.text,q,ae,D,b,C,k,o,l,T.lineStartIndex,T.lineLength,V,j,te);for(const fe of L)N[fe]=a.text.placedSymbolArray.length-1;return 4*q.length}function Zw(a){for(const o in a)return a[o];return null}function km(a,o,l,d,p,y,b,C,D,T){let k=b.top,L=b.bottom,N=b.left,V=b.right;const U=b.collisionPadding;if(U&&(N-=U[0],k-=U[1],V+=U[2],L+=U[3]),D){const j=new Ct(N,k),te=new Ct(V,k),q=new Ct(N,L),pe=new Ct(V,L),ae=Pn(D);let fe=new Ct(0,0);T&&(fe=new Ct(T[0],T[1])),j._rotateAround(ae,fe),te._rotateAround(ae,fe),q._rotateAround(ae,fe),pe._rotateAround(ae,fe),N=Math.min(j.x,te.x,q.x,pe.x),V=Math.max(j.x,te.x,q.x,pe.x),k=Math.min(j.y,te.y,q.y,pe.y),L=Math.max(j.y,te.y,q.y,pe.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,N,k,V,L,C,d,p,y),a.length-1}function qu(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function VT(a,o,l,d){const p=a.compareText;if(o in p){const y=p[o];for(let b=y.length-1;b>=0;b--)if(d.dist(y[b])<l)return!0}else p[o]=[];return p[o].push(d),!1}function Xw(a,o){const l=a.fovAboveCenter,d=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,p=(a._camera.position[2]*a.worldSize-d)/Math.cos(a._pitch),y=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),b=Math.sin(a._pitch)*y+p;return Math.min(1.01*b,p*(1/a._horizonShift))}function ph(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const l=Math.pow(2,-a.z),d=a.x*l,p=(a.x+1)*l,y=a.y*l,b=(a.y+1)*l,C=Mo(d),D=Mo(p),T=fo(y),k=fo(b),L=o.project(C,T),N=o.project(D,T),V=o.project(D,k),U=o.project(C,k);let j=Math.min(L.x,N.x,V.x,U.x),te=Math.min(L.y,N.y,V.y,U.y),q=Math.max(L.x,N.x,V.x,U.x),pe=Math.max(L.y,N.y,V.y,U.y);const ae=l/16;function fe(_e,Fe,ke,Ge,ct,ze){const Qe=(ke+ct)/2,Ye=(Ge+ze)/2,at=o.project(Mo(Qe),fo(Ye)),pt=Math.max(0,j-at.x,te-at.y,at.x-q,at.y-pe);j=Math.min(j,at.x),q=Math.max(q,at.x),te=Math.min(te,at.y),pe=Math.max(pe,at.y),pt>ae&&(fe(_e,at,ke,Ge,Qe,Ye),fe(at,Fe,Qe,Ye,ct,ze))}fe(L,N,d,y,p,y),fe(N,V,p,y,p,b),fe(V,U,p,b,d,b),fe(U,L,d,b,d,y),j-=ae,te-=ae,q+=ae,pe+=ae;const ge=1/Math.max(q-j,pe-te);return{scale:ge,x:j*ge,y:te*ge,x2:q*ge,y2:pe*ge,projection:o}}const ub=qa(new Float32Array(16));class Ca{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new bi(0,0)}projectTilePoint(o,l,d){return{x:o,y:l,z:0}}locationPoint(o,l,d=!0){return o._coordinatePoint(o.locationCoordinate(l),d)}pixelsPerMeter(o,l){return ws(1,o)*l}pixelSpaceConversion(o,l,d){return 1}farthestPixelDistance(o){return Xw(o,o.pixelsPerMeter)}pointCoordinate(o,l,d,p){const y=o.horizonLineFromTop(!1),b=new Ct(l,Math.max(y,d));return o.rayIntersectionCoordinate(o.pointRayIntersection(b,p))}pointCoordinate3D(o,l,d){const p=new Ct(l,d);if(o.elevation)return o.elevation.pointCoordinate(p);{const y=this.pointCoordinate(o,p.x,p.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(o,l){if(o.elevation)return!this.pointCoordinate3D(o,l.x,l.y);const d=o.horizonLineFromTop();return l.y<d}createInversionMatrix(o,l){return ub}createTileMatrix(o,l,d){let p,y,b;const C=d.canonical,D=qa(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=ph(C,this);p=1,y=T.x+d.wrap*T.scale,b=T.y,zu(D,D,[p/T.scale,p/T.scale,o.pixelsPerMeter/l])}else p=l/o.zoomScale(C.z),y=(C.x+Math.pow(2,C.z)*d.wrap)*p,b=C.y*p;return rm(D,D,[y,b,0]),zu(D,D,[p/en,p/en,1]),D}upVector(o,l,d){return[0,0,1]}upVectorScale(o,l,d){return{metersToTile:1}}}class UT extends Ca{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,d]=this.parallels=o.parallels||[29.5,45.5],p=Math.sin(Pn(l));this.n=(p+Math.sin(Pn(d)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:d,c:p,r0:y}=this,b=Pn(o-this.center[0]),C=Pn(l),D=Math.sqrt(p-2*d*Math.sin(C))/d;return{x:D*Math.sin(b*d),y:D*Math.cos(b*d)-y,z:0}}unproject(o,l){const{n:d,c:p,r0:y}=this,b=y+l;let C=Math.atan2(o,Math.abs(b))*Math.sign(b);b*d<0&&(C-=Math.PI*Math.sign(o)*Math.sign(b));const D=Pn(this.center[0])*d;C=On(C,-Math.PI-D,Math.PI-D);const T=Ln(qr(C/d)+this.center[0],-180,180),k=Math.asin(Ln((p-(o*o+b*b)*d*d)/(2*d),-1,1)),L=Ln(qr(k),-po,po);return new bi(T,L)}}const Wf=1.340264,Ea=-.081106,ly=893e-6,Rc=.003796,Zf=Math.sqrt(3)/2;class jT extends Ca{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const d=Math.asin(Zf*Math.sin(l)),p=d*d,y=p*p*p;return{x:.5*(o*Math.cos(d)/(Zf*(Wf+3*Ea*p+y*(7*ly+9*Rc*p)))/Math.PI+.5),y:1-.5*(d*(Wf+Ea*p+y*(ly+Rc*p))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,p=d*d,y=p*p*p;for(let k,L,N,V=0;V<12&&(L=d*(Wf+Ea*p+y*(ly+Rc*p))-l,N=Wf+3*Ea*p+y*(7*ly+9*Rc*p),k=L/N,d=Ln(d-k,-Math.PI/3,Math.PI/3),p=d*d,y=p*p*p,!(Math.abs(k)<1e-12));++V);const b=Zf*o*(Wf+3*Ea*p+y*(7*ly+9*Rc*p))/Math.cos(d),C=Math.asin(Math.sin(d)/Zf),D=Ln(180*b/Math.PI,-180,180),T=Ln(180*C/Math.PI,-po,po);return new bi(D,T)}}class gk extends Ca{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const d=360*(o-.5),p=Ln(360*(.5-l),-po,po);return new bi(d,p)}}const Rm=Math.PI/2;function mh(a){return Math.tan((Rm+a)/2)}class $T extends Ca{constructor(o){super(o),this.center=o.center||[0,30];const[l,d]=this.parallels=o.parallels||[30,30];let p=Pn(l),y=Pn(d);this.southernCenter=p+y<0,this.southernCenter&&(p=-p,y=-y);const b=Math.cos(p),C=mh(p);this.n=p===y?Math.sin(p):Math.log(b/Math.cos(y))/Math.log(mh(y)/C),this.f=b*Math.pow(mh(p),this.n)/this.n}project(o,l){l=Pn(l),this.southernCenter&&(l=-l),o=Pn(o-this.center[0]);const d=1e-6,{n:p,f:y}=this;y>0?l<-Rm+d&&(l=-Rm+d):l>Rm-d&&(l=Rm-d);const b=y/Math.pow(mh(l),p);let C=b*Math.sin(p*o),D=y-b*Math.cos(p*o);return C=.5*(C/Math.PI+.5),D=.5*(D/Math.PI+.5),{x:C,y:this.southernCenter?D:1-D,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:d,f:p}=this,y=p-l,b=Math.sign(y),C=Math.sign(d)*Math.sqrt(o*o+y*y);let D=Math.atan2(o,Math.abs(y))*b;y*d<0&&(D-=Math.PI*Math.sign(o)*b);const T=Ln(qr(D/d)+this.center[0],-180,180),k=Ln(qr(2*Math.atan(Math.pow(p/C,1/d))-Rm),-po,po);return new bi(T,this.southernCenter?-k:k)}}class cy extends Ca{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:ns(o),y:Za(l),z:0}}unproject(o,l){const d=Mo(o),p=fo(l);return new bi(d,p)}}const uy=Pn(po);class Xf extends Ca{project(o,l){const d=(l=Pn(l))*l,p=d*d;return{x:.5*((o=Pn(o))*(.8707-.131979*d+p*(p*(.003971*d-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+d*(.015085+p*(.028874*d-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,p=25,y=0,b=d*d;do{b=d*d;const T=b*b;y=(d*(1.007226+b*(.015085+T*(.028874*b-.044475-.005916*T)))-l)/(1.007226+b*(.045255+T*(.259866*b-.311325-.005916*11*T))),d=Ln(d-y,-uy,uy)}while(Math.abs(y)>1e-6&&--p>0);b=d*d;const C=Ln(qr(o/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),D=qr(d);return new bi(C,D)}}const dy=Pn(po);class db extends Ca{project(o,l){l=Pn(l),o=Pn(o);const d=Math.cos(l),p=2/Math.PI,y=Math.acos(d*Math.cos(o/2)),b=Math.sin(y)/y,C=.5*(o*p+2*d*Math.sin(o/2)/b)||0,D=.5*(l+Math.sin(l)/b)||0;return{x:.5*(C/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(o,l){let d=o=(2*o-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,y=25;const b=1e-6;let C=0,D=0;do{const T=Math.cos(p),k=Math.sin(p),L=2*k*T,N=k*k,V=T*T,U=Math.cos(d/2),j=Math.sin(d/2),te=2*U*j,q=j*j,pe=1-V*U*U,ae=pe?1/pe:0,fe=pe?Math.acos(T*U)*Math.sqrt(1/pe):0,ge=.5*(2*fe*T*j+2*d/Math.PI)-o,_e=.5*(fe*k+p)-l,Fe=.5*ae*(V*q+fe*T*U*N)+1/Math.PI,ke=ae*(te*L/4-fe*k*j),Ge=.125*ae*(L*j-fe*k*V*te),ct=.5*ae*(N*U+fe*q*T)+.5,ze=ke*Ge-ct*Fe;C=(_e*ke-ge*ct)/ze,D=(ge*Ge-_e*Fe)/ze,d=Ln(d-C,-Math.PI,Math.PI),p=Ln(p-D,-dy,dy)}while((Math.abs(C)>b||Math.abs(D)>b)&&--y>0);return new bi(qr(d),qr(p))}}class Yf extends Ca{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Pn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:d,cosPhi:p}=this;return{x:Pn(o)*p*d+.5,y:-Math.sin(Pn(l))/p*d+.5,z:0}}unproject(o,l){const{scale:d,cosPhi:p}=this,y=-(l-.5)/d,b=Ln(qr((o-.5)/d)/p,-180,180),C=Math.asin(Ln(y*p,-1,1)),D=Ln(qr(C),-po,po);return new bi(b,D)}}class hy extends cy{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,d){const p=Sl(o,l,d);return Pr(p,p,w_(va(d))),{x:p[0],y:p[1],z:p[2]}}locationPoint(o,l){const d=Uu(l.lat,l.lng),p=es([],d),y=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;Jd(d,d,p,ws(1,0)*en*y);const b=qa(new Float64Array(16));return Zd(b,o.pixelMatrix,o.globeMatrix),Pr(d,d,b),new Ct(d[0],d[1])}pixelsPerMeter(o,l){return ws(1,0)*l}pixelSpaceConversion(o,l,d){const p=ws(1,o)*l,y=Nn(ws(1,45)*l,p,d);return this.pixelsPerMeter(o,l)/y}createTileMatrix(o,l,d){const p=W1(va(d.canonical));return Zd(new Float64Array(16),o.globeMatrix,p)}createInversionMatrix(o,l){const{center:d}=o,p=w_(va(l));return Xd(p,p,Pn(d.lng)),f_(p,p,Pn(d.lat)),zu(p,p,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(o,l,d,p){return Vo(o,l,d,!0)||new mo(0,0)}pointCoordinate3D(o,l,d){const p=this.pointCoordinate(o,l,d,0);return[p.x,p.y,p.z]}isPointAboveHorizon(o,l){return!Vo(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(p,y){const b=p.cameraToCenterDistance,C=p._centerAltitude*y,D=p._camera,T=p._camera.forward(),k=Dl([],_a([],T,-b),[0,0,C]),L=p.worldSize/(2*Math.PI),N=[0,0,-L],V=p.width/p.height,U=Math.tan(p.fovAboveCenter),j=_a([],D.up(),U),te=_a([],D.right(),U*V),q=es([],Dl([],Dl([],T,j),te)),pe=[];let ae;if(new cm(k,q).closestPointOnSphere(N,L,pe)){const fe=Dl([],pe,N),ge=ts([],fe,k);ae=Math.cos(p.fovAboveCenter)*Yd(ge)}else{const fe=ts([],k,N),ge=ts([],N,k);es(ge,ge);const _e=Yd(fe)-L;ae=Math.sqrt(_e*(_e+2*L));const Fe=Math.acos(ae/(L+_e))-Math.acos(ya(T,ge));ae*=Math.cos(Fe)}return 1.01*ae}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),d=fm(o.zoom);if(d>0){const p=Xw(o,ws(1,o.center.lat)*o.worldSize),y=o.worldSize/(2*Math.PI),b=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Nn(l,p+y*(1-Math.cos(b)),Math.pow(d,10))}return l}upVector(o,l,d){return Sl(l,d,o,1)}upVectorScale(o){return{metersToTile:x_(Ev(va(o)))}}}function Kf(a){const o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new cy(a);case"equirectangular":return new gk(a);case"naturalEarth":return new Xf(a);case"equalEarth":return new jT(a);case"winkelTripel":return new db(a);case"albers":return l?new Yf(a):new UT(a);case"lambertConformalConic":return l?new Yf(a):new $T(a);case"globe":return new hy(a)}throw new Error(`Invalid projection name: ${a.name}`)}const Yw=Nf.types,hb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gh(a,o,l,d,p,y,b,C,D,T,k,L,N){const V=C?Math.min(Ol,Math.round(C[0])):0,U=C?Math.min(Ol,Math.round(C[1])):0;a.emplaceBack(o,l,Math.round(32*d),Math.round(32*p),y,b,(V<<1)+(D?1:0),U,16*T,16*k,256*L,256*N)}function fb(a,o,l,d,p,y,b){a.emplaceBack(o,l,d,p,y,b)}function Qf(a,o,l,d,p){a.emplaceBack(o,l,d,p),a.emplaceBack(o,l,d,p),a.emplaceBack(o,l,d,p),a.emplaceBack(o,l,d,p)}function Lm(a){for(const o of a.sections)if(l_(o.text))return!0;return!1}class pb{constructor(o){this.layoutVertexArray=new et,this.indexArray=new qt,this.programConfigurations=o,this.segments=new vr,this.dynamicLayoutVertexArray=new lt,this.opacityVertexArray=new Et,this.placedSymbolArray=new Yt,this.globeExtVertexArray=new dt}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,l,d,p){this.isEmpty()||(d&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,TT.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,IT.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,hb,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,ST.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||p)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}jt(pb,"SymbolBuffers");class fy{constructor(o,l,d){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new d,this.segments=new vr,this.collisionVertexArray=new Rn,this.collisionVertexArrayExt=new Dn}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,Dw.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,Tw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}jt(fy,"CollisionBuffers");class Wu{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(b=>b.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qa([]),this.placementViewportMatrix=qa([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qv(this.zoom,l["text-size"]),this.iconSizeData=qv(this.zoom,l["icon-size"]);const d=this.layers[0].layout,p=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==y&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===y||"auto"===y&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(b=>rs[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new pb(new Mc(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new pb(new Mc(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new zo,this.lineVertexArray=new wf,this.symbolInstances=new Hi}calculateGlyphDependencies(o,l,d,p,y){for(let b=0;b<o.length;b++)if(l[o.charCodeAt(b)]=!0,p&&y){const C=Al[o.charAt(b)];C&&(l[C.charCodeAt(0)]=!0)}}populate(o,l,d,p){const y=this.layers[0],b=y.layout,C="globe"===this.projection.name,D=b.get("text-font"),T=b.get("text-field"),k=b.get("icon-image"),L=("constant"!==T.value.kind||T.value.value instanceof lo&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&("constant"!==D.value.kind||D.value.value.length>0),N="constant"!==k.value.kind||!!k.value.value||Object.keys(k.parameters).length>0,V=b.get("symbol-sort-key");if(this.features=[],!L&&!N)return;const U=l.iconDependencies,j=l.glyphDependencies,te=l.availableImages,q=new R(this.zoom);for(const{feature:pe,id:ae,index:fe,sourceLayerIndex:ge}of o){const _e=y._featureFilter.needGeometry,Fe=oh(pe,_e);if(!y._featureFilter.filter(q,Fe,d))continue;if(_e||(Fe.geometry=Ic(pe,d,p)),C&&1!==pe.type&&d.z<=5){const ze=Fe.geometry,Qe=.98078528056,Ye=(at,pt)=>ya(Sl(at.x,at.y,d,1),Sl(pt.x,pt.y,d,1))<Qe;for(let at=0;at<ze.length;at++)ze[at]=K1(ze[at],Ye)}let ke,Ge;if(L){const ze=y.getValueAndResolveTokens("text-field",Fe,d,te),Qe=lo.factory(ze);Lm(Qe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===E()||this.hasRTLText&&O.isParsed())&&(ke=AT(Qe,y,Fe))}if(N){const ze=y.getValueAndResolveTokens("icon-image",Fe,d,te);Ge=ze instanceof tr?ze:tr.fromString(ze)}if(!ke&&!Ge)continue;const ct=this.sortFeaturesByKey?V.evaluate(Fe,{},d):void 0;if(this.features.push({id:ae,text:ke,icon:Ge,index:fe,sourceLayerIndex:ge,geometry:Fe.geometry,properties:pe.properties,type:Yw[pe.type],sortKey:ct}),Ge&&(U[Ge.name]=!0),ke){const ze=D.evaluate(Fe,{},d).join(","),Qe="map"===b.get("text-rotation-alignment")&&"point"!==b.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(rs.vertical)>=0;for(const Ye of ke.sections)if(Ye.image)U[Ye.image.name]=!0;else{const at=o_(ke.toString()),pt=Ye.fontStack||ze,$e=j[pt]=j[pt]||{};this.calculateGlyphDependencies(Ye.text,$e,Qe,this.allowVerticalPlacement,at)}}}"line"===b.get("symbol-placement")&&(this.features=function(pe){const ae={},fe={},ge=[];let _e=0;function Fe(ze){ge.push(pe[ze]),_e++}function ke(ze,Qe,Ye){const at=fe[ze];return delete fe[ze],fe[Qe]=at,ge[at].geometry[0].pop(),ge[at].geometry[0]=ge[at].geometry[0].concat(Ye[0]),at}function Ge(ze,Qe,Ye){const at=ae[Qe];return delete ae[Qe],ae[ze]=at,ge[at].geometry[0].shift(),ge[at].geometry[0]=Ye[0].concat(ge[at].geometry[0]),at}function ct(ze,Qe,Ye){const at=Ye?Qe[0][Qe[0].length-1]:Qe[0][0];return`${ze}:${at.x}:${at.y}`}for(let ze=0;ze<pe.length;ze++){const Qe=pe[ze],Ye=Qe.geometry,at=Qe.text?Qe.text.toString():null;if(!at){Fe(ze);continue}const pt=ct(at,Ye),$e=ct(at,Ye,!0);if(pt in fe&&$e in ae&&fe[pt]!==ae[$e]){const Mt=Ge(pt,$e,Ye),Ht=ke(pt,$e,ge[Mt].geometry);delete ae[pt],delete fe[$e],fe[ct(at,ge[Ht].geometry,!0)]=Ht,ge[Mt].geometry=null}else pt in fe?ke(pt,$e,Ye):$e in ae?Ge(pt,$e,Ye):(Fe(ze),ae[pt]=_e-1,fe[$e]=_e-1)}return ge.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,ae)=>pe.sortKey-ae.sortKey)}update(o,l,d,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,l,this.layers,d,p),this.icon.programConfigurations.updatePaintArrays(o,l,this.layers,d,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Kf(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const d=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:p,y}of l)this.lineVertexArray.emplaceBack(p,y);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(o,l,d,p,y,b,C,D,T,k,L,N,V,U){const j=o.indexArray,te=o.layoutVertexArray,q=o.globeExtVertexArray,pe=o.segments.prepareSegment(4*l.length,te,j,this.canOverlap?b.sortKey:void 0),ae=this.glyphOffsetArray.length,fe=pe.vertexLength,ge=this.allowVerticalPlacement&&C===rs.vertical?Math.PI/2:0,_e=b.text&&b.text.sections;for(let ke=0;ke<l.length;ke++){const{tl:Ge,tr:ct,bl:ze,br:Qe,tex:Ye,pixelOffsetTL:at,pixelOffsetBR:pt,minFontScaleX:$e,minFontScaleY:Mt,glyphOffset:Ht,isSDF:Rt,sectionIndex:gn}=l[ke],_t=pe.vertexLength,Jt=Ht[1];if(gh(te,T.x,T.y,Ge.x,Jt+Ge.y,Ye.x,Ye.y,d,Rt,at.x,at.y,$e,Mt),gh(te,T.x,T.y,ct.x,Jt+ct.y,Ye.x+Ye.w,Ye.y,d,Rt,pt.x,at.y,$e,Mt),gh(te,T.x,T.y,ze.x,Jt+ze.y,Ye.x,Ye.y+Ye.h,d,Rt,at.x,pt.y,$e,Mt),gh(te,T.x,T.y,Qe.x,Jt+Qe.y,Ye.x+Ye.w,Ye.y+Ye.h,d,Rt,pt.x,pt.y,$e,Mt),D){const{x:un,y:Kn,z:_n}=D.anchor,[Xt,Ri,xn]=D.up;fb(q,un,Kn,_n,Xt,Ri,xn),fb(q,un,Kn,_n,Xt,Ri,xn),fb(q,un,Kn,_n,Xt,Ri,xn),fb(q,un,Kn,_n,Xt,Ri,xn),Qf(o.dynamicLayoutVertexArray,un,Kn,_n,ge)}else Qf(o.dynamicLayoutVertexArray,T.x,T.y,T.z,ge);j.emplaceBack(_t,_t+1,_t+2),j.emplaceBack(_t+1,_t+2,_t+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ht[0]),ke!==l.length-1&&gn===l[ke+1].sectionIndex||o.programConfigurations.populatePaintArrays(te.length,b,b.index,{},V,U,_e&&_e[gn])}const Fe=D?D.anchor:T;o.placedSymbolArray.emplaceBack(Fe.x,Fe.y,Fe.z,T.x,T.y,ae,this.glyphOffsetArray.length-ae,fe,k,L,T.segment,d?d[0]:0,d?d[1]:0,p[0],p[1],C,0,!1,0,N,0)}_commitLayoutVertex(o,l,d,p,y,b,C){o.emplaceBack(l,d,p,y,b,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(o,l,d,p,y,b,C){const D=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),T=D.vertexLength,k=C.tileAnchorX,L=C.tileAnchorY;for(let V=0;V<4;V++)d.collisionVertexArray.emplaceBack(0,0,0,0);d.collisionVertexArrayExt.emplaceBack(l,-o.padding,-o.padding),d.collisionVertexArrayExt.emplaceBack(l,o.padding,-o.padding),d.collisionVertexArrayExt.emplaceBack(l,o.padding,o.padding),d.collisionVertexArrayExt.emplaceBack(l,-o.padding,o.padding),this._commitLayoutVertex(d.layoutVertexArray,p,y,b,k,L,new Ct(o.x1,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,y,b,k,L,new Ct(o.x2,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,y,b,k,L,new Ct(o.x2,o.y2)),this._commitLayoutVertex(d.layoutVertexArray,p,y,b,k,L,new Ct(o.x1,o.y2)),D.vertexLength+=4;const N=d.indexArray;N.emplaceBack(T,T+1),N.emplaceBack(T+1,T+2),N.emplaceBack(T+2,T+3),N.emplaceBack(T+3,T),D.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,d,p,y,b){for(let C=p;C<y;C++){const D=d.get(C),T=this.getSymbolInstanceTextSize(o,b,l,C);this._addCollisionDebugVertices(D,T,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(o,l,d,p,y,b){for(let C=p;C<y;C++){const D=d.get(C),T=this.getSymbolInstanceIconSize(o,l,b.placedIconSymbolIndex);this._addCollisionDebugVertices(D,T,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,b)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fy(Ut,Sm.members,$r),this.iconCollisionBox=new fy(Ut,Sm.members,$r);const d=Vf(this.iconSizeData,o),p=Vf(this.textSizeData,o);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(p,o,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(p,o,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(d,o,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(d,o,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(o,l,d,p){const y=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),b=Wv(this.textSizeData,o,y)/xr;return this.tilePixelRatio*b}getSymbolInstanceIconSize(o,l,d){const p=this.icon.placedSymbolArray.get(d),y=Wv(this.iconSizeData,o,p);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(o,l,d){o.emplaceBack(l,-d,-d),o.emplaceBack(l,d,-d),o.emplaceBack(l,d,d),o.emplaceBack(l,-d,d)}_updateTextDebugCollisionBoxes(o,l,d,p,y,b){for(let C=p;C<y;C++){const D=d.get(C),T=this.getSymbolInstanceTextSize(o,b,l,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,D.padding)}}_updateIconDebugCollisionBoxes(o,l,d,p,y,b){for(let C=p;C<y;C++){const D=d.get(C),T=this.getSymbolInstanceIconSize(o,l,b);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,D.padding)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=Vf(this.iconSizeData,o),p=Vf(this.textSizeData,o);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(p,o,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(p,o,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(d,o,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(d,o,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,d,p,y,b,C,D,T){const k={};if(l<d){const{x1:L,y1:N,x2:V,y2:U,padding:j,projectedAnchorX:te,projectedAnchorY:q,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:fe,featureIndex:ge}=o.get(l);k.textBox={x1:L,y1:N,x2:V,y2:U,padding:j,projectedAnchorX:te,projectedAnchorY:q,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:fe},k.textFeatureIndex=ge}if(p<y){const{x1:L,y1:N,x2:V,y2:U,padding:j,projectedAnchorX:te,projectedAnchorY:q,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:fe,featureIndex:ge}=o.get(p);k.verticalTextBox={x1:L,y1:N,x2:V,y2:U,padding:j,projectedAnchorX:te,projectedAnchorY:q,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:fe},k.verticalTextFeatureIndex=ge}if(b<C){const{x1:L,y1:N,x2:V,y2:U,padding:j,projectedAnchorX:te,projectedAnchorY:q,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:fe,featureIndex:ge}=o.get(b);k.iconBox={x1:L,y1:N,x2:V,y2:U,padding:j,projectedAnchorX:te,projectedAnchorY:q,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:fe},k.iconFeatureIndex=ge}if(D<T){const{x1:L,y1:N,x2:V,y2:U,padding:j,projectedAnchorX:te,projectedAnchorY:q,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:fe,featureIndex:ge}=o.get(D);k.verticalIconBox={x1:L,y1:N,x2:V,y2:U,padding:j,projectedAnchorX:te,projectedAnchorY:q,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:fe},k.verticalIconFeatureIndex=ge}return k}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,l){const d=o.placedSymbolArray.get(l),p=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<p;y+=4)o.indexArray.emplaceBack(y,y+1,y+2),o.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),d=Math.cos(o),p=[],y=[],b=[];for(let C=0;C<this.symbolInstances.length;++C){b.push(C);const D=this.symbolInstances.get(C);p.push(0|Math.round(l*D.tileAnchorX+d*D.tileAnchorY)),y.push(D.featureIndex)}return b.sort((C,D)=>p[C]-p[D]||y[D]-y[C]),b}addToSortKeyRanges(o,l){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:C,placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:T}=d;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&b!==y&&b!==p&&this.addIndicesForPlacedSymbol(this.text,b),C>=0&&this.addIndicesForPlacedSymbol(this.text,C),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}jt(Wu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Wu.MAX_GLYPHS=65535,Wu.addDynamicAttributes=Qf;const HT=new ue({"symbol-placement":new G(He.layout_symbol["symbol-placement"]),"symbol-spacing":new G(He.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new G(He.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ne(He.layout_symbol["symbol-sort-key"]),"symbol-z-order":new G(He.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new G(He.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new G(He.layout_symbol["icon-ignore-placement"]),"icon-optional":new G(He.layout_symbol["icon-optional"]),"icon-rotation-alignment":new G(He.layout_symbol["icon-rotation-alignment"]),"icon-size":new ne(He.layout_symbol["icon-size"]),"icon-text-fit":new G(He.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new G(He.layout_symbol["icon-text-fit-padding"]),"icon-image":new ne(He.layout_symbol["icon-image"]),"icon-rotate":new ne(He.layout_symbol["icon-rotate"]),"icon-padding":new G(He.layout_symbol["icon-padding"]),"icon-keep-upright":new G(He.layout_symbol["icon-keep-upright"]),"icon-offset":new ne(He.layout_symbol["icon-offset"]),"icon-anchor":new ne(He.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new G(He.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new G(He.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new G(He.layout_symbol["text-rotation-alignment"]),"text-field":new ne(He.layout_symbol["text-field"]),"text-font":new ne(He.layout_symbol["text-font"]),"text-size":new ne(He.layout_symbol["text-size"]),"text-max-width":new ne(He.layout_symbol["text-max-width"]),"text-line-height":new ne(He.layout_symbol["text-line-height"]),"text-letter-spacing":new ne(He.layout_symbol["text-letter-spacing"]),"text-justify":new ne(He.layout_symbol["text-justify"]),"text-radial-offset":new ne(He.layout_symbol["text-radial-offset"]),"text-variable-anchor":new G(He.layout_symbol["text-variable-anchor"]),"text-anchor":new ne(He.layout_symbol["text-anchor"]),"text-max-angle":new G(He.layout_symbol["text-max-angle"]),"text-writing-mode":new G(He.layout_symbol["text-writing-mode"]),"text-rotate":new ne(He.layout_symbol["text-rotate"]),"text-padding":new G(He.layout_symbol["text-padding"]),"text-keep-upright":new G(He.layout_symbol["text-keep-upright"]),"text-transform":new ne(He.layout_symbol["text-transform"]),"text-offset":new ne(He.layout_symbol["text-offset"]),"text-allow-overlap":new G(He.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new G(He.layout_symbol["text-ignore-placement"]),"text-optional":new G(He.layout_symbol["text-optional"])});var Fm={paint:new ue({"icon-opacity":new ne(He.paint_symbol["icon-opacity"]),"icon-color":new ne(He.paint_symbol["icon-color"]),"icon-halo-color":new ne(He.paint_symbol["icon-halo-color"]),"icon-halo-width":new ne(He.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ne(He.paint_symbol["icon-halo-blur"]),"icon-translate":new G(He.paint_symbol["icon-translate"]),"icon-translate-anchor":new G(He.paint_symbol["icon-translate-anchor"]),"text-opacity":new ne(He.paint_symbol["text-opacity"]),"text-color":new ne(He.paint_symbol["text-color"],{runtimeType:xo,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new ne(He.paint_symbol["text-halo-color"]),"text-halo-width":new ne(He.paint_symbol["text-halo-width"]),"text-halo-blur":new ne(He.paint_symbol["text-halo-blur"]),"text-translate":new G(He.paint_symbol["text-translate"]),"text-translate-anchor":new G(He.paint_symbol["text-translate-anchor"])}),layout:HT};class mb{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Pi,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}jt(mb,"FormatSectionOverride",{omit:["defaultValue"]});class py extends ga{constructor(o){super(o,Fm)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const p=[];for(const y of d)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,l,d,p){const y=this.layout.get(o).evaluate(l,{},d,p),b=this._unevaluatedLayout._values[o];return b.isDataDriven()||Eu(b.value)||!y?y:(C=l.properties,y.replace(/{([^{}]+)}/g,(T,k)=>k in C?String(C[k]):""));var C}createBucket(o){return new Wu(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of Fm.paint.overridableProperties){if(!py.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),d=new mb(l),p=new gc(d,l.property.specification);let y=null;y="constant"===l.value.kind||"source"===l.value.kind?new sr("source",p):new $t("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new re(l.property,y,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&py.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const d=o.get("text-field"),p=Fm.paint.properties[l];let y=!1;const b=C=>{for(const D of C)if(p.overrides&&p.overrides.hasOverride(D))return void(y=!0)};if("constant"===d.value.kind&&d.value.value instanceof lo)b(d.value.value.sections);else if("source"===d.value.kind){const C=T=>{y||(T instanceof hu&&_r(T.value)===ai?b(T.value.sections):T instanceof ml?b(T.sections):T.eachChild(C))},D=d.value;D._styleExpression&&C(D._styleExpression.expression)}return y}getProgramConfiguration(o){return new Lu(this,o)}}var GT={paint:new ue({"background-color":new G(He.paint_background["background-color"]),"background-pattern":new G(He.paint_background["background-pattern"]),"background-opacity":new G(He.paint_background["background-opacity"])})},_k={paint:new ue({"raster-opacity":new G(He.paint_raster["raster-opacity"]),"raster-hue-rotate":new G(He.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new G(He.paint_raster["raster-brightness-min"]),"raster-brightness-max":new G(He.paint_raster["raster-brightness-max"]),"raster-saturation":new G(He.paint_raster["raster-saturation"]),"raster-contrast":new G(He.paint_raster["raster-contrast"]),"raster-resampling":new G(He.paint_raster["raster-resampling"]),"raster-fade-duration":new G(He.paint_raster["raster-fade-duration"])})};class qT extends ga{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var my={paint:new ue({"sky-type":new G(He.paint_sky["sky-type"]),"sky-atmosphere-sun":new G(He.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new G(He.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new G(He.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new G(He.paint_sky["sky-gradient-radius"]),"sky-gradient":new ce(He.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new G(He.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new G(He.paint_sky["sky-atmosphere-color"]),"sky-opacity":new G(He.paint_sky["sky-opacity"])})};function Nm(a,o,l){const d=[0,0,1],p=vv([]);return Wa(p,p,l?-Pn(a)+Math.PI:Pn(a)),G1(p,p,-Pn(o)),tT(d,d,p),es(d,d)}const WT={circle:class extends ga{constructor(a){super(a,lk)}createBucket(a){return new Af(a)}queryRadius(a){const o=a;return Il("circle-radius",this,o)+Il("circle-stroke-width",this,o)+D_(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,d,p,y,b,C){const D=Sv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return iw(a,d,y,b,C,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,T)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Lu(this,a)}},heatmap:class extends ga{createBucket(a){return new sw(a)}constructor(a){super(a,gT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_m({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Il("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,d,p,y,b,C){const D=this.paint.get("heatmap-radius").evaluate(o,l);return iw(a,d,y,b,C,!0,!0,new Ct(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Lu(this,a)}},hillshade:class extends ga{constructor(a){super(a,ck)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ga{constructor(a){super(a,vT)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new Lu(this,a)}recalculate(a,o){super.recalculate(a,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new V_(a)}queryRadius(){return D_(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,d,p,y){return!a.queryGeometry.isAboveHorizon&&ew(hT(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}},"fill-extrusion":class extends ga{constructor(a){super(a,ww)}createBucket(a){return new Em(a)}queryRadius(){return D_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Lu(this,a)}queryIntersectsFeature(a,o,l,d,p,y,b,C,D){const T=Sv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(o,l),L=this.paint.get("fill-extrusion-base").evaluate(o,l),N=[0,0],V=C&&y.elevation,U=y.elevation?y.elevation.exaggeration():1,j=a.tile.getBucket(this);if(V&&j instanceof Em){const fe=j.centroidVertexArray,ge=D+1;ge<fe.length&&(N[0]=fe.geta_centroid_pos0(ge),N[1]=fe.geta_centroid_pos1(ge))}if(0===N[0]&&1===N[1])return!1;"globe"===y.projection.name&&(d=Bv([d],[new Ct(0,0),new Ct(en,en)],a.tileID.canonical).map(fe=>fe.polygon).flat());const te=V?C:null,[q,pe]=(ge=d,_e=L,Fe=k,ke=T,Ge=b,ct=te,ze=N,Qe=U,Ye=y.center.lat,"globe"===(fe=y).projection.name?function(pt,$e,Mt,Ht,Rt,gn,_t,Jt,un,Kn,_n){const Xt=[],Ri=[],xn=pt.projection.upVectorScale(_n,pt.center.lat,pt.worldSize).metersToTile,Cn=[0,0,0,1],di=[0,0,0,1],wi=(Ci,Xi,nr,kr)=>{Ci[0]=Xi,Ci[1]=nr,Ci[2]=kr,Ci[3]=1},Di=Z_();Mt>0&&(Mt+=Di),Ht+=Di;for(const Ci of $e){const Xi=[],nr=[];for(const kr of Ci){const Ei=kr.x+Rt.x,wr=kr.y+Rt.y,Rr=pt.projection.projectTilePoint(Ei,wr,_n),ir=pt.projection.upVector(_n,kr.x,kr.y);let ei=Mt,Lr=Ht;if(_t){const Ti=Y_(Ei,wr,Mt,Ht,_t,Jt,un,Kn);ei+=Ti.base,Lr+=Ti.top}0!==Mt?wi(Cn,Rr.x+ir[0]*xn*ei,Rr.y+ir[1]*xn*ei,Rr.z+ir[2]*xn*ei):wi(Cn,Rr.x,Rr.y,Rr.z),wi(di,Rr.x+ir[0]*xn*Lr,Rr.y+ir[1]*xn*Lr,Rr.z+ir[2]*xn*Lr),Pr(Cn,Cn,gn),Pr(di,di,gn),Xi.push(new uh(Cn[0],Cn[1],Cn[2])),nr.push(new uh(di[0],di[1],di[2]))}Xt.push(Xi),Ri.push(nr)}return[Xt,Ri]}(fe,ge,_e,Fe,ke,Ge,ct,ze,Qe,Ye,a.tileID.canonical):ct?function(pt,$e,Mt,Ht,Rt,gn,_t,Jt,un){const Kn=[],_n=[],Xt=[0,0,0,1];for(const Ri of pt){const xn=[],Cn=[];for(const di of Ri){const wi=di.x+Ht.x,Di=di.y+Ht.y,Ci=Y_(wi,Di,$e,Mt,gn,_t,Jt,un);Xt[0]=wi,Xt[1]=Di,Xt[2]=Ci.base,Xt[3]=1,Tf(Xt,Xt,Rt),Xt[3]=Math.max(Xt[3],1e-5);const Xi=new uh(Xt[0]/Xt[3],Xt[1]/Xt[3],Xt[2]/Xt[3]);Xt[0]=wi,Xt[1]=Di,Xt[2]=Ci.top,Xt[3]=1,Tf(Xt,Xt,Rt),Xt[3]=Math.max(Xt[3],1e-5);const nr=new uh(Xt[0]/Xt[3],Xt[1]/Xt[3],Xt[2]/Xt[3]);xn.push(Xi),Cn.push(nr)}Kn.push(xn),_n.push(Cn)}return[Kn,_n]}(ge,_e,Fe,ke,Ge,ct,ze,Qe,Ye):function(pt,$e,Mt,Ht,Rt){const gn=[],_t=[],Jt=Rt[8]*$e,un=Rt[9]*$e,Kn=Rt[10]*$e,_n=Rt[11]*$e,Xt=Rt[8]*Mt,Ri=Rt[9]*Mt,xn=Rt[10]*Mt,Cn=Rt[11]*Mt;for(const di of pt){const wi=[],Di=[];for(const Ci of di){const Xi=Ci.x+Ht.x,nr=Ci.y+Ht.y,kr=Rt[0]*Xi+Rt[4]*nr+Rt[12],Ei=Rt[1]*Xi+Rt[5]*nr+Rt[13],wr=Rt[2]*Xi+Rt[6]*nr+Rt[14],Rr=Rt[3]*Xi+Rt[7]*nr+Rt[15],ir=kr+Jt,ei=Ei+un,Lr=wr+Kn,Ti=Math.max(Rr+_n,1e-5),ur=kr+Xt,dr=Ei+Ri,ro=wr+xn,Hr=Math.max(Rr+Cn,1e-5);wi.push(new uh(ir/Ti,ei/Ti,Lr/Ti)),Di.push(new uh(ur/Hr,dr/Hr,ro/Hr))}gn.push(wi),_t.push(Di)}return[gn,_t]}(ge,_e,Fe,ke,Ge)),ae=a.queryGeometry;var fe,ge,_e,Fe,ke,Ge,ct,ze,Qe,Ye;return function(fe,ge,_e){let Fe=1/0;ew(_e,ge)&&(Fe=Uv(_e,ge[0]));for(let ke=0;ke<ge.length;ke++){const Ge=ge[ke],ct=fe[ke];for(let ze=0;ze<Ge.length-1;ze++){const Qe=Ge[ze],Ye=[Qe,Ge[ze+1],ct[ze+1],ct[ze],Qe];J1(_e,Ye)&&(Fe=Math.min(Fe,Uv(_e,Ye)))}}return Fe!==1/0&&Fe}(q,pe,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends ga{constructor(a){super(a,Bf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Wg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=Mw.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Tm(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Lu(this,a)}queryRadius(a){const o=a,l=Hv(Il("line-width",this,o),Il("line-gap-width",this,o)),d=Il("line-offset",this,o);return l/2+Math.abs(d)+D_(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,d,p,y){if(a.queryGeometry.isAboveHorizon)return!1;const b=hT(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),C=a.pixelToTileUnitsFactor/2*Hv(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),D=this.paint.get("line-offset").evaluate(o,l);return D&&(d=function(T,k){const L=[],N=new Ct(0,0);for(let V=0;V<T.length;V++){const U=T[V],j=[];for(let te=0;te<U.length;te++){const q=U[te],pe=U[te+1],ae=0===te?N:q.sub(U[te-1])._unit()._perp(),fe=te===U.length-1?N:pe.sub(q)._unit()._perp(),ge=ae._add(fe)._unit();ge._mult(1/(ge.x*fe.x+ge.y*fe.y)),j.push(ge._mult(k)._add(q))}L.push(j)}return L}(d,D*a.pixelToTileUnitsFactor)),function(T,k,L){for(let N=0;N<k.length;N++){const V=k[N];if(T.length>=3)for(let U=0;U<V.length;U++)if(sh(T,V[U]))return!0;if(M_(T,V,L))return!0}return!1}(b,d,C)}isTileClipped(){return!0}},symbol:py,background:class extends ga{constructor(a){super(a,GT)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ga{constructor(a){super(a,_k)}getProgramIds(){return["raster"]}},sky:class extends ga{constructor(a){super(a,my),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=_m({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const d=this.paint.get("sky-atmosphere-sun"),p=!d,y=a.style.light,b=y.properties.get("position");return p&&"viewport"===y.properties.get("anchor")&&Fi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?Nm(b.azimuthal,90-b.polar,o):Nm(d[0],90-d[1],o)}const l=this.paint.get("sky-gradient-center");return Nm(l[0],90-l[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class Jf{constructor(o,l,d,p){this.context=o,this.format=d,this.texture=o.gl.createTexture(),this.update(l,p)}update(o,l,d){const{width:p,height:y}=o,{context:b}=this,{gl:C}=b,{HTMLImageElement:D,HTMLCanvasElement:T,HTMLVideoElement:k,ImageData:L,ImageBitmap:N}=Je;if(C.bindTexture(C.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!l||!1!==l.premultiply)),d||this.size&&this.size[0]===p&&this.size[1]===y){const{x:V,y:U}=d||{x:0,y:0};o instanceof D||o instanceof T||o instanceof k||o instanceof L||N&&o instanceof N?C.texSubImage2D(C.TEXTURE_2D,0,V,U,C.RGBA,C.UNSIGNED_BYTE,o):C.texSubImage2D(C.TEXTURE_2D,0,V,U,p,y,C.RGBA,C.UNSIGNED_BYTE,o.data)}else this.size=[p,y],o instanceof D||o instanceof T||o instanceof k||o instanceof L||N&&o instanceof N?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,o):C.texImage2D(C.TEXTURE_2D,0,this.format,p,y,0,this.format,C.UNSIGNED_BYTE,o.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&C.generateMipmap(C.TEXTURE_2D)}bind(o,l){const{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),o!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?o===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:o),this.filter=o),l!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class gb{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class gy{constructor(){this.tasks={},this.taskQueue=[],Ai(["process"],this),this.invoker=new gb(this.process),this.nextId=0}add(o,l){const d=this.nextId++,p=function({type:y,isSymbolTile:b,zoom:C}){return C=C||0,"message"===y?0:"maybePrepare"!==y||b?"parseTile"!==y||b?"parseTile"===y&&b?300-C:"maybePrepare"===y&&b?400-C:500:200-C:100-C}(l);if(0===p){Na();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[d]={fn:o,metadata:l,priority:p,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){Na();try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const y=this.tasks[this.taskQueue[p]];y.priority<l&&(l=y.priority,o=p)}if(null===o)return null;const d=this.taskQueue[o];return this.taskQueue.splice(o,1),d}remove(){this.invoker.remove()}}class Kw{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const d=o[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const Qw=["tile","layer","source","sourceLayer","state"];class Jw{constructor(o,l,d,p,y){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=d,this._y=p,this.properties=o.properties,this.id=y}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const l of Qw)void 0!==this[l]&&(o[l]=this[l]);return o}}const Zu=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,d=0,p=0,y=0,b=0,C=0;for(1&o?p=y=b=32:l=d=C=32;(o>>=1)>1;){const T=l+p>>1,k=d+y>>1;1&o?(p=l,y=d,l=b,d=C):(l=p,d=y,p=b,y=C),b=T,C=k}const D=4*a;Zu[D+0]=l,Zu[D+1]=d,Zu[D+2]=p,Zu[D+3]=y}const Ms=new Uint16Array(2178),Xu=new Uint8Array(1089),Fc=new Uint16Array(1089);function cr(a){return 0===a?-.03125:32===a?.03125:0}var eC=Te([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const _b={type:2,extent:en,loadGeometry:()=>[[new Ct(0,0),new Ct(en+1,0),new Ct(en+1,en+1),new Ct(0,en+1),new Ct(0,0)]]};class Ka{constructor(o,l,d,p,y){this.tileID=o,this.uid=hi(),this.uses=0,this.tileSize=l,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(o){const l=o+this.timeAdded;l<da.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ph(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,d){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(p,y){const b={};if(!y)return b;for(const C of p){const D=C.layerIds.map(T=>y.getLayer(T)).filter(Boolean);if(0!==D.length){C.layers=D,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(T=>D.filter(k=>k.id===T)[0]));for(const T of D)b[T.id]=C}}return b}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof Wu){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof Wu&&y.hasRTLText){this.hasRTLText=!0,O.isLoading()||O.isLoaded()||"deferred"!==E()||I();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(y))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new fi}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const d in this.buckets){const p=this.buckets[d];p.uploadPending()&&p.upload(o)}const l=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Jf(o,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Jf(o,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Jf(o,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,l,d,p,y,b,C,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:C,transform:b,params:y,tileTransform:this.tileTransform},o,l,d):{}}querySourceFeatures(o,l){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const p=d.loadVTLayers(),y=l?l.sourceLayer:"",b=p._geojsonTileLayer||p[y];if(!b)return;const C=$a(l&&l.filter),{z:D,x:T,y:k}=this.tileID.canonical,L={z:D,x:T,y:k};for(let N=0;N<b.length;N++){const V=b.feature(N);if(C.needGeometry){const te=oh(V,!0);if(!C.filter(new R(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!C.filter(new R(this.tileID.overscaledZ),V))continue;const U=d.getId(V,y),j=new Jw(V,D,T,k,U);j.tile=L,o.push(j)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const l=this.expirationTime;if(o.cacheControl){const d=ds(o.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const d=Date.now();let p=!1;if(this.expirationTime>d)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const y=this.expirationTime-l;y?this.expirationTime=d+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!l)return;const d=this.latestFeatureIndex.loadVTLayers(),p=l.style.listImages();for(const y in this.buckets){if(!l.style.hasLayer(y))continue;const b=this.buckets[y],C=b.layers[0].sourceLayer||"_geojsonTileLayer",D=d[C],T=o[C];if(!D||!T||0===Object.keys(T).length)continue;if(b.update(T,D,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),b instanceof Tm||b instanceof V_){const L=l.style._getSourceCache(b.layers[0].source);l._terrain&&l._terrain.enabled&&L&&b.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(L.id,this.tileID)}const k=l&&l.style&&l.style.getLayer(y);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(b)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<da.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=da.now()+o}setTexture(o,l){const d=l.context,p=d.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new Jf(d,o,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(o,l){const d={};for(const p of l)d[p]=!0;this.dependencies[o]=d}hasDependency(o,l){for(const d of o){const p=this.dependencies[d];if(p)for(const y of l)if(p[y])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const d=Ic(_b,this.tileID.canonical,this.tileTransform)[0],p=new ut,y=new vs;for(let b=0;b<d.length;b++){const{x:C,y:D}=d[b];p.emplaceBack(C,D),y.emplaceBack(b)}y.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(y),this._tileDebugBuffer=o.createVertexBuffer(p,Bu.members),this._tileDebugSegments=vr.simpleSegment(0,0,p.length,y.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const d=Ic(_b,this.tileID.canonical,this.tileTransform)[0];let p,y;if(this.isRaster){const b=function(C,D){const T=ph(C,D),k=Math.pow(2,C.z);for(let te=0;te<33;te++)for(let q=0;q<33;q++){const pe=Mo((C.x+(q+cr(q))/32)/k),ae=fo((C.y+(te+cr(te))/32)/k),fe=D.project(pe,ae),ge=33*te+q;Ms[2*ge+0]=Math.round((fe.x*T.scale-T.x)*en),Ms[2*ge+1]=Math.round((fe.y*T.scale-T.y)*en)}Xu.fill(0),Fc.fill(0);for(let te=2045;te>=0;te--){const q=4*te,pe=Zu[q+0],ae=Zu[q+1],fe=Zu[q+2],ge=Zu[q+3],_e=pe+fe>>1,Fe=ae+ge>>1,ke=_e+Fe-ae,Ge=Fe+pe-_e,ct=33*ae+pe,ze=33*ge+fe,Qe=33*Fe+_e,Ye=Math.hypot((Ms[2*ct+0]+Ms[2*ze+0])/2-Ms[2*Qe+0],(Ms[2*ct+1]+Ms[2*ze+1])/2-Ms[2*Qe+1])>=16;Xu[Qe]=Xu[Qe]||(Ye?1:0),te<1022&&(Xu[Qe]=Xu[Qe]||Xu[33*(ae+Ge>>1)+(pe+ke>>1)]||Xu[33*(ge+Ge>>1)+(fe+ke>>1)])}const L=new Ze,N=new qt;let V=0;function U(te,q){const pe=33*q+te;return 0===Fc[pe]&&(L.emplaceBack(Ms[2*pe+0],Ms[2*pe+1],te*en/32,q*en/32),Fc[pe]=++V),Fc[pe]-1}function j(te,q,pe,ae,fe,ge){const _e=te+pe>>1,Fe=q+ae>>1;if(Math.abs(te-fe)+Math.abs(q-ge)>1&&Xu[33*Fe+_e])j(fe,ge,te,q,_e,Fe),j(pe,ae,fe,ge,_e,Fe);else{const ke=U(te,q),Ge=U(pe,ae),ct=U(fe,ge);N.emplaceBack(ke,Ge,ct)}}return j(0,0,32,32,32,0),j(32,32,0,0,0,32),{vertices:L,indices:N}}(this.tileID.canonical,l);p=b.vertices,y=b.indices}else{p=new Ze,y=new qt;for(const{x:C,y:D}of d)p.emplaceBack(C,D,0,0);const b=kv(p.int16,void 0,4);for(let C=0;C<b.length;C+=3)y.emplaceBack(b[C],b[C+1],b[C+2])}this._tileBoundsBuffer=o.createVertexBuffer(p,eC.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(y),this._tileBoundsSegments=vr.simpleSegment(0,0,p.length,y.length)}_makeGlobeTileDebugBuffers(o,l){const d=l.projection;if(!d||"globe"!==d.name||l.freezeTileCoverage)return;const p=this.tileID.canonical,y=w_(Cv(p,l)),b=fm(l.zoom);let C;b>0&&(C=mv(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,p,l,y,C,b),this._makeGlobeTileDebugTextBuffer(o,p,l,y,C,b)}_globePoint(o,l,d,p,y,b,C){let D=Sl(o,l,d);if(b){const T=1<<d.z,k=ns(p.center.lng),L=Za(p.center.lat),N=(d.x+.5)/T-k;let V=0;N>.5?V=-1:N<-.5&&(V=1);let U=(o/en+d.x)/T+V,j=(l/en+d.y)/T;U=(U-k)*p._pixelsPerMercatorPixel+k,j=(j-L)*p._pixelsPerMercatorPixel+L;const te=[U*p.worldSize,j*p.worldSize,0];Pr(te,te,b),D=th(D,te,C)}return Pr(D,D,y)}_makeGlobeTileDebugBorderBuffer(o,l,d,p,y,b){const C=new ut,D=new vs,T=new Re,k=(N,V,U,j,te)=>{const q=(U-N)/(te-1),pe=(j-V)/(te-1),ae=C.length;for(let fe=0;fe<te;fe++){const ge=N+fe*q,_e=V+fe*pe;C.emplaceBack(ge,_e);const Fe=this._globePoint(ge,_e,l,d,p,y,b);T.emplaceBack(Fe[0],Fe[1],Fe[2]),D.emplaceBack(ae+fe)}},L=en;k(0,0,L,0,16),k(L,0,L,L,16),k(L,L,0,L,16),k(0,L,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(D),this._tileDebugBuffer=o.createVertexBuffer(C,Bu.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(T,bv.members),this._tileDebugSegments=vr.simpleSegment(0,0,C.length,D.length)}_makeGlobeTileDebugTextBuffer(o,l,d,p,y,b){const C=en/4,D=new ut,T=new qt,k=new Re,L=25;T.reserve(32),D.reserve(L),k.reserve(L);const N=(V,U)=>L*V+U;for(let V=0;V<L;V++){const U=V*C;for(let j=0;j<L;j++){const te=j*C;D.emplaceBack(te,U);const q=this._globePoint(te,U,l,d,p,y,b);k.emplaceBack(q[0],q[1],q[2])}}for(let V=0;V<4;V++)for(let U=0;U<4;U++){const j=N(V,U),te=N(V,U+1),q=N(V+1,U),pe=N(V+1,U+1);T.emplaceBack(j,te,q),T.emplaceBack(q,te,pe)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(T),this._tileDebugTextBuffer=o.createVertexBuffer(D,Bu.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(k,bv.members),this._tileDebugTextSegments=vr.simpleSegment(0,0,L,32)}}class ZT{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,d){const p=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][p]=this.stateChanges[o][p]||{},Tr(this.stateChanges[o][p],d),null===this.deletedStates[o]){this.deletedStates[o]={};for(const y in this.state[o])y!==p&&(this.deletedStates[o][y]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][p]){this.deletedStates[o][p]={};for(const y in this.state[o][p])d[y]||(this.deletedStates[o][p][y]=null)}else for(const y in d)this.deletedStates[o]&&this.deletedStates[o][p]&&null===this.deletedStates[o][p][y]&&delete this.deletedStates[o][p][y]}removeFeatureState(o,l,d){if(null===this.deletedStates[o])return;const p=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},d&&void 0!==l)null!==this.deletedStates[o][p]&&(this.deletedStates[o][p]=this.deletedStates[o][p]||{},this.deletedStates[o][p][d]=null);else if(void 0!==l)if(this.stateChanges[o]&&this.stateChanges[o][p])for(d in this.deletedStates[o][p]={},this.stateChanges[o][p])this.deletedStates[o][p][d]=null;else this.deletedStates[o][p]=null;else this.deletedStates[o]=null}getState(o,l){const d=String(l),p=Tr({},(this.state[o]||{})[d],(this.stateChanges[o]||{})[d]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const y=this.deletedStates[o][l];if(null===y)return{};for(const b in y)delete p[b]}return p}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){const d={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),Tr(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];d[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(null===this.deletedStates[p])for(const b in this.state[p])y[b]={},this.state[p][b]={};else for(const b in this.deletedStates[p]){if(null===this.deletedStates[p][b])this.state[p][b]={};else if(this.state[p][b])for(const C of Object.keys(this.deletedStates[p][b]))delete this.state[p][b][C];y[b]=this.state[p][b]}d[p]=d[p]||{},Tr(d[p],y)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length)for(const p in o)o[p].setFeatureState(d,l)}}class tC{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const d=this.toIdx(o,l);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function Yu(a,o,l,d){let p=0,y=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(d[b])<1e-15){if(l[b]<a[b]||l[b]>o[b])return null}else{const C=1/d[b];let D=(a[b]-l[b])*C,T=(o[b]-l[b])*C;if(D>T){const k=D;D=T,T=k}if(D>p&&(p=D),T<y&&(y=T),p>y)return null}return p}function nC(a,o,l,d,p,y,b,C,D,T,k){const L=d-a,N=p-o,V=y-l,U=b-a,j=C-o,te=D-l,q=k[1]*te-k[2]*j,pe=k[2]*U-k[0]*te,ae=k[0]*j-k[1]*U,fe=L*q+N*pe+V*ae;if(Math.abs(fe)<1e-15)return null;const ge=1/fe,_e=T[0]-a,Fe=T[1]-o,ke=T[2]-l,Ge=(_e*q+Fe*pe+ke*ae)*ge;if(Ge<0||Ge>1)return null;const ct=Fe*V-ke*N,ze=ke*L-_e*V,Qe=_e*N-Fe*L,Ye=(k[0]*ct+k[1]*ze+k[2]*Qe)*ge;return Ye<0||Ge+Ye>1?null:(U*ct+j*ze+te*Qe)*ge}function _y(a,o,l){return(a-o)/(l-o)}function XT(a,o,l,d,p,y,b,C,D){const T=1<<l,k=y-d,L=b-p,N=(a+1)/T*k+d,V=(o+0)/T*L+p,U=(o+1)/T*L+p;C[0]=(a+0)/T*k+d,C[1]=V,D[0]=N,D[1]=U}class yy{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(y){const b=Math.ceil(Math.log2(y.dim/8)),C=[];let D=Math.ceil(Math.pow(2,b));const T=1/D,k=(V,U,j,te,q)=>{const pe=te?1:0,ae=(V+1)*j-pe,fe=U*j,ge=(U+1)*j-pe;q[0]=V*j,q[1]=fe,q[2]=ae,q[3]=ge};let L=new tC(D);const N=[];for(let V=0;V<D*D;V++){k(V%D,Math.floor(V/D),T,!1,N);const U=Ku(N[0],N[1],y),j=Ku(N[2],N[1],y),te=Ku(N[2],N[3],y),q=Ku(N[0],N[3],y);L.minimums.push(Math.min(U,j,te,q)),L.maximums.push(Math.max(U,j,te,q)),L.leaves.push(1)}for(C.push(L),D/=2;D>=1;D/=2){const V=C[C.length-1];L=new tC(D);for(let U=0;U<D*D;U++){k(U%D,Math.floor(U/D),2,!0,N);const j=V.getElevation(N[0],N[1]),te=V.getElevation(N[2],N[1]),q=V.getElevation(N[2],N[3]),pe=V.getElevation(N[0],N[3]),ae=V.isLeaf(N[0],N[1]),fe=V.isLeaf(N[2],N[1]),ge=V.isLeaf(N[2],N[3]),_e=V.isLeaf(N[0],N[3]),Fe=Math.min(j.min,te.min,q.min,pe.min),ke=Math.max(j.max,te.max,q.max,pe.max),Ge=ae&&fe&&ge&&_e;L.maximums.push(ke),L.minimums.push(Fe),L.leaves.push(ke-Fe<=5&&Ge?1:0)}C.push(L)}return C}(this.dem),d=l.length-1,p=l[d];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,d,0)}raycastRoot(o,l,d,p,y,b,C=1){return Yu([o,l,-100],[d,p,this.maximums[0]*C],y,b)}raycast(o,l,d,p,y,b,C=1){if(!this.nodeCount)return null;const D=this.raycastRoot(o,l,d,p,y,b,C);if(null==D)return null;const T=[],k=[],L=[],N=[],V=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:U,t:j,nodex:te,nodey:q,depth:pe}=V.pop();if(this.leaves[U]){XT(te,q,pe,o,l,d,p,L,N);const fe=1<<pe,ge=(te+0)/fe,_e=(te+1)/fe,Fe=(q+0)/fe,ke=(q+1)/fe,Ge=Ku(ge,Fe,this.dem)*C,ct=Ku(_e,Fe,this.dem)*C,ze=Ku(_e,ke,this.dem)*C,Qe=Ku(ge,ke,this.dem)*C,Ye=nC(L[0],L[1],Ge,N[0],L[1],ct,N[0],N[1],ze,y,b),at=nC(N[0],N[1],ze,L[0],N[1],Qe,L[0],L[1],Ge,y,b),pt=Math.min(null!==Ye?Ye:Number.MAX_VALUE,null!==at?at:Number.MAX_VALUE);if(pt!==Number.MAX_VALUE)return pt;{const $e=Jd([],y,b,j);if(yb(Ge,ct,Qe,ze,_y($e[0],L[0],N[0]),_y($e[1],L[1],N[1]))>=$e[2])return j}continue}let ae=0;for(let fe=0;fe<this._siblingOffset.length;fe++){XT((te<<1)+this._siblingOffset[fe][0],(q<<1)+this._siblingOffset[fe][1],pe+1,o,l,d,p,L,N),L[2]=-100,N[2]=this.maximums[this.childOffsets[U]+fe]*C;const ge=Yu(L,N,y,b);if(null!=ge){const _e=ge;T[fe]=_e;let Fe=!1;for(let ke=0;ke<ae&&!Fe;ke++)_e>=T[k[ke]]&&(k.splice(ke,0,fe),Fe=!0);Fe||(k[ae]=fe),ae++}}for(let fe=0;fe<ae;fe++){const ge=k[fe];V.push({idx:this.childOffsets[U]+ge,t:T[ge],nodex:(te<<1)+this._siblingOffset[ge][0],nodey:(q<<1)+this._siblingOffset[ge][1],depth:pe+1})}}return null}_addNode(o,l,d){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,d,p,y){if(1===o[p].isLeaf(l,d))return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const b=p-1,C=o[b];let D=0,T=0;for(let k=0;k<this._siblingOffset.length;k++){const L=2*l+this._siblingOffset[k][0],N=2*d+this._siblingOffset[k][1],V=C.getElevation(L,N),U=C.isLeaf(L,N),j=this._addNode(V.min,V.max,U);U&&(D|=1<<k),T||(T=j)}for(let k=0;k<this._siblingOffset.length;k++)D&1<<k||this._construct(o,2*l+this._siblingOffset[k][0],2*d+this._siblingOffset[k][1],b,T+k)}}function yb(a,o,l,d,p,y){return Nn(Nn(a,l,y),Nn(o,d,y),p)}function Ku(a,o,l){const d=l.dim,p=Ln(a*d-.5,0,d-1),y=Ln(o*d-.5,0,d-1),b=Math.floor(p),C=Math.floor(y),D=Math.min(b+1,d-1),T=Math.min(C+1,d-1);return yb(l.get(b,C),l.get(D,C),l.get(b,T),l.get(D,T),p-b,y-C)}const iC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function rC(a,o,l){return(256*a*256+256*o+l)/10-1e4}function YT(a,o,l){return 256*a+o+l/256-32768}class zm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,d,p=!1,y=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&"mapbox"!==d&&"terrarium"!==d)return Fi(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const b=this.dim=l.height-2,C=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=d||"mapbox",this.borderReady=p,!p){for(let D=0;D<b;D++)C[this._idx(-1,D)]=C[this._idx(0,D)],C[this._idx(b,D)]=C[this._idx(b-1,D)],C[this._idx(D,-1)]=C[this._idx(D,0)],C[this._idx(D,b)]=C[this._idx(D,b-1)];C[this._idx(-1,-1)]=C[this._idx(0,0)],C[this._idx(b,-1)]=C[this._idx(b-1,0)],C[this._idx(-1,b)]=C[this._idx(0,b-1)],C[this._idx(b,b)]=C[this._idx(b-1,b-1)],y&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new yy(this)}get(o,l,d=!1){d&&(o=Ln(o,-1,this.dim),l=Ln(l,-1,this.dim));const p=4*this._idx(o,l);return("terrarium"===this.encoding?YT:rC)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(o){return iC[o]}get unpackVector(){return iC[this.encoding]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const d=[0,0,0,0],p=zm.getUnpackVector(l);let y=Math.floor((o+p[3])/p[2]);return d[2]=y%256,y=Math.floor(y/256),d[1]=y%256,y=Math.floor(y/256),d[0]=y,d}getPixels(){return new Cs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,d){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,y=l*this.dim+this.dim,b=d*this.dim,C=d*this.dim+this.dim;switch(l){case-1:p=y-1;break;case 1:y=p+1}switch(d){case-1:b=C-1;break;case 1:C=b+1}const D=-l*this.dim,T=-d*this.dim;for(let k=b;k<C;k++)for(let L=p;L<y;L++){const N=4*this._idx(L,k),V=4*this._idx(L+D,k+T);this.pixels[N+0]=o.pixels[V+0],this.pixels[N+1]=o.pixels[V+1],this.pixels[N+2]=o.pixels[V+2],this.pixels[N+3]=o.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}jt(zm,"DEMData"),jt(yy,"DemMinMaxQuadTree",{omit:["dem"]});class KT{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(const o in this.data)for(const l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,d){const p=o.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const y={value:l,timeout:void 0};if(void 0!==d&&(y.timeout=setTimeout(()=>{this.remove(o,y)},d)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){const l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;const d=o.wrapped().key,p=void 0===l?0:this.data[d].indexOf(l),y=this.data[d][p];return this.data[d].splice(p,1),y.timeout&&clearTimeout(y.timeout),0===this.data[d].length&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){const l=[];for(const d in this.data)for(const p of this.data[d])o(p.value)||l.push(p);for(const d of l)this.remove(d.value.tileID,d)}}class ep{constructor(o,l,d){this.func=o,this.mask=l,this.range=d}}ep.ReadOnly=!1,ep.ReadWrite=!0,ep.disabled=new ep(519,ep.ReadOnly,[0,1]);class vy{constructor(o,l,d,p,y,b){this.test=o,this.ref=l,this.mask=d,this.fail=p,this.depthFail=y,this.pass=b}}vy.disabled=new vy({func:519,mask:0},0,0,7680,7680,7680);class Qa{constructor(o,l,d){this.blendFunction=o,this.blendColor=l,this.mask=d}}Qa.Replace=[1,0],Qa.disabled=new Qa(Qa.Replace,gr.transparent,[!1,!1,!1,!1]),Qa.unblended=new Qa(Qa.Replace,gr.transparent,[!0,!0,!0,!0]),Qa.alphaBlended=new Qa([1,771],gr.transparent,[!0,!0,!0,!0]);class Ja{constructor(o,l,d){this.enable=o,this.mode=l,this.frontFace=d}}Ja.disabled=new Ja(!1,1029,2305),Ja.backCCW=new Ja(!0,1029,2305),Ja.backCW=new Ja(!0,1029,2304),Ja.frontCW=new Ja(!0,1028,2304),Ja.frontCCW=new Ja(!0,1028,2305);class tp extends uu{constructor(o,l,d){super(),this.id=o,this._onlySymbols=d,l.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new KT(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new ZT,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const l=this._tiles[o];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const d=this._tiles[l];d.upload(o),d.prepare(this.map.style.imageManager)}}getIds(){return cl(this._tiles).map(o=>o.tileID).sort(sC).map(o=>o.key)}getRenderableIds(o){const l=[];for(const d in this._tiles)this._isIdRenderable(+d,o)&&l.push(this._tiles[d]);return o?l.sort((d,p)=>{const y=d.tileID,b=p.tileID,C=new Ct(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),D=new Ct(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-b.overscaledZ||D.y-C.y||D.x-C.x}).map(d=>d.tileID.key):l.map(d=>d.tileID).sort(sC).map(d=>d.key)}hasRenderableParent(o){const l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){const d=this._tiles[o];d&&("loading"!==d.state&&(d.state=l),this._loadTile(d,this._tileLoaded.bind(this,d,o,l)))}_tileLoaded(o,l,d,p){if(p)if(o.state="errored",404!==p.status)this._source.fire(new Ba(p,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=da.now(),"expired"===d&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new Ls("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const y=l[p];if(o.neighboringTiles&&o.neighboringTiles[y]){const b=this.getTileByID(y);d(o,b),d(b,o)}}function d(p,y){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let b=y.tileID.canonical.x-p.tileID.canonical.x;const C=y.tileID.canonical.y-p.tileID.canonical.y,D=Math.pow(2,p.tileID.canonical.z),T=y.tileID.key;0===b&&0===C||Math.abs(C)>1||(Math.abs(b)>1&&(1===Math.abs(b+D)?b+=D:1===Math.abs(b-D)&&(b-=D)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,b,C),p.neighboringTiles&&p.neighboringTiles[T]&&(p.neighboringTiles[T].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,d,p){for(const y in this._tiles){let b=this._tiles[y];if(p[y]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>d)continue;let C=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){const T=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[T.key],b&&b.hasData()&&(C=T)}let D=C;for(;D.overscaledZ>l;)if(D=D.scaledTo(D.overscaledZ-1),o[D.key]){p[C.key]=C;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){const d=this._loadedParentTiles[o.key];return d&&d.tileID.overscaledZ>=l?d:null}for(let d=o.overscaledZ-1;d>=l;d--){const p=o.scaledTo(d),y=this._getLoadedTile(p);if(y)return y}}_getLoadedTile(o){const l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;const d=Math.ceil(o.width/l)+1,p=Math.ceil(o.height/l)+1,y=Math.floor(d*p*5),b="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,y):y,C="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(C)}handleWrapJump(o){const l=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,l){const d={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+l),d[y.tileID.key]=y}this._tiles=d;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(o,l,d){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;let p;this.updateCacheSize(o,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new io(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(p=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(C=>this._source.hasTile(C)))):p=[];const y=this._updateRetainedTiles(p);if(aC(this._source.type)&&0!==p.length){const C={},D={},T=Object.keys(y);for(const L of T){const N=y[L],V=this._tiles[L];if(!V||V.fadeEndTime&&V.fadeEndTime<=da.now())continue;const U=this.findLoadedParent(N,Math.max(N.overscaledZ-tp.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),C[U.tileID.key]=U.tileID),D[L]=N}const k=p[p.length-1].overscaledZ;for(const L in this._tiles){const N=this._tiles[L];if(y[L]||!N.hasData())continue;let V=N.tileID;for(;V.overscaledZ>k;){V=V.scaledTo(V.overscaledZ-1);const U=this._tiles[V.key];if(U&&U.hasData()&&D[V.key]){y[L]=N.tileID;break}}}for(const L in C)y[L]||(this._coveredTiles[L]=!0,y[L]=C[L])}for(const C in y)this._tiles[C].clearFadeHold();const b=function(C,D){const T=[];for(const k in C)k in D||T.push(k);return T}(this._tiles,y);for(const C of b){const D=this._tiles[C];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const l={};if(0===o.length)return l;const d={},p=o.reduce((T,k)=>Math.min(T,k.overscaledZ),1/0),y=o[0].overscaledZ,b=Math.max(y-tp.maxOverzooming,this._source.minzoom),C=Math.max(y+tp.maxUnderzooming,this._source.minzoom),D={};for(const T of o){const k=this._addTile(T);l[T.key]=T,k.hasData()||p<this._source.maxzoom&&(D[T.key]=T)}this._retainLoadedChildren(D,p,C,l);for(const T of o){let k=this._tiles[T.key];if(k.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const N=T.children(this._source.maxzoom)[0],V=this.getTile(N);if(V&&V.hasData()){l[N.key]=N;continue}}else{const N=T.children(this._source.maxzoom);if(l[N[0].key]&&l[N[1].key]&&l[N[2].key]&&l[N[3].key])continue}let L=k.wasRequested();for(let N=T.overscaledZ-1;N>=b;--N){const V=T.scaledTo(N);if(d[V.key]||(d[V.key]=!0,k=this.getTile(V),!k&&L&&(k=this._addTile(V)),k&&(l[V.key]=V,L=k.wasRequested(),k.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const l=[];let d,p=this._tiles[o].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){d=this._loadedParentTiles[p.key];break}l.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;p=y}for(const y of l)this._loadedParentTiles[y]=d}}_addTile(o){let l=this._tiles[o.key];if(l)return l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));const d=!!l;if(!d){const p=this.map?this.map.painter:null;l=new Ka(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,d||this._source.fire(new Ls("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const d=l.getExpiryTimeout();d&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},d))}_removeTile(o){const l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,d){const p=[],y=this.transform;if(!y)return p;const b="globe"===y.projection.name,C=ns(y.center.lng);for(const D in this._tiles){const T=this._tiles[D];if(d&&T.clearQueryDebugViz(),T.holdingForFade())continue;let k;if(b){const L=T.tileID.canonical;if(0===L.z){const N=[Math.abs(Ln(C,...np(L,-1))-C),Math.abs(Ln(C,...np(L,1))-C)];k=[0,2*N.indexOf(Math.min(...N))-1]}else{const N=[Math.abs(Ln(C,...np(L,-1))-C),Math.abs(Ln(C,...np(L,0))-C),Math.abs(Ln(C,...np(L,1))-C)];k=[N.indexOf(Math.min(...N))-1]}}else k=[0];for(const L of k){const N=o.containsTile(T,y,l,L);N&&p.push(N)}}return p}getVisibleCoordinates(o){const l=this.getRenderableIds(o).map(d=>this._tiles[d].tileID);for(const d of l)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(aC(this._source.type))for(const o in this._tiles){const l=this._tiles[o];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=da.now())return!0}return!1}setFeatureState(o,l,d){this._state.updateState(o=o||"_geojsonTileLayer",l,d)}removeFeatureState(o,l,d){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,d)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,d){const p=this._tiles[o];p&&p.setDependencies(l,d)}reloadTilesForDependencies(o,l){for(const d in this._tiles)this._tiles[d].hasDependency(o,l)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(o,l))}_preloadTiles(o,l){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(o,l))};return void this._source.on("data",C)}const d=new Map,p=Array.isArray(o)?o:[o],y=this.map.painter.terrain,b=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const C of p){const D=C.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const T of D)d.set(T.key,T);this.usedForTerrain&&C.updateElevation(!1)}jr(Array.from(d.values()),(C,D)=>{const T=new Ka(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(T,k=>{"raster-dem"===this._source.type&&T.dem&&this._backfillDEM(T),D(k,T)})},l)}}function sC(a,o){const l=Math.abs(2*a.wrap)-+(a.wrap<0),d=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||d-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function aC(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function np(a,o){const l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}tp.maxOverzooming=10,tp.maxUnderzooming=3;class Nc{constructor(o,l,d){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=d}static create(o,l,d){const p=d||o.findDEMTileFor(l);if(!p||!p.dem)return;const y=p.dem,b=p.tileID,C=1<<l.canonical.z-b.canonical.z;return new Nc(p,p.tileSize/en/C,[(l.canonical.x/C-b.canonical.x)*y.dim,(l.canonical.y/C-b.canonical.y)*y.dim])}tileCoordToPixel(o,l){const d=l*this._scale+this._offset[1],p=Math.floor(o*this._scale+this._offset[0]),y=Math.floor(d);return new Ct(p,y)}getElevationAt(o,l,d,p){const y=o*this._scale+this._offset[0],b=l*this._scale+this._offset[1],C=Math.floor(y),D=Math.floor(b),T=this._dem;return p=!!p,d?Nn(Nn(T.get(C,D,p),T.get(C,D+1,p),b-D),Nn(T.get(C+1,D,p),T.get(C+1,D+1,p),b-D),y-C):T.get(C,D,p)}getElevationAtPixel(o,l,d){return this._dem.get(o,l,!!d)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*ws(1,o)*this._dem.stride}}class kl{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Iu(en,16,0),this.featureIndexArray=new Ou,this.promoteId=l}insert(o,l,d,p,y,b=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,p,y,b);const D=this.grid;for(let T=0;T<l.length;T++){const k=l[T],L=[1/0,1/0,-1/0,-1/0];for(let N=0;N<k.length;N++){const V=k[N];L[0]=Math.min(L[0],V.x),L[1]=Math.min(L[1],V.y),L[2]=Math.max(L[2],V.x),L[3]=Math.max(L[3],V.y)}L[0]<en&&L[1]<en&&L[2]>=0&&L[3]>=0&&D.insert(C,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new H_(new $f(this.rawTileData)).layers,this.sourceLayerCoder=new Kw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,d,p){this.loadVTLayers();const y=o.params||{},b=$a(y.filter),C=o.tileResult,D=o.transform,T=C.bufferedTilespaceBounds,k=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(U,j,te,q)=>nw(C.bufferedTilespaceGeometry,U,j,te,q));k.sort(QT);let L=null;D.elevation&&k.length>0&&(L=Nc.create(D.elevation,this.tileID));const N={};let V;for(let U=0;U<k.length;U++){const j=k[U];if(j===V)continue;V=j;const te=this.featureIndexArray.get(j);let q=null;this.loadMatchingFeature(N,te,b,y.layers,y.availableImages,l,d,p,(pe,ae,fe,ge=0)=>(q||(q=Ic(pe,this.tileID.canonical,o.tileTransform)),ae.queryIntersectsFeature(C,pe,fe,q,this.z,o.transform,o.pixelPosMatrix,L,ge)))}return N}loadMatchingFeature(o,l,d,p,y,b,C,D,T){const{featureIndex:k,bucketIndex:L,sourceLayerIndex:N,layoutVertexArrayOffset:V}=l,U=this.bucketLayerIDs[L];if(p&&!function(pe,ae){for(let fe=0;fe<pe.length;fe++)if(ae.indexOf(pe[fe])>=0)return!0;return!1}(p,U))return;const j=this.sourceLayerCoder.decode(N),te=this.vtLayers[j].feature(k);if(d.needGeometry){const pe=oh(te,!0);if(!d.filter(new R(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!d.filter(new R(this.tileID.overscaledZ),te))return;const q=this.getId(te,j);for(let pe=0;pe<U.length;pe++){const ae=U[pe];if(p&&p.indexOf(ae)<0)continue;const fe=b[ae];if(!fe)continue;let ge={};void 0!==q&&D&&(ge=D.getState(fe.sourceLayer||"_geojsonTileLayer",q));const _e=Tr({},C[ae]);_e.paint=_h(_e.paint,fe.paint,te,ge,y),_e.layout=_h(_e.layout,fe.layout,te,ge,y);const Fe=!T||T(te,fe,ge,V);if(!Fe)continue;const ke=new Jw(te,this.z,this.x,this.y,q);ke.layer=_e;let Ge=o[ae];void 0===Ge&&(Ge=o[ae]=[]),Ge.push({featureIndex:k,feature:ke,intersectionZ:Fe})}}lookupSymbolFeatures(o,l,d,p,y,b,C,D){const T={};this.loadVTLayers();const k=$a(y);for(const L of o)this.loadMatchingFeature(T,{bucketIndex:d,sourceLayerIndex:p,featureIndex:L,layoutVertexArrayOffset:0},k,b,C,D,l);return T}loadFeature(o){const{featureIndex:l,sourceLayerIndex:d}=o;this.loadVTLayers();const p=this.sourceLayerCoder.decode(d),y=this.vtFeatures[p];if(y[l])return y[l];const b=this.vtLayers[p].feature(l);return y[l]=b,b}hasLayer(o){for(const l of this.bucketLayerIDs)for(const d of l)if(o===d)return!0;return!1}getId(o,l){let d=o.id;if(this.promoteId){const p="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=p&&(d=o.properties[p]),"boolean"==typeof d&&(d=Number(d))}return d}}function _h(a,o,l,d,p){return Vn(a,(y,b)=>{const C=o instanceof se?o.get(b):null;return C&&C.evaluate?C.evaluate(l,d,p):C})}function QT(a,o){return o-a}jt(kl,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class lC{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new ju({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const d=this.getKey(o,l);return this.positions[d]}trim(){const o=this.width,l=this.height=Sr(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,d){const p=[];let y=o.length%2==1?-o[o.length-1]*d:0,b=o[0]*d,C=!0;p.push({left:y,right:b,isDash:C,zeroLength:0===o[0]});let D=o[0];for(let T=1;T<o.length;T++){C=!C;const k=o[T];y=D*d,D+=k,b=D*d,p.push({left:y,right:b,isDash:C,zeroLength:0===k})}return p}addRoundDash(o,l,d){const p=l/2;for(let y=-d;y<=d;y++){const b=this.width*(this.nextRow+d+y);let C=0,D=o[C];for(let T=0;T<this.width;T++){T/D.right>1&&(D=o[++C]);const k=Math.abs(T-D.left),L=Math.abs(T-D.right),N=Math.min(k,L);let V;const U=y/d*(p+1);if(D.isDash){const j=p-Math.abs(U);V=Math.sqrt(N*N+j*j)}else V=p-Math.sqrt(N*N+U*U);this.image.data[b+T]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(o,l){for(let D=o.length-1;D>=0;--D){const T=o[D],k=o[D+1];T.zeroLength?o.splice(D,1):k&&k.isDash===T.isDash&&(k.left=T.left,o.splice(D,1))}const d=o[0],p=o[o.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const y=this.width*this.nextRow;let b=0,C=o[b];for(let D=0;D<this.width;D++){D/C.right>1&&(C=o[++b]);const T=Math.abs(D-C.left),k=Math.abs(D-C.right),L=Math.min(T,k);this.image.data[y+D]=Math.max(0,Math.min(255,(C.isDash?L:-L)+l+128))}}addDash(o,l){const d=this.getKey(o,l);if(this.positions[d])return this.positions[d];const p="round"===l,y=p?7:0,b=2*y+1;if(this.nextRow+b>this.height)return Fi("LineAtlas out of space"),null;0===o.length&&o.push(1);let C=0;for(let k=0;k<o.length;k++)o[k]<0&&(Fi("Negative value is found in line dasharray, replacing values with 0"),o[k]=0),C+=o[k];if(0!==C){const k=this.width/C,L=this.getDashRanges(o,this.width,k);p?this.addRoundDash(L,k,y):this.addRegularDash(L,"square"===l?.5*k:0)}const D=this.nextRow+y;this.nextRow+=b;const T={tl:[D,y],br:[C,0]};return this.positions[d]=T,T}}jt(lC,"LineAtlas");const vb=1*xa;class by{constructor(o){const l={},d=[];for(const C in o){const D=o[C],T=l[C]={};for(const k in D.glyphs){const L=D.glyphs[+k];if(!L||0===L.bitmap.width||0===L.bitmap.height)continue;const N=L.metrics.localGlyph?vb:1,V={x:0,y:0,w:L.bitmap.width+2*N,h:L.bitmap.height+2*N};d.push(V),T[k]=V}}const{w:p,h:y}=Rw(d),b=new ju({width:p||1,height:y||1});for(const C in o){const D=o[C];for(const T in D.glyphs){const k=D.glyphs[+T];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const L=l[C][T],N=k.metrics.localGlyph?vb:1;ju.copy(k.bitmap,b,{x:0,y:0},{x:L.x+N,y:L.y+N},k.bitmap)}}this.image=b,this.positions=l}}jt(by,"GlyphAtlas");class Vm{constructor(o){this.tileID=new io(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=ph(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,l,d,p,y){this.status="parsing",this.data=o,this.collisionBoxArray=new fi;const b=new Kw(Object.keys(o.layers).sort()),C=new kl(this.tileID,this.promoteId);C.bucketLayerIDs=[];const D={},T=new lC(256,256),k={featureIndex:C,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:d},L=l.familiesBySource[this.source];for(const ge in L){const _e=o.layers[ge];if(!_e)continue;let Fe=!1,ke=!1;for(const ze of L[ge])"symbol"===ze[0].type?Fe=!0:ke=!0;if(!0===this.isSymbolTile&&!Fe||!1===this.isSymbolTile&&!ke)continue;1===_e.version&&Fi(`Vector tile source "${this.source}" layer "${ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ge=b.encode(ge),ct=[];for(let ze=0;ze<_e.length;ze++){const Qe=_e.feature(ze),Ye=C.getId(Qe,ge);ct.push({feature:Qe,id:Ye,index:ze,sourceLayerIndex:Ge})}for(const ze of L[ge]){const Qe=ze[0];void 0!==this.isSymbolTile&&"symbol"===Qe.type!==this.isSymbolTile||Qe.minzoom&&this.zoom<Math.floor(Qe.minzoom)||Qe.maxzoom&&this.zoom>=Qe.maxzoom||"none"!==Qe.visibility&&(xy(ze,this.zoom,d),(D[Qe.id]=Qe.createBucket({index:C.bucketLayerIDs.length,layers:ze,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ge,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:d})).populate(ct,k,this.tileID.canonical,this.tileTransform),C.bucketLayerIDs.push(ze.map(Ye=>Ye.id)))}}let N,V,U,j;T.trim();const te={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},q=()=>{if(N)return y(N);if(V&&U&&j){const ge=new by(V),_e=new ty(U,j);for(const Fe in D){const ke=D[Fe];ke instanceof Wu?(xy(ke.layers,this.zoom,d),cb(ke,V,ge.positions,U,_e.iconPositions,this.showCollisionBoxes,d,this.tileID.canonical,this.tileZoom,this.projection)):ke.hasPattern&&(ke instanceof Tm||ke instanceof V_||ke instanceof Em)&&(xy(ke.layers,this.zoom,d),ke.addFeatures(k,this.tileID.canonical,_e.patternPositions,d,this.tileTransform))}this.status="done",y(null,{buckets:cl(D).filter(Fe=>!Fe.isEmpty()),featureIndex:C,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ge.image,lineAtlas:T,imageAtlas:_e,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?U:null,glyphPositions:this.returnDependencies?ge.positions:null})}},pe=Vn(k.glyphDependencies,ge=>Object.keys(ge).map(Number));Object.keys(pe).length?p.send("getGlyphs",{uid:this.uid,stacks:pe},(ge,_e)=>{N||(N=ge,V=_e,q())},void 0,!1,te):V={};const ae=Object.keys(k.iconDependencies);ae.length?p.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(ge,_e)=>{N||(N=ge,U=_e,q())},void 0,!1,te):U={};const fe=Object.keys(k.patternDependencies);fe.length?p.send("getImages",{icons:fe,source:this.source,tileID:this.tileID,type:"patterns"},(ge,_e)=>{N||(N=ge,j=_e,q())},void 0,!1,te):j={},q()}}function xy(a,o,l){const d=new R(o);for(const p of a)p.recalculate(d,l)}class JT{constructor(o){this.entries={},this.scheduler=o}request(o,l,d,p){const y=this.entries[o]=this.entries[o]||{callbacks:[]};if(y.result){const[b,C]=y.result;return this.scheduler?this.scheduler.add(()=>{p(b,C)},l):p(b,C),()=>{}}return y.callbacks.push(p),y.cancel||(y.cancel=d((b,C)=>{y.result=[b,C];for(const D of y.callbacks)this.scheduler?this.scheduler.add(()=>{D(b,C)},l):D(b,C);setTimeout(()=>delete this.entries[o],3e3)})),()=>{y.result||(y.callbacks=y.callbacks.filter(b=>b!==p),y.callbacks.length||(y.cancel(),delete this.entries[o]))}}}function wy(a,o,l){const d=JSON.stringify(a.request);return a.data&&(this.deduped.entries[d]={result:[null,a.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},p=>{const y=lu(a.request,(b,C,D,T)=>{b?p(b):C&&p(null,{vectorTile:l?void 0:new H_(new $f(C)),rawData:C,cacheControl:D,expires:T})});return()=>{y.cancel(),p()}},o)}const Qu=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ip{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,d]=new Uint8Array(o,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const p=d>>4;if(1!==p)throw new Error(`Got v${p} data when expected v1.`);const y=Qu[15&d];if(!y)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(o,2,1),[C]=new Uint32Array(o,4,1);return new ip(C,b,y,o)}constructor(o,l=64,d=Float64Array,p){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=d,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const y=Qu.indexOf(this.ArrayType),b=2*o*this.ArrayType.BYTES_PER_ELEMENT,C=o*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-C%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${d}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+C+D,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+b+C+D),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+C+D,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=o,this.coords[this._pos++]=l,d}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return Cy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,d,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:b,nodeSize:C}=this,D=[0,y.length-1,0],T=[];for(;D.length;){const k=D.pop()||0,L=D.pop()||0,N=D.pop()||0;if(L-N<=C){for(let te=N;te<=L;te++){const q=b[2*te],pe=b[2*te+1];q>=o&&q<=d&&pe>=l&&pe<=p&&T.push(y[te])}continue}const V=N+L>>1,U=b[2*V],j=b[2*V+1];U>=o&&U<=d&&j>=l&&j<=p&&T.push(y[V]),(0===k?o<=U:l<=j)&&(D.push(N),D.push(V-1),D.push(1-k)),(0===k?d>=U:p>=j)&&(D.push(V+1),D.push(L),D.push(1-k))}return T}within(o,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:b}=this,C=[0,p.length-1,0],D=[],T=d*d;for(;C.length;){const k=C.pop()||0,L=C.pop()||0,N=C.pop()||0;if(L-N<=b){for(let te=N;te<=L;te++)cC(y[2*te],y[2*te+1],o,l)<=T&&D.push(p[te]);continue}const V=N+L>>1,U=y[2*V],j=y[2*V+1];cC(U,j,o,l)<=T&&D.push(p[V]),(0===k?o-d<=U:l-d<=j)&&(C.push(N),C.push(V-1),C.push(1-k)),(0===k?o+d>=U:l+d>=j)&&(C.push(V+1),C.push(L),C.push(1-k))}return D}}function Cy(a,o,l,d,p,y){if(p-d<=l)return;const b=d+p>>1;bb(a,o,b,d,p,y),Cy(a,o,l,d,b-1,1-y),Cy(a,o,l,b+1,p,1-y)}function bb(a,o,l,d,p,y){for(;p>d;){if(p-d>600){const T=p-d+1,k=l-d+1,L=Math.log(T),N=.5*Math.exp(2*L/3),V=.5*Math.sqrt(L*N*(T-N)/T)*(k-T/2<0?-1:1);bb(a,o,l,Math.max(d,Math.floor(l-k*N/T+V)),Math.min(p,Math.floor(l+(T-k)*N/T+V)),y)}const b=o[2*l+y];let C=d,D=p;for(Um(a,o,d,l),o[2*p+y]>b&&Um(a,o,d,p);C<D;){for(Um(a,o,C,D),C++,D--;o[2*C+y]<b;)C++;for(;o[2*D+y]>b;)D--}o[2*d+y]===b?Um(a,o,d,D):(D++,Um(a,o,D,p)),D<=l&&(d=D+1),l<=D&&(p=D-1)}}function Um(a,o,l,d){xb(a,l,d),xb(o,2*l,2*d),xb(o,2*l+1,2*d+1)}function xb(a,o,l){const d=a[o];a[o]=a[l],a[l]=d}function cC(a,o,l,d){const p=a-l,y=o-d;return p*p+y*y}m.ARRAY_TYPE=Gi,m.AUTH_ERR_MSG=ve,m.Aabb=Eo,m.Actor=class{constructor(a,o,l){this.target=a,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Ai(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Na()?a:Je,this.scheduler=new gy}send(a,o,l,d,p=!1,y){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=y,this.callbacks[b]=l);const C=Ed(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:a,hasCallback:!!l,targetMapId:d,mustQueue:p,sourceMapId:this.mapId,data:Hd(o,C)},C),{cancel:()=>{l&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(a){const o=a.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d.cancel()}else if(o.mustQueue||Na()){const d=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,o),d&&d.metadata||{type:"message"})}else this.processTask(l,o)}processTask(a,o){if("<response>"===o.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(o.error?l(Au(o.error)):l(null,Au(o.data)))}else{const l=Ed(this.globalScope)?void 0:[],d=o.hasCallback?(y,b)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:y?Hd(y):null,data:Hd(b,l)},l)}:y=>{},p=Au(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,p,d);else if(this.parent.getWorkerSource){const y=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,y[0],p.source)[y[1]](p,d)}else d(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},m.CanonicalTileID=X_,m.Color=gr,m.ColorMode=Qa,m.CullFaceMode=Ja,m.DEMData=zm,m.DataConstantProperty=G,m.DedupedRequest=JT,m.DepthMode=ep,m.EXTENT=en,m.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const l=o.getSource().maxzoom,d=1<<l,p=Math.floor(a.x),y=Math.floor((a.x-p)*d),b=Math.floor(a.y*d),C=this.findDEMTileFor(new io(l,p,l,y,b));return!(!C||!C.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const d=this._source();if(!d||a.y<0||a.y>1)return o;const p=d.getSource().maxzoom,y=1<<p,b=Math.floor(a.x),C=a.x-b,D=new io(p,b,p,Math.floor(C*y),Math.floor(a.y*y)),T=this.findDEMTileFor(D);if(!T||!T.dem)return o;const k=T.dem,L=1<<T.tileID.canonical.z,N=(C*L-T.tileID.canonical.x)*k.dim,V=(a.y*L-T.tileID.canonical.y)*k.dim,U=Math.floor(N),j=Math.floor(V);return(l?this.exaggeration():1)*Nn(Nn(k.get(U,j),k.get(U,j+1),V-j),Nn(k.get(U+1,j),k.get(U+1,j+1),V-j),N-U)}getAtTileOffset(a,o,l){const d=1<<a.canonical.z;return this.getAtPointOrZero(new mo(a.wrap+(a.canonical.x+o/en)/d,(a.canonical.y+l/en)/d))}getAtTileOffsetFunc(a,o,l,d){return p=>{const y=this.getAtTileOffset(a,p.x,p.y),b=d.upVector(a.canonical,p.x,p.y);return _a(b,b,y*d.upVectorScale(a.canonical,o,l).metersToTile),b}}getForTilePoints(a,o,l,d){if(this.isUsingMockSource())return!1;const p=Nc.create(this,a,d);return!!p&&(o.forEach(y=>{y[2]=this.exaggeration()*p.getElevationAt(y[0],y[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const l=o.dem.tree,d=o.tileID,p=1<<a.canonical.z-d.canonical.z;let y=a.canonical.x/p-d.canonical.x,b=a.canonical.y/p-d.canonical.y,C=0;for(let D=0;D<a.canonical.z-d.canonical.z&&!l.leaves[C];D++){y*=2,b*=2;const T=2*Math.floor(b)+Math.floor(y);C=l.childOffsets[C]+T,y%=1,b%=1}return{min:this.exaggeration()*l.minimums[C],max:this.exaggeration()*l.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},m.ErrorEvent=Ba,m.EvaluationParameters=R,m.Event=Ls,m.Evented=uu,m.FillExtrusionBucket=Em,m.Frustum=y_,m.FrustumCorners=xv,m.GLOBE_RADIUS=Tl,m.GLOBE_SCALE_MATCH_LATITUDE=45,m.GLOBE_ZOOM_THRESHOLD_MAX=wv,m.GLOBE_ZOOM_THRESHOLD_MIN=v_,m.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,o){const l=new ut,d=new qt,p=[],y=a+1+2,b=o[0]+1,C=o[0]+1+(1+o.length),D=(T,k,L)=>{let N=T===y-1?T-2:0===T?T:T-1;return N+=L?24575:0,[N,k]};for(let T=0;T<y;++T)l.emplaceBack(...D(T,0,!0));for(let T=0;T<b;++T)for(let k=0;k<y;++k)l.emplaceBack(...D(k,T,(0===k||k===y-1)&&!0));for(let T=0;T<o.length;++T){const k=o[T];for(let L=0;L<y;++L)l.emplaceBack(...D(L,k,!0))}for(let T=0;T<o.length;++T){const k=d.length,L=o[T]+1+2,N=new qt;for(let j=0;j<L-1;j++){const te=j===L-2,q=te?y*(C-o.length+T-j):y;for(let pe=0;pe<y-1;pe++){const ae=j*y+pe;0===j||te||0===pe||pe===y-2?(N.emplaceBack(ae+1,ae,ae+q),N.emplaceBack(ae+q,ae+q+1,ae+1)):(d.emplaceBack(ae+1,ae,ae+q),d.emplaceBack(ae+q,ae+q+1,ae+1))}}const V=vr.simpleSegment(0,k,l.length,d.length-k);for(let j=0;j<N.uint16.length;j+=3)d.emplaceBack(N.uint16[j],N.uint16[j+1],N.uint16[j+2]);const U=vr.simpleSegment(0,k,l.length,d.length-k);p.push({withoutSkirts:V,withSkirts:U})}return{vertices:l,indices:d,segments:p}}_createGrid(a){const o=this._fillGridMeshWithLods(64,um);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,Bu.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){const o=new qt;for(let p=0;p<=64;p++)o.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const l=new vi,d=new vi;this._poleSegments=[];for(let p=0,y=0;p<v_;p++){const b=360/(1<<p);l.emplaceBack(0,-Tl,0,.5,0),d.emplaceBack(0,-Tl,0,.5,1);for(let C=0;C<=64;C++){const D=C/64,T=Nn(0,b,D),[k,L,N]=nh(aT,lT,T,Tl);l.emplaceBack(k,L,N,D,0),d.emplaceBack(k,L,N,D,1)}this._poleSegments.push(vr.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,__,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(d,__,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const l=new $r,d=64,p=d+1+2,y=1;this._wireframeSegments=[];for(let b=0,C=0;b<um.length;b++){const D=um[b];for(let k=y;k<D+y;k++)for(let L=y;L<d+y;L++){const N=k*p+L;l.emplaceBack(N,N+1),l.emplaceBack(N,N+p),l.emplaceBack(N,N+p+1)}const T=D*d*3;this._wireframeSegments.push(vr.simpleSegment(0,C,(D+1)*p,T)),C+=T}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},m.GlyphManager=$u,m.ImagePosition=Lw,m.KDBush=ip,m.LivePerformanceUtils=J0,m.LngLat=bi,m.LngLatBounds=Fu,m.LocalGlyphMode=sy,m.MAX_MERCATOR_LATITUDE=po,m.MercatorCoordinate=mo,m.ONE_EM=xr,m.OverscaledTileID=io,m.PerformanceMarkers=cu,m.Point=Ct,m.Properties=ue,m.RGBAImage=Cs,m.Ray=cm,m.RequestManager=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ru,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!Me(a))return a;const l=xt(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!Me(a))return a;const l=xt(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,d){if(!Me(a))return a;const p=xt(a);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),l&&p.params.push(`language=${l}`),d&&p.params.push(`worldview=${d}`),this._makeAPIURL(p,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,d){const p=xt(a);return Me(a)?(p.path=`/styles/v1${p.path}/sprite${o}${l}`,this._makeAPIURL(p,this._customAccessToken||d)):(p.path+=`${o}${l}`,ht(p))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Me(a))return a;const d=xt(a);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&"raster"!==d.authority&&512===l?"@2x":""}${wn.supported?".webp":"$1"}`),"raster"===d.authority?d.path=`/${En.RASTER_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${En.TILE_URL_VERSION}${d.path}`);const p=this._customAccessToken||function(y){for(const b of y){const C=b.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(d.params)||En.ACCESS_TOKEN;return En.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,p)}canonicalizeTileURL(a,o){const l=xt(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let d="mapbox://";l.path.match(/^\/raster\/v1\//)?d+=`raster/${l.path.replace(`/${En.RASTER_URL_PREFIX}/`,"")}`:d+=`tiles/${l.path.replace(`/${En.TILE_URL_VERSION}/`,"")}`;let p=l.params;return o&&(p=p.filter(y=>!y.match(/^access_token=/))),p.length&&(d+=`?${p.join("&")}`),d}canonicalizeTileset(a,o){const l=!!o&&Me(o),d=[];for(const p of a.tiles||[])Oe(p)?d.push(this.canonicalizeTileURL(p,l)):d.push(p);return d}_makeAPIURL(a,o){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",d=xt(En.API_URL);if(a.protocol=d.protocol,a.authority=d.authority,"http"===a.protocol){const p=a.params.indexOf("secure");p>=0&&a.params.splice(p,1)}if("/"!==d.path&&(a.path=`${d.path}${a.path}`),!En.REQUIRE_ACCESS_TOKEN)return ht(a);if(o=o||En.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(p=>-1===p.indexOf("access_token")),a.params.push(`access_token=${o||""}`),ht(a)}},m.ResourceType=Lo,m.SegmentVector=vr,m.SourceCache=tp,m.StencilMode=vy,m.StructArrayLayout1ui2=vs,m.StructArrayLayout2f1f2i16=Gt,m.StructArrayLayout2i4=ut,m.StructArrayLayout2ui4=$r,m.StructArrayLayout3f12=Dn,m.StructArrayLayout3ui6=qt,m.StructArrayLayout4i8=Ze,m.StructArrayLayout5f20=vi,m.Texture=Jf,m.Tile=Ka,m.Transitionable=H,m.Uniform1f=Mf,m.Uniform1i=class extends Ga{constructor(a){super(a),this.current=0}set(a,o,l){this.fetchUniformLocation(a,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},m.Uniform2f=class extends Ga{constructor(a){super(a),this.current=[0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},m.Uniform3f=class extends Ga{constructor(a){super(a),this.current=[0,0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},m.Uniform4f=B1,m.UniformColor=JD,m.UniformMatrix2f=class extends Ga{constructor(a){super(a),this.current=Cc}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let d=0;d<4;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},m.UniformMatrix3f=class extends Ga{constructor(a){super(a),this.current=Jo}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let d=0;d<9;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},m.UniformMatrix4f=class extends Ga{constructor(a){super(a),this.current=V1}set(a,o,l){if(this.fetchUniformLocation(a,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let d=1;d<16;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},m.UnwrappedTileID=DT,m.ValidationError=Ot,m.VectorTileFeature=Nf,m.VectorTileWorkerSource=class extends uu{constructor(a,o,l,d,p){super(),this.actor=a,this.layerIndex=o,this.availableImages=l,this.loadVectorData=p||wy,this.loading={},this.loaded={},this.deduped=new JT(a.scheduler),this.isSpriteLoaded=d,this.scheduler=a.scheduler}loadTile(a,o){const l=a.uid,d=a&&a.request,p=d&&d.collectResourceTiming,y=this.loading[l]=new Vm(a);y.abort=this.loadVectorData(a,(b,C)=>{const D=!this.loading[l];if(delete this.loading[l],D||b||!C)return y.status="done",D||(this.loaded[l]=y),o(b);const T=C.rawData,k={};C.expires&&(k.expires=C.expires),C.cacheControl&&(k.cacheControl=C.cacheControl),y.vectorTile=C.vectorTile||new H_(new $f(T));const L=()=>{y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,(N,V)=>{if(N||!V)return o(N);const U={};if(p){const j=or(d);j.length>0&&(U.resourceTiming=JSON.parse(JSON.stringify(j)))}o(null,Tr({rawTileData:T.slice(0)},V,k,U))})};this.isSpriteLoaded?L():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(L,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):L()}),this.loaded=this.loaded||{},this.loaded[l]=y})}reloadTile(a,o){const l=this.loaded,d=a.uid,p=this;if(l&&l[d]){const y=l[d];y.showCollisionBoxes=a.showCollisionBoxes,y.enableTerrain=!!a.enableTerrain,y.projection=a.projection,y.tileTransform=ph(a.tileID.canonical,a.projection);const b=(C,D)=>{const T=y.reloadCallback;T&&(delete y.reloadCallback,y.parse(y.vectorTile,p.layerIndex,this.availableImages,p.actor,T)),o(C,D)};"parsing"===y.status?y.reloadCallback=b:"done"===y.status&&(y.vectorTile?y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,b):b())}}abortTile(a,o){const l=a.uid,d=this.loading[l];d&&(d.abort&&d.abort(),delete this.loading[l]),o()}removeTile(a,o){const l=this.loaded,d=a.uid;l&&l[d]&&delete l[d],o()}},m.WritingMode=rs,m.ZoomDependentExpression=$t,m.add=Dl,m.addDynamicAttributes=Qf,m.adjoint=function(a,o){var l=o[0],d=o[1],p=o[2],y=o[3],b=o[4],C=o[5],D=o[6],T=o[7],k=o[8];return a[0]=b*k-C*T,a[1]=p*T-d*k,a[2]=d*C-p*b,a[3]=C*D-y*k,a[4]=l*k-p*D,a[5]=p*y-l*C,a[6]=y*T-b*D,a[7]=d*D-l*T,a[8]=l*b-d*y,a},m.asyncAll=jr,m.bezier=tc,m.bindAll=Ai,m.boundsAttributes=eC,m.bufferConvexPolygon=function(a,o){const l=[];for(let d=0;d<a.length;d++){const p=On(d-1,-1,a.length-1),y=On(d+1,-1,a.length-1),b=a[d],C=a[y],D=a[p].sub(b).unit(),T=C.sub(b).unit(),k=T.angleWithSep(D.x,D.y),L=D.add(T).unit().mult(-1*o/Math.sin(k/2));l.push(b.add(L))}return l},m.cacheEntryPossiblyAdded=function(a){Md++,Md>ou&&(a.getActor().send("enforceCacheSizeLimit",ef),Md=0)},m.calculateGlobeLabelMatrix=function(a,o){const{x:l,y:d}=a.point,p=oT(l,d,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Zd(p,p,W1(va(o)))},m.calculateGlobeMatrix=function(a){const{x:o,y:l}=a.point,{lng:d,lat:p}=a._center;return oT(o,l,a.worldSize,d,p)},m.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,l=o/ws(1,a.center.lat),d=qa(new Float64Array(16));return rm(d,d,[a.point.x,a.point.y,0]),zu(d,d,[l,l,o]),Float32Array.from(d)},m.circumferenceAtLatitude=xs,m.clamp=Ln,m.clearTileCache=function(a){if(!su())return;const o=Je.caches.delete(ic);a&&o.catch(a).then(()=>a())},m.clipLine=zT,m.clone=function(a){var o=new Gi(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},m.clone$1=bo,m.collisionCircleLayout=Gv,m.config=En,m.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},m.create=function(){var a=new Gi(16);return Gi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},m.create$1=Nu,m.createExpression=Mu,m.createLayout=Te,m.createStyleLayer=function(a){return"custom"===a.type?new qT(a):new WT[a.type](a)},m.cross=_v,m.degToRad=Pn,m.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},m.div=function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a},m.dot=ya,m.earthRadius=Or,m.ease=Rs,m.easeCubicInOut=Kh,m.ecefToLatLng=function([a,o,l]){const d=Math.hypot(a,o,l),p=Math.atan2(a,l),y=.5*Math.PI-Math.acos(-o/d);return new bi(qr(p),qr(y))},m.emitValidationErrors=n_,m.endsWith=Mi,m.enforceCacheSizeLimit=function(a){rc(),hs&&hs.then(o=>{o.keys().then(l=>{for(let d=0;d<l.length-a;d++)o.delete(l[d])})})},m.evaluateSizeForFeature=Wv,m.evaluateSizeForZoom=Vf,m.evaluateVariableOffset=qw,m.evented=w,m.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},m.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},m.exported=da,m.exported$1=wn,m.extend=Tr,m.extend$1=Va,m.fillExtrusionHeightLift=Z_,m.filterObject=Un,m.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},m.fromQuat=function(a,o){var l=o[0],d=o[1],p=o[2],y=o[3],b=l+l,C=d+d,D=p+p,T=l*b,k=d*b,L=d*C,N=p*b,V=p*C,U=p*D,j=y*b,te=y*C,q=y*D;return a[0]=1-L-U,a[1]=k+q,a[2]=N-te,a[3]=0,a[4]=k-q,a[5]=1-T-U,a[6]=V+j,a[7]=0,a[8]=N+te,a[9]=V-j,a[10]=1-T-L,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},m.fromRotation=function(a,o){var l=Math.sin(o),d=Math.cos(o);return a[0]=d,a[1]=l,a[2]=0,a[3]=-l,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},m.fromScaling=Dc,m.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return xd[o]},m.getAABBPointSquareDist=function(a,o,l){let d=0;for(let p=0;p<2;++p){const y=l?l[p]:0;a[p]>y&&(d+=(a[p]-y)*(a[p]-y)),o[p]<y&&(d+=(y-o[p])*(y-o[p]))}return d},m.getAnchorAlignment=ib,m.getAnchorJustification=qf,m.getBounds=function(a){let o=1/0,l=1/0,d=-1/0,p=-1/0;for(const y of a)o=Math.min(o,y.x),l=Math.min(l,y.y),d=Math.max(d,y.x),p=Math.max(p,y.y);return{min:new Ct(o,l),max:new Ct(d,p)}},m.getColumn=hl,m.getDefaultExportFromCjs=Wo,m.getGridMatrix=function(a,o,l,d){const p=o.getNorth(),y=o.getSouth(),b=o.getWest(),C=o.getEast(),D=1<<a.z,T=C-b,k=p-y,L=T/64,N=-k/um[l],V=[0,L,0,N,0,0,p,b,0];if(a.z>0){const U=180/d;br(V,V,[U/T+1,0,0,0,U/k+1,0,-.5*U/L,.5*U/N,1])}return V[2]=D,V[5]=a.x,V[8]=a.y,V},m.getImage=de,m.getJSON=function(a,o){return fl(Tr(a,{type:"json"}),o)},m.getLatitudinalLod=function(a){const o=po-5;a=Ln(a,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(Pn(a))),3);return Math.round(l*(um.length-1))},m.getMapSessionAPI=Wr,m.getPerformanceMeasurement=or,m.getProjection=Kf,m.getRTLTextPluginStatus=E,m.getReferrer=oc,m.getTilePoint=function(a,{x:o,y:l},d=0){return new Ct(((o-d)*a.scale-a.x)*en,(l*a.scale-a.y)*en)},m.getTileVec3=function(a,o,l=0){return Kd(((o.x-l)*a.scale-a.x)*en,(o.y*a.scale-a.y)*en,cT(o.z,o.y))},m.getVideo=function(a,o){const l=Je.document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let d=0;d<a.length;d++){const p=Je.document.createElement("source");tf(a[d])||(l.crossOrigin="Anonymous"),p.src=a[d],l.appendChild(p)}return{cancel:()=>{}}},m.globeCenterToScreenPoint=function(a){const o=[0,0,0],l=qa(new Float64Array(16));return Zd(l,a.pixelMatrix,a.globeMatrix),Pr(o,o,l),new Ct(o[0],o[1])},m.globeDenormalizeECEF=W1,m.globeECEFOrigin=function(a,o){const l=[0,0,0];return Pr(l,l,w_(va(o.canonical))),Pr(l,l,a),l},m.globeMetersToEcef=x_,m.globeNormalizeECEF=w_,m.globePixelsToTileUnits=function(a,o){return en/(512*Math.pow(2,a))*Ev(va(o))},m.globePoleMatrixForTile=function(a,o,l){const d=qa(new Float64Array(16)),p=(o/(1<<a)-.5)*Math.PI*2;return Xd(d,l.globeMatrix,p),Float32Array.from(d)},m.globeTileBounds=va,m.globeTiltAtLngLat=sT,m.globeToMercatorTransition=fm,m.globeUseCustomAntiAliasing=function(a,o,l){const d=fm(l.zoom),p=a.style.map._antialias,y=!!o.extStandardDerivatives,b=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===d&&!p&&!b&&y},m.identity=qa,m.identity$1=vv,m.invert=mv,m.isFullscreen=function(){return!!Je.document.fullscreenElement||!!Je.document.webkitFullscreenElement},m.isLngLatBehindGlobe=Z1,m.isMapAuthenticated=function(a){return ao.has(a)},m.isMapboxURL=Me,m.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!Ed(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},m.latFromMercatorY=fo,m.latLngToECEF=Uu,m.len=am,m.length=Yd,m.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},m.lngFromMercatorX=Mo,m.loadVectorTile=wy,m.makeRequest=fl,m.mapValue=function(a,o,l,d,p){return Ln((a-o)/(l-o)*(p-d)+d,d,p)},m.mercatorScale=uT,m.mercatorXfromLng=ns,m.mercatorYfromLat=Za,m.mercatorZfromAltitude=ws,m.mul=p_,m.mul$1=nT,m.multiply=Zd,m.multiply$1=br,m.multiply$2=Qd,m.nextPowerOfTwo=Sr,m.normalize=es,m.normalize$1=iT,m.normalize$2=lm,m.number=Nn,m.ortho=function(a,o,l,d,p,y,b){var C=1/(o-l),D=1/(d-p),T=1/(y-b);return a[0]=-2*C,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*T,a[11]=0,a[12]=(o+l)*C,a[13]=(p+d)*D,a[14]=(b+y)*T,a[15]=1,a},m.pbf=Yv,m.perspective=function(a,o,l,d,p){var y,b=1/Math.tan(o/2);return a[0]=b/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=p&&p!==1/0?(a[10]=(p+d)*(y=1/(d-p)),a[14]=2*p*d*y):(a[10]=-1,a[14]=-2*d),a},m.pick=function(a,o){const l={};for(let d=0;d<o.length;d++){const p=o[d];p in a&&(l[p]=a[p])}return l},m.plugin=O,m.pointGeometry=La,m.polesInViewport=function(a){const o=qa(new Float64Array(16));Zd(o,a.pixelMatrix,a.globeMatrix);const l=[0,Ws,0],d=[0,Zs,0];return Pr(l,l,o),Pr(d,d,o),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!Z1(a,new bi(a.center.lat,90)),d[0]>0&&d[0]<=a.width&&d[1]>0&&d[1]<=a.height&&!Z1(a,new bi(a.center.lat,-90))]},m.polygonContainsPoint=sh,m.polygonIntersectsBox=nw,m.polygonIntersectsPolygon=J1,m.polygonizeBounds=function(a,o,l=0,d=!0){const p=new Ct(l,l),y=a.sub(p),b=o.add(p),C=[y,new Ct(b.x,y.y),b,new Ct(y.x,b.y)];return d&&C.push(y.clone()),C},m.posAttributes=Bu,m.postMapLoadEvent=Xn,m.postPerformanceEvent=Fr,m.postTurnstileEvent=Fn,m.potpack=Rw,m.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},m.radToDeg=qr,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.registerForPluginStateChange=function(a){return a({pluginStatus:g,pluginURL:c}),w.on("pluginStateChange",a),a},m.removeAuthState=function(a){ao.delete(a)},m.renderColorRamp=_m,m.resample=rh,m.rotateX=f_,m.rotateX$1=G1,m.rotateY=Xd,m.rotateY$1=Wa,m.rotateZ=function(a,o,l){var d=Math.sin(l),p=Math.cos(l),y=o[0],b=o[1],C=o[2],D=o[3],T=o[4],k=o[5],L=o[6],N=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=y*p+T*d,a[1]=b*p+k*d,a[2]=C*p+L*d,a[3]=D*p+N*d,a[4]=T*p-y*d,a[5]=k*p-b*d,a[6]=L*p-C*d,a[7]=N*p-D*d,a},m.rotateZ$1=function(a,o,l){l*=.5;var d=o[0],p=o[1],y=o[2],b=o[3],C=Math.sin(l),D=Math.cos(l);return a[0]=d*D+p*C,a[1]=p*D-d*C,a[2]=y*D+b*C,a[3]=b*D-y*C,a},m.scale=zu,m.scale$1=m_,m.scale$2=_a,m.scaleAndAdd=Jd,m.set=function(a,o,l,d){return a[0]=o,a[1]=l,a[2]=d,a},m.setCacheLimits=function(a,o){ef=a,ou=o},m.setColumn=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},m.setRTLTextPlugin=function(a,o,l=!1){if(g===c_||g===Gd||g===xf)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=da.resolveURL(a),g=c_,Pu=o,v(),l||I()},m.smoothstep=nc,m.spec=He,m.squaredLength=function(a){var o=a[0],l=a[1],d=a[2];return o*o+l*l+d*d},m.storeAuthState=function(a,o){o?ao.add(a):ao.delete(a)},m.sub=ts,m.subtract=gv,m.symbolSize=Zv,m.tileAABB=function(a,o,l,d,p,y,b,C,D){if("globe"===D.name)return function Sf(a,o,l){const d=o/a.worldSize,p=a.globeMatrix;if(l.z<=1){const ke=va(l).getCorners();return hm(ke,p,d),Eo.fromPoints(ke)}const y=Sc(l),b=Vu(y);hm(b,p,d);const C=Number.MAX_VALUE,D=[-C,-C,-C],T=[C,C,C];if(y.contains(a.center)){for(const ct of b)Tc(T,T,ct),sm(D,D,ct);D[2]=0;const ke=a.point,Ge=[ke.x*d,ke.y*d,0];return Tc(T,T,Ge),sm(D,D,Ge),new Eo(T,D)}const k=[p[12]*d,p[13]*d,p[14]*d],L=y.getCenter(),N=Ln(a.center.lat,-po,po),V=Ln(L.lat,-po,po),U=ns(a.center.lng),j=Za(N);let te=U-ns(L.lng);const q=j-Za(V);te>.5?te-=1:te<-.5&&(te+=1);let pe=0;Math.abs(te)>Math.abs(q)?pe=te>=0?1:3:(pe=q>=0?0:2,Jd(k,k,[p[4]*d,p[5]*d,p[6]*d],-Math.sin(Pn(q>=0?y.getSouth():y.getNorth()))*Tl));const ae=b[pe],fe=b[(pe+1)%4],ge=new rT(ae,fe,k),_e=[no(ge,0)||ae[0],no(ge,1)||ae[1],no(ge,2)||ae[2]],Fe=fm(a.zoom);if(Fe>0){const ke=function({x:ct,y:ze,z:Qe},Ye,at,pt,$e){const Mt=1/(1<<Qe);let Ht=ct*Mt,Rt=Ht+Mt,gn=ze*Mt,_t=gn+Mt,Jt=0;const un=(Ht+Rt)/2-pt;return un>.5?Jt=-1:un<-.5&&(Jt=1),Ht=((Ht+Jt)*Ye-(pt*=Ye))*at+pt,Rt=((Rt+Jt)*Ye-pt)*at+pt,gn=(gn*Ye-($e*=Ye))*at+$e,_t=(_t*Ye-$e)*at+$e,[[Ht,_t,0],[Rt,_t,0],[Rt,gn,0],[Ht,gn,0]]}(l,o,a._pixelsPerMercatorPixel,U,j);for(let ct=0;ct<b.length;ct++)th(b[ct],ke[ct],Fe);const Ge=Dl([],ke[pe],ke[(pe+1)%4]);_a(Ge,Ge,.5),th(_e,Ge,Fe)}for(const ke of b)Tc(T,T,ke),sm(D,D,ke);return T[2]=Math.min(ae[2],fe[2]),Tc(T,T,_e),sm(D,D,_e),new Eo(T,D)}(a,o,new X_(l,d,p));const T=ph({z:l,x:d,y:p},D);return new Eo([(y+T.x/T.scale)*o,o*(T.y/T.scale),b],[(y+T.x2/T.scale)*o,o*(T.y2/T.scale),C])},m.tileCornersToBounds=Sc,m.tileTransform=ph,m.transformMat3=function(a,o,l){var d=o[0],p=o[1],y=o[2];return a[0]=d*l[0]+p*l[3]+y*l[6],a[1]=d*l[1]+p*l[4]+y*l[7],a[2]=d*l[2]+p*l[5]+y*l[8],a},m.transformMat4=Pr,m.transformMat4$1=Tf,m.transformQuat=tT,m.transitionTileAABBinECEF=Cv,m.translate=rm,m.transpose=function(a,o){if(a===o){var l=o[1],d=o[2],p=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=d,a[7]=p}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},m.triggerPluginCompletionEvent=f,m.uniqueId=hi,m.updateGlobeVertexNormal=function(a,o,l,d,p){const y=5*o+2;a.float32[y+0]=l,a.float32[y+1]=d,a.float32[y+2]=p},m.validateCustomStyleLayer=function(a){const o=[],l=a.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},m.validateFilter=a=>ys(vf(a)),m.validateFog=a=>ys(Cl(a)),m.validateLayer=a=>ys(vc(a)),m.validateLight=a=>ys(Co(a)),m.validateSource=a=>ys(av(a)),m.validateStyle=t_,m.validateTerrain=a=>ys(jd(a)),m.values=cl,m.vectorTile=U_,m.version=oa,m.warnOnce=Fi,m.window=Je,m.wrap=On}),Rp(0,function(m){function Je(me){if("number"==typeof me||"boolean"==typeof me||"string"==typeof me||null==me)return JSON.stringify(me);if(Array.isArray(me)){let J="[";for(const de of me)J+=`${Je(de)},`;return`${J}]`}let Y="{";for(const J of Object.keys(me).sort())Y+=`${J}:${Je(me[J])},`;return`${Y}}`}function oa(me){let Y="";for(const J of m.refProperties)Y+=`/${Je(me[J])}`;return Y}class as{constructor(Y){this.keyCache={},Y&&this.replace(Y)}replace(Y){this._layerConfigs={},this._layers={},this.update(Y,[])}update(Y,J){for(const ve of Y)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=m.createStyleLayer(ve)).compileFilter(),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of J)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const de=function(ve,Me){const Oe={};for(let De=0;De<ve.length;De++){const Be=Me&&Me[ve[De].id]||oa(ve[De]);Me&&(Me[ve[De].id]=Be);let yt=Oe[Be];yt||(yt=Oe[Be]=[]),yt.push(ve[De])}const Pe=[];for(const De in Oe)Pe.push(Oe[De]);return Pe}(m.values(this._layerConfigs),this.keyCache);for(const ve of de){const Me=ve.map(xt=>this._layers[xt.id]),Oe=Me[0];if("none"===Oe.visibility)continue;const Pe=Oe.source||"";let De=this.familiesBySource[Pe];De||(De=this.familiesBySource[Pe]={});const Be=Oe.sourceLayer||"_geojsonTileLayer";let yt=De[Be];yt||(yt=De[Be]=[]),yt.push(Me)}}}class En{loadTile(Y,J){const{uid:de,encoding:ve,rawImageData:Me,padding:Oe,buildQuadTree:Pe}=Y,De=m.window.ImageBitmap&&Me instanceof m.window.ImageBitmap?this.getImageData(Me,Oe):Me;J(null,new m.DEMData(de,De,ve,Oe<1,Pe))}getImageData(Y,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const de=this.offscreenCanvasContext.getImageData(-J,-J,Y.width+2*J,Y.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}function wn(me,Y){if(0!==me.length){Ur(me[0],Y);for(var J=1;J<me.length;J++)Ur(me[J],!Y)}}function Ur(me,Y){for(var J=0,de=0,ve=0,Me=me.length,Oe=Me-1;ve<Me;Oe=ve++){var Pe=(me[ve][0]-me[Oe][0])*(me[Oe][1]+me[ve][1]),De=J+Pe;de+=Math.abs(J)>=Math.abs(Pe)?J-De+Pe:Pe-De+J,J=De}J+de>=0!=!!Y&&me.reverse()}var vo=m.getDefaultExportFromCjs(function me(Y,J){var de,ve=Y&&Y.type;if("FeatureCollection"===ve)for(de=0;de<Y.features.length;de++)me(Y.features[de],J);else if("GeometryCollection"===ve)for(de=0;de<Y.geometries.length;de++)me(Y.geometries[de],J);else if("Feature"===ve)me(Y.geometry,J);else if("Polygon"===ve)wn(Y.coordinates,J);else if("MultiPolygon"===ve)for(de=0;de<Y.coordinates.length;de++)wn(Y.coordinates[de],J);return Y});const ls=m.VectorTileFeature.prototype.toGeoJSON;var Ra={exports:{}},bd=m.pointGeometry,ru=m.vectorTile.VectorTileFeature,Wo=cs;function cs(me,Y){this.options=Y||{},this.features=me,this.length=me.length}function Ro(me,Y){this.id="number"==typeof me.id?me.id:void 0,this.type=me.type,this.rawGeometry=1===me.type?[me.geometry]:me.geometry,this.properties=me.tags,this.extent=Y||4096}cs.prototype.feature=function(me){return new Ro(this.features[me],this.options.extent)},Ro.prototype.loadGeometry=function(){var me=this.rawGeometry;this.geometry=[];for(var Y=0;Y<me.length;Y++){for(var J=me[Y],de=[],ve=0;ve<J.length;ve++)de.push(new bd(J[ve][0],J[ve][1]));this.geometry.push(de)}return this.geometry},Ro.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var me=this.geometry,Y=1/0,J=-1/0,de=1/0,ve=-1/0,Me=0;Me<me.length;Me++)for(var Oe=me[Me],Pe=0;Pe<Oe.length;Pe++){var De=Oe[Pe];Y=Math.min(Y,De.x),J=Math.max(J,De.x),de=Math.min(de,De.y),ve=Math.max(ve,De.y)}return[Y,de,J,ve]},Ro.prototype.toGeoJSON=ru.prototype.toGeoJSON;var Jl=m.pbf,La=Wo;function ks(me){var Y=new Jl;return function(J,de){for(var ve in J.layers)de.writeMessage(3,Ct,J.layers[ve])}(me,Y),Y.finish()}function Ct(me,Y){var J;Y.writeVarintField(15,me.version||1),Y.writeStringField(1,me.name||""),Y.writeVarintField(5,me.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(J=0;J<me.length;J++)de.feature=me.feature(J),Y.writeMessage(2,Lp,de);var ve=de.keys;for(J=0;J<ve.length;J++)Y.writeStringField(3,ve[J]);var Me=de.values;for(J=0;J<Me.length;J++)Y.writeMessage(4,Kh,Me[J])}function Lp(me,Y){var J=me.feature;void 0!==J.id&&Y.writeVarintField(1,J.id),Y.writeMessage(2,ec,me),Y.writeVarintField(3,J.type),Y.writeMessage(4,xd,J)}function ec(me,Y){var J=me.feature,de=me.keys,ve=me.values,Me=me.keycache,Oe=me.valuecache;for(var Pe in J.properties){var De=J.properties[Pe],Be=Me[Pe];if(null!==De){void 0===Be&&(de.push(Pe),Me[Pe]=Be=de.length-1),Y.writeVarint(Be);var yt=typeof De;"string"!==yt&&"boolean"!==yt&&"number"!==yt&&(De=JSON.stringify(De));var xt=yt+":"+De,ht=Oe[xt];void 0===ht&&(ve.push(De),Oe[xt]=ht=ve.length-1),Y.writeVarint(ht)}}}function Pn(me,Y){return(Y<<3)+(7&me)}function qr(me){return me<<1^me>>31}function xd(me,Y){for(var J=me.loadGeometry(),de=me.type,ve=0,Me=0,Oe=J.length,Pe=0;Pe<Oe;Pe++){var De=J[Pe],Be=1;1===de&&(Be=De.length),Y.writeVarint(Pn(1,Be));for(var yt=3===de?De.length-1:De.length,xt=0;xt<yt;xt++){1===xt&&1!==de&&Y.writeVarint(Pn(2,yt-1));var ht=De[xt].x-ve,fn=De[xt].y-Me;Y.writeVarint(qr(ht)),Y.writeVarint(qr(fn)),ve+=ht,Me+=fn}3===de&&Y.writeVarint(Pn(7,1))}}function Kh(me,Y){var J=typeof me;"string"===J?Y.writeStringField(1,me):"boolean"===J?Y.writeBooleanField(7,me):"number"===J&&(me%1!=0?Y.writeDoubleField(3,me):me<0?Y.writeSVarintField(6,me):Y.writeVarintField(5,me))}Ra.exports=ks,Ra.exports.fromVectorTileJs=ks,Ra.exports.fromGeojsonVt=function(me,Y){Y=Y||{};var J={};for(var de in me)J[de]=new La(me[de].features,Y),J[de].name=de,J[de].version=Y.version,J[de].extent=Y.extent;return ks({layers:J})},Ra.exports.GeoJSONWrapper=La;var tc=m.getDefaultExportFromCjs(Ra.exports);const Rs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},Ln=Math.fround||(nc=new Float32Array(1),me=>(nc[0]=+me,nc[0]));var nc;const On=3,jr=5,cl=6;class Tr{constructor(Y){this.options=Object.assign(Object.create(Rs),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:J,minZoom:de,maxZoom:ve}=this.options;J&&console.time("total time");const Me=`prepare ${Y.length} points`;J&&console.time(Me),this.points=Y;const Oe=[];for(let De=0;De<Y.length;De++){const Be=Y[De];if(!Be.geometry)continue;const[yt,xt]=Be.geometry.coordinates,ht=Ln(Fa(yt)),fn=Ln(Sr(xt));Oe.push(ht,fn,1/0,De,-1,1),this.options.reduce&&Oe.push(0)}let Pe=this.trees[ve+1]=this._createTree(Oe);J&&console.timeEnd(Me);for(let De=ve;De>=de;De--){const Be=+Date.now();Pe=this.trees[De]=this._createTree(this._cluster(Pe,De)),J&&console.log("z%d: %d clusters in %dms",De,Pe.numItems,+Date.now()-Be)}return J&&console.timeEnd("total time"),this}getClusters(Y,J){let de=((Y[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,Y[1]));let Me=180===Y[2]?180:((Y[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)de=-180,Me=180;else if(de>Me){const xt=this.getClusters([de,ve,180,Oe],J),ht=this.getClusters([-180,ve,Me,Oe],J);return xt.concat(ht)}const Pe=this.trees[this._limitZoom(J)],De=Pe.range(Fa(de),Sr(Oe),Fa(Me),Sr(ve)),Be=Pe.data,yt=[];for(const xt of De){const ht=this.stride*xt;yt.push(Be[ht+jr]>1?ul(Be,ht,this.clusterProps):this.points[Be[ht+On]])}return yt}getChildren(Y){const J=this._getOriginId(Y),de=this._getOriginZoom(Y),ve="No cluster with the specified id.",Me=this.trees[de];if(!Me)throw new Error(ve);const Oe=Me.data;if(J*this.stride>=Oe.length)throw new Error(ve);const Pe=this.options.radius/(this.options.extent*Math.pow(2,de-1)),De=Me.within(Oe[J*this.stride],Oe[J*this.stride+1],Pe),Be=[];for(const yt of De){const xt=yt*this.stride;Oe[xt+4]===Y&&Be.push(Oe[xt+jr]>1?ul(Oe,xt,this.clusterProps):this.points[Oe[xt+On]])}if(0===Be.length)throw new Error(ve);return Be}getLeaves(Y,J,de){const ve=[];return this._appendLeaves(ve,Y,J=J||10,de=de||0,0),ve}getTile(Y,J,de){const ve=this.trees[this._limitZoom(Y)],Me=Math.pow(2,Y),{extent:Oe,radius:Pe}=this.options,De=Pe/Oe,Be=(de-De)/Me,yt=(de+1+De)/Me,xt={features:[]};return this._addTileFeatures(ve.range((J-De)/Me,Be,(J+1+De)/Me,yt),ve.data,J,de,Me,xt),0===J&&this._addTileFeatures(ve.range(1-De/Me,Be,1,yt),ve.data,Me,de,Me,xt),J===Me-1&&this._addTileFeatures(ve.range(0,Be,De/Me,yt),ve.data,-1,de,Me,xt),xt.features.length?xt:null}getClusterExpansionZoom(Y){let J=this._getOriginZoom(Y)-1;for(;J<=this.options.maxZoom;){const de=this.getChildren(Y);if(J++,1!==de.length)break;Y=de[0].properties.cluster_id}return J}_appendLeaves(Y,J,de,ve,Me){const Oe=this.getChildren(J);for(const Pe of Oe){const De=Pe.properties;if(De&&De.cluster?Me+De.point_count<=ve?Me+=De.point_count:Me=this._appendLeaves(Y,De.cluster_id,de,ve,Me):Me<ve?Me++:Y.push(Pe),Y.length===de)break}return Me}_createTree(Y){const J=new m.KDBush(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<Y.length;de+=this.stride)J.add(Y[de],Y[de+1]);return J.finish(),J.data=Y,J}_addTileFeatures(Y,J,de,ve,Me,Oe){for(const Pe of Y){const De=Pe*this.stride,Be=J[De+jr]>1;let yt,xt,ht;if(Be)yt=hi(J,De,this.clusterProps),xt=J[De],ht=J[De+1];else{const pn=this.points[J[De+On]];yt=pn.properties;const[Mn,Fn]=pn.geometry.coordinates;xt=Fa(Mn),ht=Sr(Fn)}const fn={type:1,geometry:[[Math.round(this.options.extent*(xt*Me-de)),Math.round(this.options.extent*(ht*Me-ve))]],tags:yt};let Sn;Sn=Be||this.options.generateId?J[De+On]:this.points[J[De+On]].id,void 0!==Sn&&(fn.id=Sn),Oe.features.push(fn)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,J){const{radius:de,extent:ve,reduce:Me,minPoints:Oe}=this.options,Pe=de/(ve*Math.pow(2,J)),De=Y.data,Be=[],yt=this.stride;for(let xt=0;xt<De.length;xt+=yt){if(De[xt+2]<=J)continue;De[xt+2]=J;const ht=De[xt],fn=De[xt+1],Sn=Y.within(De[xt],De[xt+1],Pe),pn=De[xt+jr];let Mn=pn;for(const Fn of Sn){const Ui=Fn*yt;De[Ui+2]>J&&(Mn+=De[Ui+jr])}if(Mn>pn&&Mn>=Oe){let Fn,Ui=ht*pn,Xn=fn*pn,so=-1;const Fr=((xt/yt|0)<<5)+(J+1)+this.points.length;for(const aa of Sn){const Wr=aa*yt;if(De[Wr+2]<=J)continue;De[Wr+2]=J;const ao=De[Wr+jr];Ui+=De[Wr]*ao,Xn+=De[Wr+1]*ao,De[Wr+4]=Fr,Me&&(Fn||(Fn=this._map(De,xt,!0),so=this.clusterProps.length,this.clusterProps.push(Fn)),Me(Fn,this._map(De,Wr)))}De[xt+4]=Fr,Be.push(Ui/Mn,Xn/Mn,1/0,Fr,-1,Mn),Me&&Be.push(so)}else{for(let Fn=0;Fn<yt;Fn++)Be.push(De[xt+Fn]);if(Mn>1)for(const Fn of Sn){const Ui=Fn*yt;if(!(De[Ui+2]<=J)){De[Ui+2]=J;for(let Xn=0;Xn<yt;Xn++)Be.push(De[Ui+Xn])}}}}return Be}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,J,de){if(Y[J+jr]>1){const Oe=this.clusterProps[Y[J+cl]];return de?Object.assign({},Oe):Oe}const ve=this.points[Y[J+On]].properties,Me=this.options.map(ve);return de&&Me===ve?Object.assign({},Me):Me}}function ul(me,Y,J){return{type:"Feature",id:me[Y+On],properties:hi(me,Y,J),geometry:{type:"Point",coordinates:[(de=me[Y],360*(de-.5)),wd(me[Y+1])]}};var de}function hi(me,Y,J){const de=me[Y+jr],ve=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,Me=me[Y+cl],Oe=-1===Me?{}:Object.assign({},J[Me]);return Object.assign(Oe,{cluster:!0,cluster_id:me[Y+On],point_count:de,point_count_abbreviated:ve})}function Fa(me){return me/360+.5}function Sr(me){const Y=Math.sin(me*Math.PI/180),J=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return J<0?0:J>1?1:J}function wd(me){const Y=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function Ai(me,Y,J,de){for(var ve,Me=de,Oe=J-Y>>1,Pe=J-Y,De=me[Y],Be=me[Y+1],yt=me[J],xt=me[J+1],ht=Y+3;ht<J;ht+=3){var fn=Mi(me[ht],me[ht+1],De,Be,yt,xt);if(fn>Me)ve=ht,Me=fn;else if(fn===Me){var Sn=Math.abs(ht-Oe);Sn<Pe&&(ve=ht,Pe=Sn)}}Me>de&&(ve-Y>3&&Ai(me,Y,ve,de),me[ve+2]=Me,J-ve>3&&Ai(me,ve,J,de))}function Mi(me,Y,J,de,ve,Me){var Oe=ve-J,Pe=Me-de;if(0!==Oe||0!==Pe){var De=((me-J)*Oe+(Y-de)*Pe)/(Oe*Oe+Pe*Pe);De>1?(J=ve,de=Me):De>0&&(J+=Oe*De,de+=Pe*De)}return(Oe=me-J)*Oe+(Pe=Y-de)*Pe}function Vn(me,Y,J,de){var ve={id:void 0===me?null:me,type:Y,geometry:J,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Me){var Oe=Me.geometry,Pe=Me.type;if("Point"===Pe||"MultiPoint"===Pe||"LineString"===Pe)Un(Me,Oe);else if("Polygon"===Pe||"MultiLineString"===Pe)for(var De=0;De<Oe.length;De++)Un(Me,Oe[De]);else if("MultiPolygon"===Pe)for(De=0;De<Oe.length;De++)for(var Be=0;Be<Oe[De].length;Be++)Un(Me,Oe[De][Be])}(ve),ve}function Un(me,Y){for(var J=0;J<Y.length;J+=3)me.minX=Math.min(me.minX,Y[J]),me.minY=Math.min(me.minY,Y[J+1]),me.maxX=Math.max(me.maxX,Y[J]),me.maxY=Math.max(me.maxY,Y[J+1])}function bo(me,Y,J,de){if(Y.geometry){var ve=Y.geometry.coordinates,Me=Y.geometry.type,Oe=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2),Pe=[],De=Y.id;if(J.promoteId?De=Y.properties[J.promoteId]:J.generateId&&(De=de||0),"Point"===Me)Cd(ve,Pe);else if("MultiPoint"===Me)for(var Be=0;Be<ve.length;Be++)Cd(ve[Be],Pe);else if("LineString"===Me)Fi(ve,Pe,Oe,!1);else if("MultiLineString"===Me){if(J.lineMetrics){for(Be=0;Be<ve.length;Be++)Fi(ve[Be],Pe=[],Oe,!1),me.push(Vn(De,"LineString",Pe,Y.properties));return}us(ve,Pe,Oe,!1)}else if("Polygon"===Me)us(ve,Pe,Oe,!0);else{if("MultiPolygon"!==Me){if("GeometryCollection"===Me){for(Be=0;Be<Y.geometry.geometries.length;Be++)bo(me,{id:De,geometry:Y.geometry.geometries[Be],properties:Y.properties},J,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Be=0;Be<ve.length;Be++){var yt=[];us(ve[Be],yt,Oe,!0),Pe.push(yt)}}me.push(Vn(De,Me,Pe,Y.properties))}}function Cd(me,Y){Y.push(dl(me[0])),Y.push(Na(me[1])),Y.push(0)}function Fi(me,Y,J,de){for(var ve,Me,Oe=0,Pe=0;Pe<me.length;Pe++){var De=dl(me[Pe][0]),Be=Na(me[Pe][1]);Y.push(De),Y.push(Be),Y.push(0),Pe>0&&(Oe+=de?(ve*Be-De*Me)/2:Math.sqrt(Math.pow(De-ve,2)+Math.pow(Be-Me,2))),ve=De,Me=Be}var yt=Y.length-3;Y[2]=1,Ai(Y,0,yt,J),Y[yt+2]=1,Y.size=Math.abs(Oe),Y.start=0,Y.end=Y.size}function us(me,Y,J,de){for(var ve=0;ve<me.length;ve++){var Me=[];Fi(me[ve],Me,J,de),Y.push(Me)}}function dl(me){return me/360+.5}function Na(me){var Y=Math.sin(me*Math.PI/180),J=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return J<0?0:J>1?1:J}function ds(me,Y,J,de,ve,Me,Oe,Pe){if(de/=Y,Me>=(J/=Y)&&Oe<de)return me;if(Oe<J||Me>=de)return null;for(var De=[],Be=0;Be<me.length;Be++){var yt=me[Be],xt=yt.geometry,ht=yt.type,fn=0===ve?yt.minX:yt.minY,Sn=0===ve?yt.maxX:yt.maxY;if(fn>=J&&Sn<de)De.push(yt);else if(!(Sn<J||fn>=de)){var pn=[];if("Point"===ht||"MultiPoint"===ht)Qh(xt,pn,J,de,ve);else if("LineString"===ht)Ed(xt,pn,J,de,ve,!1,Pe.lineMetrics);else if("MultiLineString"===ht)hl(xt,pn,J,de,ve,!1);else if("Polygon"===ht)hl(xt,pn,J,de,ve,!0);else if("MultiPolygon"===ht)for(var Mn=0;Mn<xt.length;Mn++){var Fn=[];hl(xt[Mn],Fn,J,de,ve,!0),Fn.length&&pn.push(Fn)}if(pn.length){if(Pe.lineMetrics&&"LineString"===ht){for(Mn=0;Mn<pn.length;Mn++)De.push(Vn(yt.id,ht,pn[Mn],yt.tags));continue}"LineString"!==ht&&"MultiLineString"!==ht||(1===pn.length?(ht="LineString",pn=pn[0]):ht="MultiLineString"),"Point"!==ht&&"MultiPoint"!==ht||(ht=3===pn.length?"Point":"MultiPoint"),De.push(Vn(yt.id,ht,pn,yt.tags))}}}return De.length?De:null}function Qh(me,Y,J,de,ve){for(var Me=0;Me<me.length;Me+=3){var Oe=me[Me+ve];Oe>=J&&Oe<=de&&(Y.push(me[Me]),Y.push(me[Me+1]),Y.push(me[Me+2]))}}function Ed(me,Y,J,de,ve,Me,Oe){for(var Pe,De,Be=Jh(me),yt=0===ve?ef:ou,xt=me.start,ht=0;ht<me.length-3;ht+=3){var fn=me[ht],Sn=me[ht+1],pn=me[ht+2],Mn=me[ht+3],Fn=me[ht+4],Ui=0===ve?fn:Sn,Xn=0===ve?Mn:Fn,so=!1;Oe&&(Pe=Math.sqrt(Math.pow(fn-Mn,2)+Math.pow(Sn-Fn,2))),Ui<J?Xn>J&&(De=yt(Be,fn,Sn,Mn,Fn,J),Oe&&(Be.start=xt+Pe*De)):Ui>de?Xn<de&&(De=yt(Be,fn,Sn,Mn,Fn,de),Oe&&(Be.start=xt+Pe*De)):ic(Be,fn,Sn,pn),Xn<J&&Ui>=J&&(De=yt(Be,fn,Sn,Mn,Fn,J),so=!0),Xn>de&&Ui<=de&&(De=yt(Be,fn,Sn,Mn,Fn,de),so=!0),!Me&&so&&(Oe&&(Be.end=xt+Pe*De),Y.push(Be),Be=Jh(me)),Oe&&(xt+=Pe)}var Fr=me.length-3;fn=me[Fr],Sn=me[Fr+1],pn=me[Fr+2],(Ui=0===ve?fn:Sn)>=J&&Ui<=de&&ic(Be,fn,Sn,pn),Fr=Be.length-3,Me&&Fr>=3&&(Be[Fr]!==Be[0]||Be[Fr+1]!==Be[1])&&ic(Be,Be[0],Be[1],Be[2]),Be.length&&Y.push(Be)}function Jh(me){var Y=[];return Y.size=me.size,Y.start=me.start,Y.end=me.end,Y}function hl(me,Y,J,de,ve,Me){for(var Oe=0;Oe<me.length;Oe++)Ed(me[Oe],Y,J,de,ve,Me,!1)}function ic(me,Y,J,de){me.push(Y),me.push(J),me.push(de)}function ef(me,Y,J,de,ve,Me){var Oe=(Me-Y)/(de-Y);return me.push(Me),me.push(J+(ve-J)*Oe),me.push(1),Oe}function ou(me,Y,J,de,ve,Me){var Oe=(Me-J)/(ve-J);return me.push(Y+(de-Y)*Oe),me.push(Me),me.push(1),Oe}function hs(me,Y){for(var J=[],de=0;de<me.length;de++){var ve,Me=me[de],Oe=Me.type;if("Point"===Oe||"MultiPoint"===Oe||"LineString"===Oe)ve=sa(Me.geometry,Y);else if("MultiLineString"===Oe||"Polygon"===Oe){ve=[];for(var Pe=0;Pe<Me.geometry.length;Pe++)ve.push(sa(Me.geometry[Pe],Y))}else if("MultiPolygon"===Oe)for(ve=[],Pe=0;Pe<Me.geometry.length;Pe++){for(var De=[],Be=0;Be<Me.geometry[Pe].length;Be++)De.push(sa(Me.geometry[Pe][Be],Y));ve.push(De)}J.push(Vn(Me.id,Oe,ve,Me.tags))}return J}function sa(me,Y){var J=[];J.size=me.size,void 0!==me.start&&(J.start=me.start,J.end=me.end);for(var de=0;de<me.length;de+=3)J.push(me[de]+Y,me[de+1],me[de+2]);return J}function su(me,Y){if(me.transformed)return me;var J,de,ve,Me=1<<me.z,Oe=me.x,Pe=me.y;for(J=0;J<me.features.length;J++){var De=me.features[J],Be=De.geometry,yt=De.type;if(De.geometry=[],1===yt)for(de=0;de<Be.length;de+=2)De.geometry.push(rc(Be[de],Be[de+1],Y,Me,Oe,Pe));else for(de=0;de<Be.length;de++){var xt=[];for(ve=0;ve<Be[de].length;ve+=2)xt.push(rc(Be[de][ve],Be[de][ve+1],Y,Me,Oe,Pe));De.geometry.push(xt)}}return me.transformed=!0,me}function rc(me,Y,J,de,ve,Me){return[Math.round(J*(me*de-ve)),Math.round(J*(Y*de-Me))]}function au(me,Y,J,de,ve){for(var Me=Y===ve.maxZoom?0:ve.tolerance/((1<<Y)*ve.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:J,y:de,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Pe=0;Pe<me.length;Pe++){Oe.numFeatures++,Md(Oe,me[Pe],Me,ve);var De=me[Pe].minX,Be=me[Pe].minY,yt=me[Pe].maxX,xt=me[Pe].maxY;De<Oe.minX&&(Oe.minX=De),Be<Oe.minY&&(Oe.minY=Be),yt>Oe.maxX&&(Oe.maxX=yt),xt>Oe.maxY&&(Oe.maxY=xt)}return Oe}function Md(me,Y,J,de){var ve=Y.geometry,Me=Y.type,Oe=[];if("Point"===Me||"MultiPoint"===Me)for(var Pe=0;Pe<ve.length;Pe+=3)Oe.push(ve[Pe]),Oe.push(ve[Pe+1]),me.numPoints++,me.numSimplified++;else if("LineString"===Me)Lo(Oe,ve,me,J,!1,!1);else if("MultiLineString"===Me||"Polygon"===Me)for(Pe=0;Pe<ve.length;Pe++)Lo(Oe,ve[Pe],me,J,"Polygon"===Me,0===Pe);else if("MultiPolygon"===Me)for(var De=0;De<ve.length;De++){var Be=ve[De];for(Pe=0;Pe<Be.length;Pe++)Lo(Oe,Be[Pe],me,J,!0,0===Pe)}if(Oe.length){var yt=Y.tags||null;if("LineString"===Me&&de.lineMetrics){for(var xt in yt={},Y.tags)yt[xt]=Y.tags[xt];yt.mapbox_clip_start=ve.start/ve.size,yt.mapbox_clip_end=ve.end/ve.size}var ht={geometry:Oe,type:"Polygon"===Me||"MultiPolygon"===Me?3:"LineString"===Me||"MultiLineString"===Me?2:1,tags:yt};null!==Y.id&&(ht.id=Y.id),me.features.push(ht)}}function Lo(me,Y,J,de,ve,Me){var Oe=de*de;if(de>0&&Y.size<(ve?Oe:de))J.numPoints+=Y.length/3;else{for(var Pe=[],De=0;De<Y.length;De+=3)(0===de||Y[De+2]>Oe)&&(J.numSimplified++,Pe.push(Y[De]),Pe.push(Y[De+1])),J.numPoints++;ve&&function(Be,yt){for(var xt=0,ht=0,fn=Be.length,Sn=fn-2;ht<fn;Sn=ht,ht+=2)xt+=(Be[ht]-Be[Sn])*(Be[ht+1]+Be[Sn+1]);if(xt>0===yt)for(ht=0,fn=Be.length;ht<fn/2;ht+=2){var pn=Be[ht],Mn=Be[ht+1];Be[ht]=Be[fn-2-ht],Be[ht+1]=Be[fn-1-ht],Be[fn-2-ht]=pn,Be[fn-1-ht]=Mn}}(Pe,Me),me.push(Pe)}}function za(me,Y){var J=(Y=this.options=function(ve,Me){for(var Oe in Me)ve[Oe]=Me[Oe];return ve}(Object.create(this.options),Y)).debug;if(J&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");var ve,Me,Oe,Pe,De,Be,de=function(ve,Me){var Oe=[];if("FeatureCollection"===ve.type)for(var Pe=0;Pe<ve.features.length;Pe++)bo(Oe,ve.features[Pe],Me,Pe);else bo(Oe,"Feature"===ve.type?ve:{geometry:ve},Me);return Oe}(me,Y);this.tiles={},this.tileCoords=[],J&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pe=ve=de,De=ds(ve,1,-1-(Oe=(Me=Y).buffer/Me.extent),Oe,0,-1,2,Me),Be=ds(ve,1,1-Oe,2+Oe,0,-1,2,Me),(De||Be)&&(Pe=ds(ve,1,-Oe,1+Oe,0,-1,2,Me)||[],De&&(Pe=hs(De,1).concat(Pe)),Be&&(Pe=Pe.concat(hs(Be,-1)))),(de=Pe).length&&this.splitTile(de,0,0,0),J&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function oc(me,Y,J){return 32*((1<<me)*J+Y)+me}function fl(me,Y){const J=me.tileID.canonical;if(!this._geoJSONIndex)return Y(null,null);const de=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!de)return Y(null,null);const ve=new class{constructor(Oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=Oe.length,this._features=Oe}feature(Oe){return new class{constructor(Pe){this._feature=Pe,this.extent=m.EXTENT,this.type=Pe.type,this.properties=Pe.tags,"id"in Pe&&!isNaN(Pe.id)&&(this.id=parseInt(Pe.id,10))}loadGeometry(){if(1===this._feature.type){const Pe=[];for(const De of this._feature.geometry)Pe.push([new m.Point(De[0],De[1])]);return Pe}{const Pe=[];for(const De of this._feature.geometry){const Be=[];for(const yt of De)Be.push(new m.Point(yt[0],yt[1]));Pe.push(Be)}return Pe}}toGeoJSON(Pe,De,Be){return ls.call(this,Pe,De,Be)}}(this._features[Oe])}}(de.features);let Me=tc(ve);0===Me.byteOffset&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),Y(null,{vectorTile:ve,rawData:Me.buffer})}za.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},za.prototype.splitTile=function(me,Y,J,de,ve,Me,Oe){for(var Pe=[me,Y,J,de],De=this.options,Be=De.debug;Pe.length;){de=Pe.pop(),J=Pe.pop(),Y=Pe.pop(),me=Pe.pop();var yt=1<<Y,xt=oc(Y,J,de),ht=this.tiles[xt];if(!ht&&(Be>1&&console.time("creation"),ht=this.tiles[xt]=au(me,Y,J,de,De),this.tileCoords.push({z:Y,x:J,y:de}),Be)){Be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,J,de,ht.numFeatures,ht.numPoints,ht.numSimplified),console.timeEnd("creation"));var fn="z"+Y;this.stats[fn]=(this.stats[fn]||0)+1,this.total++}if(ht.source=me,ve){if(Y===De.maxZoom||Y===ve)continue;var Sn=1<<ve-Y;if(J!==Math.floor(Me/Sn)||de!==Math.floor(Oe/Sn))continue}else if(Y===De.indexMaxZoom||ht.numPoints<=De.indexMaxPoints)continue;if(ht.source=null,0!==me.length){Be>1&&console.time("clipping");var pn,Mn,Fn,Ui,Xn,so,Fr=.5*De.buffer/De.extent,aa=.5-Fr,Wr=.5+Fr,ao=1+Fr;pn=Mn=Fn=Ui=null,Xn=ds(me,yt,J-Fr,J+Wr,0,ht.minX,ht.maxX,De),so=ds(me,yt,J+aa,J+ao,0,ht.minX,ht.maxX,De),me=null,Xn&&(pn=ds(Xn,yt,de-Fr,de+Wr,1,ht.minY,ht.maxY,De),Mn=ds(Xn,yt,de+aa,de+ao,1,ht.minY,ht.maxY,De),Xn=null),so&&(Fn=ds(so,yt,de-Fr,de+Wr,1,ht.minY,ht.maxY,De),Ui=ds(so,yt,de+aa,de+ao,1,ht.minY,ht.maxY,De),so=null),Be>1&&console.timeEnd("clipping"),Pe.push(pn||[],Y+1,2*J,2*de),Pe.push(Mn||[],Y+1,2*J,2*de+1),Pe.push(Fn||[],Y+1,2*J+1,2*de),Pe.push(Ui||[],Y+1,2*J+1,2*de+1)}}},za.prototype.getTile=function(me,Y,J){var de=this.options,ve=de.extent,Me=de.debug;if(me<0||me>24)return null;var Oe=1<<me,Pe=oc(me,Y=(Y%Oe+Oe)%Oe,J);if(this.tiles[Pe])return su(this.tiles[Pe],ve);Me>1&&console.log("drilling down to z%d-%d-%d",me,Y,J);for(var De,Be=me,yt=Y,xt=J;!De&&Be>0;)Be--,yt=Math.floor(yt/2),xt=Math.floor(xt/2),De=this.tiles[oc(Be,yt,xt)];return De&&De.source?(Me>1&&console.log("found parent tile z%d-%d-%d",Be,yt,xt),Me>1&&console.time("drilling down"),this.splitTile(De.source,Be,yt,xt,me,Y,J),Me>1&&console.timeEnd("drilling down"),this.tiles[Pe]?su(this.tiles[Pe],ve):null):null};class lu extends m.VectorTileWorkerSource{constructor(Y,J,de,ve,Me){super(Y,J,de,ve,fl),Me&&(this.loadGeoJSON=Me)}loadData(Y,J){const de=Y&&Y.request,ve=de&&de.collectResourceTiming;this.loadGeoJSON(Y,(Me,Oe)=>{if(Me||!Oe)return J(Me);if("object"!=typeof Oe)return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{vo(Oe,!0);try{if(Y.filter){const De=m.createExpression(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===De.result)throw new Error(De.value.map(yt=>`${yt.key}: ${yt.message}`).join(", "));Oe={type:"FeatureCollection",features:Oe.features.filter(yt=>De.value.evaluate({zoom:0},yt))}}this._geoJSONIndex=Y.cluster?new Tr(function({superclusterOptions:De,clusterProperties:Be}){if(!Be||!De)return De;const yt={},xt={},ht={accumulated:null,zoom:0},fn={properties:null},Sn=Object.keys(Be);for(const pn of Sn){const[Mn,Fn]=Be[pn],Ui=m.createExpression(Fn),Xn=m.createExpression("string"==typeof Mn?[Mn,["accumulated"],["get",pn]]:Mn);yt[pn]=Ui.value,xt[pn]=Xn.value}return De.map=pn=>{fn.properties=pn;const Mn={};for(const Fn of Sn)Mn[Fn]=yt[Fn].evaluate(ht,fn);return Mn},De.reduce=(pn,Mn)=>{fn.properties=Mn;for(const Fn of Sn)ht.accumulated=pn[Fn],pn[Fn]=xt[Fn].evaluate(ht,fn)},De}(Y)).load(Oe.features):new za(De=Oe,Y.geojsonVtOptions)}catch(De){return J(De)}this.loaded={};const Pe={};if(ve){const De=m.getPerformanceMeasurement(de);De&&(Pe.resourceTiming={},Pe.resourceTiming[Y.source]=JSON.parse(JSON.stringify(De)))}J(null,Pe)}var De})}reloadTile(Y,J){const de=this.loaded;return de&&de[Y.uid]?super.reloadTile(Y,J):this.loadTile(Y,J)}loadGeoJSON(Y,J){if(Y.request)m.getJSON(Y.request,J);else{if("string"!=typeof Y.data)return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return J(null,JSON.parse(Y.data))}catch{return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(de){J(de)}}getClusterChildren(Y,J){try{J(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(de){J(de)}}getClusterLeaves(Y,J){try{J(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(de){J(de)}}}class tf{constructor(Y){this.self=Y,this.actor=new m.Actor(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=m.getProjection({name:"mercator"}),this.workerSourceTypes={vector:m.VectorTileWorkerSource,geojson:lu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(J,de)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=de},this.self.registerRTLTextPlugin=J=>{if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=J.applyArabicShaping,m.plugin.processBidirectionalText=J.processBidirectionalText,m.plugin.processStyledBidirectionalText=J.processStyledBidirectionalText}}clearCaches(Y,J,de){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],de()}checkIfReady(Y,J,de){de()}setReferrer(Y,J){this.referrer=J}spriteLoaded(Y,J){this.isSpriteLoaded[Y]=J;for(const de in this.workerSources[Y]){const ve=this.workerSources[Y][de];for(const Me in ve)ve[Me]instanceof m.VectorTileWorkerSource&&(ve[Me].isSpriteLoaded=J,ve[Me].fire(new m.Event("isSpriteLoaded")))}}setImages(Y,J,de){this.availableImages[Y]=J;for(const ve in this.workerSources[Y]){const Me=this.workerSources[Y][ve];for(const Oe in Me)Me[Oe].availableImages=J}de()}enableTerrain(Y,J,de){this.terrain=J,de()}setProjection(Y,J){this.projections[Y]=m.getProjection(J)}setLayers(Y,J,de){this.getLayerIndex(Y).replace(J),de()}updateLayers(Y,J,de){this.getLayerIndex(Y).update(J.layers,J.removedIds),de()}loadTile(Y,J,de){const ve=this.enableTerrain?m.extend({enableTerrain:this.terrain},J):J;ve.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,J.type,J.source).loadTile(ve,de)}loadDEMTile(Y,J,de){const ve=this.enableTerrain?m.extend({buildQuadTree:this.terrain},J):J;this.getDEMWorkerSource(Y,J.source).loadTile(ve,de)}reloadTile(Y,J,de){const ve=this.enableTerrain?m.extend({enableTerrain:this.terrain},J):J;ve.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,J.type,J.source).reloadTile(ve,de)}abortTile(Y,J,de){this.getWorkerSource(Y,J.type,J.source).abortTile(J,de)}removeTile(Y,J,de){this.getWorkerSource(Y,J.type,J.source).removeTile(J,de)}removeSource(Y,J,de){if(!this.workerSources[Y]||!this.workerSources[Y][J.type]||!this.workerSources[Y][J.type][J.source])return;const ve=this.workerSources[Y][J.type][J.source];delete this.workerSources[Y][J.type][J.source],void 0!==ve.removeSource?ve.removeSource(J,de):de()}loadWorkerSource(Y,J,de){try{this.self.importScripts(J.url),de()}catch(ve){de(ve.toString())}}syncRTLPluginState(Y,J,de){try{m.plugin.setState(J);const ve=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&null!=ve){this.self.importScripts(ve);const Me=m.plugin.isParsed();de(Me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ve}`),Me)}}catch(ve){de(ve.toString())}}getAvailableImages(Y){let J=this.availableImages[Y];return J||(J=[]),J}getLayerIndex(Y){let J=this.layerIndexes[Y];return J||(J=this.layerIndexes[Y]=new as),J}getWorkerSource(Y,J,de){return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][J]||(this.workerSources[Y][J]={}),this.workerSources[Y][J][de]||(this.workerSources[Y][J][de]=new this.workerSourceTypes[J]({send:(Me,Oe,Pe,De,Be,yt)=>{this.actor.send(Me,Oe,Pe,Y,Be,yt)},scheduler:this.actor.scheduler},this.getLayerIndex(Y),this.getAvailableImages(Y),this.isSpriteLoaded[Y])),this.workerSources[Y][J][de]}getDEMWorkerSource(Y,J){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][J]||(this.demWorkerSources[Y][J]=new En),this.demWorkerSources[Y][J]}enforceCacheSizeLimit(Y,J){m.enforceCacheSizeLimit(J)}getWorkerPerformanceMetrics(Y,J,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new tf(self)),tf}),Rp(0,function(m){function Je(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let f=0;f<g.length;f++)if(!Je(g[f],c[f]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==c){if("object"!=typeof c||Object.keys(g).length!==Object.keys(c).length)return!1;for(const f in g)if(!Je(g[f],c[f]))return!1;return!0}return g===c}var oa=as;function as(g){return c=g,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,E=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(E);try{w=new Worker(I),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(I),v}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var E=w.getImageData(0,0,1,1);return E&&E.width===v.width}()||(void 0===En[f=c&&c.failIfMajorPerformanceCaveat]&&(En[f]=function(v){var w,I,O,R,E=(I=v,O=document.createElement("canvas"),(R=Object.create(as.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,O.getContext("webgl",R)||O.getContext("experimental-webgl",R));if(!E)return!1;try{w=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!w||E.isContextLost())&&(E.shaderSource(w,"void main() {}"),E.compileShader(w),!0===E.getShaderParameter(w,E.COMPILE_STATUS))}(f)),!En[f]||document.documentMode));var c,f}var En={};function wn(g,c,f){const v=m.window.document.createElement(g);return void 0!==c&&(v.className=c),f&&f.appendChild(v),v}function Ur(g,c,f){const v=m.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const w of Object.keys(c))v.setAttributeNS(null,w,c[w]);return f&&f.appendChild(v),v}as.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const vo=m.window.document&&m.window.document.documentElement.style,ls=vo&&void 0!==vo.userSelect?"userSelect":"WebkitUserSelect";let Ra;function bd(){vo&&ls&&(Ra=vo[ls],vo[ls]="none")}function ru(){vo&&ls&&(vo[ls]=Ra)}function Wo(g){g.preventDefault(),g.stopPropagation(),m.window.removeEventListener("click",Wo,!0)}function cs(){m.window.addEventListener("click",Wo,!0),m.window.setTimeout(()=>{m.window.removeEventListener("click",Wo,!0)},0)}function Ro(g,c){const f=g.getBoundingClientRect();return ks(g,f,c)}function Jl(g,c){const f=g.getBoundingClientRect(),v=[];for(let w=0;w<c.length;w++)v.push(ks(g,f,c[w]));return v}function La(g){return void 0!==m.window.InstallTrigger&&2===g.button&&g.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function ks(g,c,f){const v=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new m.Point((f.clientX-c.left)*v,(f.clientY-c.top)*v)}function Ct(g,c){var f=c[0],v=c[1],w=c[2],E=c[3],I=f*E-w*v;return I?(g[0]=E*(I=1/I),g[1]=-v*I,g[2]=-w*I,g[3]=f*I,g):null}function Lp(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class ec extends m.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:f,callback:v}of this.requestors)this._notify(f,v);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,f){this._validate(c,f)&&(this.images[c]=f)}_validate(c,f){let v=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new m.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new m.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new m.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),v=!1),v}_validateStretch(c,f){if(!c)return!0;let v=0;for(const w of c){if(w[0]<v||w[1]<w[0]||f<w[1])return!1;v=w[1]}return!0}_validateContent(c,f){return!(c&&(4!==c.length||c[0]<0||f.data.width<c[0]||c[1]<0||f.data.height<c[1]||c[2]<0||f.data.width<c[2]||c[3]<0||f.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,f){f.version=this.images[c].version+1,this.images[c]=f,this.updatedImages[c]=!0}removeImage(c){const f=this.images[c];delete this.images[c],delete this.patterns[c],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,f){let v=!0;if(!this.isLoaded())for(const w of c)this.images[w]||(v=!1);this.isLoaded()||v?this._notify(c,f):this.requestors.push({ids:c,callback:f})}_notify(c,f){const v={};for(const w of c){this.images[w]||this.fire(new m.Event("styleimagemissing",{id:w}));const E=this.images[w];E?v[w]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!(!E.userImage||!E.userImage.render)}:m.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,v)}getPixelSize(){const{width:c,height:f}=this.atlasImage;return{width:c,height:f}}getPattern(c){const f=this.patterns[c],v=this.getImage(c);if(!v)return null;if(f&&f.position.version===v.version)return f.position;if(f)f.position.version=v.version;else{const w={w:v.data.width+2,h:v.data.height+2,x:0,y:0},E=new m.ImagePosition(w,v);this.patterns[c]={bin:w,position:E}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const f=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,f.RGBA),this.atlasTexture&&this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const E in this.patterns)c.push(this.patterns[E].bin);const{w:f,h:v}=m.potpack(c),w=this.atlasImage;w.resize({width:f||1,height:v||1});for(const E in this.patterns){const{bin:I}=this.patterns[E],O=I.x+1,R=I.y+1,B=this.images[E].data,z=B.width,H=B.height;m.RGBAImage.copy(B,w,{x:0,y:0},{x:O,y:R},{width:z,height:H}),m.RGBAImage.copy(B,w,{x:0,y:H-1},{x:O,y:R-1},{width:z,height:1}),m.RGBAImage.copy(B,w,{x:0,y:0},{x:O,y:R+H},{width:z,height:1}),m.RGBAImage.copy(B,w,{x:z-1,y:0},{x:O-1,y:R},{width:1,height:H}),m.RGBAImage.copy(B,w,{x:0,y:0},{x:O+z,y:R},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const f of c){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const v=this.images[f];Lp(v)&&this.updateImage(f,v)}}}const Pn=new m.Properties({anchor:new m.DataConstantProperty(m.spec.light.anchor),position:new class{constructor(){this.specification=m.spec.light.position}possiblyEvaluate(g,c){return function([f,v,w]){const E=m.degToRad(v+90),I=m.degToRad(w);return{x:f*Math.cos(E)*Math.sin(I),y:f*Math.sin(E)*Math.sin(I),z:f*Math.cos(I),azimuthal:v,polar:w}}(g.expression.evaluate(c))}interpolate(g,c,f){return{x:m.number(g.x,c.x,f),y:m.number(g.y,c.y,f),z:m.number(g.z,c.z,f),azimuthal:m.number(g.azimuthal,c.azimuthal,f),polar:m.number(g.polar,c.polar,f)}}},color:new m.DataConstantProperty(m.spec.light.color),intensity:new m.DataConstantProperty(m.spec.light.intensity)});class qr extends m.Evented{constructor(c){super(),this._transitionable=new m.Transitionable(Pn),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,f={}){if(!this._validate(m.validateLight,c,f))for(const v in c){const w=c[v];m.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),w):this._transitionable.setValue(v,w)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,f,v){return(!v||!1!==v.validate)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:m.spec})))}}const xd=new m.Properties({source:new m.DataConstantProperty(m.spec.terrain.source),exaggeration:new m.DataConstantProperty(m.spec.terrain.exaggeration)});let Kh=class extends m.Evented{constructor(g,c){super(),this._transitionable=new m.Transitionable(xd),this.set(g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(g){for(const c in g){const f=g[c];m.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),f):this._transitionable.setValue(c,f)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}};function tc(g,c,f,v){const w=m.smoothstep(45,65,f),[E,I]=Rs(g,v),O=m.length(c);let R=1-Math.min(1,Math.exp((O-E)/(I-E)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*w*g.alpha}function Rs(g,c){const f=.5/Math.tan(.5*c);return[g.range[0]+f,g.range[1]+f]}const Ln=new m.Properties({range:new m.DataConstantProperty(m.spec.fog.range),color:new m.DataConstantProperty(m.spec.fog.color),"high-color":new m.DataConstantProperty(m.spec.fog["high-color"]),"space-color":new m.DataConstantProperty(m.spec.fog["space-color"]),"horizon-blend":new m.DataConstantProperty(m.spec.fog["horizon-blend"]),"star-intensity":new m.DataConstantProperty(m.spec.fog["star-intensity"])});class nc extends m.Evented{constructor(c,f){super(),this._transitionable=new m.Transitionable(Ln),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const c=this._transform,f="globe"===c.projection.name,v=m.globeToMercatorTransition(c.zoom),w=this.properties.get("range"),E=[.5,3];return{range:f?[m.number(E[0],w[0],v),m.number(E[1],w[1],v)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,f={}){if(!this._validate(m.validateFog,c,f)){for(const v of Object.keys(m.spec.fog))c&&void 0===c[v]&&(c[v]=m.spec.fog[v].default);for(const v in c){const w=c[v];m.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),w):this._transitionable.setValue(v,w)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:m.smoothstep(45,65,c))*f.a}getOpacityAtLatLng(c,f){return this._transform.projection.supportsFog?function(v,w,E){const I=m.MercatorCoordinate.fromLngLat(w),O=E.elevation?E.elevation.getAtPointOrZero(I):0,R=[I.x,I.y,O];return m.transformMat4(R,R,E.mercatorFogMatrix),tc(v,R,E.pitch,E._fov)}(this.state,c,f):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Rs(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,f,v){return(!v||!1!==v.validate)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:m.spec})))}}class On{constructor(c,f){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=m.uniqueId();const v=this.workerPool.acquire(this.id);for(let w=0;w<v.length;w++){const E=new On.Actor(v[w],f,this.id);E.name=`Worker ${w}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,f,v){m.asyncAll(this.actors,(w,E)=>{w.send(c,f,E)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function jr(g,c,f){return c*(m.EXTENT/(g.tileSize*Math.pow(2,f-g.tileID.overscaledZ)))}On.Actor=m.Actor;class cl{constructor(c,f,v,w){this.screenBounds=c,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(c,f){let v,w;if(c instanceof m.Point||"number"==typeof c[0]){const E=m.Point.convert(c);v=[E],w=f.isPointAboveHorizon(E)}else{const E=m.Point.convert(c[0]),I=m.Point.convert(c[1]);v=[E,I],w=m.polygonizeBounds(E,I).every(O=>f.isPointAboveHorizon(O))}return new cl(v,f.getCameraPoint(),w,f)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return m.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const f=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new m.Point(1,1)):this.screenBounds[1],w=m.polygonizeBounds(f,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<v.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?w[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(w[3]=this.cameraPoint)),m.bufferConvexPolygon(w,c)}bufferedCameraGeometryGlobe(c){const f=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new m.Point(1,1)):this.screenBounds[1],w=m.polygonizeBounds(f,v,c),E=this.cameraPoint.clone();switch(3*((E.y>f.y)+(E.y>v.y))+((E.x>f.x)+(E.x>v.x))){case 0:w[0]=E,w[4]=E.clone();break;case 1:w.splice(1,0,E);break;case 2:w[1]=E;break;case 3:w.splice(4,0,E);break;case 5:w.splice(2,0,E);break;case 6:w[3]=E;break;case 7:w.splice(3,0,E);break;case 8:w[2]=E}return w}containsTile(c,f,v,w=0){const E=c.queryPadding/f._pixelsPerMercatorPixel+1,I=v?this._bufferedCameraMercator(E,f):this._bufferedScreenMercator(E,f);let O=c.tileID.wrap+(I.unwrapped?w:0);const R=I.polygon.map(se=>m.getTilePoint(c.tileTransform,se,O));if(!m.polygonIntersectsBox(R,0,0,m.EXTENT,m.EXTENT))return;O=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const B=this.screenGeometryMercator.polygon.map(se=>m.getTileVec3(c.tileTransform,se,O)),z=B.map(se=>new m.Point(se[0],se[1])),H=f.getFreeCameraOptions().position||new m.MercatorCoordinate(0,0,0),ee=m.getTileVec3(c.tileTransform,H,O),ie=B.map(se=>{const G=m.sub(se,se,ee);return m.normalize(G,G),new m.Ray(ee,G)}),oe=jr(c,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:ie,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(re=m.getBounds(R),re.min.x=m.clamp(re.min.x,0,m.EXTENT),re.min.y=m.clamp(re.min.y,0,m.EXTENT),re.max.x=m.clamp(re.max.x,0,m.EXTENT),re.max.y=m.clamp(re.max.y,0,m.EXTENT),re),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:oe};var re}_bufferedScreenMercator(c,f){const v=hi(c);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let w;return w="globe"===f.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),f):{polygon:this.bufferedScreenGeometry(c).map(E=>f.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[v]=w,w}}_bufferedCameraMercator(c,f){const v=hi(c);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let w;return w="globe"===f.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),f):{polygon:this.bufferedCameraGeometry(c).map(E=>f.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[v]=w,w}}_projectAndResample(c,f){const v=function(E,I){const O=m.multiply([],I.pixelMatrix,I.globeMatrix),R=[0,-m.GLOBE_RADIUS,0,1],B=[0,m.GLOBE_RADIUS,0,1],z=[0,0,0,1];m.transformMat4$1(R,R,O),m.transformMat4$1(B,B,O),m.transformMat4$1(z,z,O);const H=new m.Point(R[0]/R[3],R[1]/R[3]),ee=new m.Point(B[0]/B[3],B[1]/B[3]),ie=m.polygonContainsPoint(E,H)&&R[3]<z[3],oe=m.polygonContainsPoint(E,ee)&&B[3]<z[3];if(!ie&&!oe)return null;const re=function(xe,Ae,Te){for(let Ne=1;Ne<xe.length;Ne++){const ut=ul(Ae.pointCoordinate3D(xe[Ne-1]).x),Re=ul(Ae.pointCoordinate3D(xe[Ne]).x);if(Te<0){if(ut<Re)return{idx:Ne,t:-ut/(Re-1-ut)}}else if(Re<ut)return{idx:Ne,t:(1-ut)/(Re+1-ut)}}return null}(E,I,ie?-1:1);if(!re)return null;const{idx:se,t:G}=re;let ne=se>1?Tr(E.slice(0,se),I):[],ce=se<E.length?Tr(E.slice(se),I):[];ne=ne.map(xe=>new m.Point(ul(xe.x),xe.y)),ce=ce.map(xe=>new m.Point(ul(xe.x),xe.y));const ue=[...ne];0===ue.length&&ue.push(ce[ce.length-1]);const be=m.number(ue[ue.length-1].y,(0===ce.length?ne[0]:ce[0]).y,G);let we;return we=ie?[new m.Point(0,be),new m.Point(0,0),new m.Point(1,0),new m.Point(1,be)]:[new m.Point(1,be),new m.Point(1,1),new m.Point(0,1),new m.Point(0,be)],ue.push(...we),0===ce.length?ue.push(ne[0]):ue.push(...ce),{polygon:ue.map(xe=>new m.MercatorCoordinate(xe.x,xe.y)),unwrapped:!1}}(c,f);if(v)return v;const w=function(E,I){let O=!1,R=-1/0,B=0;for(let H=0;H<E.length-1;H++)E[H].x>R&&(R=E[H].x,B=H);for(let H=0;H<E.length-1;H++){const ee=(B+H)%(E.length-1),ie=E[ee],oe=E[ee+1];Math.abs(ie.x-oe.x)>.5&&(ie.x<oe.x?(ie.x+=1,0===ee&&(E[E.length-1].x+=1)):(oe.x+=1,ee+1===E.length-1&&(E[0].x+=1)),O=!0)}const z=m.mercatorXfromLng(I.center.lng);return O&&z<Math.abs(z-1)&&E.forEach(H=>{H.x-=1}),{polygon:E,unwrapped:O}}(Tr(c,f).map(E=>new m.Point(ul(E.x),E.y)),f);return{polygon:w.polygon.map(E=>new m.MercatorCoordinate(E.x,E.y)),unwrapped:w.unwrapped}}}function Tr(g,c){return m.resample(g,f=>{const v=c.pointCoordinate3D(f);f.x=v.x,f.y=v.y},1/256)}function ul(g){return g<0?1+g%1:g%1}function hi(g){return 100*g|0}function Fa(g,c,f,v,w){const E=function(I,O){if(I)return w(I);if(O){g.url&&O.tiles&&g.tiles&&delete g.tiles;const R=m.pick(m.extend(O,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);O.vector_layers&&(R.vectorLayers=O.vector_layers,R.vectorLayerIds=R.vectorLayers.map(B=>B.id)),R.tiles=c.canonicalizeTileset(R,g.url),w(null,R)}};return g.url?m.getJSON(c.transformRequest(c.normalizeSourceURL(g.url,null,f,v),m.ResourceType.Source),E):m.exported.frame(()=>E(null,g))}class Sr{constructor(c,f,v){this.bounds=m.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const f=Math.pow(2,c.z),v=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),w=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),I=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return c.x>=v&&c.x<E&&c.y>=w&&c.y<I}}class wd{constructor(c,f,v){this.context=c;const w=c.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ai={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Mi{constructor(c,f,v,w){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=w,this.context=c;const E=c.gl;this.buffer=E.createBuffer(),c.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,f){for(let v=0;v<this.attributes.length;v++){const w=f.attributes[this.attributes[v].name];void 0!==w&&c.enableVertexAttribArray(w)}}setVertexAttribPointers(c,f,v){for(let w=0;w<this.attributes.length;w++){const E=this.attributes[w],I=f.attributes[E.name];void 0!==I&&c.vertexAttribPointer(I,E.components,c[Ai[E.type]],!1,this.itemSize,E.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Vn{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Un extends Vn{getDefault(){return m.Color.transparent}set(c){const f=this.current;(c.r!==f.r||c.g!==f.g||c.b!==f.b||c.a!==f.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class bo extends Vn{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Cd extends Vn{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Fi extends Vn{getDefault(){return[!0,!0,!0,!0]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class us extends Vn{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class dl extends Vn{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Na extends Vn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const f=this.current;(c.func!==f.func||c.ref!==f.ref||c.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class ds extends Vn{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Qh extends Vn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=c,this.dirty=!1}}class Ed extends Vn{getDefault(){return[0,1]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class Jh extends Vn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=c,this.dirty=!1}}class hl extends Vn{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class ic extends Vn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.BLEND):f.disable(f.BLEND),this.current=c,this.dirty=!1}}class ef extends Vn{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class ou extends Vn{getDefault(){return m.Color.transparent}set(c){const f=this.current;(c.r!==f.r||c.g!==f.g||c.b!==f.b||c.a!==f.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class hs extends Vn{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class sa extends Vn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=c,this.dirty=!1}}class su extends Vn{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class rc extends Vn{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let au,Md=class extends Vn{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Lo extends Vn{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class za extends Vn{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class oc extends Vn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class fl extends Vn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class lu extends Vn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class tf extends Vn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class me extends Vn{getDefault(){return null}set(c){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Y extends Vn{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class J extends Vn{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class de extends Vn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class ve extends Vn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Me extends Vn{constructor(c,f){super(c),this.context=c,this.parent=f}getDefault(){return null}}class Oe extends Me{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Pe extends Me{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class De extends Pe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Be{constructor(c,f,v,w){this.context=c,this.width=f,this.height=v;const E=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Oe(c,E),w&&(this.depthAttachment=new Pe(c,E))}destroy(){const c=this.context.gl,f=this.colorAttachment.get();if(f&&c.deleteTexture(f),this.depthAttachment){const v=this.depthAttachment.get();v&&c.deleteRenderbuffer(v)}c.deleteFramebuffer(this.framebuffer)}}class yt{constructor(c,f=!1){if(this.gl=c,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const v=c;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(c),deleteVertexArrayOES:v.deleteVertexArray.bind(c),bindVertexArrayOES:v.bindVertexArray.bind(c)}}this.clearColor=new Un(this),this.clearDepth=new bo(this),this.clearStencil=new Cd(this),this.colorMask=new Fi(this),this.depthMask=new us(this),this.stencilMask=new dl(this),this.stencilFunc=new Na(this),this.stencilOp=new ds(this),this.stencilTest=new Qh(this),this.depthRange=new Ed(this),this.depthTest=new Jh(this),this.depthFunc=new hl(this),this.blend=new ic(this),this.blendFunc=new ef(this),this.blendColor=new ou(this),this.blendEquation=new hs(this),this.cullFace=new sa(this),this.cullFaceSide=new su(this),this.frontFace=new rc(this),this.program=new Md(this),this.activeTexture=new Lo(this),this.viewport=new za(this),this.bindFramebuffer=new oc(this),this.bindRenderbuffer=new fl(this),this.bindTexture=new lu(this),this.bindVertexBuffer=new tf(this),this.bindElementBuffer=new me(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Y(this),this.pixelStoreUnpack=new J(this),this.pixelStoreUnpackPremultiplyAlpha=new de(this),this.pixelStoreUnpackFlipY=new ve(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,f){return new wd(this,c,f)}createVertexBuffer(c,f,v){return new Mi(this,c,f,v)}createRenderbuffer(c,f,v){const w=this.gl,E=w.createRenderbuffer();return this.bindRenderbuffer.set(E),w.renderbufferStorage(w.RENDERBUFFER,c,f,v),this.bindRenderbuffer.set(null),E}createFramebuffer(c,f,v){return new Be(this,c,f,v)}clear({color:c,depth:f,stencil:v}){const w=this.gl;let E=0;c&&(E|=w.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==f&&(E|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),void 0!==v&&(E|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),w.clear(E)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){Je(c.blendFunction,m.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class xt extends m.Evented{constructor(c,f,v,w){if(super(),this.id=c,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(f,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new m.DedupedRequest}load(c){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=Fa(this._options,this.map._requestManager,f,v,(w,E)=>{this._tileJSONRequest=null,this._loaded=!0,w?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),v&&2!==v.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new m.ErrorEvent(w))):E&&(m.extend(this,E),E.bounds&&(this.tileBounds=new Sr(E.bounds,this.minzoom,this.maxzoom)),m.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(w)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return m.extend({},this._options)}loadTile(c,f){const v=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(v,m.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=f:c.request=c.actor.send("reloadTile",w,E.bind(this));else if(c.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",w,E.bind(this),void 0,!0);else{const I=m.loadVectorTile.call({deduped:this._deduped},w,(O,R)=>{O||!R?E.call(this,O):(w.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},c.actor&&c.actor.send("loadTile",w,E.bind(this),void 0,!0))},!0);c.request={cancel:I}}function E(I,O){return delete c.request,c.aborted?f(null):I&&404!==I.status?f(I):(O&&O.resourceTiming&&(c.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&c.setExpiryData(O),c.loadVectorData(O,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ht extends m.Evented{constructor(c,f,v,w){super(),this.id=c,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},f),m.extend(this,m.pick(f,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Fa(this._options,this.map._requestManager,null,null,(f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new m.ErrorEvent(f)):v&&(m.extend(this,v),v.bounds&&(this.tileBounds=new Sr(v.bounds,this.minzoom,this.maxzoom)),m.postTurnstileEvent(v.tiles),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(f)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return m.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,f){const v=m.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),(E,I,O,R)=>(delete c.request,c.aborted?(c.state="unloaded",f(null)):E?(c.state="errored",f(E)):I?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:O,expires:R}),c.setTexture(I,this.map.painter),c.state="loaded",m.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null)))}static loadTileData(c,f,v){c.setTexture(f,v)}static unloadTileData(c,f){c.texture&&f.saveTileTexture(c.texture)}abortTile(c,f){c.request&&(c.request.cancel(),delete c.request),f()}unloadTile(c,f){c.texture&&this.map.painter.saveTileTexture(c.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function fn(g,c,f,v,w,E,I,O){const R=[g,f,w,c,v,E,1,1,1],B=[I,O,1],z=m.adjoint([],R),[H,ee,ie]=m.transformMat3(B,B,m.transpose(z,z));return m.multiply$1(R,[H,0,0,0,ee,0,0,0,ie],R)}class Sn extends m.Evented{constructor(c,f,v,w){super(),this.id=c,this.dispatcher=v,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=f,this._dirty=!1}load(c,f){this._loaded=f||!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),(v,w)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new m.ErrorEvent(v));else if(w){const{HTMLImageElement:E}=m.window;this.image=w instanceof E?m.exported.getImageData(w):w,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const f=c.map(m.MercatorCoordinate.fromLngLat);return this.tileID=function(v){let w=1/0,E=1/0,I=-1/0,O=-1/0;for(const H of v)w=Math.min(w,H.x),E=Math.min(E,H.y),I=Math.max(I,H.x),O=Math.max(O,H.y);const R=Math.max(I-w,O-E),B=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),z=Math.pow(2,B);return new m.CanonicalTileID(B,Math.floor((w+I)/2*z),Math.floor((E+O)/2*z))}(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const R in this.tiles){const B=this.tiles[R];"loaded"!==B.state&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray)return;const f=m.tileTransform(this.tileID,this.map.transform.projection),[v,w,E,I]=this.coordinates.map(R=>{const B=f.projection.project(R[0],R[1]);return m.getTilePoint(f,B)._round()});this.perspectiveTransform=function(R,B,z,H,ee,ie,oe,re,se,G){const ne=fn(0,0,R,0,0,B,R,B),ce=fn(z,H,ee,ie,oe,re,se,G);return m.multiply$1(ce,m.adjoint(ne,ne),ce),[ce[6]/ce[8]*R/m.EXTENT,ce[7]/ce[8]*B/m.EXTENT]}(this.width,this.height,v.x,v.y,w.x,w.y,I.x,I.y,E.x,E.y);const O=this._boundsArray=new m.StructArrayLayout4i8;O.emplaceBack(v.x,v.y,0,0),O.emplaceBack(w.x,w.y,m.EXTENT,0),O.emplaceBack(I.x,I.y,0,m.EXTENT),O.emplaceBack(E.x,E.y,m.EXTENT,m.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(O,m.boundsAttributes.members),this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,f=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new m.Texture(c,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,f){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},f(null)):(c.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const pn={vector:xt,raster:ht,"raster-dem":class extends ht{constructor(g,c,f,v){super(g,c,f,v),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const f=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(w,E){w&&(g.state="errored",c(w)),E&&(g.dem=E,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=m.getImage(this.map._requestManager.transformRequest(f,m.ResourceType.Tile),function(w,E,I,O){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(w)g.state="errored",c(w);else if(E){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:I,expires:O});const R=m.window.ImageBitmap&&E instanceof m.window.ImageBitmap&&(null==au&&(au=m.window.OffscreenCanvas&&new m.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof m.window.createImageBitmap),au),B=1-(E.width-m.prevPowerOfTwo(E.width))/2;B<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const z=R?E:m.exported.getImageData(E,B),H={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:B};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",H,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const c=g.canonical,f=Math.pow(2,c.z),v=(c.x-1+f)%f,w=0===c.x?g.wrap-1:g.wrap,E=(c.x+1+f)%f,I=c.x+1===f?g.wrap+1:g.wrap,O={};return O[new m.OverscaledTileID(g.overscaledZ,w,c.z,v,c.y).key]={backfilled:!1},O[new m.OverscaledTileID(g.overscaledZ,I,c.z,E,c.y).key]={backfilled:!1},c.y>0&&(O[new m.OverscaledTileID(g.overscaledZ,w,c.z,v,c.y-1).key]={backfilled:!1},O[new m.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},O[new m.OverscaledTileID(g.overscaledZ,I,c.z,E,c.y-1).key]={backfilled:!1}),c.y+1<f&&(O[new m.OverscaledTileID(g.overscaledZ,w,c.z,v,c.y+1).key]={backfilled:!1},O[new m.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},O[new m.OverscaledTileID(g.overscaledZ,I,c.z,E,c.y+1).key]={backfilled:!1}),O}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends m.Evented{constructor(g,c,f,v){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(v),this._data=c.data,this._options=m.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const w=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*w,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*w,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:m.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*w,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},c),this}getClusterLeaves(g,c,f,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:c,offset:f},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new m.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=m.extend({},this.workerOptions),c=this._data;"string"==typeof c?(g.request=this.map._requestManager.transformRequest(m.exported.resolveURL(c),m.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new m.ErrorEvent(f));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),this.fire(new m.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const f=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(f,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(v,w)=>(delete g.request,g.unloadVectorData(),g.aborted?c(null):v?c(v):(g.loadVectorData(w,this.map.painter,"reloadTile"===f),c(null))),void 0,"loadTile"===f)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return m.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Sn{constructor(g,c,f,v){super(g,c,f,v),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,m.ResourceType.Source).url);m.getVideo(this.urls,(c,f)=>{this._loaded=!0,c?this.fire(new m.ErrorEvent(c)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Sn,canvas:class extends Sn{constructor(g,c,f,v){super(g,c,f,v),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(E=>"number"!=typeof E))||this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends m.Evented{constructor(g,c,f,v){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=c,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new m.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new m.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Sr(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),m.extend(this,m.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return m.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:f,z:v}=g.canonical;return this._implementation.hasTile({x:c,y:f,z:v})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:f,y:v,z:w}=g.tileID.canonical,E=new m.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:f,y:v,z:w},{signal:E.signal})).then(function(I){return delete g.request,g.aborted?(g.state="unloaded",c(null)):void 0===I?(g.state="errored",c(null)):null===I?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):(O=I)instanceof m.window.ImageData||O instanceof m.window.HTMLCanvasElement||O instanceof m.window.ImageBitmap||O instanceof m.window.HTMLImageElement?(this.loadTileData(g,I),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var O}.bind(this)).catch(I=>{20!==I.code&&(g.state="errored",c(I))}),g.request.cancel=()=>E.abort()}loadTileData(g,c){ht.loadTileData(g,c,this._map.painter)}unloadTileData(g){ht.unloadTileData(g,this._map.painter)}unloadTile(g,c){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:f,y:v,z:w}=g.tileID.canonical;this._implementation.unloadTile({x:f,y:v,z:w})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Mn=function(g,c,f,v){const w=new pn[c.type](g,c,f,v);if(w.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${w.id}`);return m.bindAll(["load","abort","unload","serialize","prepare"],w),w};function Fn(g,c){const f=m.identity([]);return m.scale(f,f,[.5*g.width,.5*-g.height,1]),m.translate(f,f,[1,-1,0]),m.multiply(f,f,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(f)}function Ui(g,c,f,v,w,E,I,O=!1){const R=g.tilesIn(v,I,O);R.sort(so);const B=[];for(const H of R)B.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(c,f,g._state,H,w,E,Fn(g.transform,H.tile.tileID),O)});const z=function(H){const ee={},ie={};for(const oe of H){const re=oe.queryResults,se=oe.wrappedTileID,G=ie[se]=ie[se]||{};for(const ne in re){const ce=re[ne],ue=G[ne]=G[ne]||{},be=ee[ne]=ee[ne]||[];for(const we of ce)ue[we.featureIndex]||(ue[we.featureIndex]=!0,be.push(we))}}return ee}(B);for(const H in z)z[H].forEach(ee=>{const ie=ee.feature,oe=ie.layer;oe&&"background"!==oe.type&&"sky"!==oe.type&&(ie.source=oe.source,oe["source-layer"]&&(ie.sourceLayer=oe["source-layer"]),ie.state=void 0!==ie.id?g.getFeatureState(oe["source-layer"],ie.id):{})});return z}function Xn(g,c){const f=g.getRenderableIds().map(E=>g.getTileByID(E)),v=[],w={};for(let E=0;E<f.length;E++){const I=f[E],O=I.tileID.canonical.key;w[O]||(w[O]=!0,I.querySourceFeatures(v,c))}return v}function so(g,c){const f=g.tileID,v=c.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}function Fr(){return null!=Pu.workerClass?new Pu.workerClass:new m.window.Worker(Pu.workerUrl)}const aa="mapboxgl_preloaded_worker_pool";class Wr{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<Wr.workerCount;)this.workers.push(new Fr);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[aa]}numActive(){return Object.keys(this.active).length}}let ao;function cu(){return ao||(ao=new Wr),ao}function J0(g,c){const f={};for(const v in g)"ref"!==v&&(f[v]=g[v]);return m.refProperties.forEach(v=>{v in c&&(f[v]=c[v])}),f}function la(g){g=g.slice();const c=Object.create(null);for(let f=0;f<g.length;f++)c[g[f].id]=g[f];for(let f=0;f<g.length;f++)"ref"in g[f]&&(g[f]=J0(g[f],c[g[f].ref]));return g}Wr.workerCount=2;const ii={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function or(g,c,f){f.push({command:ii.addSource,args:[g,c[g]]})}function ca(g,c,f){c.push({command:ii.removeSource,args:[g]}),f[g]=!0}function Zo(g,c,f,v){ca(g,f,v),or(g,c,f)}function Fp(g,c,f){let v;for(v in g[f])if(g[f].hasOwnProperty(v)&&"data"!==v&&!Je(g[f][v],c[f][v]))return!1;for(v in c[f])if(c[f].hasOwnProperty(v)&&"data"!==v&&!Je(g[f][v],c[f][v]))return!1;return!0}function ua(g,c,f,v,w,E){let I;for(I in c=c||{},g=g||{})g.hasOwnProperty(I)&&(Je(g[I],c[I])||f.push({command:E,args:[v,I,c[I],w]}));for(I in c)c.hasOwnProperty(I)&&!g.hasOwnProperty(I)&&(Je(g[I],c[I])||f.push({command:E,args:[v,I,c[I],w]}))}function da(g){return g.id}function Dd(g,c){return g[c.id]=c,g}class nf{constructor(c,f){this.reset(c,f)}reset(c,f){this.points=c||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=m.clamp(c,0,1);let f=1,v=this._distances[f];const w=c*this.paddedLength+this.padding;for(;v<w&&f<this._distances.length;)v=this._distances[++f];const E=f-1,I=this._distances[E],O=v-I,R=O>0?(w-I)/O:0;return this.points[E].mult(1-R).add(this.points[f].mult(R))}}class Ls{constructor(c,f,v){const w=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(c/v),this.yCellCount=Math.ceil(f/v);for(let I=0;I<this.xCellCount*this.yCellCount;I++)w.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=f,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,f,v,w,E){this._forEachCell(f,v,w,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(E)}insertCircle(c,f,v,w){this._forEachCell(f-w,v-w,f+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(f),this.circles.push(v),this.circles.push(w)}_insertBoxCell(c,f,v,w,E,I){this.boxCells[E].push(I)}_insertCircleCell(c,f,v,w,E,I){this.circleCells[E].push(I)}_query(c,f,v,w,E,I){if(v<0||c>this.width||w<0||f>this.height)return!E&&[];const O=[];if(c<=0&&f<=0&&this.width<=v&&this.height<=w){if(E)return!0;for(let R=0;R<this.boxKeys.length;R++)O.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const B=this.circles[3*R],z=this.circles[3*R+1],H=this.circles[3*R+2];O.push({key:this.circleKeys[R],x1:B-H,y1:z-H,x2:B+H,y2:z+H})}return I?O.filter(I):O}return this._forEachCell(c,f,v,w,this._queryCell,O,{hitTest:E,seenUids:{box:{},circle:{}}},I),E?O.length>0:O}_queryCircle(c,f,v,w,E){const I=c-v,O=c+v,R=f-v,B=f+v;if(O<0||I>this.width||B<0||R>this.height)return!w&&[];const z=[];return this._forEachCell(I,R,O,B,this._queryCellCircle,z,{hitTest:w,circle:{x:c,y:f,radius:v},seenUids:{box:{},circle:{}}},E),w?z.length>0:z}query(c,f,v,w,E){return this._query(c,f,v,w,!1,E)}hitTest(c,f,v,w,E){return this._query(c,f,v,w,!0,E)}hitTestCircle(c,f,v,w){return this._queryCircle(c,f,v,!0,w)}_queryCell(c,f,v,w,E,I,O,R){const B=O.seenUids,z=this.boxCells[E];if(null!==z){const ee=this.bboxes;for(const ie of z)if(!B.box[ie]){B.box[ie]=!0;const oe=4*ie;if(c<=ee[oe+2]&&f<=ee[oe+3]&&v>=ee[oe+0]&&w>=ee[oe+1]&&(!R||R(this.boxKeys[ie]))){if(O.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[ie],x1:ee[oe],y1:ee[oe+1],x2:ee[oe+2],y2:ee[oe+3]})}}}const H=this.circleCells[E];if(null!==H){const ee=this.circles;for(const ie of H)if(!B.circle[ie]){B.circle[ie]=!0;const oe=3*ie;if(this._circleAndRectCollide(ee[oe],ee[oe+1],ee[oe+2],c,f,v,w)&&(!R||R(this.circleKeys[ie]))){if(O.hitTest)return I.push(!0),!0;{const re=ee[oe],se=ee[oe+1],G=ee[oe+2];I.push({key:this.circleKeys[ie],x1:re-G,y1:se-G,x2:re+G,y2:se+G})}}}}}_queryCellCircle(c,f,v,w,E,I,O,R){const B=O.circle,z=O.seenUids,H=this.boxCells[E];if(null!==H){const ie=this.bboxes;for(const oe of H)if(!z.box[oe]){z.box[oe]=!0;const re=4*oe;if(this._circleAndRectCollide(B.x,B.y,B.radius,ie[re+0],ie[re+1],ie[re+2],ie[re+3])&&(!R||R(this.boxKeys[oe])))return I.push(!0),!0}}const ee=this.circleCells[E];if(null!==ee){const ie=this.circles;for(const oe of ee)if(!z.circle[oe]){z.circle[oe]=!0;const re=3*oe;if(this._circlesCollide(ie[re],ie[re+1],ie[re+2],B.x,B.y,B.radius)&&(!R||R(this.circleKeys[oe])))return I.push(!0),!0}}}_forEachCell(c,f,v,w,E,I,O,R){const B=this._convertToXCellCoord(c),z=this._convertToYCellCoord(f),H=this._convertToXCellCoord(v),ee=this._convertToYCellCoord(w);for(let ie=B;ie<=H;ie++)for(let oe=z;oe<=ee;oe++)if(E.call(this,c,f,v,w,this.xCellCount*oe+ie,I,O,R))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,f,v,w,E,I){const O=w-c,R=E-f,B=v+I;return B*B>O*O+R*R}_circleAndRectCollide(c,f,v,w,E,I,O){const R=(I-w)/2,B=Math.abs(c-(w+R));if(B>R+v)return!1;const z=(O-E)/2,H=Math.abs(f-(E+z));if(H>z+v)return!1;if(B<=R||H<=z)return!0;const ee=B-R,ie=H-z;return ee*ee+ie*ie<=v*v}}const Ba={unknown:0,flipRequired:1,flipNotRequired:2},uu=Math.tan(85*Math.PI/180);function He(g,c,f,v,w,E,I){const O=m.create();if(f)if("globe"===E.name){const R=m.calculateGlobeLabelMatrix(w,c);m.multiply(O,O,R)}else{const R=Ct([],I);O[0]=R[0],O[1]=R[1],O[4]=R[2],O[5]=R[3],v||m.rotateZ(O,O,w.angle)}else m.multiply(O,w.labelPlaneMatrix,g);return O}function Va(g,c,f,v,w,E,I){const O=He(g,c,f,v,w,E,I);return"globe"===E.name&&f||(O[2]=O[6]=O[10]=O[14]=0),O}function Ir(g,c,f,v,w,E,I){if(f){if("globe"===E.name){const O=He(g,c,f,v,w,E,I);return m.invert(O,O),m.multiply(O,g,O),O}{const O=m.clone(g),R=m.identity([]);return R[0]=I[0],R[1]=I[1],R[4]=I[2],R[5]=I[3],m.multiply(O,O,R),v||m.rotateZ(O,O,-w.angle),O}}return w.glCoordMatrix}function Zr(g,c,f,v){const w=[g,c,f,1];f?m.transformMat4$1(w,w,v):An(w,w,v);const E=w[3];return w[0]/=E,w[1]/=E,w[2]/=E,w}function Ng(g,c){return Math.min(.5+g/c*.5,1.5)}function Fs(g,c){const f=g[0]/g[3],v=g[1]/g[3];return f>=-c[0]&&f<=c[0]&&v>=-c[1]&&v<=c[1]}function Np(g,c,f,v,w,E,I,O,R,B){const z=f.transform,H=v?g.textSizeData:g.iconSizeData,ee=m.evaluateSizeForZoom(H,f.transform.zoom),ie="globe"===z.projection.name,oe=[256/f.width*2+1,256/f.height*2+1],re=v?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;re.clear();let se=null;ie&&(se=v?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const G=g.lineVertexArray,ne=v?g.text.placedSymbolArray:g.icon.placedSymbolArray,ce=f.transform.width/f.transform.height;let ue,be=!1;for(let we=0;we<ne.length;we++){const xe=ne.get(we),{numGlyphs:Ae,writingMode:Te}=xe;if(Te!==m.WritingMode.vertical||be||ue===m.WritingMode.horizontal||(be=!0),ue=Te,(xe.hidden||Te===m.WritingMode.vertical)&&!be){Ar(Ae,re);continue}be=!1;const Ne=new m.Point(xe.tileAnchorX,xe.tileAnchorY);let{x:ut,y:Re,z:Ze}=z.projection.projectTilePoint(Ne.x,Ne.y,B.canonical);if(R){const[on,Ut,Gt]=R(Ne);ut+=on,Re+=Ut,Ze+=Gt}const Ve=[ut,Re,Ze,1];if(m.transformMat4$1(Ve,Ve,c),!Fs(Ve,oe)){Ar(Ae,re);continue}const lt=Ng(f.transform.cameraToCenterDistance,Ve[3]),Le=m.evaluateSizeForFeature(H,ee,xe),We=I?Le/lt:Le*lt,nt=Zr(ut,Re,Ze,w);if(nt[3]<=0){Ar(Ae,re);continue}let et={};const dt=I?null:R,Et=Lt(xe,We,!1,O,c,w,E,g.glyphOffsetArray,G,re,se,nt,Ne,et,ce,dt,z.projection,B,I);be=Et.useVertical,dt&&Et.needsFlipping&&(et={}),(Et.notEnoughRoom||be||Et.needsFlipping&&Lt(xe,We,!0,O,c,w,E,g.glyphOffsetArray,G,re,se,nt,Ne,et,ce,dt,z.projection,B,I).notEnoughRoom)&&Ar(Ae,re)}v?(g.text.dynamicLayoutVertexBuffer.updateData(re),se&&g.text.globeExtVertexBuffer.updateData(se)):(g.icon.dynamicLayoutVertexBuffer.updateData(re),se&&g.icon.globeExtVertexBuffer.updateData(se))}function zg(g,c,f,v,w,E,I,O,R,B,z,H,ee,ie,oe,re){const{lineStartIndex:se,glyphStartIndex:G,segment:ne}=O,ce=G+O.numGlyphs,ue=se+O.lineLength,be=c.getoffsetX(G),we=c.getoffsetX(ce-1),xe=xo(g*be,f,v,w,E,I,ne,se,ue,R,B,z,H,ee,!0,ie,oe,re);if(!xe)return null;const Ae=xo(g*we,f,v,w,E,I,ne,se,ue,R,B,z,H,ee,!0,ie,oe,re);return Ae?{first:xe,last:Ae}:null}function Pi(g,c,f,v){return g===m.WritingMode.horizontal&&Math.abs(v)>Math.abs(f)?{useVertical:!0}:g===m.WritingMode.vertical?v>0?{needsFlipping:!0}:null:c!==Ba.unknown&&(0===(w=f)||Math.abs(v/w)>uu)?c===Ba.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null;var w}function Lt(g,c,f,v,w,E,I,O,R,B,z,H,ee,ie,oe,re,se,G,ne){const ce=c/24,ue=g.lineOffsetX*ce,be=g.lineOffsetY*ce,{lineStartIndex:we,glyphStartIndex:xe,numGlyphs:Ae,segment:Te,writingMode:Ne,flipState:ut}=g,Re=we+g.lineLength,Ze=Ve=>{if(z){const[nt,et,dt]=Ve.up,Et=B.length;m.updateGlobeVertexNormal(z,Et+0,nt,et,dt),m.updateGlobeVertexNormal(z,Et+1,nt,et,dt),m.updateGlobeVertexNormal(z,Et+2,nt,et,dt),m.updateGlobeVertexNormal(z,Et+3,nt,et,dt)}const[lt,Le,We]=Ve.point;m.addDynamicAttributes(B,lt,Le,We,Ve.angle)};if(Ae>1){const Ve=zg(ce,O,ue,be,f,H,ee,g,R,E,ie,re,!1,se,G,ne);if(!Ve)return{notEnoughRoom:!0};if(v&&!f){let[lt,Le,We]=Ve.first.point,[nt,et,dt]=Ve.last.point;[lt,Le]=Zr(lt,Le,We,I),[nt,et]=Zr(nt,et,dt,I);const Et=Pi(Ne,ut,(nt-lt)*oe,et-Le);if(g.flipState=Et&&Et.needsFlipping?Ba.flipRequired:Ba.flipNotRequired,Et)return Et}Ze(Ve.first);for(let lt=xe+1;lt<xe+Ae-1;lt++){const Le=xo(ce*O.getoffsetX(lt),ue,be,f,H,ee,Te,we,Re,R,E,ie,re,!1,!1,se,G,ne);if(!Le)return B.length-=4*(lt-xe),{notEnoughRoom:!0};Ze(Le)}Ze(Ve.last)}else{if(v&&!f){const lt=Zr(ee.x,ee.y,0,w),Le=we+Te+1,We=new m.Point(R.getx(Le),R.gety(Le)),nt=Zr(We.x,We.y,0,w),et=nt[3]>0?nt:In(ee,We,lt,1,w,void 0,se,G.canonical),dt=Pi(Ne,ut,(et[0]-lt[0])*oe,et[1]-lt[1]);if(g.flipState=dt&&dt.needsFlipping?Ba.flipRequired:Ba.flipNotRequired,dt)return dt}const Ve=xo(ce*O.getoffsetX(xe),ue,be,f,H,ee,Te,we,Re,R,E,ie,re,!1,!1,se,G,ne);if(!Ve)return{notEnoughRoom:!0};Ze(Ve)}return{}}function Dt(g,c,f,v,w){const{x:E,y:I,z:O}=v.projectTilePoint(g.x,g.y,c);if(!w)return Zr(E,I,O,f);const[R,B,z]=w(g);return Zr(E+R,I+B,O+z,f)}function In(g,c,f,v,w,E,I,O){const R=Dt(g.sub(c)._unit()._add(g),O,w,I,E);return m.sub(R,f,R),m.normalize(R,R),m.scaleAndAdd(R,f,R,v)}function xo(g,c,f,v,w,E,I,O,R,B,z,H,ee,ie,oe,re,se,G){const ne=v?g-c:g+c;let ce=ne>0?1:-1,ue=0;v&&(ce*=-1,ue=Math.PI),ce<0&&(ue+=Math.PI);let be=O+I+(ce>0?0:1)|0,we=w,xe=w,Ae=0,Te=0;const Ne=Math.abs(ne),ut=[],Re=[];let Ze=E,Ve=Ze;const lt=()=>In(Ve,Ze,xe,Ne-Ae+1,z,ee,re,se.canonical);for(;Ae+Te<=Ne;){if(be+=ce,be<O||be>=R)return null;if(xe=we,Ve=Ze,ut.push(xe),ie&&Re.push(Ve),Ze=new m.Point(B.getx(be),B.gety(be)),we=H[be],!we){const Gt=Dt(Ze,se.canonical,z,re,ee);we=Gt[3]>0?H[be]=Gt:lt()}Ae+=Te,Te=m.distance(xe,we)}oe&&ee&&(H[be]&&(we=lt(),Te=m.distance(xe,we)),H[be]=we);const Le=(Ne-Ae)/Te,We=Ze.sub(Ve)._mult(Le)._add(Ve),nt=m.sub([],we,xe),et=m.scaleAndAdd([],xe,nt,Le);let dt=[0,0,1],Et=nt[0],on=nt[1];if(G&&(dt=re.upVector(se.canonical,We.x,We.y),0!==dt[0]||0!==dt[1]||1!==dt[2])){const Gt=[dt[2],0,-dt[0]],Rn=m.cross([],dt,Gt);m.normalize(Gt,Gt),m.normalize(Rn,Rn),Et=m.dot(nt,Gt),on=m.dot(nt,Rn)}if(f){const Gt=m.cross([],dt,nt);m.normalize(Gt,Gt),m.scaleAndAdd(et,et,Gt,f*ce)}const Ut=ue+Math.atan2(on,Et);return ut.push(et),ie&&Re.push(We),{point:et,angle:Ut,path:ut,tilePath:Re,up:dt}}function Ar(g,c){const f=c.length,v=f+4*g;c.resize(v),c.float32.fill(-1/0,4*f,4*v)}function An(g,c,f){const v=c[0],w=c[1];return g[0]=f[0]*v+f[4]*w+f[12],g[1]=f[1]*v+f[5]*w+f[13],g[3]=f[3]*v+f[7]*w+f[15],g}const Xo=100;class ai{constructor(c,f,v=new Ls(c.width+200,c.height+200,25),w=new Ls(c.width+200,c.height+200,25)){this.transform=c,this.grid=v,this.ignoredGrid=w,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Xo,this.screenBottomBoundary=c.height+Xo,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=f}placeCollisionBox(c,f,v,w,E,I,O,R){let B=v.projectedAnchorX,z=v.projectedAnchorY,H=v.projectedAnchorZ;const ee=v.elevation,ie=v.tileID,oe=c.getProjection();if(ee&&ie){const[we,xe,Ae]=oe.upVector(ie.canonical,v.tileAnchorX,v.tileAnchorY),Te=oe.upVectorScale(ie.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=we*ee*Te,z+=xe*ee*Te,H+=Ae*ee*Te}const re=this.projectAndGetPerspectiveRatio(O,B,z,H,v.tileID,"globe"===oe.name||!!ee||this.transform.pitch>0,oe),se=I*re.perspectiveRatio,G=(v.x1*f+w.x-v.padding)*se+re.point.x,ne=(v.y1*f+w.y-v.padding)*se+re.point.y,ce=(v.x2*f+w.x+v.padding)*se+re.point.x,ue=(v.y2*f+w.y+v.padding)*se+re.point.y,be=re.perspectiveRatio<=.55||re.occluded;return!this.isInsideGrid(G,ne,ce,ue)||!E&&this.grid.hitTest(G,ne,ce,ue,R)||be?{box:[],offscreen:!1,occluded:re.occluded}:{box:[G,ne,ce,ue],offscreen:this.isOffscreen(G,ne,ce,ue),occluded:!1}}placeCollisionCircles(c,f,v,w,E,I,O,R,B,z,H,ee,ie,oe,re){const se=[],G=this.transform.elevation,ne=c.getProjection(),ce=G?G.getAtTileOffsetFunc(re,this.transform.center.lat,this.transform.worldSize,ne):null,ue=new m.Point(v.tileAnchorX,v.tileAnchorY);let{x:be,y:we,z:xe}=ne.projectTilePoint(ue.x,ue.y,re.canonical);if(ce){const[We,nt,et]=ce(ue);be+=We,we+=nt,xe+=et}const Ae="globe"===ne.name,Te=this.projectAndGetPerspectiveRatio(O,be,we,xe,re,Ae||!!G||this.transform.pitch>0,ne),{perspectiveRatio:Ne}=Te,ut=(H?I/Ne:I*Ne)/m.ONE_EM,Re=Zr(be,we,xe,R),Ze=Te.signedDistanceFromCamera>0?zg(ut,E,v.lineOffsetX*ut,v.lineOffsetY*ut,!1,Re,ue,v,w,R,{},G&&!H?ce:null,H&&!!G,ne,re,H):null;let Ve=!1,lt=!1,Le=!0;if(Ze&&!Te.occluded){const We=.5*ie*Ne+oe,nt=new m.Point(-100,-100),et=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),dt=new nf,{first:Et,last:on}=Ze,Ut=Et.path.length;let Gt=[];for(let qt=Ut-1;qt>=1;qt--)Gt.push(Et.path[qt]);for(let qt=1;qt<on.path.length;qt++)Gt.push(on.path[qt]);const Rn=2.5*We;B&&(Gt=Gt.map(([qt,Tn,_i],yi)=>(ce&&!Ae&&(_i=ce(yi<Ut-1?Et.tilePath[Ut-1-yi]:on.tilePath[yi-Ut+2])[2]),Zr(qt,Tn,_i,B))),Gt.some(qt=>qt[3]<=0)&&(Gt=[]));let Dn=[];if(Gt.length>0){let qt=1/0,Tn=-1/0,_i=1/0,yi=-1/0;for(const vi of Gt)qt=Math.min(qt,vi[0]),_i=Math.min(_i,vi[1]),Tn=Math.max(Tn,vi[0]),yi=Math.max(yi,vi[1]);Tn>=nt.x&&qt<=et.x&&yi>=nt.y&&_i<=et.y&&(Dn=[Gt.map(vi=>new m.Point(vi[0],vi[1]))],(qt<nt.x||Tn>et.x||_i<nt.y||yi>et.y)&&(Dn=m.clipLine(Dn,nt.x,nt.y,et.x,et.y)))}for(const qt of Dn){dt.reset(qt,.25*We);let Tn=0;Tn=dt.length<=.5*We?1:Math.ceil(dt.paddedLength/Rn)+1;for(let _i=0;_i<Tn;_i++){const yi=_i/Math.max(Tn-1,1),vi=dt.lerp(yi),lr=vi.x+Xo,$r=vi.y+Xo;se.push(lr,$r,We,0);const vs=lr-We,Hs=$r-We,zi=lr+We,fi=$r+We;if(Le=Le&&this.isOffscreen(vs,Hs,zi,fi),lt=lt||this.isInsideGrid(vs,Hs,zi,fi),!f&&this.grid.hitTestCircle(lr,$r,We,ee)&&(Ve=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!z&&Ve||!lt?[]:se,offscreen:Le,collisionDetected:Ve,occluded:Te.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const f=[];let v=1/0,w=1/0,E=-1/0,I=-1/0;for(const z of c){const H=new m.Point(z.x+Xo,z.y+Xo);v=Math.min(v,H.x),w=Math.min(w,H.y),E=Math.max(E,H.x),I=Math.max(I,H.y),f.push(H)}const O=this.grid.query(v,w,E,I).concat(this.ignoredGrid.query(v,w,E,I)),R={},B={};for(const z of O){const H=z.key;if(void 0===R[H.bucketInstanceId]&&(R[H.bucketInstanceId]={}),R[H.bucketInstanceId][H.featureIndex])continue;const ee=[new m.Point(z.x1,z.y1),new m.Point(z.x2,z.y1),new m.Point(z.x2,z.y2),new m.Point(z.x1,z.y2)];m.polygonIntersectsPolygon(f,ee)&&(R[H.bucketInstanceId][H.featureIndex]=!0,void 0===B[H.bucketInstanceId]&&(B[H.bucketInstanceId]=[]),B[H.bucketInstanceId].push(H.featureIndex))}return B}insertCollisionBox(c,f,v,w,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:E},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,f,v,w,E){const I=f?this.ignoredGrid:this.grid,O={bucketInstanceId:v,featureIndex:w,collisionGroupID:E};for(let R=0;R<c.length;R+=4)I.insertCircle(O,c[R],c[R+1],c[R+2])}projectAndGetPerspectiveRatio(c,f,v,w,E,I,O){const R=[f,v,w,1];let B=!1;w||this.transform.pitch>0?(m.transformMat4$1(R,R,c),this.fogState&&E&&"globe"!==O.name&&(B=function(ee,ie,oe,re,se,G){const ne=G.calculateFogTileMatrix(se),ce=[ie,oe,re];return m.transformMat4(ce,ce,ne),tc(ee,ce,G.pitch,G._fov)}(this.fogState,f,v,w,E.toUnwrapped(),this.transform)>.9)):An(R,R,c);const z=R[3];return{point:new m.Point((R[0]/z+1)/2*this.transform.width+Xo,(-R[1]/z+1)/2*this.transform.height+Xo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(O)/z*.5,1.5),signedDistanceFromCamera:z,occluded:I&&R[2]>z||B}}isOffscreen(c,f,v,w){return v<Xo||c>=this.screenRightBoundary||w<Xo||f>this.screenBottomBoundary}isInsideGrid(c,f,v,w){return v>=0&&c<this.gridRightBoundary&&w>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const c=m.identity([]);return m.translate(c,c,[-100,-100,0]),c}}function ha(g,c,f){const v=c.createTileMatrix(g,g.worldSize,f.toUnwrapped());return m.multiply(new Float32Array(16),g.projMatrix,v)}function mi(g,c,f){if(c.projection.name===f.projection.name)return g.projMatrix;const v=f.clone();return v.setProjection(c.projection),ha(v,c.getProjection(),g)}function Oi(g,c,f){return c.name===f.projection.name?g.projMatrix:ha(f,c,g)}class Bg{constructor(c,f,v,w){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?f:-f))):w&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class Yn{constructor(c,f,v,w,E,I=!1){this.text=new Bg(c?c.text:null,f,v,E),this.icon=new Bg(c?c.icon:null,f,w,E),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class an{constructor(c,f,v,w=!1){this.text=c,this.icon=f,this.skipFade=v,this.clipped=w}}class sc{constructor(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]}}class Td{constructor(c,f,v,w,E){this.bucketInstanceId=c,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=E}}class ev{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const f=++this.maxGroupID;this.collisionGroups[c]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[c]}}function du(g,c,f,v,w){const{horizontalAlign:E,verticalAlign:I}=m.getAnchorAlignment(g),O=-(E-.5)*c,R=-(I-.5)*f,B=m.evaluateVariableOffset(g,v);return new m.Point(O+B[0]*w,R+B[1]*w)}function gt(g,c,f,v,w){const E=new m.Point(g,c);return f&&E._rotate(v?w:-w),E}class ac{constructor(c,f,v,w,E){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new ai(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ev(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,f,v,w){const E=v.getBucket(f),I=v.latestFeatureIndex;if(!E||!I||f.id!==E.layerIds[0])return;const O=E.layers[0].layout,R=v.collisionBoxArray,B=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),z=v.tileSize/m.EXTENT,H=v.tileID.toUnwrapped();this.transform.setProjection(E.projection);const ee=(ie=v.tileID,oe=E.getProjection(),re=this.transform,oe.name===this.projection?re.calculateProjMatrix(ie.toUnwrapped()):ha(re,oe,ie));var ie,oe,re;const se="map"===O.get("text-pitch-alignment"),G="map"===O.get("text-rotation-alignment");f.compileFilter();const ne=f.dynamicFilter(),ce=f.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(v),be=Va(ee,v.tileID.canonical,se,G,this.transform,E.getProjection(),ue);let we=null;if(se){const Te=Ir(ee,v.tileID.canonical,se,G,this.transform,E.getProjection(),ue);we=m.multiply([],this.transform.labelPlaneMatrix,Te)}let xe=null;ne&&v.latestFeatureIndex&&(xe={unwrappedTileID:H,dynamicFilter:ne,dynamicFilterNeedsFeature:ce,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new Td(E.bucketInstanceId,I,E.sourceLayerIndex,E.index,v.tileID);const Ae={bucket:E,layout:O,posMatrix:ee,textLabelPlaneMatrix:be,labelToScreenMatrix:we,clippingData:xe,scale:B,textPixelRatio:z,holdingForFade:v.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:m.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(w)for(const Te of E.sortKeyRanges){const{sortKey:Ne,symbolInstanceStart:ut,symbolInstanceEnd:Re}=Te;c.push({sortKey:Ne,symbolInstanceStart:ut,symbolInstanceEnd:Re,parameters:Ae})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ae})}attemptAnchorPlacement(c,f,v,w,E,I,O,R,B,z,H,ee,ie,oe,re,se,G,ne){const{textOffset0:ce,textOffset1:ue,crossTileID:be}=ee,we=[ce,ue],xe=du(c,v,w,we,E),Ae=this.collisionIndex.placeCollisionBox(oe,E,f,gt(xe.x,xe.y,I,O,this.transform.angle),H,R,B,z.predicate);if(se){const Te=oe.getSymbolInstanceIconSize(ne,this.transform.zoom,ee.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(oe,Te,se,gt(xe.x,xe.y,I,O,this.transform.angle),H,R,B,z.predicate).box.length)return}if(Ae.box.length>0){let Te;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Te=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:we,width:v,height:w,anchor:c,textScale:E,prevAnchor:Te},this.markUsedJustification(oe,c,ee,re),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,re,ee),this.placedOrientations[be]=re),{shift:xe,placedGlyphBoxes:Ae}}}placeLayerBucketPart(c,f,v,w){const{bucket:E,layout:I,posMatrix:O,textLabelPlaneMatrix:R,labelToScreenMatrix:B,clippingData:z,textPixelRatio:H,holdingForFade:ee,collisionBoxArray:ie,partiallyEvaluatedTextSize:oe,partiallyEvaluatedIconSize:re,collisionGroup:se}=c.parameters,G=I.get("text-optional"),ne=I.get("icon-optional"),ce=I.get("text-allow-overlap"),ue=I.get("icon-allow-overlap"),be="map"===I.get("text-rotation-alignment"),we="map"===I.get("text-pitch-alignment"),xe="none"!==I.get("icon-text-fit"),Ae="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(E.projection);let Te=ce&&(ue||!E.hasIconData()||ne),Ne=ue&&(ce||!E.hasTextData()||G);!E.collisionArrays&&ie&&E.deserializeCollisionBoxes(ie),v&&w&&E.updateCollisionDebugBuffers(this.transform.zoom,ie);const ut=(Re,Ze,Ve)=>{const{crossTileID:lt,numVerticalGlyphVertices:Le}=Re;if(z){const zi={zoom:this.transform.zoom,pitch:this.transform.pitch};let fi=null;if(z.dynamicFilterNeedsFeature){const Jn=this.retainedQueryData[E.bucketInstanceId];fi=z.featureIndex.loadFeature({featureIndex:Re.featureIndex,bucketIndex:Jn.bucketIndex,sourceLayerIndex:Jn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(zi,fi,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new m.Point(Re.tileAnchorX,Re.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[lt]=new an(!1,!1,!1,!0),void f.add(lt)}if(f.has(lt))return;if(ee)return void(this.placements[lt]=new an(!1,!1,!1));let We=!1,nt=!1,et=!0,dt=!1,Et=!1,on=null,Ut={box:null,offscreen:null,occluded:null},Gt={box:null,offscreen:null,occluded:null},Rn=null,Dn=null,qt=null,Tn=0,_i=0,yi=0;Ve.textFeatureIndex?Tn=Ve.textFeatureIndex:Re.useRuntimeCollisionCircles&&(Tn=Re.featureIndex),Ve.verticalTextFeatureIndex&&(_i=Ve.verticalTextFeatureIndex);const vi=zi=>{zi.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const fi=this.transform.elevation;(fi||zi.elevation)&&(zi.elevation=fi?fi.getAtTileOffset(zi.tileID,zi.tileAnchorX,zi.tileAnchorY):0)},lr=Ve.textBox;if(lr){vi(lr);const zi=Jn=>{let Yt=m.WritingMode.horizontal;if(E.allowVerticalPlacement&&!Jn&&this.prevPlacement){const ho=this.prevPlacement.placedOrientations[lt];ho&&(this.placedOrientations[lt]=ho,Yt=ho,this.markUsedOrientation(E,Yt,Re))}return Yt},fi=(Jn,Yt)=>{if(E.allowVerticalPlacement&&Le>0&&Ve.verticalTextBox){for(const ho of E.writingModes)if(ho===m.WritingMode.vertical?(Ut=Yt(),Gt=Ut):Ut=Jn(),Ut&&Ut.box&&Ut.box.length)break}else Ut=Jn()};if(I.get("text-variable-anchor")){let Jn=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[lt]){const Hi=this.prevPlacement.variableOffsets[lt];Jn.indexOf(Hi.anchor)>0&&(Jn=Jn.filter(zo=>zo!==Hi.anchor),Jn.unshift(Hi.anchor))}const Yt=(Hi,zo,wf)=>{const xc=E.getSymbolInstanceTextSize(oe,Re,this.transform.zoom,Ze),Ou=(Hi.x2-Hi.x1)*xc+2*Hi.padding,Bo=(Hi.y2-Hi.y1)*xc+2*Hi.padding,El=xe&&!ue?zo:null;El&&vi(El);let wc={box:[],offscreen:!1,occluded:!1};const Cf=ce?2*Jn.length:Jn.length;for(let qd=0;qd<Cf;++qd){const im=this.attemptAnchorPlacement(Jn[qd%Jn.length],Hi,Ou,Bo,xc,be,we,H,O,se,qd>=Jn.length,Re,Ze,E,wf,El,oe,re);if(im&&(wc=im.placedGlyphBoxes,wc&&wc.box&&wc.box.length)){We=!0,on=im.shift;break}}return wc};fi(()=>Yt(lr,Ve.iconBox,m.WritingMode.horizontal),()=>{const Hi=Ve.verticalTextBox;return Hi&&vi(Hi),E.allowVerticalPlacement&&!(Ut&&Ut.box&&Ut.box.length)&&Le>0&&Hi?Yt(Hi,Ve.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Ut&&(We=Ut.box,et=Ut.offscreen,dt=Ut.occluded);const ho=zi(!(!Ut||!Ut.box));if(!We&&this.prevPlacement){const Hi=this.prevPlacement.variableOffsets[lt];Hi&&(this.variableOffsets[lt]=Hi,this.markUsedJustification(E,Hi.anchor,Re,ho))}}else{const Jn=(Yt,ho)=>{const Hi=E.getSymbolInstanceTextSize(oe,Re,this.transform.zoom,Ze),zo=this.collisionIndex.placeCollisionBox(E,Hi,Yt,new m.Point(0,0),ce,H,O,se.predicate);return zo&&zo.box&&zo.box.length&&(this.markUsedOrientation(E,ho,Re),this.placedOrientations[lt]=ho),zo};fi(()=>Jn(lr,m.WritingMode.horizontal),()=>{const Yt=Ve.verticalTextBox;return E.allowVerticalPlacement&&Le>0&&Yt?(vi(Yt),Jn(Yt,m.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),zi(!!(Ut&&Ut.box&&Ut.box.length))}}if(Rn=Ut,We=Rn&&Rn.box&&Rn.box.length>0,et=Rn&&Rn.offscreen,dt=Rn&&Rn.occluded,Re.useRuntimeCollisionCircles){const zi=E.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex>=0?Re.centerJustifiedTextSymbolIndex:Re.verticalPlacedTextSymbolIndex),fi=m.evaluateSizeForFeature(E.textSizeData,oe,zi),Jn=I.get("text-padding");Dn=this.collisionIndex.placeCollisionCircles(E,ce,zi,E.lineVertexArray,E.glyphOffsetArray,fi,O,R,B,v,we,se.predicate,Re.collisionCircleDiameter*fi/m.ONE_EM,Jn,this.retainedQueryData[E.bucketInstanceId].tileID),We=ce||Dn.circles.length>0&&!Dn.collisionDetected,et=et&&Dn.offscreen,dt=Dn.occluded}if(Ve.iconFeatureIndex&&(yi=Ve.iconFeatureIndex),Ve.iconBox){const zi=fi=>{vi(fi);const Jn=xe&&on?gt(on.x,on.y,be,we,this.transform.angle):new m.Point(0,0),Yt=E.getSymbolInstanceIconSize(re,this.transform.zoom,Re.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Yt,fi,Jn,ue,H,O,se.predicate)};Gt&&Gt.box&&Gt.box.length&&Ve.verticalIconBox?(qt=zi(Ve.verticalIconBox),nt=qt.box.length>0):(qt=zi(Ve.iconBox),nt=qt.box.length>0),et=et&&qt.offscreen,Et=qt.occluded}const $r=G||0===Re.numHorizontalGlyphVertices&&0===Le,vs=ne||0===Re.numIconVertices;if($r||vs?vs?$r||(nt=nt&&We):We=nt&&We:nt=We=nt&&We,We&&Rn&&Rn.box&&this.collisionIndex.insertCollisionBox(Rn.box,I.get("text-ignore-placement"),E.bucketInstanceId,Gt&&Gt.box&&_i?_i:Tn,se.ID),nt&&qt&&this.collisionIndex.insertCollisionBox(qt.box,I.get("icon-ignore-placement"),E.bucketInstanceId,yi,se.ID),Dn&&(We&&this.collisionIndex.insertCollisionCircles(Dn.circles,I.get("text-ignore-placement"),E.bucketInstanceId,Tn,se.ID),v)){const zi=E.bucketInstanceId;let fi=this.collisionCircleArrays[zi];void 0===fi&&(fi=this.collisionCircleArrays[zi]=new sc);for(let Jn=0;Jn<Dn.circles.length;Jn+=4)fi.circles.push(Dn.circles[Jn+0]),fi.circles.push(Dn.circles[Jn+1]),fi.circles.push(Dn.circles[Jn+2]),fi.circles.push(Dn.collisionDetected?1:0)}const Hs="globe"!==E.projection.name;Te=Te&&(Hs||!dt),Ne=Ne&&(Hs||!Et),this.placements[lt]=new an(We||Te,nt||Ne,et||E.justReloaded),f.add(lt)};if(Ae){const Re=E.getSortedSymbolIndexes(this.transform.angle);for(let Ze=Re.length-1;Ze>=0;--Ze){const Ve=Re[Ze];ut(E.symbolInstances.get(Ve),Ve,E.collisionArrays[Ve])}}else for(let Re=c.symbolInstanceStart;Re<c.symbolInstanceEnd;Re++)ut(E.symbolInstances.get(Re),Re,E.collisionArrays[Re]);if(v&&E.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[E.bucketInstanceId];m.invert(Re.invProjMatrix,O),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(c,f,v,w){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:R,crossTileID:B}=v,z=m.getAnchorJustification(f),H=w===m.WritingMode.vertical?R:"left"===z?E:"center"===z?I:"right"===z?O:-1;E>=0&&(c.text.placedSymbolArray.get(E).crossTileID=H>=0&&E!==H?0:B),I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=H>=0&&I!==H?0:B),O>=0&&(c.text.placedSymbolArray.get(O).crossTileID=H>=0&&O!==H?0:B),R>=0&&(c.text.placedSymbolArray.get(R).crossTileID=H>=0&&R!==H?0:B)}markUsedOrientation(c,f,v){const w=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,E=f===m.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:B}=v,z=c.text.placedSymbolArray;I>=0&&(z.get(I).placedOrientation=w),O>=0&&(z.get(O).placedOrientation=w),R>=0&&(z.get(R).placedOrientation=w),B>=0&&(z.get(B).placedOrientation=E)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const w=f?f.symbolFadeChange(c):1,E=f?f.opacities:{},I=f?f.variableOffsets:{},O=f?f.placedOrientations:{};for(const R in this.placements){const B=this.placements[R],z=E[R];z?(this.opacities[R]=new Yn(z,w,B.text,B.icon,null,B.clipped),v=v||B.text!==z.text.placed||B.icon!==z.icon.placed):(this.opacities[R]=new Yn(null,w,B.text,B.icon,B.skipFade,B.clipped),v=v||B.text||B.icon)}for(const R in E){const B=E[R];if(!this.opacities[R]){const z=new Yn(B,w,!1,!1);z.isHidden()||(this.opacities[R]=z,v=v||B.text.placed||B.icon.placed)}}for(const R in I)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=I[R]);for(const R in O)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=O[R]);v?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:c)}updateLayerOpacities(c,f){const v=new Set;for(const w of f){const E=w.getBucket(c);E&&w.latestFeatureIndex&&c.id===E.layerIds[0]&&this.updateBucketOpacities(E,v,w.collisionBoxArray)}}updateBucketOpacities(c,f,v){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const w=c.layers[0].layout,E=!!c.layers[0].dynamicFilter(),I=new Yn(null,0,!1,!1,!0),O=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),B=w.get("text-variable-anchor"),z="map"===w.get("text-rotation-alignment"),H="map"===w.get("text-pitch-alignment"),ee="none"!==w.get("icon-text-fit"),ie=new Yn(null,0,O&&(R||!c.hasIconData()||w.get("icon-optional")),R&&(O||!c.hasTextData()||w.get("text-optional")),!0);!c.collisionArrays&&v&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(v);const oe=(se,G,ne)=>{for(let ce=0;ce<G/4;ce++)se.opacityVertexArray.emplaceBack(ne)};let re=0;for(let se=0;se<c.symbolInstances.length;se++){const G=c.symbolInstances.get(se),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:ce,crossTileID:ue,numIconVertices:be}=G,we=f.has(ue);let xe=this.opacities[ue];we?xe=I:xe||(xe=ie,this.opacities[ue]=xe),f.add(ue);const Ae=ne>0||ce>0,Te=be>0,Ne=this.placedOrientations[ue],ut=Ne===m.WritingMode.vertical,Re=Ne===m.WritingMode.horizontal||Ne===m.WritingMode.horizontalOnly;if(!Ae&&!Te||xe.isHidden()||re++,Ae){const Ze=Sd(xe.text);oe(c.text,ne,ut?_r:Ze),oe(c.text,ce,Re?_r:Ze);const Ve=xe.text.isHidden(),{leftJustifiedTextSymbolIndex:lt,centerJustifiedTextSymbolIndex:Le,rightJustifiedTextSymbolIndex:We,verticalPlacedTextSymbolIndex:nt}=G,et=c.text.placedSymbolArray,dt=Ve||ut?1:0;lt>=0&&(et.get(lt).hidden=dt),Le>=0&&(et.get(Le).hidden=dt),We>=0&&(et.get(We).hidden=dt),nt>=0&&(et.get(nt).hidden=Ve||Re?1:0);const Et=this.variableOffsets[ue];Et&&this.markUsedJustification(c,Et.anchor,G,Ne);const on=this.placedOrientations[ue];on&&(this.markUsedJustification(c,"left",G,on),this.markUsedOrientation(c,on,G))}if(Te){const Ze=Sd(xe.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:lt}=G,Le=c.icon.placedSymbolArray,We=xe.icon.isHidden()?1:0;Ve>=0&&(oe(c.icon,be,ut?_r:Ze),Le.get(Ve).hidden=We),lt>=0&&(oe(c.icon,G.numVerticalIconVertices,Re?_r:Ze),Le.get(lt).hidden=We)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Ze=c.collisionArrays[se];if(Ze){let Ve=new m.Point(0,0),lt=!0;if(Ze.textBox||Ze.verticalTextBox){if(B){const We=this.variableOffsets[ue];We?(Ve=du(We.anchor,We.width,We.height,We.textOffset,We.textScale),z&&Ve._rotate(H?this.transform.angle:-this.transform.angle)):lt=!1}E&&(lt=!xe.clipped),Ze.textBox&&ln(c.textCollisionBox.collisionVertexArray,xe.text.placed,!lt||ut,Ve.x,Ve.y),Ze.verticalTextBox&&ln(c.textCollisionBox.collisionVertexArray,xe.text.placed,!lt||Re,Ve.x,Ve.y)}const Le=lt&&!(Re||!Ze.verticalIconBox);Ze.iconBox&&ln(c.iconCollisionBox.collisionVertexArray,xe.icon.placed,Le,ee?Ve.x:0,ee?Ve.y:0),Ze.verticalIconBox&&ln(c.iconCollisionBox.collisionVertexArray,xe.icon.placed,!Le,ee?Ve.x:0,ee?Ve.y:0)}}}if(c.fullyClipped=0===re,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=se.invProjMatrix,c.placementViewportMatrix=se.viewportMatrix,c.collisionCircleArray=se.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>c}setStale(){this.stale=!0}}function ln(g,c,f,v,w){g.emplaceBack(c?1:0,f?1:0,v||0,w||0),g.emplaceBack(c?1:0,f?1:0,v||0,w||0),g.emplaceBack(c?1:0,f?1:0,v||0,w||0),g.emplaceBack(c?1:0,f?1:0,v||0,w||0)}const kn=Math.pow(2,25),gr=Math.pow(2,24),Vg=Math.pow(2,17),zp=Math.pow(2,16),lo=Math.pow(2,9),tr=Math.pow(2,8),tv=Math.pow(2,1);function Sd(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const c=g.placed?1:0,f=Math.floor(127*g.opacity);return f*kn+c*gr+f*Vg+c*zp+f*lo+c*tr+f*tv+c}const _r=0;class Ns{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,f,v,w,E){const I=this._bucketParts;for(;this._currentTileIndex<c.length;)if(f.getBucketParts(I,w,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((O,R)=>O.sortKey-R.sortKey));this._currentPartIndex<I.length;){const O=I[this._currentPartIndex];if(f.placeLayerBucketPart(O,this._seenCrossTileIDs,v,0===O.symbolInstanceStart),this._currentPartIndex++,E())return!0}return!1}}class Ug{constructor(c,f,v,w,E,I,O,R){this.placement=new ac(c,E,I,O,R),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(c,f,v){const w=m.exported.now(),E=()=>{const I=m.exported.now()-w;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=f[c[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=O)&&(!I.maxzoom||I.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new Ns(I)),this._inProgressLayer.continuePlacement(v[I.source],this.placement,this._showCollisionBoxes,I,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const hu=512/m.EXTENT/2;class co{constructor(c,f,v){this.tileID=c,this.bucketInstanceId=v,this.index=new m.KDBush(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=c.canonical.x*m.EXTENT,E=c.canonical.y*m.EXTENT;for(let I=0;I<f.length;I++){const{key:O,crossTileID:R,tileAnchorX:B,tileAnchorY:z}=f.get(I),H=Math.floor((w+B)*hu),ee=Math.floor((E+z)*hu);this.index.add(H,ee),this.keys.push(O),this.crossTileIDs.push(R)}this.index.finish()}findMatches(c,f,v){const w=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=hu/Math.pow(2,f.canonical.z-this.tileID.canonical.z),I=f.canonical.x*m.EXTENT,O=f.canonical.y*m.EXTENT;for(let R=0;R<c.length;R++){const B=c.get(R);if(B.crossTileID)continue;const{key:z,tileAnchorX:H,tileAnchorY:ee}=B,ie=Math.floor((I+H)*E),oe=Math.floor((O+ee)*E),re=this.index.range(ie-w,oe-w,ie+w,oe+w);for(const se of re){const G=this.crossTileIDs[se];if(this.keys[se]===z&&!v.has(G)){v.add(G),B.crossTileID=G;break}}}}}class jg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Bp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const f=Math.round((c-this.lng)/360);if(0!==f)for(const v in this.indexes){const w=this.indexes[v],E={};for(const I in w){const O=w[I];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+f),E[O.tileID.key]=O}this.indexes[v]=E}this.lng=c}addBucket(c,f,v){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let E=0;E<f.symbolInstances.length;E++)f.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const w=this.usedCrossTileIDs[c.overscaledZ];for(const E in this.indexes){const I=this.indexes[E];if(Number(E)>c.overscaledZ)for(const O in I){const R=I[O];R.tileID.isChildOf(c)&&R.findMatches(f.symbolInstances,c,w)}else{const O=I[c.scaledTo(Number(E)).key];O&&O.findMatches(f.symbolInstances,c,w)}}for(let E=0;E<f.symbolInstances.length;E++){const I=f.symbolInstances.get(E);I.crossTileID||(I.crossTileID=v.generate(),w.add(I.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new co(c,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(c,f){for(const v of f.crossTileIDs)this.usedCrossTileIDs[c].delete(v)}removeStaleBuckets(c){let f=!1;for(const v in this.indexes){const w=this.indexes[v];for(const E in w)c[w[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[E]),delete w[E],f=!0)}return f}}class pl{constructor(){this.layerIndexes={},this.crossTileIDs=new jg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,f,v,w){let E=this.layerIndexes[c.id];void 0===E&&(E=this.layerIndexes[c.id]=new Bp);let I=!1;const O={};"globe"!==w.name&&E.handleWrapJump(v);for(const R of f){const B=R.getBucket(c);B&&c.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(R.tileID,B,this.crossTileIDs)&&(I=!0),O[B.bucketInstanceId]=!0)}return E.removeStaleBuckets(O)&&(I=!0),I}pruneUnusedLayers(c){const f={};c.forEach(v=>{f[v]=!0});for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}const ml=(g,c)=>m.emitValidationErrors(g,c&&c.filter(f=>"source.canvas"!==f.identifier)),Vp=m.pick(ii,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),fs=m.pick(ii,["setCenter","setZoom","setBearing","setPitch"]),cn={version:8,layers:[],sources:{}},Id={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ua extends m.Evented{constructor(c,f={}){super(),this.map=c,this.dispatcher=new On(cu(),this),this.imageManager=new ec,this.imageManager.setEventedParent(this),this.glyphManager=new m.GlyphManager(c._requestManager,f.localFontFamily?m.LocalGlyphMode.all:f.localIdeographFontFamily?m.LocalGlyphMode.ideographs:m.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new pl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());const v=this;this._rtlTextPluginCallback=Ua.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(E,I)=>{if(m.triggerPluginCompletionEvent(E),I&&I.every(O=>O))for(const O in v._sourceCaches){const R=v._sourceCaches[O],B=R.getSource().type;"vector"!==B&&"geojson"!==B||R.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const E=this.getSource(w.sourceId);if(E&&E.vectorLayerIds)for(const I in this._layers){const O=this._layers[I];O.source===E.id&&this._validateLayer(O)}})}loadURL(c,f={}){this.fire(new m.Event("dataloading",{dataType:"style"}));const v="boolean"==typeof f.validate?f.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,f.accessToken);const w=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(w,(E,I)=>{this._request=null,E?this.fire(new m.ErrorEvent(E)):I&&this._load(I,v)})}loadJSON(c,f={}){this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.exported.frame(()=>{this._request=null,this._load(c,!1!==f.validate)})}loadEmpty(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(cn,!1)}_updateLayerCount(c,f){const v=f?1:-1;c.is3D()&&(this._num3DLayers+=v),"circle"===c.type&&(this._numCircleLayers+=v),"symbol"===c.type&&(this._numSymbolLayers+=v)}_load(c,f){if(f&&ml(this,m.validateStyle(c)))return;this._loaded=!0,this.stylesheet=m.clone$1(c),this._updateMapProjection();for(const w in c.sources)this.addSource(w,c.sources[w],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const v=la(this.stylesheet.layers);this._order=v.map(w=>w.id),this._layers={},this._serializedLayers={};for(const w of v){const E=m.createStyleLayer(w);E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new qr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(f,v,w){let E,I,O;const R=m.exported.devicePixelRatio>1?"@2x":"";let B=m.getJSON(v.transformRequest(v.normalizeSpriteURL(f,R,".json"),m.ResourceType.SpriteJSON),(ee,ie)=>{B=null,O||(O=ee,E=ie,H())}),z=m.getImage(v.transformRequest(v.normalizeSpriteURL(f,R,".png"),m.ResourceType.SpriteImage),(ee,ie)=>{z=null,O||(O=ee,I=ie,H())});function H(){if(O)w(O);else if(E&&I){const ee=m.exported.getImageData(I),ie={};for(const oe in E){const{width:re,height:se,x:G,y:ne,sdf:ce,pixelRatio:ue,stretchX:be,stretchY:we,content:xe}=E[oe],Ae=new m.RGBAImage({width:re,height:se});m.RGBAImage.copy(ee,Ae,{x:G,y:ne},{x:0,y:0},{width:re,height:se}),ie[oe]={data:Ae,pixelRatio:ue,sdf:ce,stretchX:be,stretchY:we,content:xe}}w(null,ie)}}return{cancel(){B&&(B.cancel(),B=null),z&&(z.cancel(),z=null)}}}(c,this.map._requestManager,(f,v)=>{if(this._spriteRequest=null,f)this.fire(new m.ErrorEvent(f));else if(v)for(const w in v)this.imageManager.addImage(w,v[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new m.Event("data",{dataType:"style"}))})}_validateLayer(c){const f=this.getSource(c.source);if(!f)return;const v=c.sourceLayer;v&&("geojson"===f.type||f.vectorLayerIds&&-1===f.vectorLayerIds.indexOf(v))&&this.fire(new m.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${f.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const f=[];for(const v of c){const w=this._layers[v];"custom"!==w.type&&f.push(w.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():Id[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const f=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(w.length||E.length)&&this._updateWorkerLayers(w,E);for(const I in this._updatedSources){const O=this._updatedSources[I];"reload"===O?this._reloadSource(I):"clear"===O&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const v={};for(const w in this._sourceCaches){const E=this._sourceCaches[w];v[w]=E.used,E.used=!1}for(const w of this._order){const E=this._layers[w];if(E.recalculate(c,this._availableImages),!E.isHidden(c.zoom)){const O=this._getLayerSourceCache(E);O&&(O.used=!0)}const I=this.map.painter;if(I){const O=E.getProgramIds();if(!O)continue;const R=E.getProgramConfiguration(c.zoom);for(const B of O)I.useProgram(B,R)}}for(const w in v){const E=this._sourceCaches[w];v[w]!==E.used&&E.getSource().fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new m.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),ml(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=la(c.layers);const f=function(w,E){if(!w)return[{command:ii.setStyle,args:[E]}];let I=[];try{if(!Je(w.version,E.version))return[{command:ii.setStyle,args:[E]}];Je(w.center,E.center)||I.push({command:ii.setCenter,args:[E.center]}),Je(w.zoom,E.zoom)||I.push({command:ii.setZoom,args:[E.zoom]}),Je(w.bearing,E.bearing)||I.push({command:ii.setBearing,args:[E.bearing]}),Je(w.pitch,E.pitch)||I.push({command:ii.setPitch,args:[E.pitch]}),Je(w.sprite,E.sprite)||I.push({command:ii.setSprite,args:[E.sprite]}),Je(w.glyphs,E.glyphs)||I.push({command:ii.setGlyphs,args:[E.glyphs]}),Je(w.transition,E.transition)||I.push({command:ii.setTransition,args:[E.transition]}),Je(w.light,E.light)||I.push({command:ii.setLight,args:[E.light]}),Je(w.fog,E.fog)||I.push({command:ii.setFog,args:[E.fog]}),Je(w.projection,E.projection)||I.push({command:ii.setProjection,args:[E.projection]});const O={},R=[];!function(H,ee,ie,oe){let re;for(re in ee=ee||{},H=H||{})H.hasOwnProperty(re)&&(ee.hasOwnProperty(re)||ca(re,ie,oe));for(re in ee){if(!ee.hasOwnProperty(re))continue;const se=ee[re];H.hasOwnProperty(re)?Je(H[re],se)||("geojson"===H[re].type&&"geojson"===se.type&&Fp(H,ee,re)?ie.push({command:ii.setGeoJSONSourceData,args:[re,se.data]}):Zo(re,ee,ie,oe)):or(re,ee,ie)}}(w.sources,E.sources,R,O);const B=[];w.layers&&w.layers.forEach(H=>{H.source&&O[H.source]?I.push({command:ii.removeLayer,args:[H.id]}):B.push(H)});let z=w.terrain;z&&O[z.source]&&(I.push({command:ii.setTerrain,args:[void 0]}),z=void 0),I=I.concat(R),Je(z,E.terrain)||I.push({command:ii.setTerrain,args:[E.terrain]}),function(H,ee,ie){ee=ee||[];const oe=(H=H||[]).map(da),re=ee.map(da),se=H.reduce(Dd,{}),G=ee.reduce(Dd,{}),ne=oe.slice(),ce=Object.create(null);let ue,be,we,xe,Ae,Te,Ne;for(ue=0,be=0;ue<oe.length;ue++)we=oe[ue],G.hasOwnProperty(we)?be++:(ie.push({command:ii.removeLayer,args:[we]}),ne.splice(ne.indexOf(we,be),1));for(ue=0,be=0;ue<re.length;ue++)we=re[re.length-1-ue],ne[ne.length-1-ue]!==we&&(se.hasOwnProperty(we)?(ie.push({command:ii.removeLayer,args:[we]}),ne.splice(ne.lastIndexOf(we,ne.length-be),1)):be++,Te=ne[ne.length-ue],ie.push({command:ii.addLayer,args:[G[we],Te]}),ne.splice(ne.length-ue,0,we),ce[we]=!0);for(ue=0;ue<re.length;ue++)if(we=re[ue],xe=se[we],Ae=G[we],!ce[we]&&!Je(xe,Ae))if(Je(xe.source,Ae.source)&&Je(xe["source-layer"],Ae["source-layer"])&&Je(xe.type,Ae.type)){for(Ne in ua(xe.layout,Ae.layout,ie,we,null,ii.setLayoutProperty),ua(xe.paint,Ae.paint,ie,we,null,ii.setPaintProperty),Je(xe.filter,Ae.filter)||ie.push({command:ii.setFilter,args:[we,Ae.filter]}),Je(xe.minzoom,Ae.minzoom)&&Je(xe.maxzoom,Ae.maxzoom)||ie.push({command:ii.setLayerZoomRange,args:[we,Ae.minzoom,Ae.maxzoom]}),xe)xe.hasOwnProperty(Ne)&&"layout"!==Ne&&"paint"!==Ne&&"filter"!==Ne&&"metadata"!==Ne&&"minzoom"!==Ne&&"maxzoom"!==Ne&&(0===Ne.indexOf("paint.")?ua(xe[Ne],Ae[Ne],ie,we,Ne.slice(6),ii.setPaintProperty):Je(xe[Ne],Ae[Ne])||ie.push({command:ii.setLayerProperty,args:[we,Ne,Ae[Ne]]}));for(Ne in Ae)Ae.hasOwnProperty(Ne)&&!xe.hasOwnProperty(Ne)&&"layout"!==Ne&&"paint"!==Ne&&"filter"!==Ne&&"metadata"!==Ne&&"minzoom"!==Ne&&"maxzoom"!==Ne&&(0===Ne.indexOf("paint.")?ua(xe[Ne],Ae[Ne],ie,we,Ne.slice(6),ii.setPaintProperty):Je(xe[Ne],Ae[Ne])||ie.push({command:ii.setLayerProperty,args:[we,Ne,Ae[Ne]]}))}else ie.push({command:ii.removeLayer,args:[we]}),Te=ne[ne.lastIndexOf(we)+1],ie.push({command:ii.addLayer,args:[Ae,Te]})}(B,E.layers,I)}catch(O){console.warn("Unable to compute style diff:",O),I=[{command:ii.setStyle,args:[E]}]}return I}(this.serialize(),c).filter(w=>!(w.command in fs));if(0===f.length)return!1;const v=f.filter(w=>!(w.command in Vp));if(v.length>0)throw new Error(`Unimplemented: ${v.map(w=>w.command).join(", ")}.`);return f.forEach(w=>{"setTransition"!==w.command&&"setProjection"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,f){return this.getImage(c)?this.fire(new m.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,f),this._afterImageUpdated(c),this)}updateImage(c,f){this.imageManager.updateImage(c,f)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new m.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,f,v={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(m.validateSource,`sources.${c}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const w=Mn(c,f,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:w.serialize(),sourceId:c}));const E=I=>{const O=(I?"symbol:":"other:")+c,R=this._sourceCaches[O]=new m.SourceCache(O,w,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[c]=R,R.style=this,R.onAdd(this.map)};E(!1),"vector"!==f.type&&"geojson"!==f.type||E(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const f=this.getSource(c);if(!f)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===c)return this.fire(new m.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new m.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(c);for(const w of v)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,f){this._checkLoaded(),this.getSource(c).setData(f),this._changed=!0}getSource(c){const f=this._getSourceCache(c);return f&&f.getSource()}_getSources(){const c=[];for(const f in this._otherSourceCaches){const v=this._getSourceCache(f);v&&c.push(v.getSource())}return c}addLayer(c,f,v={}){this._checkLoaded();const w=c.id;if(this.getLayer(w))return void this.fire(new m.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let E;if("custom"===c.type){if(ml(this,m.validateCustomStyleLayer(c)))return;E=m.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateLayer,`layers.${w}`,c,{arrayIndex:-1},v))return;E=m.createStyleLayer(c),this._validateLayer(E),E.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}const I=f?this._order.indexOf(f):this._order.length;if(f&&-1===I)return void this.fire(new m.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(I,0,w),this._layerOrderChanged=!0,this._layers[w]=E;const O=this._getLayerSourceCache(E);if(this._removedLayers[w]&&E.source&&O&&"custom"!==E.type){const R=this._removedLayers[w];delete this._removedLayers[w],R.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",O.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,f){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===f)return;const v=this._order.indexOf(c);this._order.splice(v,1);const w=f?this._order.indexOf(f):this._order.length;f&&-1===w?this.fire(new m.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(w,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const f=this._layers[c];if(!f)return void this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const v=this._order.indexOf(c);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=f,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const f in this._layers)if(this._layers[f].type===c)return!0;return!1}setLayerZoomRange(c,f,v){this._checkLoaded();const w=this.getLayer(c);w?w.minzoom===f&&w.maxzoom===v||(null!=f&&(w.minzoom=f),null!=v&&(w.maxzoom=v),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,f,v={}){this._checkLoaded();const w=this.getLayer(c);if(w){if(!Je(w.filter,f))return null==f?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateFilter,`layers.${w.id}.filter`,f,{layerType:w.type},v)||(w.filter=m.clone$1(f),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const f=this.getLayer(c);return f&&m.clone$1(f.filter)}setLayoutProperty(c,f,v,w={}){this._checkLoaded();const E=this.getLayer(c);E?Je(E.getLayoutProperty(f),v)||(E.setLayoutProperty(f,v,w),this._updateLayer(E)):this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,f){const v=this.getLayer(c);if(v)return v.getLayoutProperty(f);this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,f,v,w={}){this._checkLoaded();const E=this.getLayer(c);E?Je(E.getPaintProperty(f),v)||(E.setPaintProperty(f,v,w)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,f){const v=this.getLayer(c);return v&&v.getPaintProperty(f)}setFeatureState(c,f){this._checkLoaded();const v=c.source,w=c.sourceLayer,E=this.getSource(v);if(!E)return void this.fire(new m.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const I=E.type;if("geojson"===I&&w)return void this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!w)return void this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided.")));const O=this._getSourceCaches(v);for(const R of O)R.setFeatureState(w,c.id,f)}removeFeatureState(c,f){this._checkLoaded();const v=c.source,w=this.getSource(v);if(!w)return void this.fire(new m.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const E=w.type,I="vector"===E?c.sourceLayer:void 0;if("vector"===E&&!I)return void this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const O=this._getSourceCaches(v);for(const R of O)R.removeFeatureState(I,c.id,f)}getFeatureState(c){this._checkLoaded();const f=c.source,v=c.sourceLayer,w=this.getSource(f);if(w){if("vector"!==w.type||v)return void 0===c.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(v,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const f in this._sourceCaches){const v=this._sourceCaches[f].getSource();c[v.id]||(c[v.id]=v.serialize())}return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},f=>void 0!==f)}_updateLayer(c){this._updatedLayers[c.id]=!0;const f=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&f&&"raster"!==f.getSource().type&&(this._updatedSources[c.source]="reload",f.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const f=I=>"fill-extrusion"===this._layers[I].type,v={},w=[];for(let I=this._order.length-1;I>=0;I--){const O=this._order[I];if(f(O)){v[O]=I;for(const R of c){const B=R[O];if(B)for(const z of B)w.push(z)}}}w.sort((I,O)=>O.intersectionZ-I.intersectionZ);const E=[];for(let I=this._order.length-1;I>=0;I--){const O=this._order[I];if(f(O))for(let R=w.length-1;R>=0;R--){const B=w[R].feature;if(v[B.layer.id]<I)break;E.push(B),w.pop()}else for(const R of c){const B=R[O];if(B)for(const z of B)E.push(z.feature)}}return E}queryRenderedFeatures(c,f,v){f&&f.filter&&this._validate(m.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const w={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of f.layers){const B=this._layers[R];if(!B)return this.fire(new m.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];w[B.source]=!0}}const E=[];f.availableImages=this._availableImages;const I=f&&f.layers?f.layers.some(R=>{const B=this.getLayer(R);return B&&B.is3D()}):this.has3DLayers(),O=cl.createFromScreenPoints(c,v);for(const R in this._sourceCaches){const B=this._sourceCaches[R].getSource().id;f.layers&&!w[B]||E.push(Ui(this._sourceCaches[R],this._layers,this._serializedLayers,O,f,v,I,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(R,B,z,H,ee,ie,oe){const re={},se=ie.queryRenderedSymbols(H),G=[];for(const ne of Object.keys(se).map(Number))G.push(oe[ne]);G.sort(so);for(const ne of G){const ce=ne.featureIndex.lookupSymbolFeatures(se[ne.bucketInstanceId],B,ne.bucketIndex,ne.sourceLayerIndex,ee.filter,ee.layers,ee.availableImages,R);for(const ue in ce){const be=re[ue]=re[ue]||[],we=ce[ue];we.sort((xe,Ae)=>{const Te=ne.featureSortOrder;if(Te){const Ne=Te.indexOf(xe.featureIndex);return Te.indexOf(Ae.featureIndex)-Ne}return Ae.featureIndex-xe.featureIndex});for(const xe of we)be.push(xe)}}for(const ne in re)re[ne].forEach(ce=>{const ue=ce.feature,be=z(R[ne]);if(!be)return;const we=be.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=we});return re}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),O.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(c,f){f&&f.filter&&this._validate(m.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const v=this._getSourceCaches(c);let w=[];for(const E of v)w=w.concat(Xn(E,f));return w}addSourceType(c,f,v){return Ua.getSourceType(c)?v(new Error(`A source type called "${c}" already exists.`)):(Ua.setSourceType(c,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:f.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(c,f={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const I in c)if(!Je(c[I],v[I])){w=!0;break}if(!w)return;const E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,f),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,f=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=c;if(1===f){if("object"==typeof v.source){const w="terrain-dem-src";this.addSource(w,v.source),v=m.clone$1(v),v=m.extend(v,{source:w})}if(this._validate(m.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,f)}else{const w=this.terrain,E=w.get();for(const I of Object.keys(m.spec.terrain))!v.hasOwnProperty(I)&&m.spec.terrain[I].default&&(v[I]=m.spec.terrain[I].default);for(const I in v)if(!Je(v[I],E[I])){w.set(v),this.stylesheet.terrain=v;const O=this._setTransitionParameters({duration:0});w.updateTransitions(O);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const f=this.fog=new nc(c,this.map.transform);this.stylesheet.fog=c;const v=this._setTransitionParameters({duration:0});f.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,v=f.get();0===Object.keys(c).length&&f.set(c);for(const w in c)if(!Je(c[w],v[w])){f.set(c),this.stylesheet.fog=c;const E=this._setTransitionParameters({duration:0});f.updateTransitions(E);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:m.exported.now(),transition:m.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(v=>this.isLayerDraped(this._layers[v])),f=this._order.filter(v=>!this.isLayerDraped(this._layers[v]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...f)}_createTerrain(c,f){const v=this.terrain=new Kh(c,f);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w=this._setTransitionParameters({duration:0});v.updateTransitions(w)}_force3DLayerUpdate(){for(const c in this._layers){const f=this._layers[c];"fill-extrusion"===f.type&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const f=this._layers[c];"symbol"===f.type&&this._updateLayer(f)}}_validate(c,f,v,w,E={}){return(!E||!1!==E.validate)&&ml(this,c.call(m.validateStyle,m.extend({key:f,style:this.serialize(),value:v,styleSpec:m.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const f=this._getSourceCaches(c);for(const v of f)v.clearTiles()}_reloadSource(c){const f=this._getSourceCaches(c);for(const v of f)v.resume(),v.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const f in this._sourceCaches)this._sourceCaches[f].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const f=this._sourceCaches[c];f.resume(),f.reload()}}_updatePlacement(c,f,v,w,E=!1){let I=!1,O=!1;const R={};for(const B of this._order){const z=this._layers[B];if("symbol"!==z.type)continue;if(!R[z.source]){const ee=this._getLayerSourceCache(z);if(!ee)continue;R[z.source]=ee.getRenderableIds(!0).map(ie=>ee.getTileByID(ie)).sort((ie,oe)=>oe.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(oe.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(z,R[z.source],c.center.lng,c.projection);I=I||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new m.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.exported.now(),c.zoom))&&(this.pauseablePlacement=new Ug(c,this._order,E,f,v,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.exported.now()),O=!0),I&&this.pauseablePlacement.placement.setStale()),O||I)for(const B of this._order){const z=this._layers[B];"symbol"===z.type&&this.placement.updateLayerOpacities(z,R[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,f,v){this.imageManager.getImages(f.icons,v),this._updateTilesForChangedImages();const w=E=>{E&&E.setDependencies(f.tileID.key,f.type,f.icons)};w(this._otherSourceCaches[f.source]),w(this._symbolSourceCaches[f.source])}getGlyphs(c,f,v){this.glyphManager.getGlyphs(f.stacks,v)}getResource(c,f,v){return m.makeRequest(f,v)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const f=[];return this._otherSourceCaches[c]&&f.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&f.push(this._symbolSourceCaches[c]),f}_isSourceCacheLoaded(c){const f=this._getSourceCaches(c);return 0===f.length?(this.fire(new m.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):f.every(v=>v.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ua.getSourceType=function(g){return pn[g]},Ua.setSourceType=function(g,c){pn[g]=c},Ua.registerForPluginStateChange=m.registerForPluginStateChange;var $g="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Bt="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",gl="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",qi="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",ps="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let rf={},lc={};const Ad=[];fu($g,Ad),fu(gl,Ad),fu(qi,Ad),fu(ps,Ad),rf=Zt("",gl),lc=Zt(ps,qi);const Pd=Zt("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),cc=$g,Od="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var sf={background:Zt("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Zt("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Zt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Zt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Zt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Zt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Zt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Zt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Zt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Zt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Zt("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Zt("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Zt("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Zt("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Zt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Zt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Zt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Zt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Zt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Zt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Zt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Zt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Zt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Zt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Bt),skyboxGradient:Zt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Bt),skyboxCapture:Zt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Zt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Zt("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function fu(g,c){const f=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let v of f)if(v=v.trim(),"#"===v[0]&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=v.split(" ");for(const E of w)c.includes(E)||c.push(E)}}function Zt(g,c){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w={},E=[...Ad];return fu(g,E),fu(c,E),{fragmentSource:g=g.replace(f,(I,O,R,B,z)=>(w[z]=!0,"define"===O?`\n#ifndef HAS_UNIFORM_u_${z}\nvarying ${R} ${B} ${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = u_${z};\n#endif\n`)),vertexSource:c=c.replace(f,(I,O,R,B,z)=>{const H="float"===B?"vec2":"vec4",ee=z.match(/color/)?"color":H;return w[z]?"define"===O?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${R} ${H} a_${z};\nvarying ${R} ${B} ${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = a_${z};\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = unpack_mix_${ee}(a_${z}, u_${z}_t);\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:"define"===O?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${R} ${H} a_${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = a_${z};\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = unpack_mix_${ee}(a_${z}, u_${z}_t);\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`}),staticAttributes:v,usedDefines:E}}class Up{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,f,v,w,E,I,O){this.context=c;let R=this.boundPaintVertexBuffers.length!==w.length;for(let z=0;!R&&z<w.length;z++)this.boundPaintVertexBuffers[z]!==w[z]&&(R=!0);let B=this.boundDynamicVertexBuffers.length!==O.length;for(let z=0;!B&&z<O.length;z++)this.boundDynamicVertexBuffers[z]!==O[z]&&(B=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||R||B||this.boundIndexBuffer!==E||this.boundVertexOffset!==I)this.freshBind(f,v,w,E,I,O);else{c.bindVertexArrayOES.set(this.vao);for(const z of O)z&&z.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(c,f,v,w,E,I){let O;const R=c.numAttributes,B=this.context,z=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=c,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=I;else{O=B.currentNumAttributes||0;for(let H=R;H<O;H++)z.disableVertexAttribArray(H)}f.enableAttributes(z,c),f.bind(),f.setVertexAttribPointers(z,c,E);for(const H of v)H.enableAttributes(z,c),H.bind(),H.setVertexAttribPointers(z,c,E);for(const H of I)H&&(H.enableAttributes(z,c),H.bind(),H.setVertexAttribPointers(z,c,E));w&&w.bind(),B.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function af(g,c){const f=Math.pow(2,c.canonical.z),v=c.canonical.y;return[new m.MercatorCoordinate(0,v/f).toLngLat().lat,new m.MercatorCoordinate(0,(v+1)/f).toLngLat().lat]}function wo(g,c,f,v,w,E,I){const O=g.context,R=O.gl,B=f.fbo;if(!B)return;g.prepareDrawTile();const z=g.useProgram("hillshade");O.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,B.colorAttachment.get());const H=((re,se,G,ne)=>{const ce=G.paint.get("hillshade-shadow-color"),ue=G.paint.get("hillshade-highlight-color"),be=G.paint.get("hillshade-accent-color");let we=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===G.paint.get("hillshade-illumination-anchor")&&(we-=re.transform.angle);const xe=!re.options.moving;return{u_matrix:ne||re.transform.calculateProjMatrix(se.tileID.toUnwrapped(),xe),u_image:0,u_latrange:af(0,se.tileID),u_light:[G.paint.get("hillshade-exaggeration"),we],u_shadow:ce,u_highlight:ue,u_accent:be}})(g,f,v,g.terrain?c.projMatrix:null);g.prepareDrawProgram(O,z,c.toUnwrapped());const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:ie,tileBoundsSegments:oe}=g.getTileBoundsBuffers(f);z.draw(O,R.TRIANGLES,w,E,I,m.CullFaceMode.disabled,H,v.id,ee,ie,oe)}function lf(g,c,f){if(!c.needsDEMTextureUpload)return;const v=g.context,w=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(f.stride);const E=f.getPixels();c.demTexture?c.demTexture.update(E,{premultiply:!1}):c.demTexture=new m.Texture(v,E,w.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function nv(g,c,f,v,w,E){const I=g.context,O=I.gl;if(!c.dem)return;const R=c.dem;if(I.activeTexture.set(O.TEXTURE1),lf(g,c,R),!c.demTexture)return;c.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE);const B=R.dim;I.activeTexture.set(O.TEXTURE0);let z=c.fbo;if(!z){const oe=new m.Texture(I,{width:B,height:B,data:null},O.RGBA);oe.bind(O.LINEAR,O.CLAMP_TO_EDGE),z=c.fbo=I.createFramebuffer(B,B,!0),z.colorAttachment.set(oe.texture)}I.bindFramebuffer.set(z.framebuffer),I.viewport.set([0,0,B,B]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:ee,tileBoundsSegments:ie}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(I,O.TRIANGLES,v,w,E,m.CullFaceMode.disabled,((oe,re)=>{const se=re.stride,G=m.create();return m.ortho(G,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(G,G,[0,-m.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[se,se],u_zoom:oe.overscaledZ,u_unpack:re.unpackVector}})(c.tileID,R),f.id,H,ee,ie),c.needsHillshadePrepare=!1}const gi=g=>({u_matrix:new m.UniformMatrix4f(g),u_image0:new m.Uniform1i(g),u_skirt_height:new m.Uniform1f(g)}),kd=(g,c)=>({u_matrix:g,u_image0:0,u_skirt_height:c}),jp=(g,c,f,v,w,E,I,O,R,B,z,H,ee,ie,oe)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:f,u_zoom_transition:w,u_merc_center:E,u_image0:0,u_frustum_tl:I,u_frustum_tr:O,u_frustum_br:R,u_frustum_bl:B,u_globe_pos:z,u_globe_radius:H,u_viewport:ee,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:ie});function _l(g,c){return null!=g&&null!=c&&!(!g.hasData()||!c.hasData())&&null!=g.demTexture&&null!=c.demTexture&&g.tileID.key!==c.tileID.key}const zs=new class{constructor(){this.operations={}}newMorphing(g,c,f,v,w){if(g in this.operations){const E=this.operations[g];E.to.tileID.key!==f.tileID.key&&(E.queued=f)}else this.operations[g]={startTime:v,phase:0,duration:w,from:c,to:f,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const f=this.operations[c];for(f.phase=(g-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},yl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function pu(g){return 6*Math.pow(1.5,22-g)}function Hg(g,c){const f=1<<g.z;return!c&&(0===g.x||g.x===f-1)||0===g.y||g.y===f-1}const uc=g=>({u_matrix:g});function Gg(g,c,f,v,w){if(w>0){const E=m.exported.now(),I=(E-g.timeAdded)/w,O=c?(E-c.timeAdded)/w:-1,R=f.getSource(),B=v.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),z=!c||Math.abs(c.tileID.overscaledZ-B)>Math.abs(g.tileID.overscaledZ-B),H=z&&g.refreshedUponExpiration?1:m.clamp(z?I:1-O,0,1);return g.refreshedUponExpiration&&I>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class qg extends m.SourceCache{constructor(c){const f={type:"raster-dem",maxzoom:c.transform.maxZoom},v=new On(cu(),null),w=Mn("mock-dem",f,v,c.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,f){c.state="loaded",f(null)}}class $p extends m.SourceCache{constructor(c){const f=Mn("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new On(cu(),null),c.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,f,v){if(c.freezeTileCoverage)return;this.transform=c;const w=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,I)=>{if(E[I.key]="",!this._tiles[I.key]){const O=new m.Tile(I,this._source.tileSize*I.overscaleFactor(),c.tileZoom);O.state="loaded",this._tiles[I.key]=O}return E},{});for(const E in this._tiles)E in w||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(c){const f=this.proxyCachedFBO[c];if(void 0!==f){const v=Object.values(f);this.renderCachePool.push(...v),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Hp extends m.OverscaledTileID{constructor(c,f,v){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=f,this.projMatrix=v}}class Wg extends m.Elevation{constructor(c,f){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,w,E]=function(R){const B=new m.StructArrayLayout2i4,z=new m.StructArrayLayout3ui6,H=131;B.reserve(17161),z.reserve(33800);const ee=m.EXTENT/128,ie=m.EXTENT+ee/2,oe=ie+ee;for(let se=-ee;se<oe;se+=ee)for(let G=-ee;G<oe;G+=ee){const ne=G<0||G>ie||se<0||se>ie?24575:0,ce=m.clamp(Math.round(G),0,m.EXTENT),ue=m.clamp(Math.round(se),0,m.EXTENT);B.emplaceBack(ce+ne,ue)}const re=(se,G)=>{const ne=G*H+se;z.emplaceBack(ne+1,ne,ne+H),z.emplaceBack(ne+H,ne+H+1,ne+1)};for(let se=1;se<129;se++)for(let G=1;G<129;G++)re(G,se);return[0,129].forEach(se=>{for(let G=0;G<130;G++)re(G,se),re(se,G)}),[B,z,32768]}(),I=c.context;this.gridBuffer=I.createVertexBuffer(v,m.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(w),this.gridSegments=m.SegmentVector.simpleSegment(0,0,v.length,w.length),this.gridNoSkirtSegments=m.SegmentVector.simpleSegment(0,0,v.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new $p(f.map),this.orthoMatrix=m.create(),m.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,m.EXTENT,0,m.EXTENT,0,1);const O=I.gl;this._overlapStencilMode=new m.StencilMode({func:O.GEQUAL,mask:255},0,255,O.KEEP,O.KEEP,O.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new qg(f.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,f,v){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const w=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const E=()=>{this.sourceCache.used&&m.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(f,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),f.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&m.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(m.MercatorCoordinate.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=f.getIds().map(R=>{const B=f.getTileByID(R).tileID;return B.projMatrix=v.calculateProjMatrix(B.toUnwrapped()),B});(function(R,B){const z=B.transform.pointCoordinate(B.transform.getCameraPoint()),H=new m.Point(z.x,z.y);R.sort((ee,ie)=>{if(ie.overscaledZ-ee.overscaledZ)return ie.overscaledZ-ee.overscaledZ;const oe=new m.Point(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),re=new m.Point(ie.canonical.x+(1<<ie.canonical.z)*ie.wrap,ie.canonical.y),se=H.mult(1<<ee.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(oe)-se.distSqr(re)})})(w,this.painter),this._previousZoom=v.zoom;const E=this.proxyToSource||{};this.proxyToSource={},w.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const R in I){const B=I[R];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,c[R],E),B.usedForTerrain))continue;const z=c[R];B.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[f.id]=w.map(R=>new Hp(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=m.exported.now();const O={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const B=this.terrainTileForTile[R.key];if(!B)continue;const z=B.tileID.key;z in O||(this._visibleDemTiles.push(B),O[z]=z)}}_assignTerrainTiles(c){this._initializing||c.forEach(f=>{if(this.terrainTileForTile[f.key])return;const v=this._findTileCoveringTileID(f,this.sourceCache);v&&(this.terrainTileForTile[f.key]=v)})}_prepareDEMTextures(){const c=this.painter.context,f=c.gl;for(const v in this.terrainTileForTile){const w=this.terrainTileForTile[v],E=w.dem;!E||w.demTexture&&!w.needsDEMTextureUpload||(c.activeTexture.set(f.TEXTURE1),lf(this.painter,w,E))}}_prepareDemTileUniforms(c,f,v,w){if(!f||null==f.demTexture)return!1;const E=c.tileID.canonical,I=Math.pow(2,f.tileID.canonical.z-E.z),O=w||"";return v[`u_dem_tl${O}`]=[E.x*I%1,E.y*I%1],v[`u_dem_scale${O}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,f=c.gl;if(!this._emptyDepthBufferTexture){const v=new m.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new m.Texture(c,v,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const f=this._visibleDemTiles.reduce((v,w)=>{if(!w.dem)return v;const E=w.dem.tree.minimums[0];return E>0&&c++,v+E},0);return c?f/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,f=c.gl;c.activeTexture.set(f.TEXTURE2);const v=this._getLoadedAreaMinimum(),w=new m.RGBAImage({width:1,height:1},new Uint8Array(m.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(w,{premultiply:!1}):E=this._emptyDEMTexture=new m.Texture(c,w,f.RGBA,{premultiply:!1}),E}setupElevationDraw(c,f,v){const w=this.painter.context,E=w.gl,I=(O=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:m.DEMData.getUnpackVector(O),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var O;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let R=null,B=null,z=1;if(v&&v.morphing&&this._useVertexMorphing){const H=v.morphing.srcDemTile,ee=v.morphing.dstDemTile;z=v.morphing.phase,H&&ee&&(this._prepareDemTileUniforms(c,H,I,"_prev")&&(B=H),this._prepareDemTileUniforms(c,ee,I)&&(R=ee))}if(B&&R?(w.activeTexture.set(E.TEXTURE2),R.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),w.activeTexture.set(E.TEXTURE4),B.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),I.u_dem_lerp=z):(R=this.terrainTileForTile[c.tileID.key],w.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(c,R,I)?R.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),w.activeTexture.set(E.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&R){const H=(1<<R.tileID.canonical.z)*m.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=H}if(v&&v.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),f.setTerrainUniformValues(w,I),"globe"===this.painter.transform.projection.name){const H=this.globeUniformValues(this.painter.transform,c.tileID.canonical,v&&v.useDenormalizedUpVectorScale);f.setGlobeUniformValues(w,H)}}globeUniformValues(c,f,v){const w=c.projection;return{u_tile_tl_up:w.upVector(f,0,0),u_tile_tr_up:w.upVector(f,m.EXTENT,0),u_tile_br_up:w.upVector(f,m.EXTENT,m.EXTENT),u_tile_bl_up:w.upVector(f,0,m.EXTENT),u_tile_up_scale:v?m.globeMetersToEcef(1):w.upVectorScale(f,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const f=this.painter,v=this.painter.context;0!==c.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,E,I,O,R){if("globe"===w.transform.projection.name)!function(B,z,H,ee,ie){const oe=B.context,re=oe.gl;let se,G;const ne=B.options.showTerrainWireframe?2:0,ce=B.transform,ue=m.globeUseCustomAntiAliasing(B,oe,ce),be=(lt,Le)=>{if(G===lt)return;const We=[yl[lt],"PROJECTION_GLOBE_VIEW"];ue&&We.push("CUSTOM_ANTIALIASING"),Le&&We.push(yl[ne]),se=B.useProgram("globeRaster",null,We),G=lt},we=B.colorModeForRenderPass(),xe=new m.DepthMode(re.LEQUAL,m.DepthMode.ReadWrite,B.depthRangeFor3D);zs.update(ie);const Ae=m.calculateGlobeMercatorMatrix(ce),Te=[m.mercatorXfromLng(ce.center.lng),m.mercatorYfromLat(ce.center.lat)],Ne=ne?[!1,!0]:[!1],ut=B.globeSharedBuffers,Re=[ce.width*m.exported.devicePixelRatio,ce.height*m.exported.devicePixelRatio],Ze=Float32Array.from(ce.globeMatrix),Ve={useDenormalizedUpVectorScale:!0};if(Ne.forEach(lt=>{const Le=B.transform,We=pu(Le.zoom)*z.exaggeration();G=-1;const nt=lt?re.LINES:re.TRIANGLES;for(const et of ee){const dt=H.getTile(et),Et=m.StencilMode.disabled,on=z.prevTerrainTileForTile[et.key],Ut=z.terrainTileForTile[et.key];_l(on,Ut)&&zs.newMorphing(et.key,on,Ut,ie,250),oe.activeTexture.set(re.TEXTURE0),dt.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);const Gt=zs.getMorphValuesForProxy(et.key),Rn=Gt?1:0;Gt&&m.extend$1(Ve,{morphing:{srcDemTile:Gt.from,dstDemTile:Gt.to,phase:m.easeCubicInOut(Gt.phase)}});const Dn=m.tileCornersToBounds(et.canonical),qt=m.getLatitudinalLod(Dn.getCenter().lat),Tn=m.getGridMatrix(et.canonical,Dn,qt,Le.worldSize/Le._pixelsPerMercatorPixel),_i=m.globeNormalizeECEF(m.globeTileBounds(et.canonical)),yi=jp(Le.projMatrix,Ze,Ae,_i,m.globeToMercatorTransition(Le.zoom),Te,Le.frustumCorners.TL,Le.frustumCorners.TR,Le.frustumCorners.BR,Le.frustumCorners.BL,Le.globeCenterInViewSpace,Le.globeRadius,Re,We,Tn);if(be(Rn,lt),z.setupElevationDraw(dt,se,Ve),B.prepareDrawProgram(oe,se,et.toUnwrapped()),ut){const[vi,lr,$r]=lt?ut.getWirefameBuffers(B.context,qt):ut.getGridBuffers(qt,0!==We);se.draw(oe,nt,xe,Et,we,m.CullFaceMode.backCCW,yi,"globe_raster",vi,lr,$r)}}}),ut){const lt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&lt.push("CUSTOM_ANTIALIASING"),se=B.useProgram("globeRaster",null,lt);for(const Le of ee){const{x:We,y:nt,z:et}=Le.canonical,dt=0===nt,Et=nt===(1<<et)-1,[on,Ut,Gt,Rn]=ut.getPoleBuffers(et);if(Rn&&(dt||Et)){const Dn=H.getTile(Le);oe.activeTexture.set(re.TEXTURE0),Dn.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);let qt=m.globePoleMatrixForTile(et,We,ce);const Tn=m.globeNormalizeECEF(m.globeTileBounds(Le.canonical)),_i=(yi,vi)=>yi.draw(oe,re.TRIANGLES,xe,m.StencilMode.disabled,we,m.CullFaceMode.disabled,jp(ce.projMatrix,qt,qt,Tn,0,Te,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Re,0),"globe_pole_raster",vi,Gt,Rn);z.setupElevationDraw(Dn,se,Ve),B.prepareDrawProgram(oe,se,Le.toUnwrapped()),dt&&_i(se,on),Et&&(qt=m.scale(m.create(),qt,[1,-1,1]),_i(se,Ut))}}}}(w,E,I,O,R);else{const B=w.context,z=B.gl;let H,ee;const ie=w.options.showTerrainWireframe?2:0,oe=(ce,ue)=>{if(ee===ce)return;const be=[yl[ce]];ue&&be.push(yl[ie]),H=w.useProgram("terrainRaster",null,be),ee=ce},re=w.colorModeForRenderPass(),se=new m.DepthMode(z.LEQUAL,m.DepthMode.ReadWrite,w.depthRangeFor3D);zs.update(R);const G=w.transform,ne=pu(G.zoom)*E.exaggeration();(ie?[!1,!0]:[!1]).forEach(ce=>{ee=-1;const ue=ce?z.LINES:z.TRIANGLES,[be,we]=ce?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(const xe of O){const Ae=I.getTile(xe),Te=m.StencilMode.disabled,Ne=E.prevTerrainTileForTile[xe.key],ut=E.terrainTileForTile[xe.key];_l(Ne,ut)&&zs.newMorphing(xe.key,Ne,ut,R,250),B.activeTexture.set(z.TEXTURE0),Ae.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Re=zs.getMorphValuesForProxy(xe.key),Ze=Re?1:0;let Ve;Re&&(Ve={morphing:{srcDemTile:Re.from,dstDemTile:Re.to,phase:m.easeCubicInOut(Re.phase)}});const lt=kd(xe.projMatrix,Hg(xe.canonical,G.renderWorldCopies)?ne/10:ne);oe(Ze,ce),E.setupElevationDraw(Ae,H,Ve),w.prepareDrawProgram(B,H,xe.toUnwrapped()),H.draw(B,ue,se,Te,re,m.CullFaceMode.backCCW,lt,"terrain_raster",E.gridBuffer,be,we)}})}}(f,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const f=this.painter,v=this.painter.context,w=this.proxySourceCache,E=this.proxiedCoords[w.id],I=this._drapedRenderBatches.shift(),O=[],R=f.style.order;let B=0;for(const z of E){const H=w.getTileByID(z.proxyTileKey),ee=w.proxyCachedFBO[z.key]?w.proxyCachedFBO[z.key][c]:void 0,ie=void 0!==ee?w.renderCache[ee]:this.pool[B++],oe=void 0!==ee;if(H.texture=ie.tex,oe&&!ie.dirty){O.push(H.tileID);continue}let re;v.bindFramebuffer.set(ie.fb.framebuffer),this.renderedToTile=!1,ie.dirty&&(v.clear({color:m.Color.transparent,stencil:0}),ie.dirty=!1);for(let se=I.start;se<=I.end;++se){const G=f.style._layers[R[se]];if(G.isHidden(f.transform.zoom))continue;const ne=f.style._getLayerSourceCache(G),ce=ne?this.proxyToSource[z.key][ne.id]:[z];if(!ce)continue;const ue=ce;v.viewport.set([0,0,ie.fb.width,ie.fb.height]),re!==(ne?ne.id:null)&&(this._setupStencil(ie,ce,G,ne),re=ne?ne.id:null),f.renderLayer(f,ne,G,ue)}this.renderedToTile?(ie.dirty=!0,O.push(H.tileID)):oe||--B,5===B&&(B=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),I.end+1}postRender(){}renderCacheEfficiency(c){const f=c.order.length;if(0===f)return{efficiency:100};let v,w=0,E=0,I=!1;for(let O=0;O<f;++O){const R=c._layers[c.order[O]];this._style.isLayerDraped(R)?(I&&++w,++E):I||(I=!0,v=R.id)}return 0===E?{efficiency:100}:{efficiency:100*(1-w/E),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{c=Math.min(c,f.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,f,v){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const I=E.tileID,O=1<<I.overscaledZ,{x:R,y:B}=I.canonical,z=R/O,H=(R+1)/O,ee=B/O,ie=(B+1)/O;return{minx:z,miny:ee,maxx:H,maxy:ie,t:E.dem.tree.raycastRoot(z,ee,H,ie,c,f,v),tile:E}});w.sort((E,I)=>(null!==E.t?E.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const E of w){if(null==E.t)return null;const I=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,c,f,v);if(null!=I)return I}return null}_createFBO(){const c=this.painter.context,f=c.gl,v=this.drapeBufferSize;c.activeTexture.set(f.TEXTURE0);const w=new m.Texture(c,{width:v[0],height:v[1],data:null},f.RGBA);w.bind(f.LINEAR,f.CLAMP_TO_EDGE);const E=c.createFramebuffer(v[0],v[1],!1);return E.colorAttachment.set(w.texture),E.depthAttachment=new De(c,E.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:E,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const f=this._style._layers[c],v=f.isHidden(this.painter.transform.zoom);return"custom"===f.type?!v&&f.shouldRedrape():!v&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const v of this._style._getSources())if(v instanceof xt){c=!0;break}if(!c)return;const f={};for(let v=0;v<this._style.order.length;++v){const w=this._style._layers[this._style.order[v]],E=this._style._getLayerSourceCache(w);if(E&&!f[E.id]&&!w.isHidden(this.painter.transform.zoom)&&"line"===w.type&&w.widthExpression()instanceof m.ZoomDependentExpression){f[E.id]=!0;for(const I of this.proxyCoords){const O=this.proxyToSource[I.key][E.id];if(O)for(const R of O)this._clearRenderCacheForTile(E.id,R)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof ht){c=!0;break}if(!c)return;const f={};for(let v=0;v<this._style.order.length;++v){const w=this._style._layers[this._style.order[v]],E=this._style._getLayerSourceCache(w);if(!E||f[E.id]||w.isHidden(this.painter.transform.zoom)||"raster"!==w.type)continue;const I=w.paint.get("raster-fade-duration");for(const O of this.proxyCoords){const R=this.proxyToSource[O.key][E.id];if(R)for(const B of R){const z=Gg(E.getTile(B),E.findLoadedParent(B,0),E,this.painter.transform,I);(1!==z.opacity||0!==z.mix)&&this._clearRenderCacheForTile(E.id,B)}}}}_setupDrapedRenderBatches(){const c=this._style.order,f=c.length;if(0===f)return;const v=[];let w,E=0,I=this._style._layers[c[E]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++E<f;)I=this._style._layers[c[E]];for(;E<f;++E){const O=this._style._layers[c[E]];O.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(O)?void 0===w&&(w=E):void 0!==w&&(v.push({start:w,end:E-1}),w=void 0))}void 0!==w&&v.push({start:w,end:E-1}),this._drapedRenderBatches=v}_setupRenderCache(c){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const I=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let O=0;O<I.length;++O){const R=Object.values(I[O]);f.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,w=this._tilesDirty;for(let I=v.length-1;I>=0;I--){const O=v[I];if(f.getTileByID(O.key),void 0!==f.proxyCachedFBO[O.key]){const R=c[O.key],B=this.proxyToSource[O.key];let z=0;for(const H in B){const ee=B[H],ie=R[H];if(!ie||ie.length!==ee.length||ee.some((oe,re)=>oe!==ie[re]||w[H]&&w[H].hasOwnProperty(oe.key))){z=-1;break}++z}for(const H in f.proxyCachedFBO[O.key])f.renderCache[f.proxyCachedFBO[O.key][H]].dirty=z<0||z!==Object.values(R).length}}const E=[...this._drapedRenderBatches];E.sort((I,O)=>O.end-O.start-(I.end-I.start));for(const I of E)for(const O of v){if(f.proxyCachedFBO[O.key])continue;let R=f.renderCachePool.pop();void 0===R&&f.renderCache.length<50&&(R=f.renderCache.length,f.renderCache.push(this._createFBO())),void 0!==R&&(f.proxyCachedFBO[O.key]={},f.proxyCachedFBO[O.key][I.start]=R,f.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(c,f,v,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,I=E.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let O;if(v.isTileClipped())O=f.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);O=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+O>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=O,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):m.StencilMode.disabled}_renderTileClippingMasks(c,f){const v=this.painter,w=this.painter.context,E=w.gl;v._tileClippingMaskIDs={},w.setColorMode(m.ColorMode.disabled),w.setDepthMode(m.DepthMode.disabled);const I=v.useProgram("clippingMask");for(const O of c){const R=v._tileClippingMaskIDs[O.key]=--f;I.draw(w,E.TRIANGLES,m.DepthMode.disabled,new m.StencilMode({func:E.ALWAYS,mask:0},R,255,E.KEEP,E.KEEP,E.REPLACE),m.ColorMode.disabled,m.CullFaceMode.disabled,uc(O.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(c){const f=this.painter.transform;if(c.x<0||c.x>f.width||c.y<0||c.y>f.height)return null;const v=[c.x,c.y,1,1];m.transformMat4$1(v,v,f.pixelMatrixInverse),m.scale$1(v,v,1/v[3]),v[0]/=f.worldSize,v[1]/=f.worldSize;const w=f._camera.position,E=m.mercatorZfromAltitude(1,f.center.lat),I=[w[0],w[1],w[2]/E,0],O=m.subtract([],v.slice(0,3),I);m.normalize(O,O);const R=this.raycast(I,O,this._exaggeration);return null!==R&&R?(m.scaleAndAdd(I,I,O,R),I[3]=I[2],I[2]*=E,I):null}drawDepth(){const c=this.painter,f=c.context,v=this.proxySourceCache,w=Math.ceil(c.width),E=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=f.gl,O=f.createFramebuffer(w,E,!0);f.activeTexture.set(I.TEXTURE0);const R=new m.Texture(f,{width:w,height:E,data:null},I.RGBA);R.bind(I.NEAREST,I.CLAMP_TO_EDGE),O.colorAttachment.set(R.texture);const B=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,w,E);O.depthAttachment.set(B),this._depthFBO=O,this._depthTexture=R}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,w,E]),function(I,O,R,B){if("globe"===I.transform.projection.name)return;const z=I.context,H=z.gl;z.clear({depth:1});const ee=I.useProgram("terrainDepth"),ie=new m.DepthMode(H.LESS,m.DepthMode.ReadWrite,I.depthRangeFor3D);for(const oe of B){const re=R.getTile(oe),se=kd(oe.projMatrix,0);O.setupElevationDraw(re,ee),ee.draw(z,H.TRIANGLES,ie,m.StencilMode.disabled,m.ColorMode.unblended,m.CullFaceMode.backCCW,se,"terrain_depth",O.gridBuffer,O.gridIndexBuffer,O.gridNoSkirtSegments)}}(c,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,f,v){if(c.getSource()instanceof Sn)return this._setupProxiedCoordsForImageSource(c,f,v);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const w=this.proxiedCoords[c.id]=[],E=this.proxyCoords;for(let O=0;O<E.length;O++){const R=E[O],B=this._findTileCoveringTileID(R,c);if(B){const z=this._createProxiedId(R,B,v[R.key]&&v[R.key][c.id]);w.push(z),this.proxyToSource[R.key][c.id]=[z]}}let I=!1;for(let O=0;O<f.length;O++){const R=c.getTile(f[O]);if(!R||!R.hasData())continue;const B=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==R.tileID.canonical.z){const z=this.proxyToSource[B.tileID.key][c.id],H=this._createProxiedId(B.tileID,R,v[B.tileID.key]&&v[B.tileID.key][c.id]);z?z.splice(z.length-1,0,H):this.proxyToSource[B.tileID.key][c.id]=[H],w.push(H),I=!0}}this._sourceTilesOverlap[c.id]=I}_setupProxiedCoordsForImageSource(c,f,v){if(!c.getSource().loaded())return;const w=this.proxiedCoords[c.id]=[],E=this.proxyCoords,I=c.getSource(),O=new m.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),R=I.coordinates.map(m.MercatorCoordinate.fromLngLat).reduce((z,H)=>(z.min.x=Math.min(z.min.x,H.x-O.x),z.min.y=Math.min(z.min.y,H.y-O.y),z.max.x=Math.max(z.max.x,H.x-O.x),z.max.y=Math.max(z.max.y,H.y-O.y),z),{min:new m.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new m.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(z,H)=>{const ee=z.wrap+z.canonical.x/(1<<z.canonical.z),ie=z.canonical.y/(1<<z.canonical.z),oe=m.EXTENT/(1<<z.canonical.z),re=H.wrap+H.canonical.x/(1<<H.canonical.z),se=H.canonical.y/(1<<H.canonical.z);return ee+oe<re+R.min.x||ee>re+R.max.x||ie+oe<se+R.min.y||ie>se+R.max.y};for(let z=0;z<E.length;z++){const H=E[z];for(let ee=0;ee<f.length;ee++){const ie=c.getTile(f[ee]);if(!ie||!ie.hasData()||B(H,ie.tileID))continue;const oe=this._createProxiedId(H,ie,v[H.key]&&v[H.key][c.id]),re=this.proxyToSource[H.key][c.id];re?re.push(oe):this.proxyToSource[H.key][c.id]=[oe],w.push(oe)}}}_createProxiedId(c,f,v){let w=this.orthoMatrix;if(v){const E=v.find(I=>I.key===f.tileID.key);if(E)return E}if(f.tileID.key!==c.key){const E=c.canonical.z-f.tileID.canonical.z;let I,O,R;w=m.create();const B=f.tileID.wrap-c.wrap<<c.overscaledZ;E>0?(I=m.EXTENT>>E,O=I*((f.tileID.canonical.x<<E)-c.canonical.x+B),R=I*((f.tileID.canonical.y<<E)-c.canonical.y)):(I=m.EXTENT<<-E,O=m.EXTENT*(f.tileID.canonical.x-(c.canonical.x+B<<-E)),R=m.EXTENT*(f.tileID.canonical.y-(c.canonical.y<<-E))),m.ortho(w,0,I,0,I,0,1),m.translate(w,w,[O,R,0])}return new Hp(f.tileID,c.key,w)}_findTileCoveringTileID(c,f){let v=f.getTile(c);if(v&&v.hasData())return v;const w=this._findCoveringTileCache[f.id],E=w[c.key];if(v=E?f.getTileByID(E):null,v&&v.hasData()||null===E)return v;let I=v?v.tileID:c,O=I.overscaledZ;const R=f.getSource().minzoom,B=[];if(!E){const H=f.getSource().maxzoom;if(c.canonical.z>=H){const ee=c.canonical.z-H;f.getSource().reparseOverscaled?(O=Math.max(c.canonical.z+2,f.transform.tileZoom),I=new m.OverscaledTileID(O,c.wrap,H,c.canonical.x>>ee,c.canonical.y>>ee)):0!==ee&&(O=H,I=new m.OverscaledTileID(O,c.wrap,H,c.canonical.x>>ee,c.canonical.y>>ee))}I.key!==c.key&&(B.push(I.key),v=f.getTile(I))}const z=H=>{B.forEach(ee=>{w[ee]=H}),B.length=0};for(O-=1;O>=R&&(!v||!v.hasData());O--){v&&z(v.tileID.key);const H=I.calculateScaledKey(O);if(v=f.getTileByID(H),v&&v.hasData())break;const ee=w[H];if(null===ee)break;void 0===ee?B.push(H):v=f.getTileByID(ee)}return z(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,f){let v=this._tilesDirty[c];v||(v=this._tilesDirty[c]={}),v[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(f){let v=0;const w=new m.StructArrayLayout2ui4,E=131;for(let I=1;I<129;I++){for(let O=1;O<129;O++)v=I*E+O,w.emplaceBack(v,v+1),w.emplaceBack(v,v+E),w.emplaceBack(v+1,v+E),128===I&&w.emplaceBack(v+E,v+E+1);w.emplaceBack(v+1,v+1+E)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=m.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Nn{static cacheKey(c,f,v,w){let E=`${f}${w?w.cacheKey:""}`;for(const I of v)c.usedDefines.includes(I)&&(E+=`/${I}`);return E}constructor(c,f,v,w,E,I){const O=c.gl;this.program=O.createProgram();const R=function(G){const ne=[];for(let ce=0;ce<G.length;ce++){if(null===G[ce])continue;const ue=G[ce].split(" ");ne.push(ue.pop())}return ne}(v.staticAttributes),B=w?w.getBinderAttributes():[],z=R.concat(B);let H=w?w.defines():[];H=H.concat(I.map(G=>`#define ${G}`));const ee=c.isWebGL2?"#version 300 es\n":"",ie=ee+H.concat(c.extStandardDerivatives&&0===ee.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Od):Od,Od,cc,Pd.fragmentSource,lc.fragmentSource,v.fragmentSource).join("\n"),oe=ee+H.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",cc,Pd.vertexSource,lc.vertexSource,rf.vertexSource,v.vertexSource).join("\n"),re=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);O.shaderSource(re,ie),O.compileShader(re),O.attachShader(this.program,re);const se=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())this.failedToCreate=!0;else{O.shaderSource(se,oe),O.compileShader(se),O.attachShader(this.program,se),this.attributes={},this.numAttributes=z.length;for(let G=0;G<this.numAttributes;G++)z[G]&&(O.bindAttribLocation(this.program,G,z[G]),this.attributes[z[G]]=G);O.linkProgram(this.program),O.deleteShader(se),O.deleteShader(re),this.fixedUniforms=E(c),this.binderUniforms=w?w.getUniforms(c):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new m.Uniform1i(G=c),u_dem_prev:new m.Uniform1i(G),u_dem_unpack:new m.Uniform4f(G),u_dem_tl:new m.Uniform2f(G),u_dem_scale:new m.Uniform1f(G),u_dem_tl_prev:new m.Uniform2f(G),u_dem_scale_prev:new m.Uniform1f(G),u_dem_size:new m.Uniform1f(G),u_dem_lerp:new m.Uniform1f(G),u_exaggeration:new m.Uniform1f(G),u_depth:new m.Uniform1i(G),u_depth_size_inv:new m.Uniform2f(G),u_meter_to_dem:new m.Uniform1f(G),u_label_plane_matrix_inv:new m.UniformMatrix4f(G)}),I.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new m.Uniform3f(G),u_tile_tr_up:new m.Uniform3f(G),u_tile_br_up:new m.Uniform3f(G),u_tile_bl_up:new m.Uniform3f(G),u_tile_up_scale:new m.Uniform1f(G)}))(c)),I.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new m.UniformMatrix4f(G),u_fog_range:new m.Uniform2f(G),u_fog_color:new m.Uniform4f(G),u_fog_horizon_blend:new m.Uniform1f(G),u_fog_temporal_offset:new m.Uniform1f(G),u_frustum_tl:new m.Uniform3f(G),u_frustum_tr:new m.Uniform3f(G),u_frustum_br:new m.Uniform3f(G),u_frustum_bl:new m.Uniform3f(G),u_globe_pos:new m.Uniform3f(G),u_globe_radius:new m.Uniform1f(G),u_globe_transition:new m.Uniform1f(G),u_is_globe:new m.Uniform1i(G),u_viewport:new m.Uniform2f(G)}))(c))}var G}setTerrainUniformValues(c,f){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w]&&v[w].set(this.program,w,f[w])}}setGlobeUniformValues(c,f){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w]&&v[w].set(this.program,w,f[w])}}setFogUniformValues(c,f){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w].set(this.program,w,f[w])}}draw(c,f,v,w,E,I,O,R,B,z,H,ee,ie,oe,re){const se=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(v),c.setStencilMode(w),c.setColorMode(E),c.setCullFace(I);for(const ne of Object.keys(this.fixedUniforms))this.fixedUniforms[ne].set(this.program,ne,O[ne]);oe&&oe.setUniforms(this.program,c,this.binderUniforms,ee,{zoom:ie});const G={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[f];for(const ne of H.get()){const ce=ne.vaos||(ne.vaos={});(ce[R]||(ce[R]=new Up)).bind(c,this,B,oe?oe.getPaintVertexBuffers():[],z,ne.vertexOffset,re||[]),se.drawElements(f,ne.primitiveLength*G,se.UNSIGNED_SHORT,ne.primitiveOffset*G*2)}}}function dc(g,c){const f=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,g.transform.tileZoom)/f,w=v*(c.tileID.canonical.x+c.tileID.wrap*f),E=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/jr(c,1,g.transform.tileZoom),u_pixel_coord_upper:[w>>16,E>>16],u_pixel_coord_lower:[65535&w,65535&E]}}const Rd=m.create(),Gp=(g,c,f,v,w,E,I,O,R,B,z)=>{const H=c.style.light,ee=H.properties.get("position"),ie=[ee.x,ee.y,ee.z],oe=m.create$1();"viewport"===H.properties.get("anchor")&&(m.fromRotation(oe,-c.transform.angle),m.transformMat3(ie,ie,oe));const re=H.properties.get("color"),se=c.transform,G={u_matrix:g,u_lightpos:ie,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[re.r,re.g,re.b],u_vertical_gradient:+f,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Rd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:E};return"globe"===se.projection.name&&(G.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],G.u_zoom_transition=R,G.u_inv_rot_matrix=z,G.u_merc_center=B,G.u_up_dir=se.projection.upVector(new m.CanonicalTileID(0,0,0),B[0]*m.EXTENT,B[1]*m.EXTENT),G.u_height_lift=O),G},Zg=(g,c,f,v,w,E,I,O,R,B,z,H)=>{const ee=Gp(g,c,f,v,w,E,I,R,B,z,H),ie={u_height_factor:-Math.pow(2,I.overscaledZ)/O.tileSize/8};return m.extend(ee,dc(c,O),ie)},hc=g=>({u_matrix:g}),cf=(g,c,f)=>m.extend(hc(g),dc(c,f)),mu=(g,c)=>({u_matrix:g,u_world:c}),iv=(g,c,f,v)=>m.extend(cf(g,c,f),{u_world:v}),vl=m.create(),qp=(g,c,f,v,w,E)=>{const I=g.transform,O="globe"===I.projection.name;let R;if("map"===E.paint.get("circle-pitch-alignment"))if(O){const z=m.globePixelsToTileUnits(I.zoom,c.canonical)*I._pixelsPerMercatorPixel;R=Float32Array.from([z,0,0,z])}else R=I.calculatePixelsToTileUnitsMatrix(f);else R=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const B={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:g.translatePosMatrix(c.projMatrix,f,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:m.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:vl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){B.u_inv_rot_matrix=v,B.u_merc_center=w,B.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],B.u_zoom_transition=m.globeToMercatorTransition(I.zoom);const z=w[0]*m.EXTENT,H=w[1]*m.EXTENT;B.u_up_dir=I.projection.upVector(new m.CanonicalTileID(0,0,0),z,H)}return B},st=g=>{const c=[];return"map"===g.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},uf=(g,c,f,v)=>{const w=m.EXTENT/f.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(v),u_extrude_scale:[c.pixelsToGLUnits[0]/w,c.pixelsToGLUnits[1]/w]}},Vt=(g,c,f=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:f}),Ld=m.create(),df=(g,c,f,v,w,E,I)=>{const O=g.transform,R="globe"===O.projection.name,B=R?m.globePixelsToTileUnits(O.zoom,c.canonical)*O._pixelsPerMercatorPixel:jr(f,1,E),z={u_matrix:c.projMatrix,u_extrude_scale:B,u_intensity:I,u_inv_rot_matrix:Ld,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){z.u_inv_rot_matrix=v,z.u_merc_center=w,z.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],z.u_zoom_transition=m.globeToMercatorTransition(O.zoom);const H=w[0]*m.EXTENT,ee=w[1]*m.EXTENT;z.u_up_dir=O.projection.upVector(new m.CanonicalTileID(0,0,0),H,ee)}return z},Fd=(g,c,f,v,w,E,I)=>{const O=g.transform,R=O.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:Wp(g,c,f,v),u_pixels_to_tile_units:R,u_device_pixel_ratio:E,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:Yo(f)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:gu(c,g.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},Nd=(g,c,f,v,w)=>{const E=g.transform;return{u_matrix:Wp(g,c,f,v),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:w,u_image:0,u_tile_units_to_pixels:gu(c,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function gu(g,c){return 1/jr(g,1,c.tileZoom)}function Wp(g,c,f,v){return g.translatePosMatrix(v||c.tileID.projMatrix,c,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function Yo(g){const c=g.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const _u=(g,c,f,v,w,E)=>{return{u_matrix:g,u_tl_parent:c,u_scale_parent:f,u_fade_t:v.mix,u_opacity:v.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(O=w.paint.get("raster-saturation"),O>0?1-1/(1.001-O):-O),u_contrast_factor:(I=w.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Nr(w.paint.get("raster-hue-rotate")),u_perspective_transform:E};var I,O};function Nr(g){g*=Math.PI/180;const c=Math.sin(g),f=Math.cos(g);return[(2*f+1)/3,(-Math.sqrt(3)*c-f+1)/3,(Math.sqrt(3)*c-f+1)/3]}const Ko=m.create(),ri=(g,c,f,v,w,E,I,O,R,B,z,H,ee,ie,oe,re)=>{const se=w.transform,G={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:se.width/se.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:I,u_coord_matrix:O,u_is_text:+R,u_pitch_with_map:+v,u_texsize:B,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ko,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ko,u_up_vector:[0,-1,0]};return"globe"===re.name&&(G.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],G.u_zoom_transition=H,G.u_inv_rot_matrix=ie,G.u_merc_center=ee,G.u_camera_forward=se._camera.forward(),G.u_ecef_origin=m.globeECEFOrigin(se.globeMatrix,z.toUnwrapped()),G.u_tile_matrix=Float32Array.from(se.globeMatrix),G.u_up_vector=oe),G},fc=(g,c,f,v,w,E,I,O,R,B,z,H,ee,ie,oe,re,se)=>m.extend(ri(g,c,f,v,w,E,I,O,R,B,H,ee,ie,oe,re,se),{u_gamma_scale:v?w.transform.cameraToCenterDistance*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:m.exported.devicePixelRatio,u_is_halo:+z}),hf=(g,c,f,v,w,E,I,O,R,B,z,H,ee,ie,oe,re)=>m.extend(fc(g,c,f,v,w,E,I,O,!0,R,!0,z,H,ee,ie,oe,re),{u_texsize_icon:B,u_texture_icon:1}),yu=(g,c,f)=>({u_matrix:g,u_opacity:c,u_color:f}),Xg=(g,c,f,v,w)=>m.extend(function(E,I,O){const R=I.imageManager.getPattern(E.toString()),{width:B,height:z}=I.imageManager.getPixelSize(),H=Math.pow(2,O.tileID.overscaledZ),ee=O.tileSize*Math.pow(2,I.transform.tileZoom)/H,ie=ee*(O.tileID.canonical.x+O.tileID.wrap*H),oe=ee*O.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[B,z],u_pattern_size:R.displaySize,u_tile_units_to_pixels:1/jr(O,1,I.transform.tileZoom),u_pixel_coord_upper:[ie>>16,oe>>16],u_pixel_coord_lower:[65535&ie,65535&oe]}}(v,f,w),{u_matrix:g,u_opacity:c}),Bs={fillExtrusion:g=>({u_matrix:new m.UniformMatrix4f(g),u_lightpos:new m.Uniform3f(g),u_lightintensity:new m.Uniform1f(g),u_lightcolor:new m.Uniform3f(g),u_vertical_gradient:new m.Uniform1f(g),u_opacity:new m.Uniform1f(g),u_edge_radius:new m.Uniform1f(g),u_ao:new m.Uniform2f(g),u_tile_id:new m.Uniform3f(g),u_zoom_transition:new m.Uniform1f(g),u_inv_rot_matrix:new m.UniformMatrix4f(g),u_merc_center:new m.Uniform2f(g),u_up_dir:new m.Uniform3f(g),u_height_lift:new m.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new m.UniformMatrix4f(g),u_lightpos:new m.Uniform3f(g),u_lightintensity:new m.Uniform1f(g),u_lightcolor:new m.Uniform3f(g),u_vertical_gradient:new m.Uniform1f(g),u_height_factor:new m.Uniform1f(g),u_edge_radius:new m.Uniform1f(g),u_ao:new m.Uniform2f(g),u_tile_id:new m.Uniform3f(g),u_zoom_transition:new m.Uniform1f(g),u_inv_rot_matrix:new m.UniformMatrix4f(g),u_merc_center:new m.Uniform2f(g),u_up_dir:new m.Uniform3f(g),u_height_lift:new m.Uniform1f(g),u_image:new m.Uniform1i(g),u_texsize:new m.Uniform2f(g),u_pixel_coord_upper:new m.Uniform2f(g),u_pixel_coord_lower:new m.Uniform2f(g),u_tile_units_to_pixels:new m.Uniform1f(g),u_opacity:new m.Uniform1f(g)}),fill:g=>({u_matrix:new m.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new m.UniformMatrix4f(g),u_image:new m.Uniform1i(g),u_texsize:new m.Uniform2f(g),u_pixel_coord_upper:new m.Uniform2f(g),u_pixel_coord_lower:new m.Uniform2f(g),u_tile_units_to_pixels:new m.Uniform1f(g)}),fillOutline:g=>({u_matrix:new m.UniformMatrix4f(g),u_world:new m.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new m.UniformMatrix4f(g),u_world:new m.Uniform2f(g),u_image:new m.Uniform1i(g),u_texsize:new m.Uniform2f(g),u_pixel_coord_upper:new m.Uniform2f(g),u_pixel_coord_lower:new m.Uniform2f(g),u_tile_units_to_pixels:new m.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new m.Uniform1f(g),u_extrude_scale:new m.UniformMatrix2f(g),u_device_pixel_ratio:new m.Uniform1f(g),u_matrix:new m.UniformMatrix4f(g),u_inv_rot_matrix:new m.UniformMatrix4f(g),u_merc_center:new m.Uniform2f(g),u_tile_id:new m.Uniform3f(g),u_zoom_transition:new m.Uniform1f(g),u_up_dir:new m.Uniform3f(g)}),collisionBox:g=>({u_matrix:new m.UniformMatrix4f(g),u_camera_to_center_distance:new m.Uniform1f(g),u_extrude_scale:new m.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new m.UniformMatrix4f(g),u_inv_matrix:new m.UniformMatrix4f(g),u_camera_to_center_distance:new m.Uniform1f(g),u_viewport_size:new m.Uniform2f(g)}),debug:g=>({u_color:new m.UniformColor(g),u_matrix:new m.UniformMatrix4f(g),u_overlay:new m.Uniform1i(g),u_overlay_scale:new m.Uniform1f(g)}),clippingMask:g=>({u_matrix:new m.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new m.Uniform1f(g),u_intensity:new m.Uniform1f(g),u_matrix:new m.UniformMatrix4f(g),u_inv_rot_matrix:new m.UniformMatrix4f(g),u_merc_center:new m.Uniform2f(g),u_tile_id:new m.Uniform3f(g),u_zoom_transition:new m.Uniform1f(g),u_up_dir:new m.Uniform3f(g)}),heatmapTexture:g=>({u_image:new m.Uniform1i(g),u_color_ramp:new m.Uniform1i(g),u_opacity:new m.Uniform1f(g)}),hillshade:g=>({u_matrix:new m.UniformMatrix4f(g),u_image:new m.Uniform1i(g),u_latrange:new m.Uniform2f(g),u_light:new m.Uniform2f(g),u_shadow:new m.UniformColor(g),u_highlight:new m.UniformColor(g),u_accent:new m.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new m.UniformMatrix4f(g),u_image:new m.Uniform1i(g),u_dimension:new m.Uniform2f(g),u_zoom:new m.Uniform1f(g),u_unpack:new m.Uniform4f(g)}),line:g=>({u_matrix:new m.UniformMatrix4f(g),u_pixels_to_tile_units:new m.UniformMatrix2f(g),u_device_pixel_ratio:new m.Uniform1f(g),u_units_to_pixels:new m.Uniform2f(g),u_dash_image:new m.Uniform1i(g),u_gradient_image:new m.Uniform1i(g),u_image_height:new m.Uniform1f(g),u_texsize:new m.Uniform2f(g),u_tile_units_to_pixels:new m.Uniform1f(g),u_alpha_discard_threshold:new m.Uniform1f(g),u_trim_offset:new m.Uniform2f(g)}),linePattern:g=>({u_matrix:new m.UniformMatrix4f(g),u_texsize:new m.Uniform2f(g),u_pixels_to_tile_units:new m.UniformMatrix2f(g),u_device_pixel_ratio:new m.Uniform1f(g),u_image:new m.Uniform1i(g),u_units_to_pixels:new m.Uniform2f(g),u_tile_units_to_pixels:new m.Uniform1f(g),u_alpha_discard_threshold:new m.Uniform1f(g)}),raster:g=>({u_matrix:new m.UniformMatrix4f(g),u_tl_parent:new m.Uniform2f(g),u_scale_parent:new m.Uniform1f(g),u_fade_t:new m.Uniform1f(g),u_opacity:new m.Uniform1f(g),u_image0:new m.Uniform1i(g),u_image1:new m.Uniform1i(g),u_brightness_low:new m.Uniform1f(g),u_brightness_high:new m.Uniform1f(g),u_saturation_factor:new m.Uniform1f(g),u_contrast_factor:new m.Uniform1f(g),u_spin_weights:new m.Uniform3f(g),u_perspective_transform:new m.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new m.Uniform1i(g),u_is_size_feature_constant:new m.Uniform1i(g),u_size_t:new m.Uniform1f(g),u_size:new m.Uniform1f(g),u_camera_to_center_distance:new m.Uniform1f(g),u_rotate_symbol:new m.Uniform1i(g),u_aspect_ratio:new m.Uniform1f(g),u_fade_change:new m.Uniform1f(g),u_matrix:new m.UniformMatrix4f(g),u_label_plane_matrix:new m.UniformMatrix4f(g),u_coord_matrix:new m.UniformMatrix4f(g),u_is_text:new m.Uniform1i(g),u_pitch_with_map:new m.Uniform1i(g),u_texsize:new m.Uniform2f(g),u_tile_id:new m.Uniform3f(g),u_zoom_transition:new m.Uniform1f(g),u_inv_rot_matrix:new m.UniformMatrix4f(g),u_merc_center:new m.Uniform2f(g),u_camera_forward:new m.Uniform3f(g),u_tile_matrix:new m.UniformMatrix4f(g),u_up_vector:new m.Uniform3f(g),u_ecef_origin:new m.Uniform3f(g),u_texture:new m.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new m.Uniform1i(g),u_is_size_feature_constant:new m.Uniform1i(g),u_size_t:new m.Uniform1f(g),u_size:new m.Uniform1f(g),u_camera_to_center_distance:new m.Uniform1f(g),u_rotate_symbol:new m.Uniform1i(g),u_aspect_ratio:new m.Uniform1f(g),u_fade_change:new m.Uniform1f(g),u_matrix:new m.UniformMatrix4f(g),u_label_plane_matrix:new m.UniformMatrix4f(g),u_coord_matrix:new m.UniformMatrix4f(g),u_is_text:new m.Uniform1i(g),u_pitch_with_map:new m.Uniform1i(g),u_texsize:new m.Uniform2f(g),u_texture:new m.Uniform1i(g),u_gamma_scale:new m.Uniform1f(g),u_device_pixel_ratio:new m.Uniform1f(g),u_tile_id:new m.Uniform3f(g),u_zoom_transition:new m.Uniform1f(g),u_inv_rot_matrix:new m.UniformMatrix4f(g),u_merc_center:new m.Uniform2f(g),u_camera_forward:new m.Uniform3f(g),u_tile_matrix:new m.UniformMatrix4f(g),u_up_vector:new m.Uniform3f(g),u_ecef_origin:new m.Uniform3f(g),u_is_halo:new m.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new m.Uniform1i(g),u_is_size_feature_constant:new m.Uniform1i(g),u_size_t:new m.Uniform1f(g),u_size:new m.Uniform1f(g),u_camera_to_center_distance:new m.Uniform1f(g),u_rotate_symbol:new m.Uniform1i(g),u_aspect_ratio:new m.Uniform1f(g),u_fade_change:new m.Uniform1f(g),u_matrix:new m.UniformMatrix4f(g),u_label_plane_matrix:new m.UniformMatrix4f(g),u_coord_matrix:new m.UniformMatrix4f(g),u_is_text:new m.Uniform1i(g),u_pitch_with_map:new m.Uniform1i(g),u_texsize:new m.Uniform2f(g),u_texsize_icon:new m.Uniform2f(g),u_texture:new m.Uniform1i(g),u_texture_icon:new m.Uniform1i(g),u_gamma_scale:new m.Uniform1f(g),u_device_pixel_ratio:new m.Uniform1f(g),u_is_halo:new m.Uniform1i(g)}),background:g=>({u_matrix:new m.UniformMatrix4f(g),u_opacity:new m.Uniform1f(g),u_color:new m.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new m.UniformMatrix4f(g),u_opacity:new m.Uniform1f(g),u_image:new m.Uniform1i(g),u_pattern_tl:new m.Uniform2f(g),u_pattern_br:new m.Uniform2f(g),u_texsize:new m.Uniform2f(g),u_pattern_size:new m.Uniform2f(g),u_pixel_coord_upper:new m.Uniform2f(g),u_pixel_coord_lower:new m.Uniform2f(g),u_tile_units_to_pixels:new m.Uniform1f(g)}),terrainRaster:gi,terrainDepth:gi,skybox:g=>({u_matrix:new m.UniformMatrix4f(g),u_sun_direction:new m.Uniform3f(g),u_cubemap:new m.Uniform1i(g),u_opacity:new m.Uniform1f(g),u_temporal_offset:new m.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new m.UniformMatrix4f(g),u_color_ramp:new m.Uniform1i(g),u_center_direction:new m.Uniform3f(g),u_radius:new m.Uniform1f(g),u_opacity:new m.Uniform1f(g),u_temporal_offset:new m.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new m.UniformMatrix3f(g),u_sun_direction:new m.Uniform3f(g),u_sun_intensity:new m.Uniform1f(g),u_color_tint_r:new m.Uniform4f(g),u_color_tint_m:new m.Uniform4f(g),u_luminance:new m.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new m.UniformMatrix4f(g),u_globe_matrix:new m.UniformMatrix4f(g),u_normalize_matrix:new m.UniformMatrix4f(g),u_merc_matrix:new m.UniformMatrix4f(g),u_zoom_transition:new m.Uniform1f(g),u_merc_center:new m.Uniform2f(g),u_image0:new m.Uniform1i(g),u_grid_matrix:new m.UniformMatrix3f(g),u_skirt_height:new m.Uniform1f(g),u_frustum_tl:new m.Uniform3f(g),u_frustum_tr:new m.Uniform3f(g),u_frustum_br:new m.Uniform3f(g),u_frustum_bl:new m.Uniform3f(g),u_globe_pos:new m.Uniform3f(g),u_globe_radius:new m.Uniform1f(g),u_viewport:new m.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new m.Uniform3f(g),u_frustum_tr:new m.Uniform3f(g),u_frustum_br:new m.Uniform3f(g),u_frustum_bl:new m.Uniform3f(g),u_horizon:new m.Uniform1f(g),u_transition:new m.Uniform1f(g),u_fadeout_range:new m.Uniform1f(g),u_color:new m.Uniform4f(g),u_high_color:new m.Uniform4f(g),u_space_color:new m.Uniform4f(g),u_star_intensity:new m.Uniform1f(g),u_star_density:new m.Uniform1f(g),u_star_size:new m.Uniform1f(g),u_temporal_offset:new m.Uniform1f(g),u_horizon_angle:new m.Uniform1f(g),u_rotation_matrix:new m.UniformMatrix4f(g)})};let bl;function vu(g,c,f,v,w,E,I){const O=g.context,R=O.gl,B=g.transform,z=g.useProgram("collisionBox"),H=[];let ee=0,ie=0;for(let ue=0;ue<v.length;ue++){const be=v[ue],we=c.getTile(be),xe=we.getBucket(f);if(!xe)continue;const Ae=mi(be,xe,B);let Te=Ae;0===w[0]&&0===w[1]||(Te=g.translatePosMatrix(Ae,we,w,E));const Ne=I?xe.textCollisionBox:xe.iconCollisionBox,ut=xe.collisionCircleArray;if(ut.length>0){const Re=m.create(),Ze=Te;m.mul(Re,xe.placementInvProjMatrix,B.glCoordMatrix),m.mul(Re,Re,xe.placementViewportMatrix),H.push({circleArray:ut,circleOffset:ie,transform:Ze,invTransform:Re,projection:xe.getProjection()}),ee+=ut.length/4,ie=ee}Ne&&(g.terrain&&g.terrain.setupElevationDraw(we,z),z.draw(O,R.LINES,m.DepthMode.disabled,m.StencilMode.disabled,g.colorModeForRenderPass(),m.CullFaceMode.disabled,uf(Te,B,we,xe.getProjection()),f.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,null,B.zoom,null,[Ne.collisionVertexBuffer,Ne.collisionVertexBufferExt]))}if(!I||!H.length)return;const oe=g.useProgram("collisionCircle"),re=new m.StructArrayLayout2f1f2i16;re.resize(4*ee),re._trim();let se=0;for(const ue of H)for(let be=0;be<ue.circleArray.length/4;be++){const we=4*be,xe=ue.circleArray[we+0],Ae=ue.circleArray[we+1],Te=ue.circleArray[we+2],Ne=ue.circleArray[we+3];re.emplace(se++,xe,Ae,Te,Ne,0),re.emplace(se++,xe,Ae,Te,Ne,1),re.emplace(se++,xe,Ae,Te,Ne,2),re.emplace(se++,xe,Ae,Te,Ne,3)}(!bl||bl.length<2*ee)&&(bl=function(ue){const be=2*ue,we=new m.StructArrayLayout3ui6;we.resize(be),we._trim();for(let xe=0;xe<be;xe++){const Ae=6*xe;we.uint16[Ae+0]=4*xe+0,we.uint16[Ae+1]=4*xe+1,we.uint16[Ae+2]=4*xe+2,we.uint16[Ae+3]=4*xe+2,we.uint16[Ae+4]=4*xe+3,we.uint16[Ae+5]=4*xe+0}return we}(ee));const G=O.createIndexBuffer(bl,!0),ne=O.createVertexBuffer(re,m.collisionCircleLayout.members,!0);for(const ue of H){const be={u_matrix:ue.transform,u_inv_matrix:ue.invTransform,u_camera_to_center_distance:(ce=B).getCameraToCenterDistance(ue.projection),u_viewport_size:[ce.width,ce.height]};oe.draw(O,R.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,g.colorModeForRenderPass(),m.CullFaceMode.disabled,be,f.id,ne,G,m.SegmentVector.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,B.zoom)}var ce;ne.destroy(),G.destroy()}const Zp=m.create();function zd({width:g,height:c,anchor:f,textOffset:v,textScale:w},E){const{horizontalAlign:I,verticalAlign:O}=m.getAnchorAlignment(f),R=-(I-.5)*g,B=-(O-.5)*c,z=m.evaluateVariableOffset(f,v);return new m.Point((R/w+z[0])*E,(B/w+z[1])*E)}function Yg(g,c,f,v,w,E,I,O,R,B,z){const H=g.text.placedSymbolArray,ee=g.text.dynamicLayoutVertexArray,ie=g.icon.dynamicLayoutVertexArray,oe={},re=g.getProjection(),se=Oi(O,re,E),G=E.elevation,ne=re.upVectorScale(O.canonical,E.center.lat,E.worldSize).metersToTile;ee.clear();for(let ce=0;ce<H.length;ce++){const ue=H.get(ce),{tileAnchorX:be,tileAnchorY:we,numGlyphs:xe}=ue,Ae=ue.hidden||!ue.crossTileID||g.allowVerticalPlacement&&!ue.placedOrientation?null:v[ue.crossTileID];if(Ae){let Te=0,Ne=0,ut=0;if(G){const dt=G?G.getAtTileOffset(O,be,we):0,[Et,on,Ut]=re.upVector(O.canonical,be,we);Te=dt*Et*ne,Ne=dt*on*ne,ut=dt*Ut*ne}let[Re,Ze,Ve,lt]=Zr(ue.projectedAnchorX+Te,ue.projectedAnchorY+Ne,ue.projectedAnchorZ+ut,f?se:I);const Le=Ng(E.getCameraToCenterDistance(re),lt);let We=w.evaluateSizeForFeature(g.textSizeData,B,ue)*Le/m.ONE_EM;f&&(We*=g.tilePixelRatio/R);const nt=zd(Ae,We);f?(({x:Re,y:Ze,z:Ve}=re.projectTilePoint(be+nt.x,we+nt.y,O.canonical)),[Re,Ze,Ve]=Zr(Re+Te,Ze+Ne,Ve+ut,I)):(c&&nt._rotate(-E.angle),Re+=nt.x,Ze+=nt.y,Ve=0);const et=g.allowVerticalPlacement&&ue.placedOrientation===m.WritingMode.vertical?Math.PI/2:0;for(let dt=0;dt<xe;dt++)m.addDynamicAttributes(ee,Re,Ze,Ve,et);z&&ue.associatedIconIndex>=0&&(oe[ue.associatedIconIndex]={x:Re,y:Ze,z:Ve,angle:et})}else Ar(xe,ee)}if(z){ie.clear();const ce=g.icon.placedSymbolArray;for(let ue=0;ue<ce.length;ue++){const be=ce.get(ue),{numGlyphs:we}=be,xe=oe[ue];if(be.hidden||!xe)Ar(we,ie);else{const{x:Ae,y:Te,z:Ne,angle:ut}=xe;for(let Re=0;Re<we;Re++)m.addDynamicAttributes(ie,Ae,Te,Ne,ut)}}g.icon.dynamicLayoutVertexBuffer.updateData(ie)}g.text.dynamicLayoutVertexBuffer.updateData(ee)}function ff(g,c,f){return f.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function bu(g,c,f,v,w,E,I,O,R,B,z,H){const ee=g.context,ie=ee.gl,oe=g.transform,re="map"===O,se="map"===R,G=re&&"point"!==f.layout.get("symbol-placement"),ne=re&&!se&&!G,ce=void 0!==f.layout.get("symbol-sort-key").constantOr(1);let ue=!1;const be=g.depthModeForSublayer(0,m.DepthMode.ReadOnly),we=[m.mercatorXfromLng(oe.center.lng),m.mercatorYfromLat(oe.center.lat)],xe=f.layout.get("text-variable-anchor"),Ae="globe"===oe.projection.name,Te=[],Ne=[0,-1,0];let ut=Ne;!Ae&&!oe.mercatorFromTransition||re||(ut=function(Re){const Ze=Re._camera.getWorldToCamera(Re.worldSize,1),Ve=m.multiply([],Ze,Re.globeMatrix);m.invert(Ve,Ve);const lt=[0,0,0],Le=[0,1,0,0];return m.transformMat4$1(Le,Le,Ve),lt[0]=Le[0],lt[1]=Le[1],lt[2]=Le[2],m.normalize(lt,lt),lt}(oe));for(const Re of v){const Ze=c.getTile(Re),Ve=Ze.getBucket(f);if(!Ve||"mercator"===Ve.projection.name&&Ae)continue;const lt=w?Ve.text:Ve.icon;if(!lt||Ve.fullyClipped||!lt.segments.get().length)continue;const Le=lt.programConfigurations.get(f.id),We=w||Ve.sdfIcons,nt=w?Ve.textSizeData:Ve.iconSizeData,et=se||0!==oe.pitch,dt=m.evaluateSizeForZoom(nt,oe.zoom);let Et,on,Ut,Gt,Rn=[0,0],Dn=null;if(w)on=Ze.glyphAtlasTexture,Ut=ie.LINEAR,Et=Ze.glyphAtlasTexture.size,Ve.iconsInText&&(Rn=Ze.imageAtlasTexture.size,Dn=Ze.imageAtlasTexture,Gt=et||g.options.rotating||g.options.zooming||"composite"===nt.kind||"camera"===nt.kind?ie.LINEAR:ie.NEAREST);else{const Bo=1!==f.layout.get("icon-size").constantOr(0)||Ve.iconsNeedLinear;on=Ze.imageAtlasTexture,Ut=We||g.options.rotating||g.options.zooming||Bo||et?ie.LINEAR:ie.NEAREST,Et=Ze.imageAtlasTexture.size}const qt="globe"===Ve.projection.name,Tn=qt?ut:Ne,_i=qt?m.globeToMercatorTransition(oe.zoom):0,yi=Oi(Re,Ve.getProjection(),oe),vi=oe.calculatePixelsToTileUnitsMatrix(Ze),lr=He(yi,Ze.tileID.canonical,se,re,oe,Ve.getProjection(),vi),$r=g.terrain&&se&&G?m.invert(m.create(),lr):Zp,vs=Ir(yi,Ze.tileID.canonical,se,re,oe,Ve.getProjection(),vi),Hs=xe&&Ve.hasTextData(),zi="none"!==f.layout.get("icon-text-fit")&&Hs&&Ve.hasIconData();if(G){const Bo=oe.elevation,El=Bo?Bo.getAtTileOffsetFunc(Re,oe.center.lat,oe.worldSize,Ve.getProjection()):null,wc=Va(yi,Ze.tileID.canonical,se,re,oe,Ve.getProjection(),vi);Np(Ve,yi,g,w,wc,vs,se,B,El,Re)}const fi=G||w&&xe||zi,Jn=g.translatePosMatrix(yi,Ze,E,I),Yt=fi?Zp:lr,ho=g.translatePosMatrix(vs,Ze,E,I,!0),Hi=Ve.getProjection().createInversionMatrix(oe,Re.canonical),zo=[];g.terrainRenderModeElevated()&&se&&zo.push("PITCH_WITH_MAP_TERRAIN"),qt&&zo.push("PROJECTION_GLOBE_VIEW"),fi&&zo.push("PROJECTED_POS_ON_VIEWPORT");const wf=We&&0!==f.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1);let xc;xc=We?Ve.iconsInText?hf(nt.kind,dt,ne,se,g,Jn,Yt,ho,Et,Rn,Re,_i,we,Hi,Tn,Ve.getProjection()):fc(nt.kind,dt,ne,se,g,Jn,Yt,ho,w,Et,!0,Re,_i,we,Hi,Tn,Ve.getProjection()):ri(nt.kind,dt,ne,se,g,Jn,Yt,ho,w,Et,Re,_i,we,Hi,Tn,Ve.getProjection());const Ou={program:g.useProgram(ff(We,w,Ve),Le,zo),buffers:lt,uniformValues:xc,atlasTexture:on,atlasTextureIcon:Dn,atlasInterpolation:Ut,atlasInterpolationIcon:Gt,isSDF:We,hasHalo:wf,tile:Ze,labelPlaneMatrixInv:$r};if(ce&&Ve.canOverlap){ue=!0;const Bo=lt.segments.get();for(const El of Bo)Te.push({segments:new m.SegmentVector([El]),sortKey:El.sortKey,state:Ou})}else Te.push({segments:lt.segments,sortKey:0,state:Ou})}ue&&Te.sort((Re,Ze)=>Re.sortKey-Ze.sortKey);for(const Re of Te){const Ze=Re.state;if(g.terrain&&g.terrain.setupElevationDraw(Ze.tile,Ze.program,{useDepthForOcclusion:!Ae,labelPlaneMatrixInv:Ze.labelPlaneMatrixInv}),ee.activeTexture.set(ie.TEXTURE0),Ze.atlasTexture.bind(Ze.atlasInterpolation,ie.CLAMP_TO_EDGE),Ze.atlasTextureIcon&&(ee.activeTexture.set(ie.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),Ze.isSDF){const Ve=Ze.uniformValues;Ze.hasHalo&&(Ve.u_is_halo=1,xu(Ze.buffers,Re.segments,f,g,Ze.program,be,z,H,Ve)),Ve.u_is_halo=0}xu(Ze.buffers,Re.segments,f,g,Ze.program,be,z,H,Ze.uniformValues)}}function xu(g,c,f,v,w,E,I,O,R){const B=v.context,z=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];w.draw(B,B.gl.TRIANGLES,E,I,O,m.CullFaceMode.disabled,R,f.id,g.layoutVertexBuffer,g.indexBuffer,c,f.paint,v.transform.zoom,g.programConfigurations.get(f.id),z)}function Xp(g,c,f,v,w,E,I){const O=g.context.gl,R=f.paint.get("fill-pattern"),B=R&&R.constantOr(1);let z,H,ee,ie,oe;I?(H=B&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=O.LINES):(H=B?"fillPattern":"fill",z=O.TRIANGLES);for(const re of v){const se=c.getTile(re);if(B&&!se.patternsLoaded())continue;const G=se.getBucket(f);if(!G)continue;g.prepareDrawTile();const ne=G.programConfigurations.get(f.id),ce=g.useProgram(H,ne);B&&(g.context.activeTexture.set(O.TEXTURE0),se.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),ne.updatePaintBuffers());const ue=R.constantOr(null);if(ue&&se.imageAtlas){const we=se.imageAtlas.patternPositions[ue.toString()];we&&ne.setConstantPatternPositions(we)}const be=g.translatePosMatrix(re.projMatrix,se,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(I){ie=G.indexBuffer2,oe=G.segments2;const we=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[O.drawingBufferWidth,O.drawingBufferHeight];ee="fillOutlinePattern"===H&&B?iv(be,g,se,we):mu(be,we)}else ie=G.indexBuffer,oe=G.segments,ee=B?cf(be,g,se):hc(be);g.prepareDrawProgram(g.context,ce,re.toUnwrapped()),ce.draw(g.context,z,w,g.stencilModeForClipping(re),E,m.CullFaceMode.disabled,ee,f.id,G.layoutVertexBuffer,ie,oe,f.paint,g.transform.zoom,ne)}}function pf(g,c,f,v,w,E,I){const O=g.context,R=O.gl,B=g.transform,z=f.paint.get("fill-extrusion-pattern"),H=z.constantOr(1),ee=f.paint.get("fill-extrusion-opacity"),ie=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],oe=f.layout.get("fill-extrusion-edge-radius"),re=oe>0&&!f.paint.get("fill-extrusion-rounded-roof"),se=re?0:oe,G="globe"===B.projection.name?m.fillExtrusionHeightLift():0,ne="globe"===B.projection.name,ce=ne?m.globeToMercatorTransition(B.zoom):0,ue=[m.mercatorXfromLng(B.center.lng),m.mercatorYfromLat(B.center.lat)],be=[];ne&&be.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&be.push("FAUX_AO"),re&&be.push("ZERO_ROOF_RADIUS");for(const we of v){const xe=c.getTile(we),Ae=xe.getBucket(f);if(!Ae||Ae.projection.name!==B.projection.name)continue;const Te=Ae.programConfigurations.get(f.id),Ne=g.useProgram(H?"fillExtrusionPattern":"fillExtrusion",Te,be);if(g.terrain){const We=g.terrain;if(g.style.terrainSetForDrapingOnly())We.setupElevationDraw(xe,Ne,{useMeterToDem:!0});else{if(!Ae.enableTerrain)continue;if(We.setupElevationDraw(xe,Ne,{useMeterToDem:!0}),Yp(O,c,we,Ae,f,We),!Ae.centroidVertexBuffer){const nt=Ne.attributes.a_centroid_pos;void 0!==nt&&R.vertexAttrib2f(nt,0,0)}}}H&&(g.context.activeTexture.set(R.TEXTURE0),xe.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Te.updatePaintBuffers());const ut=z.constantOr(null);if(ut&&xe.imageAtlas){const We=xe.imageAtlas.patternPositions[ut.toString()];We&&Te.setConstantPatternPositions(We)}const Re=g.translatePosMatrix(we.projMatrix,xe,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Ze=B.projection.createInversionMatrix(B,we.canonical),Ve=f.paint.get("fill-extrusion-vertical-gradient"),lt=H?Zg(Re,g,Ve,ee,ie,se,we,xe,G,ce,ue,Ze):Gp(Re,g,Ve,ee,ie,se,we,G,ce,ue,Ze);g.prepareDrawProgram(O,Ne,we.toUnwrapped());const Le=[];g.terrain&&Le.push(Ae.centroidVertexBuffer),ne&&Le.push(Ae.layoutVertexExtBuffer),Ne.draw(O,O.gl.TRIANGLES,w,E,I,m.CullFaceMode.backCCW,lt,f.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,f.paint,g.transform.zoom,Te,Le)}}function Yp(g,c,f,v,w,E){const I=[G=>{let ne=G.canonical.x-1,ce=G.wrap;return ne<0&&(ne=(1<<G.canonical.z)-1,ce--),new m.OverscaledTileID(G.overscaledZ,ce,G.canonical.z,ne,G.canonical.y)},G=>{let ne=G.canonical.x+1,ce=G.wrap;return ne===1<<G.canonical.z&&(ne=0,ce++),new m.OverscaledTileID(G.overscaledZ,ce,G.canonical.z,ne,G.canonical.y)},G=>new m.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(0===G.canonical.y?1<<G.canonical.z:G.canonical.y)-1),G=>new m.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],O=G=>{const ne=c.getSource().minzoom,ce=be=>{const we=c.getTileByID(be);if(we&&we.hasData())return we.getBucket(w)},ue=[0,-1,1];for(const be of ue){if(G.overscaledZ+be<ne)continue;const we=ce(G.calculateScaledKey(G.overscaledZ+be));if(we)return we}},R=[0,0,0],B=(G,ne)=>(R[0]=Math.min(G.min.y,ne.min.y),R[1]=Math.max(G.max.y,ne.max.y),R[2]=m.EXTENT-ne.min.x>G.max.x?ne.min.x-m.EXTENT:G.max.x,R),z=(G,ne)=>(R[0]=Math.min(G.min.x,ne.min.x),R[1]=Math.max(G.max.x,ne.max.x),R[2]=m.EXTENT-ne.min.y>G.max.y?ne.min.y-m.EXTENT:G.max.y,R),H=[(G,ne)=>B(G,ne),(G,ne)=>B(ne,G),(G,ne)=>z(G,ne),(G,ne)=>z(ne,G)],ee=new m.Point(0,0);let ie,oe,re;const se=(G,ne,ce,ue,be)=>{const we=[[ue?ce:G,ue?G:ce,0],[ue?ce:ne,ue?ne:ce,0]],xe=be<0?m.EXTENT+be:be,Ae=[ue?xe:(G+ne)/2,ue?(G+ne)/2:xe,0];return 0===ce&&be<0||0!==ce&&be>0?E.getForTilePoints(re,[Ae],!0,oe):we.push(Ae),E.getForTilePoints(f,we,!0,ie),Math.max(we[0][2],we[1][2],Ae[2])/E.exaggeration()};for(let G=0;G<4;G++){const ne=(G<2?1:5)-G,ce=v.borders[G];if(0===ce.length)continue;const ue=re=I[G](f),be=O(ue);if(!(be&&be instanceof m.FillExtrusionBucket&&be.enableTerrain)||v.borderDoneWithNeighborZ[G]===be.canonical.z&&be.borderDoneWithNeighborZ[ne]===v.canonical.z||(oe=E.findDEMTileFor(ue),!oe||!oe.dem))continue;if(!ie){const Te=E.findDEMTileFor(f);if(!Te||!Te.dem)return;ie=Te}const we=be.borders[ne];let xe=0;const Ae=be.borderDoneWithNeighborZ[ne]!==v.canonical.z;if(v.canonical.z===be.canonical.z){for(let Te=0;Te<ce.length;Te++){const Ne=v.featuresOnBorder[ce[Te]],ut=Ne.borders[G];let Re;for(;xe<we.length&&(Re=be.featuresOnBorder[we[xe]],!(Re.borders[ne][1]>ut[0]+3));)Ae&&be.encodeCentroid(void 0,Re,!1),xe++;if(Re&&xe<we.length){const Ze=xe;let Ve=0;for(;!(Re.borders[ne][0]>ut[1]-3)&&(Ve++,++xe!==we.length);)Re=be.featuresOnBorder[we[xe]];if(Re=be.featuresOnBorder[we[Ze]],Ne.intersectsCount()>1||Re.intersectsCount()>1||1!==Ve){1!==Ve&&(xe=Ze),v.encodeCentroid(void 0,Ne,!1),Ae&&be.encodeCentroid(void 0,Re,!1);continue}const lt=H[G](Ne,Re),Le=G%2?m.EXTENT-1:0;ee.x=se(lt[0],Math.min(m.EXTENT-1,lt[1]),Le,G<2,lt[2]),ee.y=0,v.encodeCentroid(ee,Ne,!1),Ae&&be.encodeCentroid(ee,Re,!1)}else v.encodeCentroid(void 0,Ne,!1)}v.borderDoneWithNeighborZ[G]=be.canonical.z,v.needsCentroidUpdate=!0,Ae&&(be.borderDoneWithNeighborZ[ne]=v.canonical.z,be.needsCentroidUpdate=!0)}else{for(const Te of ce)v.encodeCentroid(void 0,v.featuresOnBorder[Te],!1);if(Ae){for(const Te of we)be.encodeCentroid(void 0,be.featuresOnBorder[Te],!1);be.borderDoneWithNeighborZ[ne]=v.canonical.z,be.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[G]=be.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(g)}const wu=new m.Color(1,0,0,1),rv=new m.Color(0,1,0,1),Vs=new m.Color(0,0,1,1),ov=new m.Color(1,0,1,1),Kg=new m.Color(0,1,1,1);function sv(g,c,f){const v=g.context,w=g.transform,E=v.gl,I="globe"===w.projection.name,O=I?["PROJECTION_GLOBE_VIEW"]:null;let R=f.projMatrix;if(I&&m.globeToMercatorTransition(w.zoom)>0){const Ne=m.transitionTileAABBinECEF(f.canonical,w),ut=m.globeDenormalizeECEF(Ne);R=m.multiply(new Float32Array(16),w.globeMatrix,ut),m.multiply(R,w.projMatrix,R)}const B=g.useProgram("debug",null,O),z=c.getTileByID(f.key);g.terrain&&g.terrain.setupElevationDraw(z,B);const H=m.DepthMode.disabled,ee=m.StencilMode.disabled,ie=g.colorModeForRenderPass();v.activeTexture.set(E.TEXTURE0),g.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),I?z._makeGlobeTileDebugBuffers(g.context,w):z._makeDebugTileBoundsBuffers(g.context,w.projection);const re=z._tileDebugBuffer||g.debugBuffer,se=z._tileDebugIndexBuffer||g.debugIndexBuffer,G=z._tileDebugSegments||g.debugSegments;B.draw(v,E.LINE_STRIP,H,ee,ie,m.CullFaceMode.disabled,Vt(R,m.Color.red),"$debug",re,se,G,null,null,null,[z._globeTileDebugBorderBuffer]);const ne=z.latestRawTileData,ce=Math.floor((ne&&ne.byteLength||0)/1024),ue=c.getTile(f).tileSize,be=512/Math.min(ue,512)*(f.overscaledZ/w.zoom)*.5;let we=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(we+=` => ${f.overscaledZ}`),we+=` ${ce}kb`,function(Ne,ut){Ne.initDebugOverlayCanvas();const Re=Ne.debugOverlayCanvas,Ze=Ne.context.gl,Ve=Ne.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,Re.width,Re.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(ut,5,5),Ve.strokeText(ut,5,5),Ne.debugOverlayTexture.update(Re),Ne.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(g,we);const xe=z._tileDebugTextBuffer||g.debugBuffer,Ae=z._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Te=z._tileDebugTextSegments||g.debugSegments;B.draw(v,E.TRIANGLES,H,ee,m.ColorMode.alphaBlended,m.CullFaceMode.disabled,Vt(R,m.Color.transparent,be),"$debug",xe,Ae,Te,null,null,null,[z._globeTileDebugTextBuffer])}function Qg(g,c,f,v){Cu(g,0,c+f/2,g.transform.width,f,v)}function mf(g,c,f,v){Cu(g,c-f/2,0,f,g.transform.height,v)}function Cu(g,c,f,v,w,E){const I=g.context,O=I.gl;O.enable(O.SCISSOR_TEST),O.scissor(c*m.exported.devicePixelRatio,f*m.exported.devicePixelRatio,v*m.exported.devicePixelRatio,w*m.exported.devicePixelRatio),I.clear({color:E}),O.disable(O.SCISSOR_TEST)}const Kp=m.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Jg}=Kp;function ja(g,c,f,v){g.emplaceBack(c,f,v)}class gf{constructor(c){this.vertexArray=new m.StructArrayLayout3f12,this.indices=new m.StructArrayLayout3ui6,ja(this.vertexArray,-1,-1,1),ja(this.vertexArray,1,-1,1),ja(this.vertexArray,-1,1,1),ja(this.vertexArray,1,1,1),ja(this.vertexArray,-1,-1,-1),ja(this.vertexArray,1,-1,-1),ja(this.vertexArray,-1,1,-1),ja(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Jg),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=m.SegmentVector.simpleSegment(0,0,36,12)}}function ui(g,c,f,v,w,E){const I=g.gl,O=c.paint.get("sky-atmosphere-color"),R=c.paint.get("sky-atmosphere-halo-color"),B=c.paint.get("sky-atmosphere-sun-intensity"),z={u_matrix_3f:m.fromMat4(m.create$1(),v),u_sun_direction:w,u_sun_intensity:B,u_color_tint_r:[(oe=O).r,oe.g,oe.b,oe.a],u_color_tint_m:[(re=R).r,re.g,re.b,re.a],u_luminance:5e-5};var oe,re;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+E,c.skyboxTexture,0),f.draw(g,I.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,m.ColorMode.unblended,m.CullFaceMode.frontCW,z,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Bd=m.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class e_{constructor(c){const f=new m.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const v=new m.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(f,Bd.members),this.indexBuffer=c.createIndexBuffer(v),this.segments=m.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const pc={symbol:function(g,c,f,v,w){if("translucent"!==g.renderPass)return;const E=m.StencilMode.disabled,I=g.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(O,R,B,z,H,ee,ie){const oe=R.transform,re="map"===H,se="map"===ee;for(const G of O){const ne=z.getTile(G),ce=ne.getBucket(B);if(!ce||!ce.text||!ce.text.segments.get().length)continue;const ue=m.evaluateSizeForZoom(ce.textSizeData,oe.zoom),be=Oi(G,ce.getProjection(),oe),we=oe.calculatePixelsToTileUnitsMatrix(ne),xe=He(be,ne.tileID.canonical,se,re,oe,ce.getProjection(),we),Ae="none"!==B.layout.get("icon-text-fit")&&ce.hasIconData();if(ue){const Te=Math.pow(2,oe.zoom-ne.tileID.overscaledZ);Yg(ce,re,se,ie,m.symbolSize,oe,xe,G,Te,ue,Ae)}}}(v,g,f,c,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),w),0!==f.paint.get("icon-opacity").constantOr(1)&&bu(g,c,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),E,I),0!==f.paint.get("text-opacity").constantOr(1)&&bu(g,c,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),E,I),c.map.showCollisionBoxes&&(vu(g,c,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),vu(g,c,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,f,v){if("translucent"!==g.renderPass)return;const w=f.paint.get("circle-opacity"),E=f.paint.get("circle-stroke-width"),I=f.paint.get("circle-stroke-opacity"),O=void 0!==f.layout.get("circle-sort-key").constantOr(1);if(0===w.constantOr(1)&&(0===E.constantOr(1)||0===I.constantOr(1)))return;const R=g.context,B=R.gl,z=g.transform,H=g.depthModeForSublayer(0,m.DepthMode.ReadOnly),ee=m.StencilMode.disabled,ie=g.colorModeForRenderPass(),oe="globe"===z.projection.name,re=[m.mercatorXfromLng(z.center.lng),m.mercatorYfromLat(z.center.lat)],se=[];for(let ne=0;ne<v.length;ne++){const ce=v[ne],ue=c.getTile(ce),be=ue.getBucket(f);if(!be||be.projection.name!==z.projection.name)continue;const we=be.programConfigurations.get(f.id),xe=st(f);oe&&xe.push("PROJECTION_GLOBE_VIEW");const Ae=g.useProgram("circle",we,xe),Te=be.layoutVertexBuffer,Ne=be.globeExtVertexBuffer,ut=be.indexBuffer,Re=z.projection.createInversionMatrix(z,ce.canonical),Ze={programConfiguration:we,program:Ae,layoutVertexBuffer:Te,globeExtVertexBuffer:Ne,indexBuffer:ut,uniformValues:qp(g,ce,ue,Re,re,f),tile:ue};if(O){const Ve=be.segments.get();for(const lt of Ve)se.push({segments:new m.SegmentVector([lt]),sortKey:lt.sortKey,state:Ze})}else se.push({segments:be.segments,sortKey:0,state:Ze})}O&&se.sort((ne,ce)=>ne.sortKey-ce.sortKey);const G={useDepthForOcclusion:!oe};for(const ne of se){const{programConfiguration:ce,program:ue,layoutVertexBuffer:be,globeExtVertexBuffer:we,indexBuffer:xe,uniformValues:Ae,tile:Te}=ne.state,Ne=ne.segments;g.terrain&&g.terrain.setupElevationDraw(Te,ue,G),g.prepareDrawProgram(R,ue,Te.tileID.toUnwrapped()),ue.draw(R,B.TRIANGLES,H,ee,ie,m.CullFaceMode.disabled,Ae,f.id,be,xe,Ne,f.paint,z.zoom,ce,[we])}},heatmap:function(g,c,f,v){if(0!==f.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const w=g.context,E=w.gl,I=m.StencilMode.disabled,O=new m.ColorMode([E.ONE,E.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(ie,oe,re,se){const G=ie.gl,ne=oe.width*se,ce=oe.height*se;ie.activeTexture.set(G.TEXTURE1),ie.viewport.set([0,0,ne,ce]);let ue=re.heatmapFbo;if(!ue||ue&&(ue.width!==ne||ue.height!==ce)){ue&&ue.destroy();const be=G.createTexture();G.bindTexture(G.TEXTURE_2D,be),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ue=re.heatmapFbo=ie.createFramebuffer(ne,ce,!1),function(we,xe,Ae,Te,Ne,ut){const Re=we.gl;Re.texImage2D(Re.TEXTURE_2D,0,we.isWebGL2&&we.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,Ne,ut,0,Re.RGBA,we.extRenderToTextureHalfFloat?we.isWebGL2?Re.HALF_FLOAT:we.extTextureHalfFloat.HALF_FLOAT_OES:Re.UNSIGNED_BYTE,null),Te.colorAttachment.set(Ae)}(ie,0,be,ue,ne,ce)}else G.bindTexture(G.TEXTURE_2D,ue.colorAttachment.get()),ie.bindFramebuffer.set(ue.framebuffer)})(w,g,f,"globe"===g.transform.projection.name?.5:.25),w.clear({color:m.Color.transparent});const R=g.transform,B="globe"===R.projection.name,z=B?["PROJECTION_GLOBE_VIEW"]:null,H=B?m.CullFaceMode.frontCCW:m.CullFaceMode.disabled,ee=[m.mercatorXfromLng(R.center.lng),m.mercatorYfromLat(R.center.lat)];for(let ie=0;ie<v.length;ie++){const oe=v[ie];if(c.hasRenderableParent(oe))continue;const re=c.getTile(oe),se=re.getBucket(f);if(!se||se.projection.name!==R.projection.name)continue;const G=se.programConfigurations.get(f.id),ne=g.useProgram("heatmap",G,z),{zoom:ce}=g.transform;g.terrain&&g.terrain.setupElevationDraw(re,ne),g.prepareDrawProgram(w,ne,oe.toUnwrapped());const ue=R.projection.createInversionMatrix(R,oe.canonical);ne.draw(w,E.TRIANGLES,m.DepthMode.disabled,I,O,H,df(g,oe,re,ue,ee,ce,f.paint.get("heatmap-intensity")),f.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,f.paint,g.transform.zoom,G,B?[se.globeExtVertexBuffer]:null)}w.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(w,E){const I=w.context,O=I.gl,R=E.heatmapFbo;if(!R)return;I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,R.colorAttachment.get()),I.activeTexture.set(O.TEXTURE1);let B=E.colorRampTexture;B||(B=E.colorRampTexture=new m.Texture(I,E.colorRamp,O.RGBA)),B.bind(O.LINEAR,O.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(I,O.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,w.colorModeForRenderPass(),m.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:E.paint.get("heatmap-opacity")},E.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,E.paint,w.transform.zoom)}(g,f))},line:function(g,c,f,v){if("translucent"!==g.renderPass)return;const w=f.paint.get("line-opacity"),E=f.paint.get("line-width");if(0===w.constantOr(1)||0===E.constantOr(1))return;const I=g.depthModeForSublayer(0,m.DepthMode.ReadOnly),O=g.colorModeForRenderPass(),R=g.terrain&&g.terrain.renderingToTexture?1:m.exported.devicePixelRatio,B=f.paint.get("line-dasharray"),z=B.constantOr(1),H=f.layout.get("line-cap"),ee=f.paint.get("line-pattern"),ie=ee.constantOr(1),oe=f.paint.get("line-gradient"),re=ie?"linePattern":"line",se=g.context,G=se.gl,ne=(ue=>{const be=[];Yo(ue)&&be.push("RENDER_LINE_DASH"),ue.paint.get("line-gradient")&&be.push("RENDER_LINE_GRADIENT");const we=ue.paint.get("line-trim-offset");0===we[0]&&0===we[1]||be.push("RENDER_LINE_TRIM_OFFSET");const xe=ue.paint.get("line-pattern").constantOr(1),Ae=1!==ue.paint.get("line-opacity").constantOr(1);return!xe&&Ae&&be.push("RENDER_LINE_ALPHA_DISCARD"),be})(f);let ce=ne.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(ce=!1);for(const ue of v){const be=c.getTile(ue);if(ie&&!be.patternsLoaded())continue;const we=be.getBucket(f);if(!we)continue;g.prepareDrawTile();const xe=we.programConfigurations.get(f.id),Ae=g.useProgram(re,xe,ne),Te=ee.constantOr(null);if(Te&&be.imageAtlas){const We=be.imageAtlas.patternPositions[Te.toString()];We&&xe.setConstantPatternPositions(We)}const Ne=B.constantOr(null),ut=H.constantOr(null);if(!ie&&Ne&&ut&&be.lineAtlas){const We=be.lineAtlas.getDash(Ne,ut);We&&xe.setConstantPatternPositions(We)}let[Re,Ze]=f.paint.get("line-trim-offset");("round"===ut||"square"===ut)&&Re!==Ze&&(0===Re&&(Re-=1),1===Ze&&(Ze+=1));const Ve=g.terrain?ue.projMatrix:null,lt=ie?Nd(g,be,f,Ve,R):Fd(g,be,f,Ve,we.lineClipsArray.length,R,[Re,Ze]);if(oe){const We=we.gradients[f.id];let nt=We.texture;if(f.gradientVersion!==We.version){let et=256;if(f.stepInterpolant){const dt=c.getSource().maxzoom,Et=ue.canonical.z===dt?Math.ceil(1<<g.transform.maxZoom-ue.canonical.z):1;et=m.clamp(m.nextPowerOfTwo(we.maxLineLength/m.EXTENT*1024*Et),256,se.maxTextureSize)}We.gradient=m.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:et,image:We.gradient||void 0,clips:we.lineClipsArray}),We.texture?We.texture.update(We.gradient):We.texture=new m.Texture(se,We.gradient,G.RGBA),We.version=f.gradientVersion,nt=We.texture}se.activeTexture.set(G.TEXTURE1),nt.bind(f.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}z&&(se.activeTexture.set(G.TEXTURE0),be.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),xe.updatePaintBuffers()),ie&&(se.activeTexture.set(G.TEXTURE0),be.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),xe.updatePaintBuffers()),g.prepareDrawProgram(se,Ae,ue.toUnwrapped());const Le=We=>{Ae.draw(se,G.TRIANGLES,I,We,O,m.CullFaceMode.disabled,lt,f.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,f.paint,g.transform.zoom,xe,[we.layoutVertexBuffer2])};if(ce){const We=g.stencilModeForClipping(ue).ref;0===We&&g.terrain&&se.clear({stencil:0});const nt={func:G.EQUAL,mask:255};lt.u_alpha_discard_threshold=.8,Le(new m.StencilMode(nt,We,255,G.KEEP,G.KEEP,G.INVERT)),lt.u_alpha_discard_threshold=0,Le(new m.StencilMode(nt,We,255,G.KEEP,G.KEEP,G.KEEP))}else Le(g.stencilModeForClipping(ue))}ce&&(g.resetStencilClippingMasks(),g.terrain&&se.clear({stencil:0}))},fill:function(g,c,f,v){const w=f.paint.get("fill-color"),E=f.paint.get("fill-opacity");if(0===E.constantOr(1))return;const I=g.colorModeForRenderPass(),O=f.paint.get("fill-pattern"),R=g.opaquePassEnabledForLayer()&&!O.constantOr(1)&&1===w.constantOr(m.Color.transparent).a&&1===E.constantOr(0)?"opaque":"translucent";if(g.renderPass===R){const B=g.depthModeForSublayer(1,"opaque"===g.renderPass?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly);Xp(g,c,f,v,B,I,!1)}if("translucent"===g.renderPass&&f.paint.get("fill-antialias")){const B=g.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,m.DepthMode.ReadOnly);Xp(g,c,f,v,B,I,!0)}},"fill-extrusion":function(g,c,f,v){const w=f.paint.get("fill-extrusion-opacity");if(0!==w&&"translucent"===g.renderPass){const E=new m.DepthMode(g.context.gl.LEQUAL,m.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==w||f.paint.get("fill-extrusion-pattern").constantOr(1))pf(g,c,f,v,E,m.StencilMode.disabled,m.ColorMode.disabled),pf(g,c,f,v,E,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const I=g.colorModeForRenderPass();pf(g,c,f,v,E,m.StencilMode.disabled,I)}}},hillshade:function(g,c,f,v){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const w=g.context,E=g.depthModeForSublayer(0,m.DepthMode.ReadOnly),I=g.colorModeForRenderPass(),O=g.terrain&&g.terrain.renderingToTexture,[R,B]="translucent"!==g.renderPass||O?[{},v]:g.stencilConfigForOverlap(v);for(const z of B){const H=c.getTile(z);if(H.needsHillshadePrepare&&"offscreen"===g.renderPass)nv(g,H,f,E,m.StencilMode.disabled,I);else if("translucent"===g.renderPass){const ee=O&&g.terrain?g.terrain.stencilModeForRTTOverlap(z):R[z.overscaledZ];wo(g,z,H,f,E,ee,I)}}w.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,f,v,w,E){if("translucent"!==g.renderPass||0===f.paint.get("raster-opacity")||!v.length)return;const I=g.context,O=I.gl,R=c.getSource(),B=g.useProgram("raster"),z=g.colorModeForRenderPass(),H=g.terrain&&g.terrain.renderingToTexture,[ee,ie]=R instanceof Sn||H?[{},v]:g.stencilConfigForOverlap(v),oe=ie[ie.length-1].overscaledZ,re=!g.options.moving;for(const se of ie){const G=H?m.DepthMode.disabled:g.depthModeForSublayer(se.overscaledZ-oe,1===f.paint.get("raster-opacity")?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly,O.LESS),ne=se.toUnwrapped(),ce=c.getTile(se);if(H&&(!ce||!ce.hasData()))continue;const ue=H?se.projMatrix:g.transform.calculateProjMatrix(ne,re),be=g.terrain&&H?g.terrain.stencilModeForRTTOverlap(se):ee[se.overscaledZ],we=E?0:f.paint.get("raster-fade-duration");ce.registerFadeDuration(we);const xe=c.findLoadedParent(se,0),Ae=Gg(ce,xe,c,g.transform,we);let Te,Ne;g.terrain&&g.terrain.prepareDrawTile();const ut="nearest"===f.paint.get("raster-resampling")?O.NEAREST:O.LINEAR;I.activeTexture.set(O.TEXTURE0),ce.texture.bind(ut,O.CLAMP_TO_EDGE),I.activeTexture.set(O.TEXTURE1),xe?(xe.texture.bind(ut,O.CLAMP_TO_EDGE),Te=Math.pow(2,xe.tileID.overscaledZ-ce.tileID.overscaledZ),Ne=[ce.tileID.canonical.x*Te%1,ce.tileID.canonical.y*Te%1]):ce.texture.bind(ut,O.CLAMP_TO_EDGE),ce.texture.useMipmap&&I.extTextureFilterAnisotropic&&g.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const Re=_u(ue,Ne||[0,0],Te||1,Ae,f,R instanceof Sn?R.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(I,B,ne),R instanceof Sn)R.boundsBuffer&&R.boundsSegments&&B.draw(I,O.TRIANGLES,G,m.StencilMode.disabled,z,m.CullFaceMode.disabled,Re,f.id,R.boundsBuffer,g.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:Ze,tileBoundsIndexBuffer:Ve,tileBoundsSegments:lt}=g.getTileBoundsBuffers(ce);B.draw(I,O.TRIANGLES,G,be,z,m.CullFaceMode.disabled,Re,f.id,Ze,Ve,lt)}}g.resetStencilClippingMasks()},background:function(g,c,f,v){const w=f.paint.get("background-color"),E=f.paint.get("background-opacity");if(0===E)return;const I=g.context,O=I.gl,R=g.transform,B=R.tileSize,z=f.paint.get("background-pattern");if(g.isPatternMissing(z))return;const H=!z&&1===w.a&&1===E&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==H)return;const ee=m.StencilMode.disabled,ie=g.depthModeForSublayer(0,"opaque"===H?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly),oe=g.colorModeForRenderPass(),re=g.useProgram(z?"backgroundPattern":"background");let se,G=v;G||(se=g.getBackgroundTiles(),G=Object.values(se).map(ne=>ne.tileID)),z&&(I.activeTexture.set(O.TEXTURE0),g.imageManager.bind(g.context));for(const ne of G){const ce=ne.toUnwrapped(),ue=v?ne.projMatrix:g.transform.calculateProjMatrix(ce);g.prepareDrawTile();const be=c?c.getTile(ne):se?se[ne.key]:new m.Tile(ne,B,R.zoom,g),we=z?Xg(ue,E,g,z,{tileID:ne,tileSize:B}):yu(ue,E,w);g.prepareDrawProgram(I,re,ce);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Ae,tileBoundsSegments:Te}=g.getTileBoundsBuffers(be);re.draw(I,O.TRIANGLES,ie,ee,oe,m.CullFaceMode.disabled,we,f.id,xe,Ae,Te)}},sky:function(g,c,f){const v=g.transform,w="mercator"===v.projection.name||"globe"===v.projection.name?1:m.smoothstep(7,8,v.zoom),E=f.paint.get("sky-opacity")*w;if(0===E)return;const I=g.context,O=f.paint.get("sky-type"),R=new m.DepthMode(I.gl.LEQUAL,m.DepthMode.ReadOnly,[0,1]),B=g.frameCounter/1e3%1;"atmosphere"===O?"offscreen"===g.renderPass?f.needsSkyboxCapture(g)&&(function(z,H,ee,ie){const oe=z.context,re=oe.gl;let se=H.skyboxFbo;if(!se){se=H.skyboxFbo=oe.createFramebuffer(32,32,!1),H.skyboxGeometry=new gf(oe),H.skyboxTexture=oe.gl.createTexture(),re.bindTexture(re.TEXTURE_CUBE_MAP,H.skyboxTexture),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MAG_FILTER,re.LINEAR);for(let ue=0;ue<6;++ue)re.texImage2D(re.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,re.RGBA,32,32,0,re.RGBA,re.UNSIGNED_BYTE,null)}oe.bindFramebuffer.set(se.framebuffer),oe.viewport.set([0,0,32,32]);const G=H.getCenter(z,!0),ne=z.useProgram("skyboxCapture"),ce=new Float64Array(16);m.identity(ce),m.rotateY(ce,ce,.5*-Math.PI),ui(oe,H,ne,ce,G,0),m.identity(ce),m.rotateY(ce,ce,.5*Math.PI),ui(oe,H,ne,ce,G,1),m.identity(ce),m.rotateX(ce,ce,.5*-Math.PI),ui(oe,H,ne,ce,G,2),m.identity(ce),m.rotateX(ce,ce,.5*Math.PI),ui(oe,H,ne,ce,G,3),m.identity(ce),ui(oe,H,ne,ce,G,4),m.identity(ce),m.rotateY(ce,ce,Math.PI),ui(oe,H,ne,ce,G,5),oe.viewport.set([0,0,z.width,z.height])}(g,f),f.markSkyboxValid(g)):"sky"===g.renderPass&&function(z,H,ee,ie,oe){const re=z.context,se=re.gl,G=z.transform,ne=z.useProgram("skybox");re.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,H.skyboxTexture);const ce={u_matrix:G.skyboxMatrix,u_sun_direction:H.getCenter(z,!1),u_cubemap:0,u_opacity:ie,u_temporal_offset:oe};z.prepareDrawProgram(re,ne),ne.draw(re,se.TRIANGLES,ee,m.StencilMode.disabled,z.colorModeForRenderPass(),m.CullFaceMode.backCW,ce,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(g,f,R,E,B):"gradient"===O&&"sky"===g.renderPass&&function(z,H,ee,ie,oe){const re=z.context,se=re.gl,G=z.transform,ne=z.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new gf(re)),re.activeTexture.set(se.TEXTURE0);let ce=H.colorRampTexture;ce||(ce=H.colorRampTexture=new m.Texture(re,H.colorRamp,se.RGBA)),ce.bind(se.LINEAR,se.CLAMP_TO_EDGE);const ue=(be=G.skyboxMatrix,we=H.getCenter(z,!1),xe=H.paint.get("sky-gradient-radius"),Ae=ie,Te=oe,{u_matrix:be,u_color_ramp:0,u_center_direction:we,u_radius:m.degToRad(xe),u_opacity:Ae,u_temporal_offset:Te});var be,we,xe,Ae,Te;z.prepareDrawProgram(re,ne),ne.draw(re,se.TRIANGLES,ee,m.StencilMode.disabled,z.colorModeForRenderPass(),m.CullFaceMode.backCW,ue,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(g,f,R,E,B)},debug:function(g,c,f){for(let v=0;v<f.length;v++)sv(g,c,f[v])},custom:function(g,c,f,v){const w=g.context,E=f.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&f.isLayerDraped()){if("offscreen"===g.renderPass){const I=E.prerender;if(I){if(g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const O=g.transform.pointMerc;I.call(E,w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),m.globeToMercatorTransition(g.transform.zoom),[O.x,O.y],g.transform.pixelsPerMeterRatio)}else I.call(E,w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const O=E.renderToTile;if(O){const R=v[0].canonical,B=new m.MercatorCoordinate(R.x+v[0].wrap*(1<<R.z),R.y,R.z);w.setDepthMode(m.DepthMode.disabled),w.setStencilMode(m.StencilMode.disabled),w.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),O.call(E,w.gl,B),w.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),w.setStencilMode(m.StencilMode.disabled);const I="3d"===E.renderingMode?new m.DepthMode(g.context.gl.LEQUAL,m.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,m.DepthMode.ReadOnly);if(w.setDepthMode(I),"globe"===g.transform.projection.name){const O=g.transform.pointMerc;E.render(w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),m.globeToMercatorTransition(g.transform.zoom),[O.x,O.y],g.transform.pixelsPerMeterRatio)}else E.render(w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState(),w.bindFramebuffer.set(null)}}else m.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Wi{constructor(c,f,v=!1){this.context=new yt(c,v),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=m.SourceCache.maxUnderzooming+m.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,f){const v=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Wg(this,c));const w=this._terrain;this.transform.elevation=v?w:null,w.update(c,this.transform,f)}_updateFog(c){const f=c.fog;if(!f||"globe"===this.transform.projection.name||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,w]=f.getFovAdjustedRange(this.transform._fov);if(v>w)return void(this.transform.fogCullDistSq=null);const E=v+.78*(w-v);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,f){if(this.width=c*m.exported.devicePixelRatio,this.height=f*m.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const c=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(f,m.posAttributes.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);const v=new m.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(m.EXTENT,0),v.emplaceBack(0,m.EXTENT),v.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=c.createVertexBuffer(v,m.posAttributes.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);const w=new m.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(w,m.posAttributes.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);const E=new m.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(m.EXTENT,0,m.EXTENT,0),E.emplaceBack(0,m.EXTENT,0,m.EXTENT),E.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(E,m.boundsAttributes.members),this.mercatorBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);const I=new m.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(I);const O=new m.StructArrayLayout1ui2;for(const B of[0,1,3,2,0])O.emplaceBack(B);this.debugIndexBuffer=c.createIndexBuffer(O),this.emptyTexture=new m.Texture(c,new m.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=m.create();const R=this.context.gl;this.stencilClearMode=new m.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(m.window.performance.now()),this.atmosphereBuffer=new e_(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,f=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,f.TRIANGLES,m.DepthMode.disabled,this.stencilClearMode,m.ColorMode.disabled,m.CullFaceMode.disabled,uc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,f,v){if(!f||this.currentStencilSource===f.id||!c.isTileClipped()||!v||0===v.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let O=!1;for(const R of v)if(void 0===this._tileClippingMaskIDs[R.key]){O=!0;break}if(!O)return}this.currentStencilSource=f.id;const w=this.context,E=w.gl;this.nextStencilID+v.length>256&&this.clearStencil(),w.setColorMode(m.ColorMode.disabled),w.setDepthMode(m.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const O of v){const R=f.getTile(O),B=this._tileClippingMaskIDs[O.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:H,tileBoundsSegments:ee}=this.getTileBoundsBuffers(R);I.draw(w,E.TRIANGLES,m.DepthMode.disabled,new m.StencilMode({func:E.ALWAYS,mask:0},B,255,E.KEEP,E.KEEP,E.REPLACE),m.ColorMode.disabled,m.CullFaceMode.disabled,uc(O.projMatrix),"$clipping",z,H,ee)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,f=this.context.gl;return new m.StencilMode({func:f.NOTEQUAL,mask:255},c,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const f=this.context.gl;return new m.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(c){const f=this.context.gl,v=c.sort((I,O)=>O.overscaledZ-I.overscaledZ),w=v[v.length-1].overscaledZ,E=v[0].overscaledZ-w+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const I={};for(let O=0;O<E;O++)I[O+w]=new m.StencilMode({func:f.GEQUAL,mask:255},O+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=E,[I,v]}return[{[w]:m.StencilMode.disabled},v]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new m.ColorMode([c.CONSTANT_COLOR,c.ONE],new m.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?m.ColorMode.unblended:m.ColorMode.alphaBlended}depthModeForSublayer(c,f,v){if(!this.opaquePassEnabledForLayer())return m.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new m.DepthMode(v||this.context.gl.LEQUAL,f,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,f){this.style=c,this.options=f,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(m.exported.now()),this.imageManager.beginFrame();const v=this.style.order,w=this.style._sourceCaches;for(const B in w){const z=w[B];z.used&&z.prepare(this.context)}const E={},I={},O={};for(const B in w){const z=w[B];E[B]=z.getVisibleCoordinates(),I[B]=E[B].slice().reverse(),O[B]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<v.length;B++)if(this.style._layers[v[B]].is3D()){this.opaquePassCutoff=B;break}if(this.terrain&&(this.terrain.updateTileBinding(O),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new m.GlobeSharedBuffers(this.context)),!m.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const B of v){const z=this.style._layers[B],H=c._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const ee=H?I[H.id]:void 0;("custom"===z.type||z.isSky()||ee&&ee.length)&&this.renderLayer(this,H,z,ee)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const R=this.terrain;if(R&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&R.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[v[this.currentLayer]],z=c._getLayerSourceCache(B);if(B.isSky())continue;const H=z?I[z.id]:void 0;this._renderTileClippingMasks(B,z,H),this.renderLayer(this,z,B,H)}if(this.style.fog&&this.transform.projection.supportsFog&&function(B,z){const H=B.context,ee=H.gl,ie=B.transform,oe=new m.DepthMode(ee.LEQUAL,m.DepthMode.ReadOnly,[0,1]),re=B.useProgram("globeAtmosphere",null,"globe"===ie.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),se=m.globeToMercatorTransition(ie.zoom),G=z.properties.get("color").toArray01(),ne=z.properties.get("high-color").toArray01(),ce=z.properties.get("space-color").toArray01PremultipliedAlpha(),ue=m.identity$1([]);m.rotateY$1(ue,ue,-m.degToRad(ie._center.lng)),m.rotateX$1(ue,ue,m.degToRad(ie._center.lat)),m.rotateZ$1(ue,ue,ie.angle),m.rotateX$1(ue,ue,-ie._pitch);const be=m.fromQuat(new Float32Array(16),ue),we=m.mapValue(z.properties.get("star-intensity"),0,1,0,.25),Ae=m.mapValue(z.properties.get("horizon-blend"),0,1,5e-4,.25),Te=m.globeUseCustomAntiAliasing(B,H,ie)&&5e-4===Ae?ie.worldSize/(2*Math.PI*1.025)-1:ie.globeRadius,Ne=B.frameCounter/1e3%1,ut=m.length(ie.globeCenterInViewSpace),Re=Math.sqrt(Math.pow(ut,2)-Math.pow(Te,2)),Ze=Math.acos(Re/ut),Ve={u_frustum_tl:ie.frustumCorners.TL,u_frustum_tr:ie.frustumCorners.TR,u_frustum_br:ie.frustumCorners.BR,u_frustum_bl:ie.frustumCorners.BL,u_horizon:ie.frustumCorners.horizon,u_transition:se,u_fadeout_range:Ae,u_color:G,u_high_color:ne,u_space_color:ce,u_star_intensity:we,u_star_size:5*m.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ne,u_horizon_angle:Ze,u_rotation_matrix:be};B.prepareDrawProgram(H,re);const lt=B.atmosphereBuffer;lt&&re.draw(H,ee.TRIANGLES,oe,m.StencilMode.disabled,m.ColorMode.alphaBlended,m.CullFaceMode.backCW,Ve,"skybox",lt.vertexBuffer,lt.indexBuffer,lt.segments)}(this,this.style.fog),this.renderPass="sky",(m.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const B=this.style._layers[v[this.currentLayer]],z=c._getLayerSourceCache(B);B.isSky()&&this.renderLayer(this,z,B,z?I[z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const B=this.style._layers[v[this.currentLayer]],z=c._getLayerSourceCache(B);if(B.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(B)){if(B.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const H=z?("symbol"===B.type?O:I)[z.id]:void 0;this._renderTileClippingMasks(B,z,z?E[z.id]:void 0),this.renderLayer(this,z,B,H),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let B=null;m.values(this.style._layers).forEach(z=>{const H=c._getLayerSourceCache(z);H&&!z.isHidden(this.transform.zoom)&&(!B||B.getSource().maxzoom<H.getSource().maxzoom)&&(B=H)}),B&&this.options.showTileBoundaries&&pc.debug(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const z=B.transform.padding;Qg(B,B.transform.height-(z.top||0),3,wu),Qg(B,z.bottom||0,3,rv),mf(B,z.left||0,3,Vs),mf(B,B.transform.width-(z.right||0),3,ov);const H=B.transform.centerPoint;var ee,ie,oe,re;Cu(ee=B,(ie=H.x)-1,(oe=B.transform.height-H.y)-10,2,20,re=Kg),Cu(ee,ie-10,oe-1,20,2,re)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(m.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,f,v,w){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||w&&w.length)&&(this.id=v.id,this.gpuTimingStart(v),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(v.type)||c.terrain&&"custom"===v.type)&&pc[v.type](c,f,v,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let v=this.gpuTimers[c.id];v||(v=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),v.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,f=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),c.beginQueryEXT(c.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const f={};for(const v in c){const w=c[v],E=this.context.extTimerQuery,I=E.getQueryObjectEXT(w.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(w.query),f[v]=I}return f}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let v=0;for(const w of c)v+=f.getQueryObjectEXT(w,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(w);return v}translatePosMatrix(c,f,v,w,E){if(!v[0]&&!v[1])return c;const I=E?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(I){const B=Math.sin(I),z=Math.cos(I);v=[v[0]*z-v[1]*B,v[0]*B+v[1]*z]}const O=[E?v[0]:jr(f,v[0],this.transform.zoom),E?v[1]:jr(f,v[1],this.transform.zoom),0],R=new Float32Array(16);return m.translate(R,c,O),R}saveTileTexture(c){const f=this._tileTextures[c.size[0]];f?f.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const f=this._tileTextures[c];return f&&f.length>0?f.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&0===this.terrain.exaggeration(),v=this.style&&this.style.fog,w=[];return this.terrainRenderModeElevated()&&w.push("TERRAIN"),"globe"===this.transform.projection.name&&w.push("GLOBE"),f&&w.push("ZERO_EXAGGERATION"),v&&!c&&0!==v.getOpacity(this.transform.pitch)&&w.push("FOG"),c&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}useProgram(c,f,v){this.cache=this.cache||{};const w=v||[],E=this.currentGlobalDefines().concat(w),I=Nn.cacheKey(sf[c],c,E,f);return this.cache[I]||(this.cache[I]=new Nn(this.context,c,sf[c],f,Bs[c],E)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,f,v){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const E=w.getOpacity(this.transform.pitch),I=((O,R,B,z,H,ee,ie,oe,re,se,G)=>{const ne=O.transform,ce=R.properties.get("color").toArray01();ce[3]=z;const ue=O.frameCounter/1e3%1;return{u_fog_matrix:B?ne.calculateFogTileMatrix(B):O.identityMat,u_fog_range:R.getFovAdjustedRange(ne._fov),u_fog_color:ce,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:ue,u_frustum_tl:H,u_frustum_tr:ee,u_frustum_br:ie,u_frustum_bl:oe,u_globe_pos:re,u_globe_radius:se,u_viewport:G,u_globe_transition:m.globeToMercatorTransition(ne.zoom),u_is_globe:+("globe"===ne.projection.name)}})(this,w,v,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*m.exported.devicePixelRatio,this.transform.height*m.exported.devicePixelRatio]);f.setFogUniformValues(c,I)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,f=c.createTexture();return c.bindTexture(c.TEXTURE_2D,f),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,f=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const w of v)f[w.key]=c[w.key]||new m.Tile(w,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class _f{constructor(c=0,f=0,v=0,w=0){if(isNaN(c)||c<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=f,this.left=v,this.right=w}interpolate(c,f,v){return null!=f.top&&null!=c.top&&(this.top=m.number(c.top,f.top,v)),null!=f.bottom&&null!=c.bottom&&(this.bottom=m.number(c.bottom,f.bottom,v)),null!=f.left&&null!=c.left&&(this.left=m.number(c.left,f.left,v)),null!=f.right&&null!=c.right&&(this.right=m.number(c.right,f.right,v)),this}getCenter(c,f){const v=m.clamp((this.left+c-this.right)/2,0,c),w=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(v,w)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new _f(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Vd(g,c){const f=m.getColumn(g,3);m.fromQuat(g,c),m.setColumn(g,3,f)}function Pt(g,c){const f=m.identity$1([]);return m.rotateZ$1(f,f,-c),m.rotateX$1(f,f,-g),f}function Xr(g,c){const f=[g[0],g[1],0],v=[c[0],c[1],0];if(m.length(f)>=1e-15){const I=m.normalize([],f);m.scale$2(v,I,m.dot(v,I)),c[0]=v[0],c[1]=v[1]}const w=m.cross([],c,g);if(m.len(w)<1e-15)return null;const E=Math.atan2(-w[1],w[0]);return Pt(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),E)}class Qn{constructor(c,f){this.position=c,this.orientation=f}get position(){return this._position}set position(c){if(c){const f=c instanceof m.MercatorCoordinate?c:new m.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(f.x=m.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(c,f){if(this.orientation=null,!this.position)return;const v=this.position,w=this._elevation?this._elevation.getAtPointOrZero(m.MercatorCoordinate.fromLngLat(c)):0,E=m.MercatorCoordinate.fromLngLat(c,w),I=[E.x-v.x,E.y-v.y,E.z-v.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Xr(I,f)}setPitchBearing(c,f){this.orientation=Pt(m.degToRad(c),m.degToRad(-f))}}class zr{constructor(c,f){this._transform=m.identity([]),this.orientation=f,this.position=c}get mercatorPosition(){const c=this.position;return new m.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=m.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var f;c&&m.setColumn(this._transform,3,[(f=c)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||m.identity$1([]),c&&Vd(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,f){this._orientation=Pt(c,f),Vd(this._transform,this._orientation)}forward(){const c=m.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=m.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=m.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,f){const v=new Float64Array(16);return m.invert(v,this.getWorldToCamera(c,f)),v}getWorldToCameraPosition(c,f,v){const w=this.position;m.scale$2(w,w,-c);const E=new Float64Array(16);return m.fromScaling(E,[v,v,v]),m.translate(E,E,w),E[10]*=f,E}getWorldToCamera(c,f){const v=new Float64Array(16),w=new Float64Array(4),E=this.position;return m.conjugate(w,this._orientation),m.scale$2(E,E,-c),m.fromQuat(v,w),m.translate(v,v,E),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=f,v[9]*=f,v[10]*=f,v[11]*=f,v}getCameraToClipPerspective(c,f,v,w){const E=new Float64Array(16);return m.perspective(E,c,f,v,w),E}getDistanceToElevation(c,f=!1){const v=0===c?0:m.mercatorZfromAltitude(c,f?m.latFromMercatorY(this.position[1]):this.position[1]),w=this.forward();return(v-this.position[2])/w[2]}clone(){return new zr([...this.position],[...this.orientation])}}function Br(g,c){const f=uo(g.projection,g.zoom,g.width,g.height),v=function(E,I,O,R,B){const z=new m.LngLat(O.lng-180*fa,O.lat),H=new m.LngLat(O.lng+180*fa,O.lat),ee=E.project(z.lng,z.lat),ie=E.project(H.lng,H.lat),oe=-Math.atan2(ie.y-ee.y,ie.x-ee.x),re=m.MercatorCoordinate.fromLngLat(O);re.y=m.clamp(re.y,-1+fa,1-fa);const se=re.toLngLat(),G=E.project(se.lng,se.lat),ne=m.MercatorCoordinate.fromLngLat(se);ne.x+=fa;const ce=ne.toLngLat(),ue=E.project(ce.lng,ce.lat),be=gc(ue.x-G.x,ue.y-G.y,oe),we=m.MercatorCoordinate.fromLngLat(se);we.y+=fa;const xe=we.toLngLat(),Ae=E.project(xe.lng,xe.lat),Te=gc(Ae.x-G.x,Ae.y-G.y,oe),Ne=Math.abs(be.x)/Math.abs(Te.y),ut=m.identity([]);m.rotateZ(ut,ut,-oe*(1-(B?0:R)));const Re=m.identity([]);return m.scale(Re,Re,[1,1-(1-Ne)*R,1]),Re[4]=-Te.x/Te.y*R,m.rotateZ(Re,Re,oe),m.multiply(Re,ut,Re),Re}(g.projection,0,g.center,f,c),w=mc(g);return m.scale(v,v,[w,w,1]),v}function mc(g){const c=g.projection,f=uo(g.projection,g.zoom,g.width,g.height),v=Qp(c,g.center),w=Qp(c,m.LngLat.convert(c.center));return Math.pow(2,v*f+(1-f)*w)}function uo(g,c,f,v,w=1/0){const E=g.range;if(!E)return 0;const I=Math.min(w,Math.max(f,v)),O=Math.log(I/1024)/Math.LN2;return m.smoothstep(E[0]+O,E[1]+O,c)}const fa=1/4e4;function Qp(g,c){const f=m.clamp(c.lat,-m.MAX_MERCATOR_LATITUDE,m.MAX_MERCATOR_LATITUDE),v=new m.LngLat(c.lng-180*fa,f),w=new m.LngLat(c.lng+180*fa,f),E=g.project(v.lng,f),I=g.project(w.lng,f),O=m.MercatorCoordinate.fromLngLat(v),R=m.MercatorCoordinate.fromLngLat(w),B=I.x-E.x,z=I.y-E.y,H=R.x-O.x,ee=R.y-O.y,ie=Math.sqrt((H*H+ee*ee)/(B*B+z*z));return Math.log(ie)/Math.LN2}function gc(g,c,f){const v=Math.cos(f),w=Math.sin(f);return{x:g*v-c*w,y:g*w+c*v}}class Eu{constructor(c,f,v,w,E,I,O){this.tileSize=512,this._renderWorldCopies=void 0===E||E,this._minZoom=c||0,this._maxZoom=f||22,this._minPitch=v??0,this._maxPitch=w??60,this.setProjection(I),this.setMaxBounds(O),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new _f,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new zr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new Eu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,f=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||v)&&this._updateCameraOnTerrain(),(c||v)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return m.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=m.getProjection(this.projectionOptions);const v=!Je(f,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=m.getProjection({name:"mercator"});const f=c!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return m.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new m.Point(this.width,this.height)}get bearing(){return m.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const f=-c*Math.PI/180;var v,w,E,I,O,R,B,z,H,ee;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(v=new m.ARRAY_TYPE(4),m.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),w=this.rotationMatrix,I=this.angle,O=(E=this.rotationMatrix)[0],R=E[1],B=E[2],z=E[3],H=Math.sin(I),ee=Math.cos(I),w[0]=O*ee+B*H,w[1]=R*ee+z*H,w[2]=O*-H+B*ee,w[3]=R*-H+z*ee)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const f=m.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=m.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const f=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let w=0,E=0;for(let I=0;I<f.length;I++){const O=new m.Point(f[I][0]*this.width,v+f[I][1]*(this.height-v)),R=c.pointCoordinate(O);if(!R)continue;const B=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);w+=R[3]*B,E+=B}return 0===E?NaN:w/E}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*f,w=this._mercatorZfromZoom(c),E=this._mercatorZfromZoom(this._maxZoom),I=Math.max(w-v,E);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let v;v=c.z<this._camera.position[2]?[f.x,f.y,f.z]:[c.x,c.y,c.z];const w=m.length(m.sub([],this._camera.position,v));return m.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let f=!1;if(c.orientation&&!m.exactEquals(c.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(c.orientation)),c.position){const v=[c.position.x,c.position.y,c.position.z];m.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,f=new Qn;return f.position=new m.MercatorCoordinate(c[0],c[1],c[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(c){if(!m.length$1(c))return!1;m.normalize$1(c,c);const f=m.transformQuat([],[0,0,-1],c),v=m.transformQuat([],[0,-1,0],c);if(v[2]<0)return!1;const w=Xr(f,v);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(c){const f=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;c[2]=m.clamp(c[2],w/v,w/f),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,f,v){this._unmodified=!1,this._edgeInsets.interpolate(c,f,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const f=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(c){const f=[new m.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const v=this.pointCoordinate(new m.Point(0,0)),w=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),I=this.pointCoordinate(new m.Point(0,this.height)),O=Math.floor(Math.min(v.x,w.x,E.x,I.x)),R=Math.floor(Math.max(v.x,w.x,E.x,I.x)),B=1;for(let z=O-B;z<=R+B;z++)0!==z&&f.push(new m.UnwrappedTileID(z,c))}return f}coveringTiles(c){let f=this.coveringZoomLevel(c);const v=f,w=this.elevation&&!c.isTerrainDEM,E="mercator"===this.projection.name;if(void 0!==c.minzoom&&f<c.minzoom)return[];void 0!==c.maxzoom&&f>c.maxzoom&&(f=c.maxzoom);const I=this.locationCoordinate(this.center),O=this.center.lat,R=1<<f,B=[R*I.x,R*I.y,0],z="globe"===this.projection.name,H=!z,ee=m.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,H),ie=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=R*m.mercatorZfromAltitude(1,this.center.lat),re=this._camera.position[2]/m.mercatorZfromAltitude(1,this.center.lat),se=[R*ie.x,R*ie.y,re*(H?1:oe)],G=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),ne=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,ce=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ue=c.isTerrainDEM?-ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,be=this.projection.isReprojectedInTileSpace?mc(this):1,we=Le=>{const nt=new m.MercatorCoordinate(Le.x+25e-6,Le.y,Le.z),et=new m.MercatorCoordinate(Le.x,Le.y+25e-6,Le.z),dt=Le.toLngLat(),Et=nt.toLngLat(),on=et.toLngLat(),Ut=this.locationCoordinate(dt),Gt=this.locationCoordinate(Et),Rn=this.locationCoordinate(on),Dn=Math.hypot(Gt.x-Ut.x,Gt.y-Ut.y),qt=Math.hypot(Rn.x-Ut.x,Rn.y-Ut.y);return Math.sqrt(Dn*qt)*be/25e-6},xe=Le=>{const We=ce,nt=ue;return{aabb:m.tileAABB(this,R,0,0,0,Le,nt,We,this.projection),zoom:0,x:0,y:0,minZ:nt,maxZ:We,wrap:Le,fullyVisible:!1}},Ae=[];let Te=[];const Ne=f,ut=c.reparseOverscaled?v:f,Re=Le=>Le*Le,Ze=Re((re-this._centerAltitude)*oe),Ve=Le=>{if(!this._elevation||!Le.tileID||!E)return;const We=this._elevation.getMinMaxForTile(Le.tileID),nt=Le.aabb;We?(nt.min[2]=We.min,nt.max[2]=We.max,nt.center[2]=(nt.min[2]+nt.max[2])/2):(Le.shouldSplit=lt(Le),Le.shouldSplit||(nt.min[2]=nt.max[2]=nt.center[2]=this._centerAltitude))},lt=Le=>{if(Le.zoom<ne)return!0;if(Le.zoom===Ne)return!1;if(null!=Le.shouldSplit)return Le.shouldSplit;const We=Le.aabb.distanceX(se),nt=Le.aabb.distanceY(se);let et=Ze,dt=1;if(z){et=Re(Le.aabb.distanceZ(se));const Ut=Math.pow(2,Le.zoom),Gt=m.latFromMercatorY((Le.y+1)/Ut),Rn=m.latFromMercatorY(Le.y/Ut),Dn=Math.min(Math.max(O,Gt),Rn),qt=m.circumferenceAtLatitude(Dn)/m.circumferenceAtLatitude(O);if(dt=Dn===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,qt/this._mercatorScaleRatio),this.zoom<=m.GLOBE_ZOOM_THRESHOLD_MIN&&Le.zoom===Ne-1&&qt>=.9)return!0}else if(w&&(et=Re(Le.aabb.distanceZ(se)*oe)),this.projection.isReprojectedInTileSpace&&v<=5){const Ut=Math.pow(2,Le.zoom),Gt=we(new m.MercatorCoordinate((Le.x+.5)/Ut,(Le.y+.5)/Ut));dt=Gt>.85?1:Gt}const Et=We*We+nt*nt+et;return Et<Re((1<<Ne-Le.zoom)*G*dt*((Ut,Gt)=>{if(Gt*Re(.707)<Ut)return 1;const Rn=Math.sqrt(Gt/Ut);return Rn/(1.4144271570014144+(Math.pow(1.1,Rn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(et,Ze),Et))};if(this.renderWorldCopies)for(let Le=1;Le<=3;Le++)Ae.push(xe(-Le)),Ae.push(xe(Le));for(Ae.push(xe(0));Ae.length>0;){const Le=Ae.pop(),We=Le.x,nt=Le.y;let et=Le.fullyVisible;if(!et){const dt=Le.aabb.intersects(ee);if(0===dt)continue;et=2===dt}if(Le.zoom!==Ne&&lt(Le))for(let dt=0;dt<4;dt++){const Et=(We<<1)+dt%2,on=(nt<<1)+(dt>>1),Ut={aabb:E?Le.aabb.quadrant(dt):m.tileAABB(this,R,Le.zoom+1,Et,on,Le.wrap,Le.minZ,Le.maxZ,this.projection),zoom:Le.zoom+1,x:Et,y:on,wrap:Le.wrap,fullyVisible:et,tileID:void 0,shouldSplit:void 0,minZ:Le.minZ,maxZ:Le.maxZ};w&&!z&&(Ut.tileID=new m.OverscaledTileID(Le.zoom+1===Ne?ut:Le.zoom+1,Le.wrap,Le.zoom+1,Et,on),Ve(Ut)),Ae.push(Ut)}else{const dt=Le.zoom===Ne?ut:Le.zoom;if(c.minzoom&&c.minzoom>dt)continue;const Et=B[0]-(.5+We+(Le.wrap<<Le.zoom))*(1<<f-Le.zoom),on=B[1]-.5-nt,Ut=Le.tileID?Le.tileID:new m.OverscaledTileID(dt,Le.wrap,Le.zoom,We,nt);Te.push({tileID:Ut,distanceSq:Et*Et+on*on})}}if(this.fogCullDistSq){const Le=this.fogCullDistSq,We=this.horizonLineFromTop();Te=Te.filter(nt=>{const et=[0,0,0,1],dt=[m.EXTENT,m.EXTENT,0,1],Et=this.calculateFogTileMatrix(nt.tileID.toUnwrapped());m.transformMat4$1(et,et,Et),m.transformMat4$1(dt,dt,Et);const on=m.getAABBPointSquareDist(et,dt);if(0===on)return!0;let Ut=!1;const Gt=this._elevation;if(Gt&&on>Le&&0!==We){const Rn=this.calculateProjMatrix(nt.tileID.toUnwrapped());let Dn;c.isTerrainDEM||(Dn=Gt.getMinMaxForTile(nt.tileID)),Dn||(Dn={min:ue,max:ce});const qt=m.furthestTileCorner(this.rotation),Tn=[qt[0]*m.EXTENT,qt[1]*m.EXTENT,Dn.max];m.transformMat4(Tn,Tn,Rn),Ut=(1-Tn[1])*this.height*.5<We}return on<Le||Ut})}return Te.sort((Le,We)=>Le.distanceSq-We.distanceSq).map(Le=>Le.tileID)}resize(c,f){this.width=c,this.height=f,this.pixelsToGLUnits=[2/c,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const f=m.clamp(c.lat,-m.MAX_MERCATOR_LATITUDE,m.MAX_MERCATOR_LATITUDE),v=this.projection.project(c.lng,f);return new m.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/m.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,f){let v,w;const E=this.centerPoint;if("globe"===this.projection.name){const O=this.worldSize;v=(f.x-E.x)/O,w=(f.y-E.y)/O}else{const O=this.pointCoordinate(f),R=this.pointCoordinate(E);v=O.x-R.x,w=O.y-R.y}const I=this.locationCoordinate(c);this.setLocation(new m.MercatorCoordinate(I.x-v,I.y-w))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,f){const v=f?m.mercatorZfromAltitude(f,c.lat):void 0,w=this.projection.project(c.lng,c.lat);return new m.MercatorCoordinate(w.x,w.y,v)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,f){const v=f??this._centerAltitude,w=[c.x,c.y,0,1],E=[c.x,c.y,1,1];m.transformMat4$1(w,w,this.pixelMatrixInverse),m.transformMat4$1(E,E,this.pixelMatrixInverse);const I=E[3];m.scale$1(w,w,1/w[3]),m.scale$1(E,E,1/I);const O=w[2],R=E[2];return{p0:w,p1:E,t:O===R?0:(v-O)/(R-O)}}screenPointToMercatorRay(c){const f=[c.x,c.y,0,1],v=[c.x,c.y,1,1];return m.transformMat4$1(f,f,this.pixelMatrixInverse),m.transformMat4$1(v,v,this.pixelMatrixInverse),m.scale$1(f,f,1/f[3]),m.scale$1(v,v,1/v[3]),f[2]=m.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,v[2]=m.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,m.scale$1(f,f,1/this.worldSize),m.scale$1(v,v,1/this.worldSize),new m.Ray([f[0],f[1],f[2]],m.normalize([],m.sub([],v,f)))}rayIntersectionCoordinate(c){const{p0:f,p1:v,t:w}=c,E=m.mercatorZfromAltitude(f[2],this._center.lat),I=m.mercatorZfromAltitude(v[2],this._center.lat);return new m.MercatorCoordinate(m.number(f[0],v[0],w)/this.worldSize,m.number(f[1],v[1],w)/this.worldSize,m.number(E,I,w))}pointCoordinate(c,f=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,f)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let f=this.projection.pointCoordinate3D(this,c.x,c.y);if(f)return new m.MercatorCoordinate(f[0],f[1],f[2]);let v=0,w=this.horizonLineFromTop();if(c.y>w)return this.pointCoordinate(c);const E=.02*w,I=c.clone();for(let O=0;O<10&&w-v>E;O++){I.y=m.number(v,w,.66);const R=this.projection.pointCoordinate3D(this,I.x,I.y);R?(w=I.y,f=R):v=I.y}return f?new m.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=m.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const f=this.pointCoordinate(c);return f.y>=0&&f.y<=1}_coordinatePoint(c,f){const v=f&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,w=[c.x*this.worldSize,c.y*this.worldSize,v+c.toAltitude(),1];return m.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new m.Point(w[0]/w[3],w[1]/w[3]):new m.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:f}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,E=this.pointLocation3D(new m.Point(f,c)),I=this.pointLocation3D(new m.Point(w,c)),O=this.pointLocation3D(new m.Point(w,v)),R=this.pointLocation3D(new m.Point(f,v));let B=Math.min(E.lng,I.lng,O.lng,R.lng),z=Math.max(E.lng,I.lng,O.lng,R.lng),H=Math.min(E.lat,I.lat,O.lat,R.lat),ee=Math.max(E.lat,I.lat,O.lat,R.lat);const ie=Math.pow(2,-this.zoom)/16*270,oe="globe"===this.projection.name?1:4,re=(se,G,ne,ce,ue)=>{const be=(se+ne)/2,we=(G+ce)/2,xe=new m.Point(be,we),{lng:Ae,lat:Te}=this.pointLocation3D(xe),Ne=Math.max(0,B-Ae,H-Te,Ae-z,Te-ee);B=Math.min(B,Ae),z=Math.max(z,Ae),H=Math.min(H,Te),ee=Math.max(ee,Te),(ue<oe||Ne>ie)&&(re(se,G,be,we,ue+1),re(be,we,ne,ce,ue+1))};if(re(f,c,w,c,1),re(w,c,w,v,1),re(w,v,f,v,1),re(f,v,f,c,1),"globe"===this.projection.name){const[se,G]=m.polesInViewport(this);se?(ee=90,z=180,B=-180):G&&(H=-90,z=180,B=-180)}return new m.LngLatBounds(new m.LngLat(B,H),new m.LngLat(z,ee))}_getBoundsRectangular(c,f){const{top:v,left:w}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,O=new m.Point(w,v),R=new m.Point(I,v),B=new m.Point(I,E),z=new m.Point(w,E);let H=this.pointCoordinate(O,c),ee=this.pointCoordinate(R,c);const ie=this.pointCoordinate(B,f),oe=this.pointCoordinate(z,f),re=(se,G)=>(G.y-se.y)/(G.x-se.x);return H.y>1&&ee.y>=0?H=new m.MercatorCoordinate((1-oe.y)/re(oe,H)+oe.x,1):H.y<0&&ee.y<=1&&(H=new m.MercatorCoordinate(-oe.y/re(oe,H)+oe.x,0)),ee.y>1&&H.y>=0?ee=new m.MercatorCoordinate((1-ie.y)/re(ie,ee)+ie.x,1):ee.y<0&&H.y<=1&&(ee=new m.MercatorCoordinate(-ie.y/re(ie,ee)+ie.x,0)),(new m.LngLatBounds).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(oe)).extend(this.coordinateLocation(ie))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=c.visibleDemTiles.reduce((v,w)=>{if(w.dem){const E=w.dem.tree;v.min=Math.min(v.min,E.minimums[0]),v.max=Math.max(v.max,E.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*c.exaggeration(),f.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-f*(1-this._horizonShift);return c?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-m.MAX_MERCATOR_LATITUDE,this.maxLat=m.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=m.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=m.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=m.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=m.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,f){return this.projection.createTileMatrix(this,f,c)}calculateDistanceTileData(c){const f=c.key,v=this._distanceTileDataCache;if(v[f])return v[f];const w=c.canonical,E=1/this.height,I=this.cameraWorldSize,O=I/this.zoomScale(w.z),R=(w.x+Math.pow(2,w.z)*c.wrap)*O,B=w.y*O,z=this.point;z.x*=I/this.worldSize,z.y*=I/this.worldSize;const H=this.angle,ee=Math.sin(-H),ie=-Math.cos(-H);return v[f]={bearing:[ee,ie],center:[(z.x-R)*E,(z.y-B)*E],scale:O/m.EXTENT*E},v[f]}calculateFogTileMatrix(c){const f=c.key,v=this._fogTileMatrixCache;if(v[f])return v[f];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return m.multiply(w,this.worldToFogMatrix,w),v[f]=new Float32Array(w),v[f]}calculateProjMatrix(c,f=!1){const v=c.key,w=f?this._alignedProjMatrixCache:this._projMatrixCache;if(w[v])return w[v];const E=this.calculatePosMatrix(c,this.worldSize);return m.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,E),w[v]=new Float32Array(E),w[v]}calculatePixelsToTileUnitsMatrix(c){const f=c.tileID.key,v=this._pixelsToTileUnitsCache;if(v[f])return v[f];const w=function(E,I){const{scale:O}=E.tileTransform,R=O*m.EXTENT/(E.tileSize*Math.pow(2,I.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return B=new Float32Array(4),ee=(z=I.inverseAdjustmentMatrix)[1],ie=z[2],oe=z[3],se=(H=[R,R])[1],B[0]=z[0]*(re=H[0]),B[1]=ee*re,B[2]=ie*se,B[3]=oe*se,B;var B,z,H,ee,ie,oe,re,se}(c,this);return v[f]=w,v[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,f=m.fromScaling([],[c,c,c]);return m.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const f=m.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),w=this._camera.forward(),E=m.mercatorZfromAltitude(1,this._center.lat);v[2]/=E,w[2]/=E,m.normalize(w,w);const I=c.raycast(v,w,c.exaggeration());if(I){const O=m.scaleAndAdd([],v,w,I),R=new m.MercatorCoordinate(O[0],O[1],m.mercatorZfromAltitude(O[2],m.latFromMercatorY(O[1]))),B=(R.z+m.length([R.x-v[0],R.y-v[1],R.z-v[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const f=this._elevation,v=m.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(v),E=f.getAtPointOrZero(new m.MercatorCoordinate(...w)),I=this.pixelsPerMeter/this.worldSize*E,O=this._minimumHeightOverTerrain(),R=w[2]-I;if(R<=O)if(R<0||c){const B=this.locationCoordinate(this._center,this._centerAltitude),z=[w[0],w[1],B.z-w[2]],H=m.length(z);z[2]-=(O-R)/this._pixelsPerMercatorPixel;const ee=m.length(z);if(0===ee)return;m.scale$2(z,z,H/ee*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],B.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const ee=this.center;return ee.lat=m.clamp(ee.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(ee.lng=m.clamp(ee.lng,this.minLng,this.maxLng)),this.center=ee,void(this._constraining=!1)}const f=this._unmodified,{x:v,y:w}=this.point;let E=0,I=v,O=w;const R=this.width/2,B=this.height/2,z=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(w-B<z&&(O=z+B),w+B>H&&(O=H-B),H-z<this.height&&(E=Math.max(E,this.height/(H-z)),O=(H+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ee=this.worldMinX*this.scale,ie=this.worldMaxX*this.scale,oe=this.worldSize/2-(ee+ie)/2;I=(v+oe+this.worldSize)%this.worldSize-oe,I-R<ee&&(I=ee+R),I+R>ie&&(I=ie-R),ie-ee<this.width&&(E=Math.max(E,this.width/(ie-ee)),I=(ie+ee)/2)}I===v&&O===w||(this.center=this.unproject(new m.Point(I,O))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,f=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=m.mercatorZfromAltitude(1,this.center.lat)/m.mercatorZfromAltitude(1,m.GLOBE_SCALE_MATCH_LATITUDE));const v=uo(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w="meters"===this.projection.zAxisUnit?f:1,E=this._camera.getWorldToCamera(this.worldSize,w),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-c.x/this.width,I[9]=2*c.y/this.height;let O=m.mul([],I,E);if(this.projection.isReprojectedInTileSpace){const we=this.locationCoordinate(this.center),xe=m.identity([]);m.translate(xe,xe,[we.x*this.worldSize,we.y*this.worldSize,0]),m.multiply(xe,xe,Br(this)),m.translate(xe,xe,[-we.x*this.worldSize,-we.y*this.worldSize,0]),m.multiply(O,O,xe),this.inverseAdjustmentMatrix=function(Ae){const Te=Br(Ae,!0);return Ct([],[Te[0],Te[1],Te[4],Te[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=m.scale([],O,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=O,this.invProjMatrix=m.invert(new Float64Array(16),this.projMatrix);const R=m.invert([],I);this.frustumCorners=m.FrustumCorners.fromInvProjectionMatrix(R,this.horizonLineFromTop(),this.height);const B=new Float32Array(16);m.identity(B),m.scale(B,B,[1,-1,1]),m.rotateX(B,B,this._pitch),m.rotateZ(B,B,this.angle);const z=m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-c.x/this.width,z[9]=2*(c.y+H)/this.height,this.skyboxMatrix=m.multiply(B,z,B);const ee=this.point,ie=ee.x,oe=ee.y,re=this.width%2/2,se=this.height%2/2,G=Math.cos(this.angle),ne=Math.sin(this.angle),ce=ie-Math.round(ie)+G*re+ne*se,ue=oe-Math.round(oe)+G*se+ne*re,be=new Float64Array(O);if(m.translate(be,be,[ce>.5?ce-1:ce,ue>.5?ue-1:ue,0]),this.alignedProjMatrix=be,O=m.create(),m.scale(O,O,[this.width/2,-this.height/2,1]),m.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=m.create(),m.scale(O,O,[1,-1,1]),m.translate(O,O,[-1,-1,0]),m.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},O=m.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=m.calculateGlobeMatrix(this);const we=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=m.transformMat4(we,we,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,v=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,E=[c,c,f];m.scale$2(E,E,w),m.scale$2(v,v,-1),m.multiply$2(v,v,E);const I=m.create();m.translate(I,I,v),m.scale(I,I,E),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,f,w)}_computeCameraPosition(c){const f=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),w=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-c/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-v[0]*E,w.y/this.worldSize-v[1]*E,c/this.worldSize*this._centerAltitude-v[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],w=c[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(E=Math.min((f-v)/w,1)),this._camera.position=m.scaleAndAdd([],this._camera.position,c,E),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,f=this._camera.forward(),{pitch:v,bearing:w}=this._camera.getPitchBearing(),E=m.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(m.degToRad(this._maxPitch)),O=Math.max((c[2]-E)/Math.cos(v),I),R=this._zoomFromMercatorZ(O);m.scaleAndAdd(c,c,f,O),this._pitch=m.clamp(v,m.degToRad(this.minPitch),m.degToRad(this.maxPitch)),this.angle=m.wrap(w,-Math.PI,Math.PI),this._setZoom(m.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new m.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let f=0,v=m.GLOBE_ZOOM_THRESHOLD_MAX,w=0,E=1/0;for(;v-f>1e-6&&v>f;){const I=f+.5*(v-f),O=this.tileSize*Math.pow(2,I),R=this.getCameraToCenterDistance(this.projection,I,O),B=this.scaleZoom(R/(c*this.tileSize)),z=Math.abs(I-B);z<E&&(E=z,w=I),I<B?f=I:v=I}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(m.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,f){const v=Math.min(c.x,f.x),w=Math.max(c.x,f.x),E=Math.min(c.y,f.y),I=Math.max(c.y,f.y);if(E<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const O=[new m.Point(v,E),new m.Point(w,I),new m.Point(v,I),new m.Point(w,E)],R=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const z of O){const H=this.pointRayIntersection(z);if(H.t<0)return!0;const ee=this.rayIntersectionCoordinate(H);if(ee.x<R||ee.y<0||ee.x>B||ee.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+m.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new m.Point(0,0),new m.Point(this.width,this.height))}zoomDeltaToMovement(c,f){const v=m.length(m.sub([],this._camera.position,c)),w=this._zoomFromMercatorZ(v)+f;return v-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const c=function([f,v,w],E){const I=[f,v,w,1];m.transformMat4$1(I,I,E);const O=I[3]=Math.max(I[3],1e-6);return I[0]/=O,I[1]/=O,I[2]/=O,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new m.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,c))}}getCameraToCenterDistance(c,f=this.zoom,v=this.worldSize){const w=uo(c,f,this.width,this.height,1024),E=c.pixelSpaceConversion(this.center.lat,v,w);return.5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&m.multiply(c,c,this.globeMatrix),c}}function Mu(g,c){let f=!1,v=null;const w=()=>{v=null,f&&(g(),v=setTimeout(w,c),f=!1)};return()=>(f=!0,v||w(),v)}class sr{constructor(c){this._hashName=c&&encodeURIComponent(c),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Mu(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,m.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),m.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const f=$t(c);if(this._hashName){const v=this._hashName;let w=!1;const E=m.window.location.hash.slice(1).split("&").map(I=>{const O=I.split("=")[0];return O===v?(w=!0,`${O}=${f}`):I}).filter(I=>I);return w||E.push(`${v}=${f}`),`#${E.join("&")}`}return`#${f}`}_getCurrentHash(){const c=m.window.location.hash.replace("#","");if(this._hashName){let f;return c.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(f=v)}),(f&&f[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(v=>isNaN(v))){const v=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(f[3]||0):c.getBearing();return c.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=m.window.location.href.replace(/(#.+)?$/,this.getHashString());m.window.history.replaceState(m.window.history.state,null,c)}}function $t(g,c){const f=g.getCenter(),v=Math.round(100*g.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,w),I=Math.round(f.lng*E)/E,O=Math.round(f.lat*E)/E,R=g.getBearing(),B=g.getPitch();let z=c?`/${I}/${O}/${v}`:`${v}/${O}/${I}`;return(R||B)&&(z+="/"+Math.round(10*R)/10),B&&(z+=`/${Math.round(B)}`),z}const bn={linearity:.3,easing:m.bezier(0,0,.3,1)},Ni=m.extend({deceleration:2500,maxSpeed:1400},bn),Fo=m.extend({deceleration:20,maxSpeed:1400},bn),Ot=m.extend({deceleration:1e3,maxSpeed:360},bn),ji=m.extend({deceleration:1e3,maxSpeed:90},bn);class _c{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,f=m.exported.now();for(;c.length>0&&f-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(f.pan.mag()){const E=ms(f.pan.mag(),v,m.extend({},Ni,c||{}));w.offset=f.pan.mult(E.amount/f.pan.mag()),w.center=this._map.transform.center,Zi(w,E)}if(f.zoom){const E=ms(f.zoom,v,Fo);w.zoom=this._map.transform.zoom+E.amount,Zi(w,E)}if(f.bearing){const E=ms(f.bearing,v,Ot);w.bearing=this._map.transform.bearing+m.clamp(E.amount,-179,179),Zi(w,E)}if(f.pitch){const E=ms(f.pitch,v,ji);w.pitch=this._map.transform.pitch+E.amount,Zi(w,E)}if(w.zoom||w.bearing){const E=void 0===f.pinchAround?f.around:f.pinchAround;w.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Zi(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function ms(g,c,f){const{maxSpeed:v,linearity:w,deceleration:E}=f,I=m.clamp(g*w/(c/1e3),-v,v),O=Math.abs(I)/(E*w);return{easing:f.easing,duration:1e3*O,amount:I*(O/2)}}class ar extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,v,w={}){const E=Ro(f.getCanvasContainer(),v),I=f.unproject(E);super(c,m.extend({point:E,lngLat:I,originalEvent:v},w)),this._defaultPrevented=!1,this.target=f}}class mn extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,v){const w="touchend"===c?v.changedTouches:v.touches,E=Jl(f.getCanvasContainer(),w),I=E.map(R=>f.unproject(R)),O=E.reduce((R,B,z,H)=>R.add(B.div(H.length)),new m.Point(0,0));super(c,{points:E,point:O,lngLats:I,lngLat:f.unproject(O),originalEvent:v}),this._defaultPrevented=!1}}class xl extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,v){super(c,{originalEvent:v}),this._defaultPrevented=!1}}class yf{constructor(c,f){this._map=c,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new xl(c.type,this._map,c))}mousedown(c,f){return this._mousedownPos=f,this._firePreventable(new ar(c.type,this._map,c))}mouseup(c){this._map.fire(new ar(c.type,this._map,c))}preclick(c){const f=m.extend({},c);f.type="preclick",this._map.fire(new ar(f.type,this._map,f))}click(c,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(c),this._map.fire(new ar(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new ar(c.type,this._map,c))}mouseover(c){this._map.fire(new ar(c.type,this._map,c))}mouseout(c){this._map.fire(new ar(c.type,this._map,c))}touchstart(c){return this._firePreventable(new mn(c.type,this._map,c))}touchmove(c){this._map.fire(new mn(c.type,this._map,c))}touchend(c){this._map.fire(new mn(c.type,this._map,c))}touchcancel(c){this._map.fire(new mn(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $a{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new ar(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new ar(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yr{constructor(c,f){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,f){this.isEnabled()&&c.shiftKey&&0===c.button&&(bd(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(c,f){if(!this._active)return;const v=f,w=this._startPos,E=this._lastPos;if(!w||!E||E.equals(v)||!this._box&&v.dist(w)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=wn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const I=Math.min(w.x,v.x),O=Math.max(w.x,v.x),R=Math.min(w.y,v.y),B=Math.max(w.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${R}px)`,this._box.style.width=O-I+"px",this._box.style.height=B-R+"px")})}mouseupWindow(c,f){if(!this._active)return;const v=this._startPos,w=f;if(v&&0===c.button){if(this.reset(),cs(),v.x!==w.x||v.y!==w.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:E=>E.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ru(),delete this._startPos,delete this._lastPos}_fireEvent(c,f){return this._map.fire(new m.Event(c,{originalEvent:f}))}}function wl(g,c){const f={};for(let v=0;v<g.length;v++)f[g[v].identifier]=c[v];return f}class Us{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const E=new m.Point(0,0);for(const I of w)E._add(I);return E.div(w.length)}(f),this.touches=wl(v,f)))}touchmove(c,f,v){if(this.aborted||!this.centroid)return;const w=wl(v,f);for(const E in this.touches){const I=w[E];(!I||I.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(c,f,v){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class gs{constructor(c){this.singleTap=new Us(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,f,v){this.singleTap.touchstart(c,f,v)}touchmove(c,f,v){this.singleTap.touchmove(c,f,v)}touchend(c,f,v){const w=this.singleTap.touchend(c,f,v);if(w){const E=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(w)<30;if(E&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Ud{constructor(){this._zoomIn=new gs({numTouches:1,numTaps:2}),this._zoomOut=new gs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,f,v){this._zoomIn.touchstart(c,f,v),this._zoomOut.touchstart(c,f,v)}touchmove(c,f,v){this._zoomIn.touchmove(c,f,v),this._zoomOut.touchmove(c,f,v)}touchend(c,f,v){const w=this._zoomIn.touchend(c,f,v),E=this._zoomOut.touchend(c,f,v);return w?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(w)},{originalEvent:c})}):E?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(E)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Jp={0:1,2:2};class Qo{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,f){return!1}_move(c,f){return{}}mousedown(c,f){if(this._lastPoint)return;const v=La(c);this._correctButton(c,v)&&(this._lastPoint=f,this._eventButton=v)}mousemoveWindow(c,f){const v=this._lastPoint;if(v)if(c.preventDefault(),null!=this._eventButton&&function(w,E){const I=Jp[E];return void 0===w.buttons||(w.buttons&I)!==I}(c,this._eventButton))this.reset();else if(this._moved||!(f.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(v,f)}mouseupWindow(c){this._lastPoint&&La(c)===this._eventButton&&(this._moved&&cs(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class js extends Qo{mousedown(c,f){super.mousedown(c,f),this._lastPoint&&(this._active=!0)}_correctButton(c,f){return 0===f&&!c.ctrlKey}_move(c,f){return{around:f,panDelta:f.sub(c)}}}class Du extends Qo{_correctButton(c,f){return 0===f&&c.ctrlKey||2===f}_move(c,f){const v=.8*(f.x-c.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(c){c.preventDefault()}}class Tu extends Qo{_correctButton(c,f){return 0===f&&c.ctrlKey||2===f}_move(c,f){const v=-.5*(f.y-c.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(c){c.preventDefault()}}class jn{constructor(c,f){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),m.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)}touchstart(c,f,v){return this._calculateTransform(c,f,v)}touchmove(c,f,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===v.length&&!m.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,f,v)}}touchend(c,f,v){this._calculateTransform(c,f,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,f,v){v.length>0&&(this._active=!0);const w=wl(v,f),E=new m.Point(0,0),I=new m.Point(0,0);let O=0;for(const B in w){const z=w[B],H=this._touches[B];H&&(E._add(z),I._add(z.sub(H)),O++,w[B]=z)}if(this._touches=w,O<this._minTouches||!I.mag())return;const R=I.div(O);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(O),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=wn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class vf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,f,v){return{}}touchstart(c,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(c,f,v){const w=this._firstTwoTouches;if(!w)return;c.preventDefault();const[E,I]=w,O=yc(v,f,E),R=yc(v,f,I);if(!O||!R)return;const B=this._aroundCenter?null:O.add(R).div(2);return this._move([O,R],B,c)}touchend(c,f,v){if(!this._firstTwoTouches)return;const[w,E]=this._firstTwoTouches,I=yc(v,f,w),O=yc(v,f,E);I&&O||(this._active&&cs(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yc(g,c,f){for(let v=0;v<g.length;v++)if(g[v].identifier===f)return c[v]}function bf(g,c){return Math.log(g/c)/Math.LN2}class $s extends vf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,f){const v=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(bf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bf(this._distance,v),pinchAround:f}}}function Su(g,c){return 180*g.angleWith(c)/Math.PI}class vc extends vf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,f){const v=this._vector;if(this._vector=c[0].sub(c[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Su(this._vector,v),pinchAround:f}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const f=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const w=Su(c,v);return Math.abs(w)<f}}function _s(g){return Math.abs(g.y)>Math.abs(g.x)}class Yr extends vf{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,_s(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,f,v){const w=this._lastPoints;if(!w)return;const E=c[0].sub(w[0]),I=c[1].sub(w[1]);return this._map._cooperativeGestures&&!m.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(E,I,v.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(E.y+I.y)/2*-.5})}gestureBeginsVertically(c,f,v){if(void 0!==this._valid)return this._valid;const w=c.mag()>=2,E=f.mag()>=2;if(!w&&!E)return;if(!w||!E)return null==this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const I=c.y>0==f.y>0;return _s(c)&&_s(f)&&I}}const av={panStep:100,bearingStep:15,pitchStep:10};class No{constructor(){const c=av;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let f=0,v=0,w=0,E=0,I=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?v=-1:(c.preventDefault(),E=-1);break;case 39:c.shiftKey?v=1:(c.preventDefault(),E=1);break;case 38:c.shiftKey?w=1:(c.preventDefault(),I=-1);break;case 40:c.shiftKey?w=-1:(c.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:O=>{const R=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:Co,zoom:f?Math.round(R)+f*(c.shiftKey?2:1):R,bearing:O.getBearing()+v*this._bearingStep,pitch:O.getPitch()+w*this._pitchStep,offset:[-E*this._panStep,-I*this._panStep],center:O.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Co(g){return g*(2-g)}const jd=4.000244140625;class Cl{constructor(c,f){this._map=c,this._el=c.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,m.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||m.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=c.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const v=m.exported.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==f&&f%jd==0?this._type="wheel":0!==f&&Math.abs(f)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(w*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),c.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=c,this._delta-=f,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=Ro(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>jd?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==B&&(B=1/B);const z=f(),H=Math.pow(2,z),ee="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(ee*B))),"wheel"===this._type&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:f(),w=this._startZoom,E=this._easing;let I,O=!1;if("wheel"===this._type&&w&&E){const R=Math.min((m.exported.now()-this._lastWheelEventTime)/200,1),B=E(R);I=m.number(w,v,B),R<1?this._frameId||(this._frameId=!0):O=!0}else I=v,O=!0;return this._active=!0,O&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!O,zoomDelta:I-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let f=m.ease;if(this._prevEase){const v=this._prevEase,w=(m.exported.now()-v.start)/v.duration,E=v.easing(w+.01)-v.easing(w),I=.27/Math.sqrt(E*E+1e-4)*.01,O=Math.sqrt(.0729-I*I);f=m.bezier(I,O,.25,1)}return this._prevEase={start:m.exported.now(),duration:c,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=wn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(m.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class $d{constructor(c,f){this._clickZoom=c,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $i{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,f){return c.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(c.shiftKey?-1:1),around:v.unproject(f)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class em{constructor(){this._tap=new gs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,f,v){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=f[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(c,f,v))}touchmove(c,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=f[0],E=w.y-this._swipePoint.y;return this._swipePoint=w,c.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(c,f,v)}touchend(c,f,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(c,f,v)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class t_{constructor(c,f,v){this._el=c,this._mousePan=f,this._touchPan=v}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class lv{constructor(c,f,v){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=f,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class N1{constructor(c,f,v,w){this._el=c,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ys=g=>g.zoom||g.drag||g.pitch||g.rotate;class n_ extends m.Event{}class z1{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,f){const v=m.sub([],f,c);this.radius=m.length(v[2]<0?m.div([],v,this.constants):[v[0],v[1],0])}projectRay(c){m.div(c,c,this.constants),m.normalize(c,c),m.mul$1(c,c,this.constants);const f=m.scale$2([],c,this.radius);if(f[2]>0){const v=m.scale$2([],[0,0,1],m.dot(f,[0,0,1])),w=m.scale$2([],m.normalize([],[f[0],f[1],0]),this.radius),E=m.add([],f,m.scale$2([],m.sub([],m.add([],w,v),f),2));f[0]=E[0],f[1]=E[1]}return f}}function pa(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Ha{constructor(c,f){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _c(c),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new z1,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[m.window,"blur",void 0]];for(const[w,E,I]of this._listeners)w.addEventListener(E,w===m.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[c,f,v]of this._listeners)c.removeEventListener(f,c===m.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(c){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new yf(f,c));const w=f.boxZoom=new yr(f,c);this._add("boxZoom",w);const E=new Ud,I=new $i;f.doubleClickZoom=new $d(I,E),this._add("tapZoom",E),this._add("clickZoom",I);const O=new em;this._add("tapDragZoom",O);const R=f.touchPitch=new Yr(f);this._add("touchPitch",R);const B=new Du(c),z=new Tu(c);f.dragRotate=new lv(c,B,z),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const H=new js(c),ee=new jn(f,c);f.dragPan=new t_(v,H,ee),this._add("mousePan",H),this._add("touchPan",ee,["touchZoom","touchRotate"]);const ie=new vc,oe=new $s;f.touchZoomRotate=new N1(v,oe,ie,O),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new $a(f));const re=f.scrollZoom=new Cl(f,this);this._add("scrollZoom",re,["mousePan"]);const se=f.keyboard=new No;this._add("keyboard",se);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[G]&&f[G].enable(c[G])}_add(c,f,v){this._handlers.push({handlerName:c,handler:f,allowed:v}),this._handlersById[c]=f}stop(c){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ys(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,f,v){for(const w in c)if(w!==v&&(!f||f.indexOf(w)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const f=[];for(const v of c)this._el.contains(v.target)&&f.push(v);return f}handleEvent(c,f){this._updatingCamera=!0;const v="renderFrame"===c.type,w=v?void 0:c,E={needsRenderFrame:!1},I={},O={},R=c.touches?this._getMapTouches(c.touches):void 0,B=R?Jl(this._el,R):v?void 0:Ro(this._el,c);for(const{handlerName:ee,handler:ie,allowed:oe}of this._handlers){if(!ie.isEnabled())continue;let re;this._blockedByActive(O,oe,ee)?ie.reset():ie[f||c.type]&&(re=ie[f||c.type](c,B,R),this.mergeHandlerResult(E,I,re,ee,w),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||ie.isActive())&&(O[ee]=ie)}const z={};for(const ee in this._previousActiveHandlers)O[ee]||(z[ee]=w);this._previousActiveHandlers=O,(Object.keys(z).length||pa(E))&&(this._changes.push([E,I,z]),this._triggerRenderFrame()),(Object.keys(O).length||pa(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=E;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(c,f,v,w,E){if(!v)return;m.extend(c,v);const I={handlerName:w,originalEvent:v.originalEvent||E};void 0!==v.zoomDelta&&(f.zoom=I),void 0!==v.panDelta&&(f.drag=I),void 0!==v.pitchDelta&&(f.pitch=I),void 0!==v.bearingDelta&&(f.rotate=I)}_applyChanges(){const c={},f={},v={};for(const[w,E,I]of this._changes)w.panDelta&&(c.panDelta=(c.panDelta||new m.Point(0,0))._add(w.panDelta)),w.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(c.around=w.around),void 0!==w.aroundCoord&&(c.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(c.pinchAround=w.pinchAround),w.noInertia&&(c.noInertia=w.noInertia),m.extend(f,E),m.extend(v,I);this._updateMapTransform(c,f,v),this._changes=[]}_updateMapTransform(c,f,v){const w=this._map,E=w.transform,I=ne=>[ne.x,ne.y,ne.z];if((ne=>{const ce=this._eventsInProgress.drag;return ce&&!this._handlersById[ce.handlerName].isActive()})()&&!pa(c)){const ne=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",ne!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&w._stop(!0),!pa(c))return void this._fireEvents(f,v,!0);let{panDelta:O,zoomDelta:R,bearingDelta:B,pitchDelta:z,around:H,aroundCoord:ee,pinchAround:ie}=c;E._isCameraConstrained&&(R>0&&(R=0),E._isCameraConstrained=!1),void 0!==ie&&(H=ie),(R||(ne=>f.drag&&!this._eventsInProgress.drag)())&&H&&(this._dragOrigin=I(E.pointCoordinate3D(H)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",w._stop(!0),H=H||w.transform.centerPoint,B&&(E.bearing+=B),z&&(E.pitch+=z),E._updateCameraState();const oe=[0,0,0];if(O)if("mercator"===E.projection.name){const ne=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(H).dir),ce=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(H.sub(O)).dir);oe[0]=ce[0]-ne[0],oe[1]=ce[1]-ne[1]}else{const ne=E.pointCoordinate(H);if("globe"===E.projection.name){O=O.rotate(-E.angle);const ce=E._pixelsPerMercatorPixel/E.worldSize;oe[0]=-O.x*m.mercatorScale(m.latFromMercatorY(ne.y))*ce,oe[1]=-O.y*m.mercatorScale(E.center.lat)*ce}else{const ce=E.pointCoordinate(H.sub(O));ne&&ce&&(oe[0]=ce.x-ne.x,oe[1]=ce.y-ne.y)}}const re=E.zoom,se=[0,0,0];if(R){const ne=I(ee||E.pointCoordinate3D(H)),ce={dir:m.normalize([],m.sub([],ne,E._camera.position))};if(ce.dir[2]<0){const ue=E.zoomDeltaToMovement(ne,R);m.scale$2(se,ce.dir,ue)}}const G=m.add(oe,oe,se);E._translateCameraConstrained(G),R&&Math.abs(E.zoom-re)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(f,v,!0)}_fireEvents(c,f,v){const w=ys(this._eventsInProgress),E=ys(c),I={};for(const z in c){const{originalEvent:H}=c[z];this._eventsInProgress[z]||(I[`${z}start`]=H),this._eventsInProgress[z]=c[z]}!w&&E&&this._fireEvent("movestart",E.originalEvent);for(const z in I)this._fireEvent(z,I[z]);E&&this._fireEvent("move",E.originalEvent);for(const z in c){const{originalEvent:H}=c[z];this._fireEvent(z,H)}const O={};let R;for(const z in this._eventsInProgress){const{handlerName:H,originalEvent:ee}=this._eventsInProgress[z];this._handlersById[H].isActive()||(delete this._eventsInProgress[z],R=f[H]||ee,O[`${z}end`]=R)}for(const z in O)this._fireEvent(z,O[z]);const B=ys(this._eventsInProgress);if(v&&(w||E)&&!B){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=ee=>0!==ee&&-this._bearingSnap<ee&&ee<this._bearingSnap;z?(H(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:R})):(this._map.fire(new m.Event("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,f){this._map.fire(new m.Event(c,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new n_("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Iu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class tm extends m.Evented{constructor(c,f){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=!1!==f.respectPrefersReducedMotion,m.bindAll(["_renderFrameCallback"],this)}getCenter(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,f){return this.jumpTo({center:c},f)}panBy(c,f,v){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},f),v)}panTo(c,f,v){return this.easeTo(m.extend({center:c},f),v)}getZoom(){return this.transform.zoom}setZoom(c,f){return this.jumpTo({zoom:c},f),this}zoomTo(c,f,v){return this.easeTo(m.extend({zoom:c},f),v)}zoomIn(c,f){return this.zoomTo(this.getZoom()+1,c,f),this}zoomOut(c,f){return this.zoomTo(this.getZoom()-1,c,f),this}getBearing(){return this.transform.bearing}setBearing(c,f){return this.jumpTo({bearing:c},f),this}getPadding(){return this.transform.padding}setPadding(c,f){return this.jumpTo({padding:c},f),this}rotateTo(c,f,v){return this.easeTo(m.extend({bearing:c},f),v)}resetNorth(c,f){return this.rotateTo(0,m.extend({duration:1e3},c),f),this}resetNorthPitch(c,f){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),f),this}snapToNorth(c,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,f):this}getPitch(){return this.transform.pitch}setPitch(c,f){return this.jumpTo({pitch:c},f),this}cameraForBounds(c,f){c=m.LngLatBounds.convert(c);const v=f&&f.bearing||0,w=f&&f.pitch||0,E=c.getNorthWest(),I=c.getSouthEast();return this._cameraForBounds(this.transform,E,I,v,w,f)}_extendCameraOptions(c){const f={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=m.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const v=c.padding;c.padding={top:v,bottom:v,right:v,left:v}}return c.padding=m.extend(f,c.padding),c}_minimumAABBFrustumDistance(c,f){const v=f.max[0]-f.min[0],w=f.max[1]-f.min[1];return v/w>c.aspect?v/(2*Math.tan(.5*c.fovX)*c.aspect):w/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,f,v,w,E,I){const O=c.clone(),R=this._extendCameraOptions(I);O.bearing=w,O.pitch=E;const B=m.LngLat.convert(f),z=m.LngLat.convert(v),H=.5*(B.lat+z.lat),ee=.5*(B.lng+z.lng),ie=m.latLngToECEF(H,ee),oe=m.normalize([],ie),re=m.normalize([],m.cross([],oe,[0,1,0])),se=m.cross([],re,oe),G=[re[0],re[1],re[2],0,se[0],se[1],se[2],0,oe[0],oe[1],oe[2],0,0,0,0,1],ne=[ie,m.latLngToECEF(B.lat,B.lng),m.latLngToECEF(z.lat,B.lng),m.latLngToECEF(z.lat,z.lng),m.latLngToECEF(B.lat,z.lng),m.latLngToECEF(H,B.lng),m.latLngToECEF(H,z.lng),m.latLngToECEF(B.lat,ee),m.latLngToECEF(z.lat,ee)];let ce=m.Aabb.fromPoints(ne.map(et=>[m.dot(re,et),m.dot(se,et),m.dot(oe,et)]));const ue=m.transformMat4([],ce.center,G);0===m.squaredLength(ue)&&m.set(ue,0,0,1),m.normalize(ue,ue),m.scale$2(ue,ue,m.GLOBE_RADIUS),O.center=m.ecefToLatLng(ue);const be=O.getWorldToCameraMatrix(),we=m.invert(new Float64Array(16),be);ce=m.Aabb.applyTransform(ce,m.multiply([],be,G)),m.transformMat4(ue,ue,be);const xe=.5*(ce.max[2]-ce.min[2]),Ae=this._minimumAABBFrustumDistance(O,ce),Te=m.scale$2([],[0,0,1],xe),Ne=m.add(Te,ue,Te),ut=Ae+(0===O.pitch?0:m.distance(ue,Ne)),Re=O.globeCenterInViewSpace,Ze=m.sub([],ue,[Re[0],Re[1],Re[2]]);m.normalize(Ze,Ze),m.scale$2(Ze,Ze,ut);const Ve=m.add([],ue,Ze);m.transformMat4(Ve,Ve,we);const lt=m.earthRadius/m.GLOBE_RADIUS,Le=m.length(Ve),We=m.mercatorZfromAltitude(Math.max(Le*lt-m.earthRadius,Number.EPSILON),0),nt=Math.min(O.zoomFromMercatorZAdjusted(We),R.maxZoom);return nt>.5*(m.GLOBE_ZOOM_THRESHOLD_MIN+m.GLOBE_ZOOM_THRESHOLD_MAX)?(O.setProjection({name:"mercator"}),O.zoom=nt,this._cameraForBounds(O,f,v,w,E,I)):{center:O.center,zoom:nt,bearing:w,pitch:E}}queryTerrainElevation(c,f){const v=this.transform.elevation;return v?(f=m.extend({},{exaggerated:!0},f),v.getAtPoint(m.MercatorCoordinate.fromLngLat(c),null,f.exaggerated)):null}_cameraForBounds(c,f,v,w,E,I){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,f,v,w,E,I);const O=c.clone(),R=this._extendCameraOptions(I),B=O.padding;O.bearing=w,O.pitch=E;const z=m.LngLat.convert(f),H=m.LngLat.convert(v),ee=new m.LngLat(z.lng,H.lat),ie=new m.LngLat(H.lng,z.lat),oe=O.project(z),re=O.project(H),se=this.queryTerrainElevation(z),G=this.queryTerrainElevation(H),ne=this.queryTerrainElevation(ee),ce=this.queryTerrainElevation(ie),ue=[[oe.x,oe.y,Math.min(se||0,G||0,ne||0,ce||0)],[re.x,re.y,Math.max(se||0,G||0,ne||0,ce||0)]];let be=m.Aabb.fromPoints(ue);const we=O.getWorldToCameraMatrix(),xe=m.invert(new Float64Array(16),we);be=m.Aabb.applyTransform(be,we);const Ae=m.sub([],be.max,be.min),Te=B.left||0,Ne=B.right||0,ut=B.bottom||0,Re=B.top||0,{left:Ze,right:Ve,top:lt,bottom:Le}=R.padding,We=.5*(Te+Ne),nt=.5*(Re+ut),et=Math.min(O.scaleZoom(O.scale*Math.min((O.width-(Te+Ne+Ze+Ve))/Ae[0],(O.height-(ut+Re+Le+lt))/Ae[1])),R.maxZoom),dt=O.scale/O.zoomScale(et);be=new m.Aabb([be.min[0]-(Ze+We)*dt,be.min[1]-(Le+nt)*dt,be.min[2]],[be.max[0]+(Ve+We)*dt,be.max[1]+(lt+nt)*dt,be.max[2]]);const Et=.5*Ae[2],on=this._minimumAABBFrustumDistance(O,be),Ut=[0,0,1,0];m.transformMat4$1(Ut,Ut,we),m.normalize$2(Ut,Ut);const Gt=m.scale$2([],Ut,on+Et),Rn=m.add([],be.center,Gt),Dn=("number"==typeof R.offset.x&&"number"==typeof R.offset.y?new m.Point(R.offset.x,R.offset.y):m.Point.convert(R.offset)).rotate(-m.degToRad(w));be.center[0]-=Dn.x*dt,be.center[1]+=Dn.y*dt,m.transformMat4(be.center,be.center,xe),m.transformMat4(Rn,Rn,xe);const qt=[be.center[0],be.center[1],Rn[2]*O.pixelsPerMeter];m.scale$2(qt,qt,1/O.worldSize);const Tn=m.lngFromMercatorX(qt[0]),_i=m.latFromMercatorY(qt[1]),yi=Math.min(O._zoomFromMercatorZ(qt[2]),R.maxZoom),vi=new m.LngLat(Tn,_i);return O.mercatorFromTransition&&yi<.5*(m.GLOBE_ZOOM_THRESHOLD_MIN+m.GLOBE_ZOOM_THRESHOLD_MAX)?(O.setProjection({name:"globe"}),O.zoom=yi,this._cameraForBounds(O,f,v,w,E,I)):{center:vi,zoom:yi,bearing:w,pitch:E}}fitBounds(c,f,v){const w=this.cameraForBounds(c,f);return this._fitInternal(w,f,v)}fitScreenCoordinates(c,f,v,w,E){const I=m.Point.convert(c),O=m.Point.convert(f),R=new m.Point(Math.min(I.x,O.x),Math.min(I.y,O.y)),B=new m.Point(Math.max(I.x,O.x),Math.max(I.y,O.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,O))return this;const z=this.transform.pointLocation3D(R),H=this.transform.pointLocation3D(B),ee=this.transform.pointLocation3D(new m.Point(R.x,B.y)),ie=this.transform.pointLocation3D(new m.Point(B.x,R.y)),oe=[Math.min(z.lng,H.lng,ee.lng,ie.lng),Math.min(z.lat,H.lat,ee.lat,ie.lat)],re=[Math.max(z.lng,H.lng,ee.lng,ie.lng),Math.max(z.lat,H.lat,ee.lat,ie.lat)],se=w&&w.pitch?w.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,oe,re,v,se,w);return this._fitInternal(G,w,E)}_fitInternal(c,f,v){return c?(delete(f=m.extend(c,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(c,f){this.stop();const v=c.preloadOnly?this.transform.clone():this.transform;let w=!1,E=!1,I=!1;return"zoom"in c&&v.zoom!==+c.zoom&&(w=!0,v.zoom=+c.zoom),void 0!==c.center&&(v.center=m.LngLat.convert(c.center)),"bearing"in c&&v.bearing!==+c.bearing&&(E=!0,v.bearing=+c.bearing),"pitch"in c&&v.pitch!==+c.pitch&&(I=!0,v.pitch=+c.pitch),null==c.padding||v.isPaddingEqual(c.padding)||(v.padding=c.padding),c.preloadOnly?(this._preloadTiles(v),this):(this.fire(new m.Event("movestart",f)).fire(new m.Event("move",f)),w&&this.fire(new m.Event("zoomstart",f)).fire(new m.Event("zoom",f)).fire(new m.Event("zoomend",f)),E&&this.fire(new m.Event("rotatestart",f)).fire(new m.Event("rotate",f)).fire(new m.Event("rotateend",f)),I&&this.fire(new m.Event("pitchstart",f)).fire(new m.Event("pitch",f)).fire(new m.Event("pitchend",f)),this.fire(new m.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||m.warnOnce(Iu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,f){const v=this.transform;if(!v.projection.supportsFreeCamera)return m.warnOnce(Iu),this;this.stop();const w=v.zoom,E=v.pitch,I=v.bearing;v.setFreeCameraOptions(c);const O=w!==v.zoom,R=E!==v.pitch,B=I!==v.bearing;return this.fire(new m.Event("movestart",f)).fire(new m.Event("move",f)),O&&this.fire(new m.Event("zoomstart",f)).fire(new m.Event("zoom",f)).fire(new m.Event("zoomend",f)),B&&this.fire(new m.Event("rotatestart",f)).fire(new m.Event("rotate",f)).fire(new m.Event("rotateend",f)),R&&this.fire(new m.Event("pitchstart",f)).fire(new m.Event("pitch",f)).fire(new m.Event("pitchend",f)),this.fire(new m.Event("moveend",f)),this}easeTo(c,f){this._stop(!1,c.easeId),(!1===(c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const v=this.transform,w=this.getZoom(),E=this.getBearing(),I=this.getPitch(),O=this.getPadding(),R="zoom"in c?+c.zoom:w,B="bearing"in c?this._normalizeBearing(c.bearing,E):E,z="pitch"in c?+c.pitch:I,H="padding"in c?c.padding:v.padding,ee=m.Point.convert(c.offset);let ie,oe,re;if("globe"===v.projection.name){const Te=m.MercatorCoordinate.fromLngLat(v.center),Ne=ee.rotate(-v.angle);Te.x+=Ne.x/v.worldSize,Te.y+=Ne.y/v.worldSize;const ut=Te.toLngLat(),Re=m.LngLat.convert(c.center||ut);this._normalizeCenter(Re),ie=v.centerPoint.add(Ne),oe=new m.Point(Te.x,Te.y).mult(v.worldSize),re=new m.Point(m.mercatorXfromLng(Re.lng),m.mercatorYfromLat(Re.lat)).mult(v.worldSize).sub(oe)}else{ie=v.centerPoint.add(ee);const Te=v.pointLocation(ie),Ne=m.LngLat.convert(c.center||Te);this._normalizeCenter(Ne),oe=v.project(Te),re=v.project(Ne).sub(oe)}const se=v.zoomScale(R-w);let G,ne;c.around&&(G=m.LngLat.convert(c.around),ne=v.locationPoint(G));const ce=this._zooming||R!==w,ue=this._rotating||E!==B,be=this._pitching||z!==I,we=!v.isPaddingEqual(H),xe=Te=>Ne=>{if(ce&&(Te.zoom=m.number(w,R,Ne)),ue&&(Te.bearing=m.number(E,B,Ne)),be&&(Te.pitch=m.number(I,z,Ne)),we&&(Te.interpolatePadding(O,H,Ne),ie=Te.centerPoint.add(ee)),G)Te.setLocationAtPoint(G,ne);else{const ut=Te.zoomScale(Te.zoom-w),Re=R>w?Math.min(2,se):Math.max(.5,se),Ze=Math.pow(Re,1-Ne),Ve=Te.unproject(oe.add(re.mult(Ne*Ze)).mult(ut));Te.setLocationAtPoint(Te.renderWorldCopies?Ve.wrap():Ve,ie)}return c.preloadOnly||this._fireMoveEvents(f),Te};if(c.preloadOnly){const Te=this._emulate(xe,c.duration,v);return this._preloadTiles(Te),this}const Ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ce,this._rotating=ue,this._pitching=be,this._padding=we,this._easeId=c.easeId,this._prepareEase(f,c.noMoveStart,Ae),this._ease(xe(v),Te=>{v.recenterOnTerrain(),this._afterEase(f,Te)},c),this}_prepareEase(c,f,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||v.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!v.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!v.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!v.pitching&&this.fire(new m.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))}_afterEase(c,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,w=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),E&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}flyTo(c,f){if(this._prefersReducedMotion(c)){const et=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(et,f)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);const v=this.transform,w=this.getZoom(),E=this.getBearing(),I=this.getPitch(),O=this.getPadding(),R="zoom"in c?m.clamp(+c.zoom,v.minZoom,v.maxZoom):w,B="bearing"in c?this._normalizeBearing(c.bearing,E):E,z="pitch"in c?+c.pitch:I,H="padding"in c?c.padding:v.padding,ee=v.zoomScale(R-w),ie=m.Point.convert(c.offset);let oe=v.centerPoint.add(ie);const re=v.pointLocation(oe),se=m.LngLat.convert(c.center||re);this._normalizeCenter(se);const G=v.project(re),ne=v.project(se).sub(G);let ce=c.curve;const ue=Math.max(v.width,v.height),be=ue/ee,we=ne.mag();if("minZoom"in c){const et=m.clamp(Math.min(c.minZoom,w,R),v.minZoom,v.maxZoom),dt=ue/v.zoomScale(et-w);ce=Math.sqrt(dt/we*2)}const xe=ce*ce;function Ae(et){const dt=(be*be-ue*ue+(et?-1:1)*xe*xe*we*we)/(2*(et?be:ue)*xe*we);return Math.log(Math.sqrt(dt*dt+1)-dt)}function Te(et){return(Math.exp(et)-Math.exp(-et))/2}function Ne(et){return(Math.exp(et)+Math.exp(-et))/2}const ut=Ae(0);let Re=function(et){return Ne(ut)/Ne(ut+ce*et)},Ze=function(et){return ue*((Ne(ut)*(Te(dt=ut+ce*et)/Ne(dt))-Te(ut))/xe)/we;var dt},Ve=(Ae(1)-ut)/ce;if(Math.abs(we)<1e-6||!isFinite(Ve)){if(Math.abs(ue-be)<1e-6)return this.easeTo(c,f);const et=be<ue?-1:1;Ve=Math.abs(Math.log(be/ue))/ce,Ze=function(){return 0},Re=function(dt){return Math.exp(et*ce*dt)}}c.duration="duration"in c?+c.duration:1e3*Ve/("screenSpeed"in c?+c.screenSpeed/ce:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const lt=E!==B,Le=z!==I,We=!v.isPaddingEqual(H),nt=et=>dt=>{const Et=dt*Ve,on=1/Re(Et);et.zoom=1===dt?R:w+et.scaleZoom(on),lt&&(et.bearing=m.number(E,B,dt)),Le&&(et.pitch=m.number(I,z,dt)),We&&(et.interpolatePadding(O,H,dt),oe=et.centerPoint.add(ie));const Ut=1===dt?se:et.unproject(G.add(ne.mult(Ze(Et))).mult(on));return et.setLocationAtPoint(et.renderWorldCopies?Ut.wrap():Ut,oe),et._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(f),et};if(c.preloadOnly){const et=this._emulate(nt,c.duration,v);return this._preloadTiles(et),this}return this._zooming=!0,this._rotating=lt,this._pitching=Le,this._padding=We,this._prepareEase(f,!1),this._ease(nt(v),()=>this._afterEase(f),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,f)}if(!c){const v=this.handlers;v&&v.stop(!1)}return this}_ease(c,f,v){!1===v.animate||0===v.duration?(c(1),f()):(this._easeStart=m.exported.now(),this._easeOptions=v,this._onEaseFrame=c,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((m.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,f){c=m.wrap(c,-180,180);const v=Math.abs(c-f);return Math.abs(c-360-f)<v&&(c-=360),Math.abs(c+360-f)<v&&(c+=360),c}_normalizeCenter(c){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const v=c.lng-f.center.lng;c.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&m.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,f,v){const w=Math.ceil(15*f/1e3),E=[],I=c(v.clone());for(let O=0;O<=w;O++){const R=I(O/w);E.push(R.clone())}return E}}class jt{constructor(c={}){this.options=c,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const f=this.options&&this.options.compact;return this._map=c,this._container=wn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=wn("button","mapboxgl-ctrl-attrib-button",this._container),wn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=wn("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===f&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,f){const v=this._map._getUIString(`AttributionControl.${f}`);c.setAttribute("aria-label",v),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(c){const v=f.reduce((w,E,I)=>(E.value&&(w+=`${E.key}=${E.value}${I<f.length-1?"&":""}`),w),"?");c.href=`${m.config.FEEDBACK_URL}/${v}#${$t(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const f=this._map.style._sourceCaches;for(const w in f){const E=f[w];if(E.used){const I=E.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c.sort((w,E)=>w.length-E.length),c=c.filter((w,E)=>{for(let I=E+1;I<c.length;I++)if(c[I].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const v=c.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,c.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class i_{constructor(){m.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=wn("div","mapboxgl-ctrl");const f=wn("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const f in c){const v=c[f].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const f=c[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class r_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const f=++this._id;return this._queue.push({callback:c,id:f,cancelled:!1}),f}remove(c){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const w of v)if(w.id===c)return void(w.cancelled=!0)}run(c=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Hd(g,c,f){if(g=new m.LngLat(g.lng,g.lat),c){const v=new m.LngLat(g.lng-360,g.lat),w=new m.LngLat(g.lng+360,g.lat),E=360*Math.ceil(Math.abs(g.lng-f.center.lng)/360),I=f.locationPoint(g).distSqr(c),O=c.x<0||c.y<0||c.x>f.width||c.y>f.height;f.locationPoint(v).distSqr(c)<I&&(O||Math.abs(v.lng-f.center.lng)<E)?g=v:f.locationPoint(w).distSqr(c)<I&&(O||Math.abs(w.lng-f.center.lng)<E)&&(g=w)}for(;Math.abs(g.lng-f.center.lng)>180;){const v=f.locationPoint(g);if(v.x>=0&&v.y>=0&&v.x<=f.width&&v.y<=f.height)break;g.lng>f.center.lng?g.lng-=360:g.lng+=360}return g}const Au={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class zt extends m.Evented{constructor(c,f){if(super(),(c instanceof m.window.HTMLElement||f)&&(c=m.extend({element:c},f)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=wn("div");const w=41,E=27,I=Ur("svg",{display:"block",height:w*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${w}`},this._element),O=Ur("radialGradient",{id:"shadowGradient"},Ur("defs",{},I));Ur("stop",{offset:"10%","stop-opacity":.4},O),Ur("stop",{offset:"100%","stop-opacity":.05},O),Ur("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),Ur("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),Ur("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),Ur("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const v=this._element.classList;for(const w in Au)v.remove(`mapboxgl-marker-anchor-${w}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const f=c.code,v=c.charCode||c.keyCode;"Space"!==f&&"Enter"!==f&&32!==v&&13!==v||this.togglePopup()}_onMapClick(c){const f=c.originalEvent.target,v=this._element;this._popup&&(f===v||v.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,f=this._pos;if(!c||!f)return!1;const v=c.unproject(f),w=c.getFreeCameraOptions();if(!w.position)return!1;const E=w.position.toLngLat();return E.distanceTo(v)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const f=this._pos;if(!f||f.x<0||f.x>c.transform.width||f.y<0||f.y>c.transform.height)return void this._clearFadeTimer();const v=c.unproject(f);let w;c._showingGlobe()&&m.isLngLatBehindGlobe(c.transform,this._lngLat)?w=0:(w=1-c._queryFogOpacity(v),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${Au[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${f.x}px,${f.y}px)\n        `}_calculateXYTransform(){const c=this._pos,f=this._map,v=this.getPitchAlignment();if(!f||!c||"map"!==v)return"";if(!f._showingGlobe()){const R=f.getPitch();return R?`rotateX(${R}deg)`:""}const w=m.radToDeg(m.globeTiltAtLngLat(f.transform,this._lngLat)),E=c.sub(m.globeCenterToScreenPoint(f.transform)),I=Math.abs(E.x)+Math.abs(E.y);if(0===I)return"";const O=w/I;return`rotateX(${-E.y*O}deg) rotateY(${E.x*O}deg)`}_calculateZTransform(){const c=this._pos,f=this._map;if(!f||!c)return"";let v=0;const w=this.getRotationAlignment();if("map"===w)if(f._showingGlobe()){const E=f.project(new m.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=f.project(new m.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);v=m.radToDeg(Math.atan2(I.y,I.x))-90}else v=-f.getBearing();else if("horizon"===w){const E=m.smoothstep(4,6,f.getZoom()),I=m.globeCenterToScreenPoint(f.transform);I.y+=E*f.transform.height;const O=c.sub(I),R=m.radToDeg(Math.atan2(O.y,O.x));v=(R>90?R-270:R+90)*(1-E)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(c){m.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=Hd(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),!0===c?this._updateFrameId=m.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=m.Point.convert(c),this._update(),this}_onMove(c){const f=this._map;if(!f)return;const v=this._pointerdownPos,w=this._positionDelta;if(v&&w){if(!this._isDragging){const E=this._clickTolerance||f._clickTolerance;if(c.point.dist(v)<E)return;this._isDragging=!0}this._pos=c.point.sub(w),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new m.Event("dragend")),this._state="inactive"}_addDragHandler(c){const f=this._map,v=this._pos;f&&v&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(v),this._pointerdownPos=c.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const f=this._map;return f&&(c?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const o_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},s_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nm(g=new m.Point(0,0),c="bottom"){if("number"==typeof g){const f=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new m.Point(0,g);case"top-left":return new m.Point(f,f);case"top-right":return new m.Point(-f,f);case"bottom":return new m.Point(0,-g);case"bottom-left":return new m.Point(f,-f);case"bottom-right":return new m.Point(-f,-f);case"left":return new m.Point(g,0);case"right":return new m.Point(-g,0)}return new m.Point(0,0)}return g instanceof m.Point||Array.isArray(g)?m.Point.convert(g):m.Point.convert(g[c]||[0,0])}class a_{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const f=m.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,f,v){this._start=this.getValue(f),this._end=c,this._startTime=f,this._endTime=f+v}}const cv={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},uv={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},bc={showCompass:!0,showZoom:!0,visualizePitch:!1};class l_{constructor(c,f,v=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new Du({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,v&&(this.mousePitch=new Tu({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(c,f){this.mouseRotate.mousedown(c,f),this.mousePitch&&this.mousePitch.mousedown(c,f),bd()}move(c,f){const v=this.map,w=this.mouseRotate.mousemoveWindow(c,f),E=w&&w.bearingDelta;if(E&&v.setBearing(v.getBearing()+E),this.mousePitch){const I=this.mousePitch.mousemoveWindow(c,f),O=I&&I.pitchDelta;O&&v.setPitch(v.getPitch()+O)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ru(),m.window.removeEventListener("mousemove",this.mousemove),m.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(m.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),Ro(this.element,c)),m.window.addEventListener("mousemove",this.mousemove),m.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,Ro(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=Jl(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=Jl(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const c_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Gd={maxWidth:100,unit:"metric"},xf={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Pu={version:m.version,supported:oa,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:class extends tm{constructor(g){if(m.LivePerformanceUtils.mark(m.PerformanceMarkers.create),null!=(g=m.extend({},uv,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&m.isSafariWithAntialiasingBug(m.window)&&(g.antialias=!1,m.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Eu(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._useWebGL2=g.useWebGL2,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new r_,this._domRenderTaskQueue=new r_,this._controls=[],this._markers=[],this._popups=[],this._mapId=m.uniqueId(),this._locale=m.extend({},cv,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new a_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new m.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=m.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof m.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&m.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==m.window&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1),m.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),m.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Ha(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new sr("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,m.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new jt({customAttribution:g.customAttribution})),this._logoControl=new i_,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new m.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new m.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(g,c){if(void 0===c&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=g.onAdd(this);this._controls.push(g);const v=this._controlPositions[c];return-1!==c.indexOf("bottom")?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new m.Event("movestart",g)).fire(new m.Event("move",g)),this.fire(new m.Event("resize",g)),c&&this.fire(new m.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(m.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new m.Event("zoomstart")).fire(new m.Event("zoom")).fire(new m.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new m.Event("zoomstart")).fire(new m.Event("zoom")).fire(new m.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new m.Event("pitchstart")).fire(new m.Event("pitch")).fire(new m.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new m.Event("pitchstart")).fire(new m.Event("pitch")).fire(new m.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?m.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(c=>"auto"===c?m.window.navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,c=g.projection.name;let f;"globe"===c&&g.zoom>=m.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),f=!0):"mercator"===c&&g.zoom<m.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;if(c="globe"===g.name&&this.transform.zoom>=m.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(m.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(m.Point.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,f){if("mouseenter"===g||"mouseover"===g){let v=!1;const w=I=>{const O=c.filter(B=>this.getLayer(B)),R=O.length?this.queryRenderedFeatures(I.point,{layers:O}):[];R.length?v||(v=!0,f.call(this,new ar(g,this,I.originalEvent,{features:R}))):v=!1},E=()=>{v=!1};return{layers:new Set(c),listener:f,delegates:{mousemove:w,mouseout:E}}}if("mouseleave"===g||"mouseout"===g){let v=!1;const w=I=>{const O=c.filter(R=>this.getLayer(R));(O.length?this.queryRenderedFeatures(I.point,{layers:O}):[]).length?v=!0:v&&(v=!1,f.call(this,new ar(g,this,I.originalEvent)))},E=I=>{v&&(v=!1,f.call(this,new ar(g,this,I.originalEvent)))};return{layers:new Set(c),listener:f,delegates:{mousemove:w,mouseout:E}}}{const v=w=>{const E=c.filter(O=>this.getLayer(O)),I=E.length?this.queryRenderedFeatures(w.point,{layers:E}):[];I.length&&(w.features=I,f.call(this,w),delete w.features)};return{layers:new Set(c),listener:f,delegates:{[g]:v}}}}on(g,c,f){if(void 0===f)return super.on(g,c);Array.isArray(c)||(c=[c]);const v=this._createDelegatedListener(g,c,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(g,c,f){if(void 0===f)return super.once(g,c);Array.isArray(c)||(c=[c]);const v=this._createDelegatedListener(g,c,f);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(g,c,f){if(void 0===f)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);const v=(E,I)=>{if(E.size!==I.size)return!1;for(const O of E)if(!I.has(O))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[g]:void 0;return w&&(E=>{for(let I=0;I<E.length;I++){const O=E[I];if(O.listener===f&&v(O.layers,c)){for(const R in O.delegates)this.off(R,O.delegates[R]);return E.splice(I,1),this}}})(w),this}queryRenderedFeatures(g,c){return this.style?(void 0!==c||void 0===g||g instanceof m.Point||Array.isArray(g)||(c=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(g,c){return this.style.querySourceFeatures(g,c)}isPointOnSurface(g){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&m.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(m.Point.convert(g))}setStyle(g,c){return!1!==(c=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(null==c)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Ua(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ua(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if("string"==typeof g){const f=this._requestManager.normalizeStyleURL(g),v=this._requestManager.transformRequest(f,m.ResourceType.Style);m.getJSON(v,(w,E)=>{w?this.fire(new m.ErrorEvent(w)):E&&this._updateDiff(E,c)})}else"object"==typeof g&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(f){m.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(m.warnOnce("There is no style added to the map."),!1)}addSource(g,c){return this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const c in g){const f=g[c]._tiles;for(const v in f){const w=f[v];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}addSourceType(g,c,f){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,f)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,c,{pixelRatio:f=1,sdf:v=!1,stretchX:w,stretchY:E,content:I}={}){if(this._lazyInitEmptyStyle(),c instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&c instanceof m.window.ImageBitmap){const{width:O,height:R,data:B}=m.exported.getImageData(c);this.style.addImage(g,{data:new m.RGBAImage({width:O,height:R},B),pixelRatio:f,stretchX:w,stretchY:E,content:I,sdf:v,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:R}=c,B=c;this.style.addImage(g,{data:new m.RGBAImage({width:O,height:R},new Uint8Array(B.data)),pixelRatio:f,stretchX:w,stretchY:E,content:I,sdf:v,version:0,userImage:B}),B.onAdd&&B.onAdd(this,g)}}updateImage(g,c){const f=this.style.getImage(g);if(!f)return void this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=c instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&c instanceof m.window.ImageBitmap?m.exported.getImageData(c):c,{width:w,height:E}=v;void 0!==w&&void 0!==E?w===f.data.width&&E===f.data.height?(f.data.replace(v.data,!(c instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&c instanceof m.window.ImageBitmap)),this.style.updateImage(g,f)):this.fire(new m.ErrorEvent(new Error(`The width and height of the updated image (${w}, ${E})\n                must be that same as the previous version of the image\n                (${f.data.width}, ${f.data.height})`))):this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){m.getImage(this._requestManager.transformRequest(g,m.ResourceType.Image),(f,v)=>{c(f,v instanceof m.window.HTMLImageElement?m.exported.getImageData(v):v)})}listImages(){return this.style.listImages()}addLayer(g,c){return this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)}moveLayer(g,c){return this.style.moveLayer(g,c),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,c,f){return this.style.setLayerZoomRange(g,c,f),this._update(!0)}setFilter(g,c,f={}){return this.style.setFilter(g,c,f),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,c,f,v={}){return this.style.setPaintProperty(g,c,f,v),this._update(!0)}getPaintProperty(g,c){return this.style.getPaintProperty(g,c)}setLayoutProperty(g,c,f,v={}){return this.style.setLayoutProperty(g,c,f,v),this._update(!0)}getLayoutProperty(g,c){return this.style.getLayoutProperty(g,c)}setLight(g,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(m.LngLat.convert(g),this.transform):0}setFeatureState(g,c){return this.style.setFeatureState(g,c),this._update()}removeFeatureState(g,c){return this.style.removeFeatureState(g,c),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let f,v,w,E=this._container;for(;E&&(!v||!w);){const I=m.window.getComputedStyle(E).transform;I&&"none"!==I&&(f=I.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&"0"!==f[0]&&"1"!==f[0]&&(v=f[0]),f[3]&&"0"!==f[3]&&"1"!==f[3]&&(w=f[3])),E=E.parentElement}this._containerWidth=v?Math.abs(g/v):g,this._containerHeight=w?Math.abs(c/w):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=wn("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=wn("div","mapboxgl-canvas-container",g);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=wn("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=wn("div","mapboxgl-control-container",g),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{v[w]=wn("div",`mapboxgl-ctrl-${w}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const f=m.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(g),this._canvas.height=f*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);-1!==c&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const g=m.extend({},oa.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",g),f=c||this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);f?(this._useWebGL2&&!c&&m.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),m.storeAuthState(f,!0),this.painter=new Wi(f,this.transform,!!c),this.on("data",v=>{"source"===v.dataType&&this.painter.setTileLoadedFlag(!0)}),m.exported$1.testSupport(f)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;const f=this.painter.context.extTimerQuery,v=m.exported.now();if(this.listens("gpu-timing-frame")&&(c=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],m.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],m.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,R=this.transform.pitch,B=m.exported.now(),z=new m.EvaluationParameters(O,{now:B,fadeDuration:w,pitch:R,transition:this.style.getTransition()});this.style.update(z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const O=m.exported.now()-v;f.endQueryEXT(f.TIME_ELAPSED_EXT,c),setTimeout(()=>{const R=f.getQueryObjectEXT(c,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(c),this.fire(new m.Event("gpu-timing-frame",{cpuTime:O,gpuTime:R})),m.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){const O=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(O);this.fire(new m.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(O);this.fire(new m.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(I||this._repaint)this.triggerRepaint();else{const O=!this.isMoving()&&this.loaded();if(O&&(E=this._updateAverageElevation(v,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new m.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new m.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,m.LivePerformanceUtils.mark(m.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&m.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const f=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&f(0);if((c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=g;const I=Math.abs(v-w);if(I>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(w),f(w);this._averageElevation.easeTo(w,g,300)}else if(I>1e-4)return this._averageElevation.jumpTo(w),f(w)}return!!this._averageElevation.isEasing(g)&&f(this._averageElevation.getValue(g))}_authenticate(){m.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===m.AUTH_ERR_MSG||401===g.status)){const c=this.painter.context.gl;m.storeAuthState(c,!1),this._logoControl instanceof i_&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new m.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),m.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const f=this.painter.context.gl,v=f.createFramebuffer();function w(E){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,E,0);const I=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,I),I}return f.bindFramebuffer(f.FRAMEBUFFER,v),this._canvasPixelComparison(w(g),c.canvasCopies.map(w),c.timeStamps)}_canvasPixelComparison(g,c,f){let v=f[1]-f[0];const w=g.length/4;for(let E=0;E<c.length;E++){const I=c[E];let O=0;for(let R=0;R<I.length;R+=4)I[R]===g[R]&&I[R+1]===g[R+1]&&I[R+2]===g[R+2]&&I[R+3]===g[R+3]&&(O+=1);v+=(f[E+2]-f[E+1])*(1-O/w)}return v}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==m.window&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1),m.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),m.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new m.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=m.exported.frame(c=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return m.asyncAll(c,(f,v)=>f._preloadTiles(g,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===m.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){m.setCacheLimits(g,c)}get version(){return m.version}},NavigationControl:class{constructor(g){this.options=m.extend({},bc,g),this._container=wn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),wn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),wn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:c}):f.resetNorth({},{originalEvent:c}))}),this._compassIcon=wn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),f=c===g.getMaxZoom(),v=c===g.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new l_(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const f=wn("button",g,this._container);return f.type="button",f.addEventListener("click",c),f}_setButtonTitle(g,c){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",f),g.firstElementChild&&g.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends m.Evented{constructor(g){super(),this.options=m.extend({geolocation:m.window.navigator.geolocation},c_,g),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Mu(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=wn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,g(f)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==m.window.navigator.permissions?m.window.navigator.permissions.query({name:"geolocation"}).then(f=>c("denied"!==f.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),f=g.coords;return!!c&&(f.longitude<c.getWest()||f.longitude>c.getEast()||f.latitude<c.getSouth()||f.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",g)),this._finish()}}_updateCamera(g){const c=new m.LngLat(g.coords.longitude,g.coords.latitude),f=g.coords.accuracy,v=this._map.getBearing(),w=m.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(f),w,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new m.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=m.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,f=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=wn("button","mapboxgl-ctrl-geolocate",this._container),wn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=wn("div","mapboxgl-user-location"),this._dotElement.appendChild(wn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(wn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new zt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=wn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new m.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{m.window.addEventListener("ondeviceorientationabsolute"in m.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==m.window.DeviceMotionEvent&&"function"==typeof m.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),m.window.removeEventListener("deviceorientation",this._onDeviceOrientation),m.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:jt,ScaleControl:class{constructor(g){this.options=m.extend({},Gd,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),m.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,f=c._containerHeight/2,v=c._containerWidth/2-g/2,w=c.unproject([v,f]),E=c.unproject([v+g,f]),I=w.distanceTo(E);if("imperial"===this.options.unit){const O=3.2808*I;O>5280?this._setScale(g,O/5280,"mile"):this._setScale(g,O,"foot")}else"nautical"===this.options.unit?this._setScale(g,I/1852,"nautical-mile"):I>=1e3?this._setScale(g,I/1e3,"kilometer"):this._setScale(g,I,"meter")}_setScale(g,c,f){this._map._requestDomTask(()=>{const v=function(E){const I=Math.pow(10,`${Math.floor(E)}`.length-1);let O=E/I;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(R){const B=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*B)/B}(O),I*O}(c),w=v/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==f?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(v):`${v}&nbsp;${xf[f]}`,this._container.style.width=g*w+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=wn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof m.window.HTMLElement?this._container=g.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in m.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=wn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!m.window.document.fullscreenEnabled&&!m.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=wn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);wn("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(m.window.document.fullscreenElement||m.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends m.Evented{constructor(g){super(),this.options=m.extend(Object.create(o_),g),m.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new m.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new m.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=m.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(m.window.document.createTextNode(g))}setHTML(g){const c=m.window.document.createDocumentFragment(),f=m.window.document.createElement("body");let v;for(f.innerHTML=g;v=f.firstChild,v;)c.appendChild(v);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=wn("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const f=this._closeButton=wn("button","mapboxgl-popup-close-button",c);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,f=this._container,v=this._pos;if(!c||!f||!v)return"bottom";const w=f.offsetWidth,E=f.offsetHeight,I=v.x<w/2,O=v.x>c.transform.width-w/2;if(v.y+g<E)return I?"top-left":O?"top-right":"top";if(v.y>c.transform.height-E){if(I)return"bottom-left";if(O)return"bottom-right"}return I?"left":O?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,f=this._content;if(!c||!this._lngLat&&!this._trackPointer||!f)return;let v=this._container;if(v||(v=this._container=wn("div","mapboxgl-popup",c.getContainer()),this._tip=wn("div","mapboxgl-popup-tip",v),v.appendChild(f)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Hd(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const w=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),E=nm(this.options.offset),I=this._anchor=this._getAnchor(E.y),O=nm(this.options.offset,I),R=w.add(O).round();c._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${Au[I]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&c._showingGlobe()){const w=m.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(s_);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:zt,Style:Ua,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,FreeCameraOptions:Qn,Evented:m.Evented,config:m.config,prewarm:function(){cu().acquire(aa)},clearPrewarmedResources:function(){const g=ao;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(aa),ao=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(g){m.config.ACCESS_TOKEN=g},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(g){m.config.API_URL=g},get workerCount(){return Wr.workerCount},set workerCount(g){Wr.workerCount=g},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){m.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){m.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:m.exported.setNow,restoreNow:m.exported.restoreNow};return Pu}),ni}()}},K0=>{K0(K0.s=906)}]);